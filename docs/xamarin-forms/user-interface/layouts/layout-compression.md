---
title: Сжатие макета
description: Сжатие макета позволяет удалить указанные макеты из визуального дерева с целью повышения скорости отрисовки страниц. В этой статье объясняется, как включить сжатие макета и необходимые преимущества для использования.
ms.prod: xamarin
ms.assetid: da9e1b26-9d31-4762-94c3-4039f306b7f2
ms.technology: xamarin-forms
author: davidbritch
ms.author: dabritch
ms.date: 12/13/2017
ms.openlocfilehash: ba9be51daa32be1034e2bdfafafe80c45d00d83c
ms.sourcegitcommit: 6e955f6851794d58334d41f7a550d93a47e834d2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/12/2018
ms.locfileid: "38995236"
---
# <a name="layout-compression"></a>Сжатие макета

_Сжатие макета позволяет удалить указанные макеты из визуального дерева с целью повышения скорости отрисовки страниц. В этой статье объясняется, как включить сжатие макета и необходимые преимущества для использования._

## <a name="overview"></a>Обзор

Xamarin.Forms выполняет компоновку, используя два ряда рекурсивных вызовов методов:

- Макет начинается в верхней части визуального дерева со страницей, и проходит все ветви визуального дерева вплоть до охватывающих все визуальные элементы на странице. Для изменения размеров и положения их дочерние элементы относительно сами отвечают элементы, которые являются родительскими для других элементов.
- Недействительности — это процесс, по которому изменение элемента на странице запускает новый цикл макета. Элементы считаются недопустимыми, если они больше не имеют правильный размер или положение. Каждый элемент в визуальном дереве, имеющий дочерние элементы оповещение при изменении размеров одного из его дочерних элементов. Таким образом изменение размера элемента в визуальном дереве может привести к изменения, которые ripple вверх по дереву.

Дополнительные сведения о Xamarin.Forms выполнение макет, см. в разделе [Создание пользовательского макета](~/xamarin-forms/user-interface/layouts/custom.md).

В результате процесса макета — это иерархия собственных элементов управления. Тем не менее эта иерархия включает в себя дополнительный контейнер модулей подготовки отчетов и программы-оболочки для модулей подготовки отчетов платформы, дальнейшей подобных представление иерархии вложенности. Чем глубже уровень вложенности, тем больше объем работы с Xamarin.Forms для выполнения для отображения страницы. Для сложных макетов иерархии представлений может быть глубокого и широкой, с несколькими уровнями вложенности.

Например рассмотрим следующую кнопку из примера приложения для входа в Facebook.

![](layout-compression-images/facebook-button.png "Кнопка Facebook")

Эта кнопка указывается как пользовательский элемент управления со следующей иерархией представления XAML:

```xaml
<ContentView ...>
    <StackLayout>
        <StackLayout ...>
            <AbsoluteLayout ...>
                <Button ... />    
                <Image ... />
                <Image ... />
                <BoxView ... />
                <Label ... />
                <Button ... />
            </AbsoluteLayout>
        </StackLayout>
        <Label ... />
    </StackLayout>    
</ContentView>
```

Можно проверить в итоге иерархия вложенное представление с [Xamarin Inspector](~/tools/inspector/index.md). В Android вложенное представление иерархии содержит 17 представления:

![](layout-compression-images/no-compression.png "Просмотр иерархии для кнопки \"Facebook\"")

Сжатие макета, который доступен для приложений Xamarin.Forms на платформах iOS и Android, нацелена на плоскую структуру представления, вложения, удаляя указанные макеты из визуального дерева, что может повысить производительность отрисовки страницы. Увеличение производительности, который доставляется зависит от сложности страницы, версии используемой операционной системы и устройства, на котором работает приложение. Однако наиболее заметное повышение производительности будет наблюдаться на старых устройствах.

> [!NOTE]
> Хотя эта статья посвящена результаты применения сжатия макета в Android, это одинаково применимы к iOS.

## <a name="layout-compression"></a>Сжатие макета

Сжатие макета в XAML, можно включить, задав `CompressedLayout.IsHeadless` вложенное свойство, чтобы `true` макет класса:

```xaml
<StackLayout CompressedLayout.IsHeadless="true">
  ...
</StackLayout>   
```

Кроме того, его можно включить в C#, указав экземпляр макета в качестве первого аргумента `CompressedLayout.SetIsHeadless` метод:

```csharp
CompressedLayout.SetIsHeadless(stackLayout, true);
```

> [!IMPORTANT]
> Поскольку сжатие макета позволяет удалить макет из визуального дерева, не подходит для макетов, имеют внешний вид, или, получающие сенсорный ввод. Таким образом, макеты, задать [ `VisualElement` ](xref:Xamarin.Forms.VisualElement) свойства (такие как [ `BackgroundColor` ](xref:Xamarin.Forms.VisualElement.BackgroundColor), [ `IsVisible` ](xref:Xamarin.Forms.VisualElement.IsVisible), [ `Rotation` ](xref:Xamarin.Forms.VisualElement.Rotation), [ `Scale` ](xref:Xamarin.Forms.VisualElement.Scale), [ `TranslationX` ](xref:Xamarin.Forms.VisualElement.TranslationX) и [ `TranslationY` ](xref:Xamarin.Forms.VisualElement.TranslationY) или, которые принимают жесты, не являются кандидатами для макета сжатие. Тем не менее Включение сжатия макета в макете, задает внешний вид свойства либо, принимающий жесты, не приведет к ошибке сборки или времени выполнения. Вместо этого применяется сжатие макета и внешний вид свойства и распознавания жестов, выполняться не будут.

Для кнопки "Facebook" можно включить сжатие макета в классах три макета:

```xaml
<StackLayout CompressedLayout.IsHeadless="true">
    <StackLayout CompressedLayout.IsHeadless="true" ...>
        <AbsoluteLayout CompressedLayout.IsHeadless="true" ...>
            ...
        </AbsoluteLayout>
    </StackLayout>
    ...
</StackLayout>  
```

В Android в результате вложенное представление иерархии 14 представлений:

![](layout-compression-images/layout-compression.png "Просмотр иерархии для кнопки Facebook с использованием сжатия макета")

По сравнению с исходной иерархии вложенное представление 17 представлений, это значение представляет снижением количеством просмотров % 17. Хотя это сокращение может возникнуть незначащие, сокращения представления по всей страницы может быть более значительными.

### <a name="fast-renderers"></a>Быстрые отрисовщики

Быстрые отрисовщики сокращают затраты на отрисовку элементов управления Xamarin.Forms на Android путем сведения в итоге иерархия собственного представления. Это еще больше повышает производительность, создав меньше объектов, что в свою очередь приводит в менее сложное визуальное дерево, а также сокращается использование памяти. Дополнительные сведения о быстрых отрисовщиков, см. в разделе [быстрые Отрисовщики](~/xamarin-forms/internals/fast-renderers.md).

Для кнопки Facebook в приложении-примере объединение сжатие макета и быстрые отрисовщики создает является вложенной иерархией 8 представлений:

![](layout-compression-images/layout-compression-with-fast-renderers.png "Просмотр иерархии для кнопки Facebook с сжатие макета и быстрые Отрисовщики")

По сравнению с исходной иерархии вложенное представление 17 представлений, представляет собой сокращение количества 52%.

Пример приложения содержит страницы, извлеченные из реальных приложениях. Без сжатия макета и быстрые отрисовщики страницы создает является вложенной иерархией 130 представлений в Android. Включение быстрых отрисовщиков и сжатие макета в классах соответствующую компоновку уменьшает иерархии вложенное представление с 70 представлениями, сокращение количества 46%.

## <a name="summary"></a>Сводка

Сжатие макета позволяет удалить указанные макеты из визуального дерева с целью повышения скорости отрисовки страниц. В этом случае рост производительности зависит от сложности страницы, версии используемой операционной системы и устройства, на котором выполняется приложение. Однако наиболее заметное повышение производительности будет наблюдаться на старых устройствах.


## <a name="related-links"></a>Связанные ссылки

- [Создание пользовательского макета](~/xamarin-forms/user-interface/layouts/custom.md)
- [Быстрые отрисовщики](~/xamarin-forms/internals/fast-renderers.md)
- [LayoutCompression (пример)](https://developer.xamarin.com/samples/xamarin-forms/userinterface/layoutcompression/)
