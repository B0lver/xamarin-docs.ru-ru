---
title: Контейнерного Микрослужбами
description: В этой главе объясняется, как использовать микрослужбами и контейнеры для построения гибкие, масштабируемые и надежные современных облачных приложений.
ms.prod: xamarin
ms.assetid: 5872ad92-04e0-4f1a-9691-79d5602f5683
ms.technology: xamarin-forms
author: davidbritch
ms.author: dabritch
ms.date: 08/07/2017
ms.openlocfilehash: 33be84bc17f72c8b70d117a0742b001f1f763d3d
ms.sourcegitcommit: 66682dd8e93c0e4f5dee69f32b5fc5a96443e307
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/08/2018
ms.locfileid: "35242265"
---
# <a name="containerized-microservices"></a>Контейнерного Микрослужбами

Разработка приложений клиент сервер привела к сосредоточиться на создании многоуровневых приложений, использование специальных технологий на каждом уровне. Такие приложения часто называют *монолитные* приложений и являются упакованные на оборудовании, предварительно масштабируется для пиковых нагрузок. Данный подход к разработке главных недостатка являются тесную связь между компонентами в рамках каждого уровня, что невозможно легко масштабируется отдельных компонентов, а также затраты на проверку. Простое обновление может иметь непредвиденные последствия на остальных уровня, и поэтому его уровня целиком тестировать повторно и повторного развертывания требует изменений в компонент приложения.

Особенно о в возрасте облаке, что отдельные компоненты не могут быть легко масштабируется. Монолитные приложения содержит специфические для домена функциональные возможности и обычно делится на функциональные уровни, например переднего плана, бизнес-логики и хранилища данных. Монолитные приложения масштабируется путем клонирования всего приложения на нескольких компьютерах, как показано на рисунке 8-1.

![](containerized-microservices-images/monolithicapp.png "Подход для масштабирования монолитные приложения")

**Рис. 8-1**: монолитные приложения масштабирование подход

## <a name="microservices"></a>Микрослужбами

Микрослужбами предлагают другой подход для разработки и развертывания приложений, подход, который подходит для требования к надежности современных облачных приложений, масштабирования и гибкости. Приложение микрослужбами разлагаются на независимые компоненты, которые вместе работают над достижением общей функциональности приложения. Термин микрослужбу подчеркивает, должен составлять приложения из службы достаточно мал, чтобы отразить независимых проблем, чтобы каждый микрослужбу реализует одной функции. Кроме того каждый микрослужбу имеет четко определенных контрактов, чтобы другие микрослужбами могли обмениваться данными и обмениваться данными. Типичные примеры микрослужбами включают покупательская корзина, складских запасах обработки, подсистемы и обработки платежей.

Микрослужбами можно распределить независимо друг от друга, по сравнению с очень больших монолитные приложений, которые масштабируются в соответствии друг с другом. Это означает, что определенной функциональной области, которого требуется больше обработки питания или сети пропускной способности для поддержки запросу, можно масштабировать вместо без необходимости масштабирования другие области приложения. На рисунке 8-2 показано этот подход, где микрослужбами развертывания и масштабирования независимо друг от друга, создание экземпляров служб на нескольких компьютерах.

![](containerized-microservices-images/microservicesapp.png "Подход масштабирования приложения Микрослужбами")

**Рис. 8-2**: масштабирование подход приложения Микрослужбами

Микрослужбу масштабирования может быть практически мгновенно, что позволяет приложению адаптироваться к изменяющимся загружает. Например один микрослужбу в сети функциональные возможности приложения может быть только микрослужбу в приложении, которое требуется для масштабирования для обработки дополнительных входящего трафика.

Классическая модель для масштабируемость приложения является уровень балансировки нагрузки без сохранения состояния, с общей внешнего хранилища данных для хранения постоянных данных. С отслеживанием состояния микрослужбами управлять собственные постоянных данных, которые обычно запоминался локально на серверах, на которых они размещаются, во избежание переполнения сетевого доступа и сложности между службами операций. Это обеспечивает быструю обработку возможных данных и позволяет избавиться от необходимости для кэширования систем. Кроме того масштабируемый с отслеживанием состояния микрослужбами обычно секционирования данных между их экземпляры, для управления размером и передача пропускная способность превышении которого один сервер может поддерживать.

Микрослужбами также поддерживает независимые обновления. Слабая связь между микрослужбами обеспечивает развитие быстрое и надежное приложение. Своей природе независимые, распределенных поддерживает последовательного обновления, когда будет обновлять только подмножество экземпляров одного микрослужбу в любой момент времени. Таким образом при обнаружении проблемы, дефектный обновления может быть выполнен откат, после чего обновить все экземпляры с ошибочного кода или конфигурации. Аналогично микрослужбами обычно используют управление версиями, чтобы клиенты увидят согласованность версий обновления применены, независимо от того, какие микрослужбу передаваемых экземпляра с.

Таким образом микрослужбу приложения имеют много преимуществ над монолитные приложения:

-   Каждый микрослужбу относительно небольшой, простую в управлении развития.
-   Каждый микрослужбу разработки и развертывания, независимо от других служб.
-   Каждый микрослужбу может быть масштабирован независимо друг от друга. Например службы каталога или службе корзины для покупок может потребоваться более одного порядка сортировки службы быть масштабирован. Таким образом полученный инфраструктуры более эффективно потреблять ресурсы при горизонтального масштабирования.
-   Каждый микрослужбу изолирует все проблемы. Если в службе имеется проблема службы только влияет. Другие службы могут продолжать обрабатывать запросы.
-   Каждый микрослужбу можно использовать новейшие технологии. Поскольку микрослужбами являются автономными и выполнения side-by-side, последних технологий и платформ можно использовать, вместо того чтобы использовать старой платформе, которая может использоваться приложением монолитные нажимать.

Тем не менее это решение на основе микрослужбу также имеет потенциальные недостатки:

-   Выбор способа секционирования приложения в микрослужбами может оказаться сложной задачей, как каждый микрослужбу должно быть полностью автономными, end-to-end, включая ответственность за его источники данных.
-   Разработчики должны реализовывать обмен данными между службами, что увеличивает сложность и задержка приложения.
-   Атомарные транзакции между несколькими микрослужбами обычно недоступны. Таким образом бизнес-требования должны поддерживать окончательной согласованности между микрослужбами.
-   В рабочей среде нет сложности при развертывании и управлении системы скомпрометированы независимых служб.
-   Прямая связь клиента микрослужбу может усложнить рефакторинг контракты микрослужбами. Например со временем как система секционируется на службы может потребоваться изменение. Одна служба может разбить на две или несколько служб, и может объединить две службы. Когда клиенты взаимодействуют напрямую с микрослужбами, этой оптимизации работы могут нарушить совместимость с приложениями клиента.

## <a name="containerization"></a>Контейнеризация

Создание контейнеров — это подход к разработке программного обеспечения, в котором приложение и его с версиями набор зависимостей, а также его конфигурации среды абстрагированы как файлы манифеста развертывания, объединенных в один пакет как образ контейнера, как единое целое, и операционная система развернута.

Контейнер — это изолированная, ресурсов управляемой и переносимая операционная среда, где приложение может работать, не касаясь ресурсам другие контейнеры, или узел. Таким образом контейнер выглядит и действует как недавно установленные физический компьютер или виртуальная машина.

Есть большое сходство между контейнерами и виртуальных машин, как показано на рисунке 8-3.

![](containerized-microservices-images/containersvsvirtualmachines.png "Подход масштабирования приложения Микрослужбами")

**Рис. 8-3**: сравнение виртуальных машин и контейнеров

Контейнер операционной системой, содержит файловую систему и может осуществляться по сети, как если бы он был физической или виртуальной машины. Тем не менее технологии и основные понятия, используемые контейнерами сильно отличаются от виртуальных машин. Виртуальные машины включают приложения и необходимые зависимости, а также полной операционной системы. Контейнеры включают приложения и его зависимостей, но совместно использовать операционной системы с помощью других контейнеров, выполняющихся на операционная система узла (помимо контейнеры Hyper-V, которые выполняются в специальной виртуальной машине на контейнер) в качестве изолированных процессах. Таким образом контейнеры совместного использования ресурсов и обычно требуют меньше ресурсов, чем виртуальные машины.

Преимуществом контейнера ориентированный подход разработки и развертывания является, он позволяет избежать проблем, возникающие в среде несогласованные параметры настройки и проблем, которые поставляются с их. Кроме того контейнеры позволяют функциональность увеличение скорости работы приложения путем создания экземпляров новых контейнеров, при необходимости.

Ниже перечислены основные понятия, при создании и работа с контейнерами

-   Узел контейнера: Физической или виртуальной машины настроен на узле контейнеров. На узле контейнера работает один или несколько контейнеров.
-   Образ контейнера: Изображение состоит из объединения друг над другом многоуровневый файловые системы и является основой для контейнера. Изображение не имеет состояния, и он не изменяется при его развертывании в различных средах.
-   Контейнер: Контейнер — это экземпляр среды выполнения, изображения.
-   Образ ОС контейнера: Контейнеры развертываются из образов. Образ ОС контейнера — это первый из возможного множества слоев образа, составляющих контейнер. В операционной системе контейнера является постоянным и не может изменяться.
-   Репозиторий контейнера: Каждый раз создается образ контейнера, образа и его зависимости сохраняются в локальном репозитории. Эти образы могут выполняться много раз на узле контейнера. Образы контейнеров могут также храниться в открытом или закрытом реестре, таких как [Docker Hub](https://hub.docker.com/), после чего они могут использоваться в другой контейнер узлах.

Все более предприятий внедряют контейнеров при реализации микрослужбу приложений на основе и Docker стала реализация стандартный контейнер, принята большинства программных платформ и поставщиков облака.

Приложение ссылку eShopOnContainers использует Docker для размещения четырех контейнерного микрослужбами серверной части, как показано на рисунке 8-4.

![](containerized-microservices-images/microservicesarchitecture.png "eShopOnContainers ссылки микрослужбами серверной части приложения")

**Рис. 8-4**: eShopOnContainers ссылки микрослужбами серверной части приложения

Архитектура внутренних служб в приложении ссылку разлагаются на несколько автономных подсистем в форме совместной микрослужбами и контейнеров. Каждый микрослужбу предоставляет одну область функциональных возможностей: это служба удостоверений, службы каталога, порядка сортировки службы и службы корзины.

Каждый микрослужбу имеет собственную базу данных, позволяя им быть полностью отделены от других микрослужбами. При необходимости, согласованность между базами данных различных микрослужбами достигается с помощью события уровня приложения. Дополнительные сведения см. в разделе [связи между Микрослужбами](#communication_between_microservices).

Дополнительные сведения о приложении ссылок см. в разделе [Микрослужбами .NET: архитектура контейнерных приложений .NET](https://aka.ms/microservicesebook).

<a name="communication_between_client_and_microservices" />

## <a name="communication-between-client-and-microservices"></a>Обмен данными между клиентом и Микрослужбами

Мобильное приложение eShopOnContainers взаимодействует с контейнерного микрослужбами серверной части с помощью *направить клиента к микрослужбу* взаимодействия, как показано на рисунке 8-5.

![](containerized-microservices-images/directclienttomicroservicecommunication.png "Подход масштабирования приложения Микрослужбами")

**Рис. 8-5**: прямое взаимодействие клиента микрослужбу

С прямой обмен данными клиента микрослужбу мобильное приложение выполняет запросы к каждой микрослужбу напрямую через общедоступную конечную точку с другим портом TCP на микрослужбы. В рабочей среде конечная точка будет обычно сопоставляются с микрослужбу балансировки нагрузки. это распределение запросов между доступных экземпляров.

> [!TIP]
> Рассмотрите возможность использования API взаимодействия шлюза. Прямая связь клиента микрослужбу может иметь недостатки при построении больших и сложных микрослужбу приложение на основе, но более подходит для небольших приложений. При разработке больших микрослужбу на базе приложения с десятками микрослужбами, рассмотрите возможность использования API взаимодействия шлюза. Дополнительные сведения см. в разделе [Микрослужбами .NET: архитектура контейнерных приложений .NET](https://aka.ms/microservicesebook).

<a name="communication_between_microservices" />

## <a name="communication-between-microservices"></a>Обмен данными между Микрослужбами

Приложения на основе микрослужбами является распределенной системе может работать на нескольких компьютерах. Обычно каждый экземпляр службы — это процесс. Таким образом службы должны взаимодействовать, используя протокол межпроцессного взаимодействия, таких как HTTP, TCP, Advanced Message Queuing Protocol (AMQP) или двоичные протоколы, в зависимости от характера каждой службы.

Два обычных подхода к микрослужбу микрослужбу связи — это REST связь, основанная на HTTP, при запросе данных и упрощенных асинхронный обмен сообщениями при взаимодействии между микрослужбами несколько обновлений.

Асинхронного обмена сообщениями на основе событиями взаимодействия важно при распространении изменений через несколько микрослужбами. При таком подходе микрослужбу публикует события каких-либо заметных происходит, например, при обновлении бизнес-сущности. Другие микрослужбами подписываться на эти события. Затем при получении события микрослужбу обновляет свои собственные бизнес-сущности, которые в свою очередь может привести к дополнительные события при публикации. Это публикации подписки функции обычно достигается с помощью шины событий.

Шина событий позволяет публикация-подписка на обмен данными между микрослужбами, не требуя компоненты, которые необходимо явно учитывает друг от друга, как показано на рисунке 8-6.

![](containerized-microservices-images/eventbus.png "Публикация и подписка с шиной событий")

**Рис. 8-6:** публикации подписки с шиной событий

С точки зрения приложения шины событие является просто публикации-подписки через интерфейс канала. Тем не менее можно изменять способ реализации события шины. Например использовать реализацию события шины RabbitMQ, служебную шину Azure или шины другие службы, например NServiceBus и MassTransit. Рис. 8-7 показано, как шине событий в приложении eShopOnContainers ссылки.

![](containerized-microservices-images/microservicesarchitecturewitheventbus.png "Асинхронное взаимодействие с событиями в приложении ссылку")

**Рис. 8-7:** асинхронной связи с событиями в приложении ссылку

Шина событие eShopOnContainers, реализовано с помощью RabbitMQ, предоставляет один ко многим асинхронной публикации подписки функциональные возможности. Это означает, что после публикации при возникновении события, может быть несколько подписчиков, прослушивание для одного события. Данная связь показана на рисунке 8 – 9.

![](containerized-microservices-images/eventdrivencommunication.png "Один ко многим связи")

**На рисунке 8 – 9**: один ко многим связи

Этот подход один ко многим связи использует события для реализации бизнес-транзакций, которые охватывают несколько служб, обеспечивая окончательной согласованности между службами. Окончательное согласованность транзакций состоит из ряда распределенных шагов. Таким образом когда микрослужбу профиль пользователя получает команду UpdateUser, обновляет сведения о пользователе в своей базе данных и публикует UserUpdated событий для событий шины. Микрослужбу корзины и порядка сортировки микрослужбу подписаны на получить это событие и в ответ обновление сведений о покупателей в соответствующие базы данных.

> [!NOTE]
> Шина событие eShopOnContainers, реализовано с помощью RabbitMQ, предназначен для использования только в качестве эксперимента. Для рабочих систем шины реализации альтернативных событий должны быть рассмотрены.

Сведения о реализации канала событий см. в разделе [Микрослужбами .NET: архитектура контейнерных приложений .NET](https://aka.ms/microservicesebook).

## <a name="summary"></a>Сводка

Микрослужбами предлагают подходом к разработке приложений и развертывания, который подходит для современных облачных приложений требованиям гибкость, масштабирования и надежность. Одним из основных преимуществ микрослужбами заключается, они могут быть масштабирован независимо друг от друга, это означает, что определенной функциональной области можно масштабировать, требует больше обработки питания или сети пропускной способности для поддержки запросу, без без необходимости масштабирования области приложение, которое не сталкиваются с повышением спроса.

Контейнер — это изолированная, ресурсов управляемой и переносимая операционная среда, где приложение может работать, не касаясь ресурсам другие контейнеры, или узел. Все более предприятий внедряют контейнеров при реализации микрослужбу приложений на основе и Docker стала реализация стандартный контейнер, принята большинства программных платформ и поставщиков облака.


## <a name="related-links"></a>Связанные ссылки

- [Загрузить электронную книгу (2 МБ в формате PDF)](https://aka.ms/xamarinpatternsebook)
- [eShopOnContainers (GitHub) (пример)](https://github.com/dotnet-architecture/eShopOnContainers)
