---
title: Authenticate RESTful Веб-службы
description: Базовая аутентификация предоставляет доступ к ресурсам только тем клиентам, которые имеют правильные учетные данные. В этой статье объясняется, как использовать базовую аутентификацию для защиты доступа к ресурсам веб-службы RESTful.
ms.prod: xamarin
ms.assetid: 7B5FFDC4-F2AA-4B12-A30A-1DACC7FECBF1
ms.technology: xamarin-forms
author: davidbritch
ms.author: dabritch
ms.date: 01/22/2018
ms.openlocfilehash: 65606b72c3944809a09b8c70b9cdbb5524e0f856
ms.sourcegitcommit: 2a8eb8bce427e72d4e7edd06ce432e19f17dcdd7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2020
ms.locfileid: "80388594"
---
# <a name="authenticate-a-restful-web-service"></a>Authenticate RESTful Веб-службы

_HTTP поддерживает использование нескольких механизмов аутентификации для контроля доступа к ресурсам. Базовая аутентификация предоставляет доступ к ресурсам только тем клиентам, которые имеют правильные учетные данные. В этой статье показано, как использовать базовую аутентификацию для защиты доступа к ресурсам веб-службы RESTful._

> [!NOTE]
> В iOS 9 и больше, App Transport Security (ATS) обеспечивает безопасные соединения между интернет-ресурсами (например, сервером бэк-энда приложения) и приложением, тем самым предотвращая случайное раскрытие конфиденциальной информации. Поскольку ATS включен по умолчанию в приложениях, созданных для iOS 9, все соединения будут подпадать под требования безопасности ATS. Если соединения не отвечают этим требованиям, они потерпят неудачу, за исключением.
> ATS может быть исключена, если невозможно `HTTPS` использовать протокол и безопасную связь для интернет-ресурсов. Это может быть достигнуто путем обновления файла **Info.plist** приложения. Для получения дополнительной [информации см.](~/ios/app-fundamentals/ats.md)

## <a name="authenticating-users-over-http"></a>Проверка подлинности пользователей через HTTP

Базовая аутентификация является простейшым механизмом аутентификации, поддерживаемым HTTP, и включает в себя отправку клиентом имени пользователя и пароля в виде незашифрованного закодированного текста base64. Процесс создания моментальных снимков хранилища состоит из следующих этапов:

- Если веб-служба получает запрос на защищенный ресурс, она отклоняет запрос с кодом состояния HTTP 401 (доступ отклонен) и устанавливает заголовок ответа WWW-Authenticate, как показано на следующей диаграмме:

![](rest-images/basic-authentication-fail.png "Basic Authentication Failing")

- Если веб-служба получает запрос на защищенный `Authorization` ресурс, а заголовок правильно настроен, веб-служба отвечает кодом состояния HTTP 200, который указывает, что запрос выполнен и что запрашиваемая информация находится в ответе. Этот сценарий отображается на следующей диаграмме:

![](rest-images/basic-authentication-success.png "Basic Authentication Succeeding")

> [!NOTE]
> Базовая аутентификация должна использоваться только при подключении HTTPS. При использовании в подключении HTTP `Authorization` заголовок может быть легко расшифрован, если трафик HTTP захвачен злоумышленником.

## <a name="specifying-basic-authentication-in-a-web-request"></a>Определение базовой аутентификации в веб-запросе

Использование базовой аутентификации определяется следующим образом:

1. Строка "Основные" добавляется в `Authorization` заголовок запроса.
1. Имя пользователя и пароль объединяются в строку с форматом "имя пользователя: пароль", который `Authorization` затем base64 кодируется и добавляется в заголовок запроса.

Таким образом, с именем пользователя 'XamarinUser' и паролем 'XamarinPassword', заголовок становится:

```csharp
Authorization: Basic WGFtYXJpblVzZXI6WGFtYXJpblBhc3N3b3Jk
```

Класс `HttpClient` может установить значение `Authorization` заголовка на свойстве. `HttpClient.DefaultRequestHeaders.Authorization` Поскольку `HttpClient` экземпляр существует в `Authorization` нескольких запросах, заголовок должен быть установлен только один раз, а не при каждом запросе, как показано в следующем примере кода:

```csharp
public class RestService : IRestService
{
  HttpClient _client;
  ...

  public RestService ()
  {
    var authData = string.Format ("{0}:{1}", Constants.Username, Constants.Password);
    var authHeaderValue = Convert.ToBase64String (Encoding.UTF8.GetBytes (authData));

    _client = new HttpClient ();
    _client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue ("Basic", authHeaderValue);
  }
  ...
}
```

Затем, когда запрос сделан на операцию веб-службы, запрос подписывается с `Authorization` заголовком, указывая, имеет ли пользователь разрешение на вызвать операцию.

> [!IMPORTANT]
> Хотя этот код хранит учетные данные как константы, они не должны храниться в небезопасном формате в опубликованном приложении.

## <a name="processing-the-authorization-header-server-side"></a>Обработка серверной стороны заголовка авторизации

Служба REST должна украшать `[BasicAuthentication]` каждое действие атрибутом. Этот атрибут используется для разбора `Authorization` заголовка и определения допустимы химачем закодированных учетных данных base64, сравнивая их со значениями, хранящимися в *Web.config.* Хотя этот подход подходит для выборочной службы, он требует расширения для общедоступной веб-службы.

В базовом модуле аутентификации, используемом IIS, пользователи аутентифицируются против своих учетных данных Windows. Таким образом, пользователи должны иметь учетные записи на домене сервера. Тем не менее, базовая модель проверки подлинности может быть настроена для обеспечения пользовательской аутентификации, где учетные записи пользователей аутентифицируются против внешнего источника, например базы данных. Для получения дополнительной информации смотрите [Базовая аутентификация в ASP.NET Web API](https://www.asp.net/web-api/overview/security/basic-authentication) на веб-сайте ASP.NET.

> [!NOTE]
> Базовая аутентификация не была разработана для управления выходом из системы. Таким образом, стандартный базовый подход к аутентификации для выхода из системы заключается в том, чтобы закончить сеанс.

## <a name="related-links"></a>Связанные ссылки

- [Потребляйте веб-сервис RESTful](~/xamarin-forms/data-cloud/web-services/rest.md)
- [HTTPClient](https://msdn.microsoft.com/library/system.net.http.httpclient(v=vs.110).aspx)
