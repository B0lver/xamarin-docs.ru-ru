---
title: Проверка подлинности веб-службы RESTFUL
description: Обычная проверка подлинности предоставляет доступ к ресурсам только тем клиентам, которые имеют правильные учетные данные. В этой статье объясняется, как использовать обычную проверку подлинности для защиты доступа к ресурсам веб-службы RESTFUL.
ms.prod: xamarin
ms.assetid: 7B5FFDC4-F2AA-4B12-A30A-1DACC7FECBF1
ms.technology: xamarin-forms
author: davidbritch
ms.author: dabritch
ms.date: 01/22/2018
no-loc:
- Xamarin.Forms
- Xamarin.Essentials
ms.openlocfilehash: 2a46d099520103ba6f1552d5bda3f619c07b743d
ms.sourcegitcommit: 008bcbd37b6c96a7be2baf0633d066931d41f61a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/22/2020
ms.locfileid: "86928527"
---
# <a name="authenticate-a-restful-web-service"></a>Проверка подлинности веб-службы RESTFUL

_Протокол HTTP поддерживает использование нескольких механизмов проверки подлинности для управления доступом к ресурсам. Обычная проверка подлинности предоставляет доступ к ресурсам только тем клиентам, которые имеют правильные учетные данные. В этой статье показано, как использовать обычную проверку подлинности для защиты доступа к ресурсам веб-службы RESTFUL._

> [!NOTE]
> В iOS 9 и более поздних версиях Защита транспорта приложений (ATS) обеспечивает безопасное подключение между Интернет-ресурсами (например, серверным сервером приложения) и приложением, тем самым предотвращая случайное раскрытие конфиденциальной информации. Поскольку ATS включена по умолчанию в приложениях, созданных для iOS 9, все подключения будут подвергаться требованиям безопасности ATS. Если соединения не соответствуют этим требованиям, они завершатся сбоем с исключением.
> ATS можно отключать, если невозможно использовать `HTTPS` протокол и безопасное взаимодействие с Интернет-ресурсами. Это можно сделать, обновив файл **info. plist** приложения. Дополнительные сведения см. в статье [Безопасность транспорта приложений](~/ios/app-fundamentals/ats.md).

## <a name="authenticating-users-over-http"></a>Проверка подлинности пользователей по протоколу HTTP

Обычная проверка подлинности — это простейший механизм проверки подлинности, поддерживаемый HTTP, и предполагает, что клиент отправляет имя пользователя и пароль в виде незашифрованного текста в кодировке Base64. Процесс создания моментальных снимков хранилища состоит из следующих этапов:

- Если веб-служба получает запрос на защищенный ресурс, она отклоняет запрос с кодом состояния HTTP 401 (отказано в доступе) и задает заголовок ответа WWW-Authenticate, как показано на следующей схеме:

![Сбой обычной проверки подлинности](rest-images/basic-authentication-fail.png)

- Если веб-служба получает запрос на защищенный ресурс с `Authorization` правильно заданным заголовком, веб-служба реагирует на код состояния HTTP 200, который указывает на то, что запрос выполнен успешно и запрошенные сведения находятся в ответе. Этот сценарий показан на следующей схеме:

![Обычная проверка подлинности](rest-images/basic-authentication-success.png)

> [!NOTE]
> Обычную проверку подлинности следует использовать только через HTTPS. При использовании через HTTP-соединение `Authorization` заголовок можно легко декодировать, если HTTP-трафик захвачен злоумышленником.

## <a name="specifying-basic-authentication-in-a-web-request"></a>Указание обычной проверки подлинности в веб-запросе

Использование обычной проверки подлинности задается следующим образом:

1. Строка "Basic" добавляется в `Authorization` заголовок запроса.
1. Имя пользователя и пароль объединяются в строку с форматом "имя_пользователя: пароль", который затем кодируется в Base64 и добавляется в `Authorization` заголовок запроса.

Таким образом, с именем пользователя "Ксамаринусер" и паролем "Ксамаринпассворд" заголовок выглядит следующим образом:

```csharp
Authorization: Basic WGFtYXJpblVzZXI6WGFtYXJpblBhc3N3b3Jk
```

`HttpClient`Класс может задавать `Authorization` значение заголовка для `HttpClient.DefaultRequestHeaders.Authorization` Свойства. Поскольку `HttpClient` экземпляр существует в нескольких запросах, `Authorization` заголовок должен быть задан только один раз, а не при выполнении каждого запроса, как показано в следующем примере кода:

```csharp
public class RestService : IRestService
{
  HttpClient _client;
  ...

  public RestService ()
  {
    var authData = string.Format ("{0}:{1}", Constants.Username, Constants.Password);
    var authHeaderValue = Convert.ToBase64String (Encoding.UTF8.GetBytes (authData));

    _client = new HttpClient ();
    _client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue ("Basic", authHeaderValue);
  }
  ...
}
```

Затем при выполнении запроса к операции веб-службы запрос подписывается с `Authorization` заголовком, указывая, имеет ли пользователь разрешение на вызов операции.

> [!IMPORTANT]
> Хотя этот код хранит учетные данные как константы, они не должны храниться в небезопасном формате в опубликованном приложении.

## <a name="processing-the-authorization-header-server-side"></a>Обработка на стороне сервера заголовка авторизации

Служба RESTFUL должна снабдить каждое действие `[BasicAuthentication]` атрибутом. Этот атрибут используется для синтаксического анализа `Authorization` заголовка и определения допустимости учетных данных в кодировке Base64 путем их сравнения со значениями, хранящимися в *Web.config*. Хотя этот подход подходит для примера службы, он требует расширения для общедоступной веб-службы.

В модуле обычной проверки подлинности, используемом службами IIS, пользователи проходят проверку подлинности по учетным данным Windows. Таким образом, пользователи должны иметь учетные записи в домене сервера. Однако модель обычной проверки подлинности может быть настроена на разрешение пользовательской проверки подлинности, при которой учетные записи пользователей проходят проверку подлинности во внешнем источнике, например в базе данных. Дополнительные сведения см. [в разделе Обычная проверка подлинности в веб-API ASP.NET](https://www.asp.net/web-api/overview/security/basic-authentication) на веб-сайте ASP.NET.

> [!NOTE]
> Обычная проверка подлинности не предназначена для управления выходом из систему. Таким образом, для выхода из сеанса стандартный метод обычной проверки подлинности — завершить сеанс.

## <a name="related-links"></a>Связанные ссылки

- [Использование веб-службы RESTFUL](~/xamarin-forms/data-cloud/web-services/rest.md)
- [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(v=vs.110).aspx)
