---
title: Использование Jenkins с Xamarin
description: В этом документе описывается, как использовать Jenkins для непрерывной интеграции с приложениями Xamarin. Он описывает, как установить, настроить и использовать Jenkins.
ms.prod: xamarin
ms.assetid: 1E6825DF-1254-4FCB-B94D-ADD33D1B5309
author: lobrien
ms.author: laobri
ms.date: 03/23/2017
ms.openlocfilehash: 2e6a75fa3c4c63e8dea402c6761f8ef753908540
ms.sourcegitcommit: 4b402d1c508fa84e4fc3171a6e43b811323948fc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61047866"
---
# <a name="using-jenkins-with-xamarin"></a>Использование Jenkins с Xamarin

_В этом руководстве показано, как настроить Jenkins, как сервер непрерывной интеграции и автоматизации компиляции мобильных приложений, созданных с помощью Xamarin. Здесь описана установка Jenkins в OS X, настройте его и настроить задания для компиляции приложения Xamarin.iOS и Xamarin.Android, когда фиксируются изменения для системы управления исходным кодом._

[Общие сведения о непрерывной интеграции с Xamarin](~/tools/ci/intro-to-ci.md) вводит непрерывной интеграции, практикой разработки полезных программного обеспечения, которая позволяет своевременно получать предупреждения некорректно работающие или несовместимые кода. CI позволяет разработчикам решать проблемы и проблемы, как они возникают и сохраняет в состоянии, пригодном для развертывания программного обеспечения. В этом пошаговом руководстве описывается, как совместное использование содержимого из обоих документов.

В этом руководстве показано, как установить Jenkins на отдельный компьютер под управлением OS X и настройте его на автоматический запуск при запуске компьютера. После установки Jenkins мы установим дополнительные подключаемые модули для поддержки MS Build. Jenkins поддерживает Git без дополнительной настройки. Если TFS используется для управления исходным кодом, также можно установить дополнительные средства подключаемого модуля и командной строки.

После настройки Jenkins и будут установлены все необходимые подключаемые модули, мы создадим один или несколько заданий для компиляции проекты Xamarin.Android и Xamarin.iOS. Задание — это коллекция действия и метаданные, необходимые для выполнения определенных действий. Задание обычно состоит из следующих элементов:

- **Исходный код Management (SCM)** — это запись метаданных в файлах конфигурации Jenkins, содержащий сведения о подключении к системе управления версиями и файлы, которые требуется извлечь.
- **Триггеры** — триггеры используются для запуска задания, в зависимости от определенных действий, например когда разработчик фиксирует изменения в репозиторий исходного кода.
- **Инструкции по построению** – это подключаемый модуль или скрипт, который используется для компиляции исходного кода и предоставления двоичный файл, который может быть установлен на мобильных устройствах.
- **Необязательные действия построения** — это могут быть запуск модульных тестов, выполнения статического анализа для кода, подписывание кода, или другое задание для выполнения других начиная создавать связанные рабочие.
- **Уведомления** — задание может отправить какого-либо рода уведомления о состоянии построения.
- **Безопасность** – хотя это необязательно, настоятельно рекомендуется также включить функции безопасности Jenkins.

В этом руководстве показано, как Настройка сервера Jenkins, представленные для каждого из этих точек. Изучив его мы должны иметь хорошее понимание того, как установить и настроить Jenkins для создания IPA и APK для наших проектах Xamarin для мобильных.

## <a name="requirements"></a>Требования

Идеальный сервер является автономным компьютером, посвященное исключительно для создания и возможно тестирования приложения. Отдельный компьютер гарантирует, что артефакты, которые могут быть необходимы для других ролей (например, веб-сервера), необходимы сборки. Например если сервер также выступает в качестве веб-сервера, веб-сервера может потребоваться конфликтующие версии библиотеки некоторых общих. Из-за этого конфликта веб-сервер может работать неправильно или Jenkins создаст сборок, которые не работают, если развернуты для пользователей.

Сервер сборки для мобильных приложений Xamarin устанавливается очень напоминает рабочей станции разработчика. Он имеет учетную запись пользователя, в какие Jenkins, Visual Studio для Mac, и будут установлены Xamarin.iOS и Xamarin.Android. Все сертификаты, Подготовка профилей и хранилищ ключей для подписи кода должны быть также установлены. *Обычно учетной записи пользователя на сервере построения отличается от учетных записей разработчика — убедитесь, что установка и настройка программного обеспечения, ключи и сертификаты, войдя в систему с помощью учетной записи пользователя сервера сборки.*

Все эти элементы на стандартный сервер сборки Jenkins на следующей схеме:

[![](jenkins-walkthrough-images/image1.png "Схема иллюстрирует все эти элементы на стандартный сервер сборки Jenkins")](jenkins-walkthrough-images/image1.png#lightbox)

только приложения iOS можно создать и подпись, на компьютере под управлением macOS. Mac Mini разумным решением, но любой компьютер, могут работать с OS X 10.10 (Yosemite) или более поздней версии достаточно.

Если TFS используется для управления исходным кодом, вам потребуется выполнить установку [Team Explorer Everywhere](https://docs.microsoft.com/azure/devops/java/download-eclipse-plug-in/). Team Explorer Everywhere предоставляет кросс платформенных доступ к TFS в окне терминала в macOS.

[!include[](~/tools/ci/includes/firewall-information.md)]

## <a name="installing-jenkins"></a>Установка Jenkins

Чтобы установить его является первой задачи с помощью Jenkins. Существует три способа выполнения Jenkins в OS X:

- Как управляющая программа, в фоновом режиме.
- Внутри контейнер сервлетов, например Tomcat, Jetty или JBoss.
- Как обычный процесс под учетной записью пользователя.

Большинство традиционных непрерывной интеграции работающие в фоновом режиме, либо как управляющая программа (в OS X или \*nix) или как служба (в Windows). Это подходит для сценариев, где никак не взаимодействует графического пользовательского интерфейса, которые требуется и настройки среды построения можно легко выполнить. Мобильные приложения также требуют keystores и подписывания сертификатов, которые может оказаться проблемой для доступа, когда запущен сервер Jenkins, как управляющая программа. Из-за эти проблемы этот документ посвящен третий сценарий — под управлением учетной записи пользователя Jenkins на сервере сборки.

Jenkins.App — это удобный способ установки Jenkins. Это AppleScript оболочку, которая упрощает запуск и остановка сервера Jenkins. Вместо запуска в оболочке bash, Jenkins работает как приложение с помощью значка на панели Dock, как показано на следующем снимке экрана:

[![](jenkins-walkthrough-images/image2.png "Вместо запуска в оболочке bash, Jenkins работает как приложение с помощью значка на панели Dock, как показано на следующем снимке экрана")](jenkins-walkthrough-images/image2.png#lightbox)

Запуск или остановка Jenkins сложнее, чем запуск или остановка Jenkins.App.

Чтобы установить Jenkins.App, загрузите последнюю версию со страницы загрузки проекта, изображенного на снимке экрана ниже:

[![](jenkins-walkthrough-images/image3.png "Приложения, загрузки страницы, изображенного на этом снимке экрана загрузки последней версии из проектов")](jenkins-walkthrough-images/image3.png#lightbox)

Извлеките ZIP-файл для `/Applications` папку на сервере сборки и запуска, так же, как любое другое приложение OS X.
При первом запуске Jenkins.App, он будет представлять диалоговое окно, информирующее о том, что он загрузит Jenkins:

[![](jenkins-walkthrough-images/image4.png "Приложения, он будет представлять диалоговое окно, информирующее о том, что он загрузит Jenkins")](jenkins-walkthrough-images/image4.png#lightbox)

После завершения его загрузки Jenkins.App появится другое диалоговое окно, запрашивающее, если вы хотите настроить запуск Jenkins, как показано на следующем снимке экрана:

[![](jenkins-walkthrough-images/image5.png "Приложение завершило его загрузки, он будет отображать другое диалоговое окно, запрашивающее, если вы хотите настроить запуск Jenkins, как показано на следующем снимке экрана")](jenkins-walkthrough-images/image5.png#lightbox)

Настройка Jenkins является необязательным и не нужно выполнять каждый раз при запуске приложения – параметры по умолчанию для Jenkins, будут работать для большинства ситуаций.

Если это необходимо для настройки Jenkins, щелкните **изменить значения по умолчанию** кнопки. Этого появится два последовательных диалоговых окон: один, запрашивает параметры командной строки Java и еще одно, которое запрашивает параметры командной строки Jenkins. Следующие два снимка экрана отображение этих двух диалоговых окон:

[![](jenkins-walkthrough-images/image6.png "На этом снимке экрана показаны диалоговые окна")](jenkins-walkthrough-images/image6.png#lightbox)

[![](jenkins-walkthrough-images/image7.png "На этом снимке экрана показаны диалоговые окна")](jenkins-walkthrough-images/image7.png#lightbox)

После запуска Jenkins можно задать его в качестве элемента имени входа, таким образом, чтобы он запустится каждый раз пользователь вошел в систему на компьютере. Это можно сделать, щелкнув правой кнопкой мыши значок Jenkins на панели закрепления и выбрав **параметры... > открыть при входе в систему**, как показано на следующем снимке экрана:

[![](jenkins-walkthrough-images/image8.png "Вы это можно сделать, щелкнув правой кнопкой мыши значок Jenkins на панели закрепления и выбрав OptionsOpen при входе в систему, как показано на следующем снимке экрана")](jenkins-walkthrough-images/image8.png#lightbox)

Это приведет к Jenkins.App на автоматический запуск при каждом входе пользователя, но не при загрузке компьютера вверх. Это можно указать учетную запись пользователя, OS X будет использовать для автоматического входа во время загрузки. Откройте **системных настройках**и выберите **пользователи и группы** значок, как показано на следующем снимке экрана:

[![](jenkins-walkthrough-images/image9.png "Откройте системные настройки и щелкните значок группы пользователей, как показано на следующем снимке экрана")](jenkins-walkthrough-images/image9.png#lightbox)

Щелкните **параметры входа в систему** кнопку, а затем выберите учетную запись, OS X будет использовать для входа в систему во время загрузки.

На этом этапе установки Jenkins. Тем не менее если мы хотим создавать мобильные приложения Xamarin, нам потребуется установить некоторые подключаемые модули.

### <a name="installing-plugins"></a>Установка подключаемых модулей

После завершения установщик Jenkins.App оно будет начинаться Jenkins и запустить веб-браузер на URL-адрес http://localhost:8080, как показано на следующем снимке экрана:

[![](jenkins-walkthrough-images/image10.png "8080, как показано на следующем снимке экрана")](jenkins-walkthrough-images/image10.png#lightbox)

На этой странице выберите **Jenkins > Управление Jenkins > Управление подключаемыми модулями** в меню в левом верхнем углу, как показано на следующем снимке экрана:

[![](jenkins-walkthrough-images/image11.png "На этой странице выберите Jenkins управление Jenkins управление подключаемыми модулями в меню в левом верхнем углу")](jenkins-walkthrough-images/image11.png#lightbox)

При этом отобразится **Manager подключаемый модуль Jenkins** страницы. Если щелкнуть на вкладке доступны, вы увидите список из более чем 600 подключаемые модули, которые могут быть загружены и установлены. Это является изображенного на снимке экрана ниже:

[![](jenkins-walkthrough-images/image12.png "Если щелкнуть на вкладке доступны, вы увидите список из более чем 600 подключаемые модули, которые можно загрузить и установить")](jenkins-walkthrough-images/image12.png#lightbox)

Прокрутке все подключаемые модули для нахождения некоторые может занять много времени и подвержено ошибкам 600. Jenkins предоставляет поле фильтра поиска в правом верхнем углу интерфейса. Использовать это поле фильтра для поиска упростит поиску и установлены один или все следующие подключаемые модули:

- **Подключаемый модуль Jenkins MSBuild** – этот подключаемый модуль позволяет создавать Visual Studio и Visual Studio для Mac решений (SLN) и проектов (CSPROJ-файл).
- **Подключаемый модуль инжектор окружения** – это необязательно, но полезные подключаемый модуль, позволяющий установить переменные среды на задания и построения уровня. Он также предлагает дополнительную защиту для переменных, такие как пароли, используемые для кода подписи приложения. Иногда используется аббревиатура как *подключаемый модуль EnvInject* .
- **Team Foundation Server Plugin** — это необязательный подключаемого модуля, он будет только требуется, если вы используете Team Foundation Server или Team Foundation Services для управления исходным кодом.

Jenkins поддерживает Git без любые дополнительные подключаемые модули.

После установки всех подключаемых модулей, вам понадобится перезапустить Jenkins и Настройка глобальных параметров для каждого подключаемого модуля. Глобальные параметры для подключаемого модуля можно найти, выбрав **Jenkins > Управление Jenkins > Настройка системы** из в левом верхнем углу, как показано на следующем снимке экрана:

[![](jenkins-walkthrough-images/image13.png "Глобальные параметры для подключаемого модуля можно найти, выбрав Jenkins / Manage Jenkins / Настройка системы в верхнем левом углу передать угла")](jenkins-walkthrough-images/image13.png#lightbox)

Если выбран этот пункт меню, то будете перенаправлены на **Настройка системы [Jenkins]** страницы. Эта страница содержит разделы для настройки самого Jenkins и задать некоторые значения глобального подключаемого модуля.  На следующем снимке экрана показан пример этой страницы:

[![](jenkins-walkthrough-images/image14.png "На этом снимке экрана показан пример этой страницы")](jenkins-walkthrough-images/image14.png#lightbox)

#### <a name="configuring-the-msbuild-plugin"></a>Настройка подключаемого модуля MSBuild

Подключаемый модуль MSBuild должен быть настроен на использование **/Library/Frameworks/Mono.framework/Commands/xbuild** для компиляции Visual Studio для Mac файлы решения и проекта. Прокрутите вниз **Настройка системы [Jenkins]** странице до **добавьте MSBuild** кнопка отображается, как показано на следующем снимке экрана:

 [![](jenkins-walkthrough-images/image15.png "Прокрутите страницу вниз, Настройка системы Jenkins пока не появится кнопка Добавить MSBuild")](jenkins-walkthrough-images/image15.png#lightbox)

Щелкните эту кнопку и заполните **имя** и **путь** для **MSBuild** поля в появившейся форме. Имя вашего **MSBuild** установки должно быть понятное имя, при **путь к MSBuild** должно содержать путь к `xbuild`, которой обычно является **/Library/Frameworks / Mono.framework/Commands/xbuild**. После сохранения изменений, нажав кнопку сохранения или кнопку «Применить» в нижней части страницы, Jenkins будут иметь возможность использовать `xbuild` для компиляции решения.

#### <a name="configuring-the-tfs-plugin"></a>Настройка подключаемый модуль TFS

В этом разделе является обязательным, если планируется использовать TFS для вашей системы управления исходным кодом.

Чтобы на рабочей станции macOS для взаимодействия с сервером TFS [Team Explorer Everywhere](https://docs.microsoft.com/azure/devops/java/download-eclipse-plug-in/) должна быть установлена на рабочей станции. Team Explorer Everywhere — это набор средств от корпорации Майкрософт, который включает в себя клиент кроссплатформенной командной строки для доступа к TFS. Team Explorer Everywhere можно загрузить в Майкрософт и установить в три этапа:

1. Распакуйте файл архива в каталог, доступный для учетной записи пользователя. Например, может Распакуйте файл **~/tee**.
2. Настройка пути оболочки или системы, включаемых в папке, содержащей файлы, которые были распакованы в шаге приведенного выше. Например, примененная к объекту директива

    ```
    echo export PATH~/tee/:$PATH' >> ~/.bash_profile
    ```

3. Чтобы убедиться, что установлен Team Explorer Everywhere, откройте сеанс терминала и выполните `tf` команды. Если tf настроена должным образом, вы увидите следующие выходные данные в сеансе терминалов:

    ```
    $ tf
    Team Explorer Everywhere Command Line Client (version 11.0.0.201306181526)

    Available commands and their options:
    ```

После установки клиент командной строки для TFS Jenkins необходимо предоставить полный путь к `tf` клиент командной строки. Прокрутите вниз **Настройка системы [Jenkins]** странице, пока не найдете в разделе Team Foundation Server, как показано на следующем снимке экрана:

[![](jenkins-walkthrough-images/image17.png "Прокрутите страницу вниз, Настройка системы Jenkins, пока не найдете в разделе Team Foundation Server")](jenkins-walkthrough-images/image17.png#lightbox)

Введите полный путь к `tf` команду и нажмите кнопку **Сохранить** кнопки.

### <a name="configure-jenkins-security"></a>Настройка безопасности Jenkins

При первой установке Jenkins имеет выключены функции безопасности, поэтому любой пользователь может установить и выполнять любые задания анонимно. В этом разделе описывается, как настроить безопасность с помощью Jenkins пользовательской базы данных для настройки проверки подлинности и авторизации.

Параметры безопасности можно найти, выбрав **Jenkins > Управление Jenkins > Настройка глобальной безопасности**, как показано на следующем снимке экрана:

[![](jenkins-walkthrough-images/image18.png "Параметры безопасности можно найти, выбрав Jenkins / Manage Jenkins / Настройка глобальной безопасности")](jenkins-walkthrough-images/image18.png#lightbox)

На **Настройка глобальной безопасности** страницы, проверка **включить защиту** флажок и **контроля доступа** отображения формы, как на следующем снимке экрана:

[![](jenkins-walkthrough-images/image19.png "На странице \"Настройка глобальной безопасности\" проверить безопасность включить флажок и контроля доступа форма будет выглядеть, на следующий снимок экрана")](jenkins-walkthrough-images/image19.png#lightbox)

Переключение в переключателе **Jenkins собственную пользовательскую базу данных** в **раздел сферы безопасности**и убедитесь, что **позволяют пользователям регистрироваться** также проверяется, как показано в Следующий снимок экрана:

[![](jenkins-walkthrough-images/image20.png "Переключение переключатель для Jenkins собственной пользовательской базы данных в разделе сферы безопасности и убедитесь, что также установлен флажок Разрешить пользователям зарегистрироваться")](jenkins-walkthrough-images/image20.png#lightbox)

Наконец перезапустите Jenkins и создайте новую учетную запись. Первая учетная запись, которая создается является привилегированной учетной записью, и эта учетная запись будет автоматически обновлен до администратора. Вернитесь к **Настройка глобальной безопасности** странице и снимите флажок **безопасности на основе матрицы** "переключатель". Учетная запись root должен быть предоставлен полный доступ и анонимной учетной записи должен быть предоставлен доступ только для чтения, как показано на следующем снимке экрана:

[![](jenkins-walkthrough-images/image21.png "Учетная запись root должен быть предоставлен полный доступ и анонимной учетной записи должен быть предоставлен доступ только для чтения")](jenkins-walkthrough-images/image21.png#lightbox)

После того как эти параметры сохраняются и перезапустить Jenkins, будет включена безопасность.

#### <a name="disabling-security"></a>Отключение безопасности

В случае забытого пароля или Jenkins уровня блокировки можно отключить безопасность, выполнив следующие действия:

1. Остановите Jenkins. Если вы используете Jenkins.app, это можно сделать, щелкнув правой кнопкой мыши значок на панели Dock Jenkins.App и выбрав в открывшемся меню Quit:

    ![Значок приложения в панели закрепления и выбрав в меню, появившемся Quit](jenkins-walkthrough-images/image19.png)

2. Откройте файл **~/.jenkins/config.xml** в текстовом редакторе.
3. Измените значение свойства `<usesecurity></usesecurity>` элемент из `true` для `false`.
4. Удалить `<authorizationstrategy></authorizationstrategy>` и `<securityrealm></securityrealm>` элементы из файла.
5. Перезапустите Jenkins.

## <a name="setting-up-a-job"></a>Настройка задания

На верхнем уровне, Jenkins единое различные задачи, необходимые для создания программного обеспечения в *задания*. Задание также имеет метаданные, связанные с ним, предоставляя информацию о сборке, как получить исходный код, как часто следует запускать сборки, любые специальные переменные, которые необходимы для построения и как для уведомления разработчиков, если сборка завершается с ошибкой.

Задания создаются путем выбора **Jenkins > новое задание** в меню в правом верхнем углу, как показано на следующем снимке экрана:

![](jenkins-walkthrough-images/image22.png "Задания создаются, выбрав в меню в правом верхнем углу нового задания Jenkins")

При этом отобразится **новое задание [Jenkins]** страницы. Введите имя для задания и выберите **построить проект программного обеспечения в свободном стиле** "переключатель". На следующем рисунке показан пример этого:

![](jenkins-walkthrough-images/image23.png "Введите имя для задания и выберите сборку типа \"переключатель\" программное обеспечение в свободном стиле проекта")

Щелкнув **ОК** кнопка представляет страницу настройки для задания. Это должно быть аналогично снимке экрана ниже:

![](jenkins-walkthrough-images/image24.png "Это должно напоминать на этом снимке экрана")

Jenkins организует заданий в каталог на жестком диске, расположенный по следующему пути: **~/.jenkins/jobs/[JOB имя]**

Эта папка содержит все файлы и артефакты, определенные в задание, таких как журналы, файлы конфигурации и исходный код, который должен быть скомпилирован.

После создания исходное задание, он должен соответствовать один или несколько из следующих:

- Необходимо указать систему управления исходным кодом.
- Один или несколько *действия при сборке* необходимо добавить в проект. Ниже приведены шаги или задачи, необходимые для построения приложения.
- Задание необходимо назначить один *триггер сборки* — это набор инструкций о том, как часто Jenkins для извлечения кода и сборки окончательной проекции.

### <a name="configuring-source-code-control"></a>Настройка системы управления исходным кодом

Первой задачи, выполняемые Jenkins получить исходный код из системы управления исходным кодом. Jenkins поддерживает многие из популярных системах управления исходного кода доступны уже сегодня. В этом разделе рассматриваются два популярных систем, Git и Team Foundation Server. Каждый из этих системах управления исходного кода рассматривается более подробно в следующих разделах.

#### <a name="using-git-for-source-code-control"></a>С помощью Git для управления исходным кодом

Если вы используете TFS для управления исходным кодом, [пропустить](#using-tfs-for-source-code-management) этот раздел и перейдите к следующему разделу, с помощью TFS.

Jenkins поддерживает Git по умолчанию — не дополнительные подключаемые модули необходимы. Чтобы использовать Git, щелкните **Git** кнопку-переключатель и введите URL-адрес для репозитория Git, как показано на следующем снимке экрана:

![](jenkins-walkthrough-images/image25.png "Чтобы использовать Git, щелкните переключатель в Git и введите URL-адрес для репозитория Git")

После сохранения изменений конфигурации Git будет завершена.

#### <a name="using-tfs-for-source-code-management"></a>Использование TFS для управления исходным кодом

Этот раздел относится только к пользователю Team Foundation Server.

Щелкните **Team Foundation Server** "переключатель" и раздел конфигурации TFS должно выглядеть, какова на следующем снимке экрана:

![](jenkins-walkthrough-images/image26.png "Щелкните переключатель в Team Foundation Server и появится раздел конфигурации TFS")

Введите необходимые сведения для TFS. На следующем рисунке показан пример заполненной формы:

![](jenkins-walkthrough-images/image27.png "На этом снимке экрана показан пример заполненной формы")

#### <a name="testing-the-source-code-control-configuration"></a>Тестирование конфигурации системы управления версиями кода

После настройки управления соответствующего исходного кода щелкните **Сохранить** для сохранения изменений. Таким образом вы вернетесь на домашнюю страницу для задания, которое будет напоминать следующий снимок экрана:

![](jenkins-walkthrough-images/image28.png "Таким образом вы вернетесь на домашнюю страницу для задания, что будут похожи на этом снимке экрана")

Самый простой способ проверить настройку управления исходным кодом является инициировать создание сборки вручную, несмотря на то, что отсутствуют указанные действия построения. Чтобы выполнить сборку вручную, имеет на домашнюю страницу задания **сборки теперь** связи в меню в левой части, как показано на следующем снимке экрана:

![](jenkins-walkthrough-images/image29.png "Чтобы выполнить сборку вручную, на домашнюю страницу задания есть ссылка сборки теперь в меню в левой части")

При запуске построения историю сборки диалогового окна отображается мигающий синий круг, индикатор хода выполнения, номер сборки и время запуска сборки, как на следующем снимке экрана:

![](jenkins-walkthrough-images/image30.png "При запуске построения историю сборки диалоговое окно отображает мигает синий круг, индикатор хода выполнения, номер сборки и время запуска построения")

Если задание завершилось успешно, будет отображаться синий круг. В случае сбоя, отображается красный кружок.

Чтобы упростить устранение неполадок, которые могут возникнуть в процессе построения, Jenkins соберет все выходные данные консоли для задания. Чтобы просмотреть выходные данные консоли, щелкнуть задание в **историю сборки**, а затем на **выходных данных консоли** ссылку в меню слева. На следующем снимке экрана показан **выходных данных консоли** ссылку, а также объем выходных данных из успешного задания:

![](jenkins-walkthrough-images/image31.png "На этом снимке экрана показано, в ссылке выходных данных консоли, а также объем выходных данных из успешного задания")

#### <a name="location-of-build-artifacts"></a>Расположение артефактов сборки

Jenkins извлечет весь исходный код в специальных папку с именем *рабочей области*. Этот каталог можно найти в папке по следующему адресу:

    ```
    ~/.jenkins/jobs/[JOB NAME]/workspace
    ```

Путь к рабочей области, которые будут храниться в переменной среды с именем `$WORKSPACE`.

Существует возможность перейдите в папку рабочей области в Jenkins, перейдите на главную страницу для задания и затем щелкнув **рабочей области** ссылку в меню слева. На следующем рисунке показан пример рабочей области для задания с именем **HelloWorld**:

![](jenkins-walkthrough-images/image32.png "На этом снимке экрана показан пример рабочей области для задания с именем HelloWorld")

### <a name="build-triggers"></a>Триггеры сборки

Существует несколько различных стратегий для инициирования сборки в Jenkins — они известны как *триггеры сборки*. Триггер построения помогает решать, когда для запуска задания и постройте проект Jenkins. Ниже приведены два наиболее распространенных триггеров построения.

- **Периодически создавать** – этот триггер запускает Jenkins запустить задание с заданными интервалами, например каждые два часа, или в полночь по рабочим дням. Сборка будет запущен независимо от того, следует ли будут внесены любые изменения в репозиторий исходного кода.
- **Опрос SCM** – этот триггер будет опрашивать системы управления исходным кодом на регулярной основе. Если изменения были зафиксированы на репозиторий исходного кода, Jenkins запустится новая сборка.

Опрос SCM — это популярный триггер, так как она обеспечивает быструю обратную связь, когда разработчик фиксирует изменения, вызывающие прерывать сборку. Это полезно для оповещений команды были зафиксированы недавно код вызывает проблемы что позволяет решить проблему, хотя изменения будут по-прежнему новой помнить разработчикам.

Периодических сборок часто используются для создания версии приложения, которое можно распространять инженеров-испытателей. Например периодической сборки может быть выполнено для вечером в пятницу, таким образом, чтобы члены группы контроля Качества можно протестировать работу за предыдущую неделю.

### <a name="compiling-a-xamarinios-applications"></a>Компиляция приложений Xamarin.iOS
Проекты Xamarin.iOS можно скомпилировать в командной строке с помощью `xbuild` или `msbuild`. Команда оболочки будет выполняться в контексте учетной записи пользователя, на котором выполняется Jenkins. Очень важно, что учетная запись имеет доступ к профилю подготовки таким образом, приложение может быть правильно установочный пакет для распространения. Это можно добавить на страницу настройки задания эта команда оболочки.

Прокрутите вниз до раздела **построения** раздел. Нажмите кнопку **добавить шаг сборки** и выберите **оболочку выполнения**, как показано на следующем снимке экрана:

![](jenkins-walkthrough-images/image33.png "Нажмите кнопку Добавить шаг сборки и выберите Execute shell")

[!include[](~/tools/ci/includes/commandline-compile-of-xamarin-ios-ipa.md)]

### <a name="building-a-xamarinandroid-project"></a>Сборка проекта Xamarin.Android

Сборка проекта Xamarin.Android очень похожа на построение проекта Xamarin.iOS. Чтобы создать пакет APK из проекта Xamarin.Android, Jenkins необходимо выполнить следующие действия:

- Скомпилируйте проект подключаемый модуль MSBuild
- Вход "и" индекс выровнять APK с помощью хранилища ключей допустимым выпуском.

Более подробно в следующих двух разделах рассматриваются эти два этапа.

### <a name="creating-the-apk"></a>Создание пакета APK

Щелкните **добавить шаг сборки** и выберите **построения Visual Studio проекта или решения с помощью MSBuild**, как показано на следующем снимке экрана:

![](jenkins-walkthrough-images/image36.png "Создание пакета APK, щелкните на кнопка \"Добавить сборки шаг\" и выберите сборки Visual Studio проекта или решения, с помощью MSBuild")

После шага построения добавляется в проект, заполните поля форм, которые отображаются. Ниже приведен один пример заполненной формы:

![](jenkins-walkthrough-images/image37.png "После шага построения добавляется в проект, заполните поля форм, которые отображаются")

Этот этап сборки будет выполняться `xbuild` в **$WORKSPACE** папки. Для файла сборки MSBuild **Xamarin.Android.csproj** файла. **Аргументы командной строки** Указание целевого объекта сборки выпуска **PackageForAndroid**. Этот продукт этого шага будет пакет APK, по следующему адресу:

    ```
    $WORKSPACE/[PROJECT NAME]/bin/Release
    ```

На следующем рисунке показан пример этого APK:

![](jenkins-walkthrough-images/image38.png "На этом снимке экрана показан пример этого APK")

Этот пакет APK не готово к развертыванию, как она не подписана с помощью закрытое хранилище ключей и должны быть выровнены zip.

#### <a name="signing-and-zipaligning-the-apk-for-release"></a>Подписывание и Zipaligning APK для выпуска

Подписывание и zipaligning APK, с технической точки зрения двух отдельных задач, выполняемых на два отдельных командной строки средства из пакета SDK для Android. Тем не менее удобно для их выполнения в действии одной сборки. Дополнительные сведения о подписи и zipaligning пакет APK см. в разделе документации по Xamarin о подготовке приложения Android для выпуска.

Обе команды требуют параметры командной строки, которые могут изменяться из проекта на проект. Кроме того некоторые из этих параметров командной строки, пароли, которые не должны отображаться в выходных данных консоли при выполнении сборки. Мы сохраним некоторые из этих параметров командной строки в переменных среды. Переменные среды, необходимых для подписи и/или выравнивание zip описаны в следующей таблице:

|Переменная среды|Описание|
|--- |--- |
|KEYSTORE_FILE|Это путь к хранилищу ключей для подписывания пакета APK|
|KEYSTORE_ALIAS|Ключ в хранилище ключей, которое будет использоваться для подписывания пакета APK.|
|INPUT_APK|Пакет APK, который создается путем `xbuild`.|
|SIGNED_APK|Подписанный пакет APK, полученных при `jarsigner`.|
|FINAL_APK|Это ZIP-файл по краю APK, который является результатом какого `zipalign`.|
|STORE_PASS|Это пароль, который используется для доступа к содержимому хранилища ключей для подписания файла.|

Как описано в разделе о требованиях, эти переменные среды можно задать во время сборки, подключаемый модуль EnvInject. В задании должно быть новую сборку шаг добавлен на основе переменных среды вставки, как показано на следующем рисунке:

![](jenkins-walkthrough-images/image39.png "В задании должно быть новую сборку на основе переменных среды вставки добавлен этап")

В **свойства содержимого** форме поле, которое будет отображаться, добавляются переменные среды, по одному в строке, в следующем формате:

    ```
    ENVIRONMENT_VARIABLE_NAME = value
    ```

На следующем снимке экрана показаны переменные среды, которые требуются для подписывания пакета APK:

![](jenkins-walkthrough-images/image40.png "На этом снимке экрана показаны переменные среды, которые требуются для подписывания пакета APK")

Обратите внимание на то, что некоторые из переменных среды для файлов APK построены `WORKSPACE` переменной среды.

Переменная среды окончательный — пароль для доступа к содержимому хранилища ключей: `STORE_PASS`. Пароли находятся конфиденциальные значения, которые должны быть закрыты или указан в файлах журнала. Подключаемый модуль EnvInject можно настроить для защиты этих значений, чтобы они не отображаются в журналах.

Непосредственно перед **построения** раздел конфигурации задания **среда построения** раздел. Когда **внедрить пароли** флажок установлен, некоторые формы полей для отображения. Эти формы поля используются для извлечения имени и значения переменной среды. На следующем снимке экрана показан пример добавления `STORE_PASS` переменной среды:

![](jenkins-walkthrough-images/image41.png "На этом снимке экрана приведен пример добавления переменной среды STOREPASS")

После инициализации переменных среды, следующий шаг — добавить шаг сборки для подписывания и zip, выравнивание пакета APK. Сразу после шага построения для вставки переменные среды, будут другой **оболочку выполнения** команды сборки, которая выполнит `jarsigner` и `zipalign`. Каждая команда будет иметь вверх на одну строку, как показано в следующем фрагменте:

    ```
    jarsigner -verbose -sigalg MD5withRSA -digestalg SHA1 -keystore $KEYSTORE_FILE -storepass $STORE_PASS -signedjar $SIGNED_APK $INPUT_APK $KEYSTORE_ALIAS
    zipalign -f -v 4 $SIGNED_APK $FINAL_APK
    ```

На следующем рисунке показан пример ввода `jarsigner` и `zipalign` команд в шаг:

![](jenkins-walkthrough-images/image42.png "На этом снимке экрана показан пример того, как вводить команды jarsigner и zipalign в шаг")

После определения всех действий построения, рекомендуется инициировать создание сборки вручную, чтобы убедиться в надлежащей работе всех компонентов. Если сборка завершается с ошибкой, **выходных данных консоли** необходимо проверить сведения на причину, чтобы завершить сборку.

### <a name="submitting-tests-to-test-cloud"></a>Отправка тестов в Test Cloud

Автоматические тесты можно отправить в Test Cloud, с помощью команд оболочки. Дополнительные сведения о настройке тестового запуска в тестовом облаке Xamarin, ознакомьтесь с руководством по использованию [Xamarin.UITest](/appcenter/test-cloud/preparing-for-upload/uitest/).

## <a name="summary"></a>Сводка

В этом руководстве мы введена Jenkins, как сервер сборки на macOS и настроен для компиляции и подготовки мобильных приложений Xamarin для выпуска. Мы установили Jenkins на компьютере macOS, а также несколько подключаемых модулей для поддержки процесса сборки. Мы создали и настроить задание, которое будет извлечь код из TFS или Git и затем скомпилируйте этот код в приложение готово выпуска. Мы также изучили два разных способа установить расписание задания должны выполняться.

## <a name="related-links"></a>Связанные ссылки

- [Непрерывная интеграция](~/tools/ci/index.md)
- [Тестирование Центра приложений](https://docs.microsoft.com/appcenter/test-cloud/)
