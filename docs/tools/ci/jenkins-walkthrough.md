---
title: С помощью Jenkins, с помощью Xamarin
description: В этом руководстве показано, как настроить Jenkins как сервер непрерывной интеграции и автоматизации компиляции мобильных приложений, созданных с помощью Xamarin. Здесь описана процедура установки Jenkins в OS X, настроить его и установить задания для компиляции приложения Xamarin.iOS и Xamarin.Android, если изменения фиксируются в системе управления исходным кодом.
ms.prod: xamarin
ms.assetid: 1E6825DF-1254-4FCB-B94D-ADD33D1B5309
author: topgenorth
ms.author: toopge
ms.date: 03/23/2017
ms.openlocfilehash: 1052507bfbf06e264f9e9da89be1e0f35fa70ce1
ms.sourcegitcommit: 0a72c7dea020b965378b6314f558bf5360dbd066
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/09/2018
---
# <a name="using-jenkins-with-xamarin"></a>С помощью Jenkins, с помощью Xamarin

_В этом руководстве показано, как настроить Jenkins как сервер непрерывной интеграции и автоматизации компиляции мобильных приложений, созданных с помощью Xamarin. Здесь описана процедура установки Jenkins в OS X, настроить его и установить задания для компиляции приложения Xamarin.iOS и Xamarin.Android, если изменения фиксируются в системе управления исходным кодом._

[Введение в непрерывной интеграции с Xamarin](~/tools/ci/intro-to-ci.md) вводит непрерывной интеграции как практику разработки полезных программного обеспечения, которое позволяет своевременно получать предупреждения поврежденные или несовместимые кода. Элемент конфигурации позволяет разработчикам устранения неполадок и проблем, как они возникают и сохраняет в состоянии, пригодном для развертывания программного обеспечения. В этом пошаговом руководстве описывается, как совместно использовать содержимое, полученное от обоих документов.

В этом руководстве показано, как установить Jenkins на выделенном компьютере под управлением OS X и настройте его на автоматический запуск при запуске компьютера. После установки Jenkins будет установлен на дополнительные подключаемые модули для поддержки MS Build. Jenkins поддерживает Git без дополнительной настройки. Если TFS используется для управления исходным кодом, также можно установить дополнительные средства подключаемого модуля и программы командной строки.

После настройки Jenkins были установлены необходимые подключаемые модули, мы создадим одно или несколько заданий для компиляции проектов Xamarin.Android и Xamarin.iOS. Задание — это совокупность действия и метаданные, необходимые для выполнения некоторых задач. Задание обычно состоит из следующих компонентов:

-  **Исходный код управления (SCM)** — это операция метаданных в файлах конфигурации Jenkins, содержащий сведения о подключении к системе управления исходным кодом и файлы, которые требуется получить.
-  **Триггеры** — триггеры используются для запуска задания, основанные на определенные действия, например, когда разработчик фиксирует изменения в репозиторий исходного кода.
-  **Инструкции по построению** — это подключаемого модуля или сценария, который компиляцию исходного кода и создает двоичный файл, который может быть установлен на мобильных устройствах.
-  **Необязательные действия построения** — это могут быть запуск модульных тестов, выполнение статического анализа кода, подписывание кода, или запуск другого задания, для выполнения других построить связанные рабочие.
-  **Уведомления о** — задание может посылать какую-либо уведомления о состоянии сборки.
-  **Безопасность** — хотя это необязательно, настоятельно рекомендуется также включить функции безопасности Jenkins.


В этом руководстве описаны шаги настройки сервера Jenkins, охватывающие каждой из этих точек. К концу ее мы должны хорошо понимает того, как установить и настроить Jenkins, создавая IPA и apk-ФАЙЛ в проектах мобильных Xamarin.

## <a name="requirements"></a>Требования

Идеальный сервер является автономным компьютером, выделенных для единственной целью построения и тестирования приложения возможно. Отдельный компьютер гарантирует, что артефакты, которые могут потребоваться для других ролей (например, веб-сервера) не повлиять сборки. Например если сервер сборки также используется в качестве веб-сервера, веб-сервер может потребовать конфликтующие версии библиотеки некоторых общих. Из-за этого конфликта веб-сервер может не работать надлежащим образом или Jenkins создаст построений, которые не работают, если развернут для пользователей.

Сервер сборки для мобильных приложений Xamarin настраивается очень напоминает рабочей станции разработчика. Он имеет учетную запись пользователя в какой Jenkins, Visual Studio для Mac, и Xamarin.iOS и Xamarin.Android будут установлены. Все сертификаты, подготовки профили и хранилищ ключей подписывания кода необходимо также установить. *Обычно учетная запись пользователя на сервере сборки отдельно от учетных записей разработчиков: Убедитесь, что для установки и настройки программного обеспечения, ключи и сертификаты вход выполнен с учетной записи пользователя сервера сборки.*

На следующей схеме показана все эти элементы на сервере построений типичный Jenkins:

 [![](jenkins-walkthrough-images/image1.png "Диаграмма иллюстрирует все эти элементы на сервере построений типичный Jenkins")](jenkins-walkthrough-images/image1.png#lightbox)

приложения iOS можно только выполнять построение и подпись, на компьютере под управлением Mac OS X. Mac Mini разумного параметр экономичные, но любой компьютер, поддерживающий работу OS X 10.10 (Yosemite) или выше является достаточным.

Если TFS используется для управления исходным кодом, требуется установить [Team Explorer Everywhere](http://www.microsoft.com/en-ca/download/details.aspx?id=40785), от корпорации Майкрософт. Team Explorer Everywhere предоставляет кросс платформенных доступ к TFS с терминала в OS X.

[!include[](~/tools/ci/includes/firewall-information.md)]

## <a name="installing-jenkins"></a>Установка Jenkins

Первая задача с помощью Jenkins — установить его. Существует три способа выполнения в OS x — Jenkins

-  Как управляющая программа, в фоновом режиме.
-  В контейнере сервлетов, например Tomcat, Jetty или JBoss.
-  Как обычный процесс, выполняющийся под учетной записью пользователя.


Большинство традиционных непрерывной интеграции работающие в фоновом режиме, либо как управляющая программа (в OS X или \*nix) или как служба (в Windows). Это подходит для сценариев, где нет никакого взаимодействия с графическим интерфейсом пользователя требуется, а настройки среды построения можно легко выполнить. Мобильные приложения также требуют keystores и подписи сертификатов, которые может вызывать трудности для доступа к выполняющейся как управляющая программа Jenkins. Из-за этих проблем в этом документе рассматриваются на третий сценарий: запуск Jenkins учетной записи пользователя на сервере сборки.

Jenkins.App — удобный способ установки Jenkins. Это AppleScript оболочку, которая упрощает запуска и остановки сервера Jenkins. Вместо запуска в оболочке bash Jenkins запускается как приложение со значком в отгрузки, как показано на следующем снимке экрана:

 [![](jenkins-walkthrough-images/image2.png "Вместо запуска в оболочке bash Jenkins работает как приложение со значком в отгрузки, как показано на этом снимке экрана")](jenkins-walkthrough-images/image2.png#lightbox)

Запуск или остановка Jenkins очень похож на запуск или остановка Jenkins.App.

Чтобы установить Jenkins.App, загрузите последнюю версию со страницы загрузки проекта, на следующем снимке экрана показаны:

 [![](jenkins-walkthrough-images/image3.png "Приложения, загрузки страницы, на этом снимке экрана показаны загрузки последней версии из проектов")](jenkins-walkthrough-images/image3.png#lightbox)

Извлеките содержимое ZIP-файла `/Applications` папке сервера сборки и запуска, так же, как любое другое приложение OS X.
При первом запуске Jenkins.App, он будет представлять диалоговое окно, информирующее о том, что он будет загружать Jenkins:

 [![](jenkins-walkthrough-images/image4.png "Приложения, он будет представлять диалоговое окно, информирующее о том, что он будет загружать Jenkins")](jenkins-walkthrough-images/image4.png#lightbox)

После завершения его загрузки Jenkins.App будет отображаться другое диалоговое окно, запрашивающее, если вы хотите настроить запуск Jenkins, как показано на следующем снимке экрана:

 [![](jenkins-walkthrough-images/image5.png "Приложение завершения его загрузки, оно будет отображать другое диалоговое окно, запрашивающее, если вы хотите настроить запуск Jenkins, как показано на этом снимке экрана")](jenkins-walkthrough-images/image5.png#lightbox)

Настройка Jenkins является необязательным и не должен выполняться каждый раз при запуске приложения — параметры по умолчанию для Jenkins будет работать для большинства ситуаций.

Если это необходимо для настройки Jenkins, щелкните на **изменить значения по умолчанию** кнопки. Этого появится два диалоговых окна последовательных: один запрашивает параметры командной строки Java, а другой, запрашивающие Jenkins параметры командной строки. Следующие два снимка экрана показаны эти два диалоговых окна:

 [![](jenkins-walkthrough-images/image6.png "На этом снимке экрана показаны шаги в диалоговых окнах")](jenkins-walkthrough-images/image6.png#lightbox)

 [![](jenkins-walkthrough-images/image7.png "На этом снимке экрана показаны шаги в диалоговых окнах")](jenkins-walkthrough-images/image7.png#lightbox)

После запуска Jenkins можно задать как элемент имени входа, что он будет запуск каждый раз, то имена входа в компьютер. Это можно сделать, щелкнув правой кнопкой мыши на значок Jenkins в дока и выбрав **параметры... Откройте при входе в систему**, как показано на следующем снимке экрана:

 [![](jenkins-walkthrough-images/image8.png "Этого можно, щелкнув правой кнопкой мыши на значок Jenkins в дока и выбрав OptionsOpen при входе в систему, как показано на этом снимке экрана")](jenkins-walkthrough-images/image8.png#lightbox)

Это приведет к Jenkins.App на автоматический запуск при каждом входе пользователя, но не когда компьютер загружается. Можно указать учетную запись пользователя, OS X будет использоваться для автоматического входа в систему с во время загрузки. Откройте **системных настройках**и выберите **& группы пользователей** значок, как показано на этом снимке экрана:

 [![](jenkins-walkthrough-images/image9.png "Откройте системные настройки и щелкните значок группы пользователей, как показано на этом снимке экрана")](jenkins-walkthrough-images/image9.png#lightbox)

Щелкните **параметры входа в систему** кнопку, а затем выберите учетную запись, OS X будет использоваться для входа во время загрузки.

На этом этапе установлено Jenkins. Тем не менее если требуется создавать мобильные приложения Xamarin, нам потребуется установить некоторых подключаемых модулей.


### <a name="installing-plugins"></a>Установка подключаемых модулей

После завершения установки Jenkins.App его начала Jenkins и запустить веб-браузер на URL-адрес http://localhost:8080, как показано на снимке экрана ниже:

 [![](jenkins-walkthrough-images/image10.png "8080, как показано на этом снимке экрана")](jenkins-walkthrough-images/image10.png#lightbox)

На этой странице выберите **Jenkins > Управление Jenkins > Управление подключаемыми модулями** меню в верхний левый угол, как показано на снимке экрана ниже:

 [![](jenkins-walkthrough-images/image11.png "На этой странице выберите в меню, в верхний левый угол Jenkins управления Jenkins управление подключаемыми модулями")](jenkins-walkthrough-images/image11.png#lightbox)

При этом отобразится **Jenkins подключаемого модуля диспетчера** страницы. При нажатии кнопки на вкладке доступны, вы увидите список около 600 подключаемых модулей, которые могут быть загружены и установлены. Это на рисунке на снимке экрана ниже:

 [![](jenkins-walkthrough-images/image12.png "При нажатии кнопки на вкладке доступны, вы увидите список около 600 подключаемых модулей, которые могут быть загружены и установлены")](jenkins-walkthrough-images/image12.png#lightbox)

Прокрутка всех 600 подключаемые модули для поиска нескольких может оказаться трудоемкой и подвержены ошибкам. Jenkins поле фильтра поиска в правом верхнем углу интерфейса. Использовать это поле фильтра для поиска упростит поиску и установлены один или все следующие подключаемые модули:

-  **Подключаемый модуль MSBuild Jenkins** — этот подключаемый модуль делает возможным создание Visual Studio и Visual Studio для Mac решения (SLN-файл) и проекты (CSPROJ-файл).
-  **Подключаемый модуль инжектор окружения** — это необязательно, но полезно подключаемый модуль, дает возможность установки переменных среды на задание и уровне сборки. Он также предлагает дополнительной защиты для переменных, такие как пароли, используемые для кода подписать приложение. Иногда называемого *EnvInject подключаемого модуля* .
-  **Team Foundation Server Plugin** — это необязательный подключаемый модуль, который является только при использовании Team Foundation Server или службы Team Foundation для управления исходным кодом.

Jenkins Git поддерживает не все дополнительные подключаемые модули.

После установки всех подключаемых модулей, может потребоваться перезапустить Jenkins и Настройка глобальных параметров для каждого подключаемого модуля. Глобальные параметры для подключаемого модуля можно найти, выбрав **Jenkins > Управление Jenkins > Настройка системы** из левый верхний угол, как показано на снимке экрана ниже:

 [![](jenkins-walkthrough-images/image13.png "Глобальные параметры для подключаемого модуля можно найти, выбрав Jenkins и управление Jenkins / Настройка системы в верхнем левом углу стороны угла")](jenkins-walkthrough-images/image13.png#lightbox)

При выборе этого параметра меню, вы перейдете к **Настройка системы [Jenkins]** страницы. Эта страница содержит разделы для настройки Jenkins сам и задать некоторые значения глобальных подключаемого модуля.  На следующем снимке экрана показан пример страницы:

 [![](jenkins-walkthrough-images/image14.png "На этом снимке экрана показан пример страницы")](jenkins-walkthrough-images/image14.png#lightbox)


#### <a name="configuring-the-msbuild-plugin"></a>Настройка подключаемого модуля MSBuild

Подключаемый модуль MSBuild должен быть настроен на использование **/Library/Frameworks/Mono.framework/Commands/xbuild** для компиляции Visual Studio для Mac файлы решения и проекта. Прокрутите вниз **Настройка системы [Jenkins]** страницы до **добавьте MSBuild** кнопка появляется, как показано на снимке экрана ниже:

 [![](jenkins-walkthrough-images/image15.png "Прокрутите окно вниз страницы настройки системы Jenkins появляется кнопка «Добавить MSBuild»")](jenkins-walkthrough-images/image15.png#lightbox)

Нажмите эту кнопку и заполнить **имя** и **путь** для **MSBuild** поля в появившейся форме. Имя вашего **MSBuild** установки должен быть что-нибудь осмысленное при **путь к MSBuild** должен представлять собой путь к `xbuild`, которой обычно является **список_путей/платформы / Mono.framework/Commands/xbuild**. После того как мы сохраните изменения, нажав кнопку «Сохранение» или «применить» в нижней части страницы, будет иметь возможность использовать Jenkins `xbuild` для компиляции пользовательских решений.

#### <a name="configuring-the-tfs-plugin"></a>Настройка подключаемый модуль TFS

Этот раздел является обязательным, если планируется использовать TFS для вашей системы управления версиями.

Чтобы на рабочей станции OS X для взаимодействия с сервером TFS Team Explorer Everywhere должны устанавливаться на рабочей станции. Team Explorer Everywhere — это набор средств Майкрософт, куда входит клиент кросс платформенных командной строки для доступа к TFS. Team Explorer Everywhere можно загрузить в Майкрософт и установить в три этапа:

1. Распакуйте файл архива в каталог, доступный для учетной записи пользователя. Например, может распаковать файл **~/tee**.
2. Настройка пути для включения к папке, содержащей файлы, которые были распакованы в шаге приведенного выше оболочки или системы. Например, примененная к объекту директива

        echo export PATH~/tee/:$PATH' >> ~/.bash_profile

3. Чтобы убедиться, что установлен Team Explorer Everywhere, откройте сеанс терминала и выполнения `tf` команды. При правильной настройке tf в сеансе терминалов появится следующий результат:

        $ tf
        Team Explorer Everywhere Command Line Client (version 11.0.0.201306181526)

        Available commands and their options:

После установки клиента командной строки для TFS Jenkins необходимо задать полный путь к `tf` клиент командной строки. Прокрутите вниз **Настройка системы [Jenkins]** страницы найдите раздел Team Foundation Server, как показано на следующем снимке экрана:

 [![](jenkins-walkthrough-images/image17.png "Прокрутите вниз страницы настройки системы Jenkins, пока не найдете раздел Team Foundation Server")](jenkins-walkthrough-images/image17.png#lightbox)

Введите полный путь к `tf` команду и нажмите кнопку **Сохранить** кнопки.

### <a name="configure-jenkins-security"></a>Настройка безопасности Jenkins

При первой установке Jenkins имеет выключены функции безопасности, поэтому любой пользователь может установить и запустить задание любого вида анонимно. В этом разделе описывается настройка безопасности с помощью пользовательской базы данных Jenkins для настройки проверки подлинности и авторизации.

Параметры безопасности можно найти, выбрав **Jenkins > Управление Jenkins > Настройка глобальных безопасности**, как показано на этом снимке экрана:

 [![](jenkins-walkthrough-images/image18.png "Параметры безопасности можно найти, выбрав Jenkins / Jenkins, управление и настройка глобальной безопасности")](jenkins-walkthrough-images/image18.png#lightbox)

На **Настройка глобальных безопасности** установите флажок **включить защиту** флажок и **управления доступом** формы должно быть, похоже на следующем снимке экрана:

 [![](jenkins-walkthrough-images/image19.png "На странице настройки глобальной безопасности проверки безопасности включить форму управления доступом и флажок должно быть, похоже на следующий снимок экрана")](jenkins-walkthrough-images/image19.png#lightbox)

Переключение в переключателе **Jenkins собственную пользовательскую базу данных** в **раздел области безопасности**и убедитесь, что **разрешить пользователям зарегистрироваться** также проверяется, как показано в Следующий снимок экрана:

 [![](jenkins-walkthrough-images/image20.png "Переключение в переключателе Jenkins собственную пользовательскую базу данных в разделе области безопасности и убедитесь, что также установлен флажок Разрешить пользователям зарегистрироваться")](jenkins-walkthrough-images/image20.png#lightbox)

Наконец перезапустите Jenkins и создать новую учетную запись. Первая учетная запись, которая создается является учетной записи root, и эта учетная запись будет автоматически обновлен до администратора. Вернитесь к **Настройка глобальных безопасности** страницы и отмечать **безопасности на основе матрицы** переключатель. Учетной записи root должен быть предоставлен полный доступ и анонимной учетной записи должен быть предоставлен доступ только для чтения, как показано на следующем снимке экрана:

 [![](jenkins-walkthrough-images/image21.png "Учетной записи root должен быть предоставлен полный доступ и анонимной учетной записи должен быть предоставлен доступ только для чтения")](jenkins-walkthrough-images/image21.png#lightbox)

Как только эти параметры сохраняются и перезапуска Jenkins безопасности будет включена.


#### <a name="disabling-security"></a>Отключение безопасности

В случае забытый пароль или Jenkins уровня блокировки имеется возможность отключить безопасность, выполнив следующие действия:

1. Остановите Jenkins. Если вы используете Jenkins.app, это можно сделать, щелкнув правой кнопкой мыши на значок Jenkins.App в дока и выбрав Quit в появившемся меню:

    ![](jenkins-walkthrough-images/image19.png "Значок приложения на дока и выбрав в меню, появившемся Quit")
2. Откройте файл **~/.jenkins/config.xml** в текстовом редакторе.
3. Измените значение `<usesecurity></usesecurity>` элемент из `true` для `false`.
4. Удалить `<authorizationstrategy></authorizationstrategy>` и `<securityrealm></securityrealm>` элементы из файла.
5. Перезапустите Jenkins.

## <a name="setting-up-a-job"></a>Настройка задания

На верхнем уровне Jenkins представляет различные задачи, необходимые для создания программного обеспечения в *задания*. Задание также содержит метаданные, связанные с ним, предоставляя информацию о построении, например для получения исходного кода, как часто следует запускать построения, все специальные переменные, которые необходимы для построения и способ уведомления разработчиков ошибки сборки.

Задания создаются путем выбора **Jenkins > новое задание** меню в правом верхнем углу окна, как показано на следующем снимке экрана:


![](jenkins-walkthrough-images/image22.png "Задания создаются путем выбора из меню в правом верхнем углу новое задание Jenkins")

При этом отобразится **новое задание [Jenkins]** страницы. Введите имя для задания и выберите **построения проекта программного обеспечения освободить стиль** переключатель. На следующей картинке показан пример этого:

![](jenkins-walkthrough-images/image23.png "Введите имя для задания и щелкните переключатель, проектов программного обеспечения освободить стиля построения")

Щелкнув **ОК** кнопка представляет страницу конфигурации для задания. Это должна напоминать следующий снимок экрана.

![](jenkins-walkthrough-images/image24.png "Это должен быть похож на этом снимке экрана")

Jenkins организует заданий в каталоге на жестком диске, расположенный по следующему пути: **~/.jenkins/jobs/[JOB имя]**

Эта папка содержит все файлы и артефакты, относящиеся к заданию, например журналы, файлы конфигурации и исходный код, который должна быть скомпилирована.

После создания начального задания необходимо установить с одним или несколькими из следующих:

 - Должен быть указан в системе управления исходным кодом.
 - Один или несколько *построения действий* необходимо добавить в проект. Это действия или задачи, необходимые для построения приложения.
 - Задания необходимо назначить один *триггер построения* — это набор инструкций о том, как часто Jenkins получить код и сборка окончательной проекции.

### <a name="configuring-source-code-control"></a>Настройка системы управления версиями

Первая задача не Jenkins получить исходный код из системы управления исходным кодом. Jenkins поддерживает многие популярные системах управления исходного кода сегодня. В этом разделе рассматриваются два распространенных систем Git и Team Foundation Server. Каждый из этих системах управления исходного кода рассматривается более подробно в следующих разделах.

#### <a name="using-git-for-source-code-control"></a>С помощью Git для управления исходным кодом

Если вы используете TFS для управления исходным кодом [пропустить](#Using_TFS_for_Source_Code_Management) этот раздел и перейдите к следующему разделу, с помощью TFS.

Jenkins поддерживает Git готового — необходимы нет дополнительные подключаемые модули. Чтобы использовать Git, щелкните на **Git** переключатель и введите URL-адрес в репозитории Git, как показано на следующем снимке экрана:

![](jenkins-walkthrough-images/image25.png "Чтобы использовать Git, щелкните переключатель в Git и введите URL-адрес для репозитория Git")

После сохранения изменений Git Настройка завершена.

#### <a name="using-tfs-for-source-code-management"></a>С помощью TFS для управления исходным кодом

Этот раздел применим только для пользователей Team Foundation Server.

Щелкните **Team Foundation Server** переключатель и раздела конфигурации TFS должно выглядеть, какова на следующем снимке экрана:


![](jenkins-walkthrough-images/image26.png "Щелкните переключатель в Team Foundation Server и должны отображаться в разделе конфигурации TFS")

Укажите сведения, необходимые для TFS. На следующей картинке показан пример заполненная форма:

![](jenkins-walkthrough-images/image27.png "На этом снимке экрана показан пример заполненная форма")

#### <a name="testing-the-source-code-control-configuration"></a>Тестирование конфигурации управления исходного кода

После настройки управления соответствующего исходного кода щелкните **Сохранить** для сохранения изменений. Это будет вернуться на домашнюю страницу для задания, который будет напоминать следующий снимок экрана:

![](jenkins-walkthrough-images/image28.png "Это вернуться на домашнюю страницу для задания, как показано на этом снимке экрана")

Самый простой способ проверить настройку управления исходным кодом является запустить сборку вручную, даже если действий построения, не указан. Ручной запуск построения имеет домашнюю страницу задания **сборки теперь** ссылку в меню с левой стороны, как показано на снимке экрана ниже:

![](jenkins-walkthrough-images/image29.png "Для запуска построения вручную, домашнюю страницу задания имеет ссылку сборки теперь в левой части меню")

При запуске построения окно журнала построения отображается мигающий синий круг, индикатор хода выполнения, номер сборки и время начала сборки, аналогичные следующим образом:

![](jenkins-walkthrough-images/image30.png "При запуске построения диалогового окна создания журнала отображает мигает синий круг, индикатор хода выполнения, номер сборки и время запуска построения")

Если задание выполняется успешно, будет отображаться голубой круг. В случае сбоя, отображается красный кружок.

Чтобы упростить устранение неполадок, которые могут возникнуть в процессе построения, Jenkins соберет все выходные данные в консоли для задания. Для просмотра выходных данных консоли, нажмите кнопку для задания в **журнала построения**, а затем на **вывод на консоль** ссылку в меню слева. На следующем снимке экрана показано **вывод на консоль** связи, а также некоторые выходные данные из успешного задания:

![](jenkins-walkthrough-images/image31.png "На этом снимке экрана показано ссылку вывод на консоль, а также некоторые выходные данные из успешного задания")

#### <a name="location-of-build-artifacts"></a>Расположение артефактов сборки

Jenkins извлечет весь исходный код в специальных папку с названием *рабочей*. Этот каталог можно найти в папке в следующем расположении:

    ~/.jenkins/jobs/[JOB NAME]/workspace

Путь к рабочей области будет храниться в переменной среды с именем `$WORKSPACE`.

Можно просматривать папки рабочей области в Jenkins, перейдите на главную страницу для задания и затем щелкните на **рабочей** ссылку в меню слева. На следующем рисунке показан пример рабочей области для задания с именем **HelloWorld**:

![](jenkins-walkthrough-images/image32.png "На этом снимке экрана показан пример рабочей области для задания с именем "HelloWorld"")

### <a name="build-triggers"></a>Построение триггеры

Существует несколько различных стратегий для инициализации сборки в Jenkins — они известны как *сборки триггеров*. Триггер построения помогает решить, когда следует запустить задание и выполните построение проекта Jenkins. Два наиболее распространенных триггеров сборки являются:

- **Построение периодически** — этот триггер запускает Jenkins для запуска задания с заданным интервалом, например каждые два часа или в полночь по рабочим дням. Запускает сборки независимо от того, следует ли будут внесены изменения в репозитории исходного кода.
- **SCM опроса** — этот триггер будет опрашивать управления исходным кодом на регулярной основе. Если все изменения были зафиксированы на репозиторий исходного кода, Jenkins будет запустите новую сборку.

Опрос SCM является триггером популярных, так как он обеспечивает быстрый отзыв при разработчик фиксирует изменения, которые приводят к прервать сборки. Это полезно для предупреждений команды были зафиксированы недавно код вызывает проблемы что позволяет решить проблему, пока изменения будут по-прежнему свежей помнить разработчикам.

Периодических сборок часто используются для создания версии приложения, которое можно распространять тест-инженеры. Например периодические сборки может быть выполнено для пятницу вечером, чтобы члены команды QA можно проверить работу предыдущей недели.


### <a name="compiling-a-xamarinios-applications"></a>Компиляция приложения Xamarin.iOS
Проекты Xamarin.iOS можно скомпилировать в командной строке с помощью `xbuild` или `msbuild`. Команда оболочки будет выполняться в контексте учетной записи пользователя, на котором выполняется Jenkins. Очень важно, что учетная запись пользователя имеет доступ к профиля подготовки, чтобы приложение можно было правильно упаковать для распространения. Можно добавить на страницу настройки задания эта команда оболочки.

Прокрутите вниз до **построения** раздела. Нажмите кнопку **добавить шаг сборки** и выберите пункт **выполнение оболочки**, как показано на следующем снимке экрана:

![](jenkins-walkthrough-images/image33.png "Нажмите кнопку Добавить шаг сборки и выберите Execute оболочки")


[!include[](~/tools/ci/includes/commandline-compile-of-xamarin-ios-ipa.md)]

### <a name="building-a-xamarinandroid-project"></a>Сборка проекта Xamarin.Android

Сборка проекта Xamarin.Android очень похожа на построение проекта Xamarin.iOS. Чтобы создать apk-ФАЙЛ из проекта Xamarin.Android, Jenkins необходимо настроить для выполнения следующие два действия:

 - Скомпилируйте проект с помощью подключаемого модуля MSBuild
 - Вход и zip выравнивание APK с допустимым выпуском хранилища ключей.

В следующих двух разделах более подробно рассматриваются следующие два действия.

### <a name="creating-the-apk"></a>Создание APK

Щелкните **добавить шаг сборки** и выберите **сборки проекта Visual Studio или решение с помощью MSBuild**, как показано на снимке экрана ниже:

![](jenkins-walkthrough-images/image36.png "Создание apk-ФАЙЛ, нажмите на кнопку шага построения добавить и выбрать сборку проекта Visual Studio или решения с помощью MSBuild")

Если на этапе построения добавляется в проект, заполните поля формы, которые отображаются. Снимке экрана ниже приведен один пример заполненной формы.

![](jenkins-walkthrough-images/image37.png "Если на этапе построения добавляется в проект, заполните поля формы, которые отображаются")


Этот этап сборки будет выполняться `xbuild` в **$WORKSPACE** папки. Файл сборки MSBuild равно **Xamarin.Android.csproj** файла. **Аргументы командной строки** укажите сборку выпуска целевого **PackageForAndroid**. Этот продукт этого шага будет apk-ФАЙЛ, в следующем расположении:

    $WORKSPACE/[PROJECT NAME]/bin/Release

На следующей картинке показан пример этого APK:

![](jenkins-walkthrough-images/image38.png "На этом снимке экрана показан пример этого APK")

Это APK не готова для развертывания, как она не подписана с помощью частного хранилища ключей и должны быть выровнены zip.

#### <a name="signing-and-zipaligning-the-apk-for-release"></a>Подписывание и Zipaligning APK для выпуска

Подписывание и zipaligning APK, технически двух отдельных задач, выполняемых на два отдельных командной строки средства из пакета SDK для Android. Тем не менее удобном для их выполнения в действии одна сборка. Дополнительные сведения о входе и zipaligning apk-ФАЙЛ документации Xamarin о подготовке приложения для выпуска.

Обе эти команды требуют параметров командной строки, которые могут изменяться из проекта на проект. Кроме того некоторые из этих параметров командной строки, пароли, которые не должны отображаться в выходных данных консоли при выполнении сборки. Мы будем хранить некоторые из этих параметров командной строки в переменных среды. Переменные среды, необходимые для подписи и/или выравнивание zip описаны в следующей таблице:

|Переменная среды|Описание|
|--- |--- |
|KEYSTORE_FILE|— Это путь в хранилище ключей для подписи APK|
|KEYSTORE_ALIAS|Ключ в хранилище ключей, который будет использоваться для входа APK.|
|INPUT_APK|Apk-ФАЙЛ, созданный `xbuild`.|
|SIGNED_APK|Созданные знаком APK `jarsigner`.|
|FINAL_APK|Это ZIP-файл по краю APK, произведенное `zipalign`.|
|STORE_PASS|Это пароль, используемый для доступа к содержимому для сотрудникам файл ключей.|

Как описано в разделе "требования", эти переменные среды можно задать во время сборки с помощью подключаемого модуля EnvInject. В задании должно быть новое построение шаг добавлен на основе вставки переменных среды, как показано на следующем снимке экрана:

![](jenkins-walkthrough-images/image39.png "В задании должно быть новое построение шаг добавлен в зависимости от вставки переменные среды")

В **свойства содержимого** форме поле, которое будет отображаться, добавляются переменные среды, по одному в строке, в следующем формате:

    ENVIRONMENT_VARIABLE_NAME = value

На следующем рисунке показан переменные среды, которые требуются для подписи APK:

![](jenkins-walkthrough-images/image40.png "На этом снимке экрана показаны переменные среды, которые требуются для подписи APK")

Обратите внимание на то, какие-либо переменные среды для файлов APK построены на `WORKSPACE` переменной среды.

Пароль для доступа к содержимому хранилище ключей является переменной среды окончательного: `STORE_PASS`. Пароли являются конфиденциальные значения, которые должны быть закрыты или указан в файлах журнала. Подключаемый модуль EnvInject можно настроить так, чтобы защитить эти значения, они не отображаются в журналах.

Непосредственно перед **построения** раздел конфигурации задания **среду сборки среды** раздела. Когда **внедрить пароли** переключаться флажок, некоторую форму полей для отображения. Эти поля в форме используются для извлечения имени и значения переменной среды. Снимке экрана ниже приведен пример добавления `STORE_PASS` переменной среды:

![](jenkins-walkthrough-images/image41.png "Этот снимок экрана с примером может служить добавление переменной среды STOREPASS")

После инициализации переменных среды следующим шагом является добавление этапа сборки для подписи и почтовый индекс выравнивание APK. Сразу после шага построения для вставки переменные среды, будут другой **выполнение оболочки** командной сборки, который будет выполнять `jarsigner` и `zipalign`. Каждая команда может занять одну строку, как показано в следующем фрагменте:


    jarsigner -verbose -sigalg MD5withRSA -digestalg SHA1 -keystore $KEYSTORE_FILE -storepass $STORE_PASS -signedjar $SIGNED_APK $INPUT_APK $KEYSTORE_ALIAS
    zipalign -f -v 4 $SIGNED_APK $FINAL_APK

На следующей картинке показан пример введите `jarsigner` и `zipalign` команд в шаг:

![](jenkins-walkthrough-images/image42.png "На этом снимке экрана показан пример того, как для ввода команды jarsigner и zipalign в шаге")

После всех действий построения на месте, рекомендуется запускать ручной сборки, чтобы убедиться, что все работает. Если в случае ошибки сборки **вывод на консоль** должна рассматриваться на предмет сведений о причине к неудачному завершению сборки.

### <a name="submitting-tests-to-test-cloud"></a>Отправка тесты для тестирования облака

Автоматические тесты можно передать на Test Cloud с помощью команд оболочки. Дополнительные сведения о настройке тестового запуска в Xamarin Test Cloud у нас есть руководства по использованию [Xamarin.UITest](https://developer.xamarin.com/guides/testcloud/uitest/working-with/submitting-tests-to-xamarin-test-cloud/) или [Calabash](https://developer.xamarin.com/guides/testcloud/calabash/working-with/submitting-tests-to-xamarin-test-cloud/).


## <a name="summary"></a>Сводка

В этом руководстве мы сервера сборки в Mac OS X, реализованная Jenkins и настроить его для компиляции и подготовка для выпуска Xamarin мобильных приложений. Jenkins мы установлены на компьютере Mac OS X вместе с несколько подключаемых модулей для поддержки процесса построения. Мы создается и настраивается задание, которое кода по запросу из Git или TFS, а затем скомпилировать этот код в готовности конечного приложения. Мы также использовать два разных способа планирование запуска заданий.

## <a name="related-links"></a>Связанные ссылки

- [Непрерывная интеграция](https://developer.xamarin.com~/testcloud/ci/)
- [Отправка тесты для Xamarin Test Cloud](https://developer.xamarin.com~/testcloud/submitting/)
- [Почему Jenkins не поддерживается в Xamarin?](~/cross-platform/troubleshooting/questions/xamarin-jenkins.md)
