---
title: С помощью команды города с помощью Xamarin
description: В этом руководстве, рассмотрим действия, связанные с использованием TeamCity для компиляции приложения для мобильных устройств и их отправки в Xamarin Test Cloud.
ms.prod: xamarin
ms.assetid: AC2626CB-28A7-4808-B2A9-789D67899546
ms.technology: xamarin-cross-platform
author: topgenorth
ms.author: toopge
ms.date: 03/23/2017
ms.openlocfilehash: 643ae8f30dc6447b548448f77883b204d8dc76c2
ms.sourcegitcommit: 945df041e2180cb20af08b83cc703ecd1aedc6b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/04/2018
---
# <a name="using-team-city-with-xamarin"></a>С помощью команды города с помощью Xamarin

_В этом руководстве, рассмотрим действия, связанные с использованием TeamCity для компиляции приложения для мобильных устройств и их отправки в Xamarin Test Cloud._

Как было сказано в [введение в непрерывной интеграции](~/tools/ci/intro-to-ci.md) руководстве непрерывной интеграции (CI) полезна при разработке приложений для мобильных устройств качества. Предусмотрено много вариантов приемлемым для непрерывной интеграции серверное программное обеспечение; в этом руководстве основное внимание уделяется [TeamCity](http://www.jetbrains.com/teamcity/) из JetBrains.

Существует несколько различных вариантов установки TeamCity. Ниже приведен список некоторых из них.

- **Служба Windows** — в этом сценарии TeamCity запуск при загрузке Windows как служба Windows. Должны быть связаны с узлом Mac сборки для компиляции приложений iOS.

- **Запуск управляющей программы в OS X** — по существу, это очень похоже на запуск в качестве службы Windows, описанной в предыдущем шаге. По умолчанию построения будет выполняться в учетной записи root.

- **Учетная запись пользователя в OS X** — можно запустить TeamCity, запускается каждый раз при входе пользователя в учетной записи пользователя.

Из предыдущих сценариях TeamCity под управлением учетной записи пользователя в OS X является простой и удобный в программу установки.

Существуют несколько шагов, связанные с настройкой TeamCity:

- **Установка TeamCity** — в этом руководстве не рассматривается установка TeamCity. В этом руководстве предполагается, что TeamCity установлен и запущен под учетной записью пользователя. Инструкции по [Установка TeamCity](http://confluence.jetbrains.com/display/TCD8/Installation) можно найти в [TeamCity 8 документации](http://confluence.jetbrains.com/display/TCD8/TeamCity+Documentation) , созданная JetBrains.

- **Подготовка сервера построения** — для этого шага требуется установить необходимое программное обеспечение, средства, и сертификаты, необходимые для построения приложений для мобильных устройств и подготовки их к распространению.

- **Создание скрипта построения** — этот шаг не является обязательным, но скрипт сборки является полезным вспомогательное средство для создания приложений в автоматическом режиме. С помощью скрипта построения помогут при устранении неполадок сборки, которые могут возникнуть и обеспечивает надежные, стабильные для создания двоичных файлов для распространения, даже если непрерывной интеграции не см.

- **Создание проекта TeamCity** — после завершения предыдущие три шага, необходимо создать проект TeamCity, который будет содержать все метаданные-необходимые для получения исходного кода, компиляцией проектов и отправлять тесты Xamarin Test Cloud.

# <a name="requirements"></a>Требования

Опыт работы с [Xamarin Test Cloud](https://developer.xamarin.com/guides/testcloud) является обязательным.

Знакомство с TeamCity 8.1 является обязательным. Установка TeamCity выходит за рамки настоящего документа. Предполагается, что установлена на OS X Mavericks TeamCity и выполняется под учетной записью пользователя, а не учетной записи root.

Сервер сборки должно быть автономный компьютер, с OS X, предназначенный для непрерывной интеграции. В идеальном случае сервер сборки не будет отвечать за других ролей, таких как сервер базы данных, веб-сервере или рабочей станции разработчика.

> [!IMPORTANT]
> В данном руководстве не рассматривается «без монитора» установки Xamarin.

[!include[](~/tools/ci/includes/firewall-information.md)]

## <a name="preparing-the-build-server"></a>Подготовка сервера построения

Для установки всех необходимых средств, программного обеспечения и сертификаты, необходимые для создания приложений для мобильных устройств является ключевым этапом в настройке сервера сборки. Очень важно обеспечить возможность компиляции мобильного решения и любые тесты, сервер сборки. Чтобы свести к минимуму проблемы с конфигурацией, программное обеспечение и инструменты должен устанавливаться в той же учетной записью, на котором размещается TeamCity. Ниже приведен список требования:

1. **Visual Studio для Mac** — Сюда входят Xamarin.iOS и Xamarin.Android.
2. **Имя входа в хранилище компонента Xamarin** — это необязательный шаг, только требуется, если приложение использует компоненты из хранилища компонент Xamarin. Упреждающего ведения журнала в хранилище компонентов на этом этапе не позволит проблемы при попытке построения TeamCity компиляции приложения.
3. **Xcode** — для компиляции и подписание приложения iOS требуется Xcode.
4. **Средства командной строки Xcode** — это описано в шаге 1 раздела установки [обновление Ruby с rbenv](https://developer.xamarin.com/guides/testcloud/calabash/updating-ruby-using-rbenv/) руководства.
5. **Подписи службы идентификации и профили подготовки** — импортировать сертификаты и подготовительный профиль с помощью XCode. См. в руководстве Apple [экспорт удостоверений подписи и профили подготовки](https://developer.apple.com/library/ios/recipes/xcode_help-accounts_preferences/articles/export_signing_assets.html) для получения дополнительных сведений.
6. **Android Keystores** — копирование необходимые keystores Android в каталог, что TeamCity пользователь имеет доступ, т. е. `~/Documents/keystores/MyAndroidApp1`.
7. **Calabash** — это необязательный шаг, если ваше приложение было написано с помощью Calabash тестов. См. в разделе [Calabash Установка на OS X Mavericks](https://developer.xamarin.com/guides/testcloud/calabash/osx-installation/) руководства и [обновление Ruby с rbenv](https://developer.xamarin.com/guides/testcloud/calabash/updating-ruby-using-rbenv/) для дополнительных сведений.

На следующей схеме показана все эти компоненты:

![](teamcity-images/image1.png "Диаграмма иллюстрирует все эти компоненты")

Как только все программное обеспечение установлено, войдите с учетной записью пользователя и убедитесь, что все программное обеспечение правильно установлен и работает. Это должно включать компиляции решения и отправка приложение в облаке для тестирования. Это может значительно упростить путем выполнения сценария сборки, как описано в следующем разделе.

## <a name="create-a-build-script"></a>Создание сценария построения

Несмотря на то, что это вполне TeamCity для обработки всех аспектов компиляции и отправка мобильных приложений в Test Cloud сам по себе, настоятельно рекомендуется создать скрипт построения. Скрипт сборки обеспечивает следующие преимущества:

1. **Документация** — скрипт сборки служит форме документации на построение программного обеспечения. Эта функция удаляет некоторые «работа», связанного с развертыванием приложений и позволяет разработчикам сосредоточиться на функции.
1. **Повторимость** — скрипт сборки обеспечивается каждый раз при компиляции приложения и развертывания, он точно таким же образом, независимо от того, кто или что делает работу. Это repeatable согласованности устраняет проблемы и ошибки, которые могут проникают в из-за неправильно выполненного построения или человеческой ошибки.
1. **Управление версиями** — скрипт сборки могут быть включены в системе управления версиями. Это означает, что изменения в сценарий отслеживаются, отслеживания и устранить найденные ошибки или неточности.
1. **Подготовка среды** — сценарий построения может включать логику, чтобы установить все необходимые зависимостей третьих лиц. Это позволит гарантировать, что все компоненты, необходимые построение приложений.

Скрипт построения может быть простым как файл Powershell (в Windows) или bash сценария (в OS X). При создании сценария построения, существует несколько вариантов языков сценариев:

- [**Rake** ](https://github.com/jimweirich/rake) – это язык конкретного домена (DSL) для построения проектов, на основании Ruby. Rake имеет преимущество популярности и широким спектром библиотеки.

- [**psake** ](https://github.com/psake/psake) — это библиотека Windows Powershell для создания программного обеспечения

- [**ПОДДЕЛАТЬ** ](http://fsharp.github.io/FAKE/) — это DSL в F #, что делает возможным использование существующих библиотек .NET, при необходимости.

Используемый язык сценариев зависит от настроек и требования. [TaskyPro Calabash](https://github.com/xamarin/test-cloud-samples/tree/master/TaskyPro/TaskyPro-Calabash) пример содержит пример использования Rake как [создания скрипта](https://github.com/xamarin/test-cloud-samples/blob/master/TaskyPro/TaskyPro-Calabash/Rakefile).


> [!NOTE]
> Это позволяет использовать системы построения на основе XML, такие как MSBuild или NAnt, но эти отсутствие выразительность и удобства сопровождения доменный язык DSL, предназначенный для создания программного обеспечения.

### <a name="parameterizing-the-build-script"></a>Параметризация скрипт построения

Процесс построения и тестирования программного обеспечения требуются данные, которые должны храниться в секрете. В частности Создание APK может требовать пароль для ключей и/или псевдоним ключа в хранилище ключей. Аналогично Test Cloud требуется ключ API, которое является уникальным для разработчиков. Эти типы значений не должны быть жестких закодированных в скрипте сборки. Вместо этого они должны передаваться как переменные в скрипте построения.

Менее важной являются значениями, таких как iOS Идентификатором устройства или устройства Android, идентификации устройств, которыми облако тестирования следует использовать для тестирования работает. Они не являются значения, которые должны быть защищены, но они могут изменяться из сборки.

Сохранение этих типов переменных вне скрипт построения также упрощает скрипт сборки в рамках организации, совместно с разработчиками использовать пример. Разработчики могут использовать тот же самый скрипт, что и сервер построения, но можно использовать свои собственные keystores и ключи API.

Существует два возможных варианта для хранения этих конфиденциальные значения.

- **Файл конфигурации** — для защиты ключа API тестирования облака, это значение не должно проверяться в системе управления версиями. Файл может создаваться для каждого компьютера. Язык сценариев, используемый как значения считываются из этого файла зависит.

- **Переменные среды** — их легко настраивать на уровне компьютера и ared независимо от используемого языка скриптов.

Есть свои преимущества и недостатки каждого из этих вариантов. TeamCity хорошо работает с переменными среды, поэтому в этом руководстве рекомендует этот метод при создании сценариев построения.

### <a name="build-steps"></a>Шаги построения

Скрипт сборки должны иметь возможность выполните следующие действия:

- **Скомпилируйте приложение** — Сюда входят подписи приложения с помощью правильного профиля подготовки.

- **Отправить приложение Xamarin Test Cloud** — Сюда входят подписи и zip, выравнивание apk-ФАЙЛ с помощью соответствующих ключей.

Следующие два действия будут описаны более подробно ниже.

#### <a name="compiling-a-xamarinios-application"></a>Компиляция приложения Xamarin.iOS

[!include[](~/tools/ci/includes/commandline-compile-of-xamarin-ios-ipa.md)]

#### <a name="compiling-a-xamarinandroid-application"></a>Компиляция приложения Xamarin.Android

Для компиляции приложения, используйте **xbuild** (или **msbuild** в Windows):

```bash
/Library/Frameworks/Mono.framework/Commands/xbuild /t:SignAndroidPackage /p:Configuration=Release /path/to/android.csproj
```

Обратите внимание, что при компиляции приложения Xamarin Android **xbuild** использует проект и что сборка приложения iOS **xbuild** требует решения.

#### <a name="submitting-xamarinuitests-to-test-cloud"></a>Отправка Xamarin.UITests облако теста

UITests отправляются с помощью `test-cloud.exe` приложения, как показано в следующем фрагменте:

```bash
test-cloud.exe <path-to-apk-or-ipa-file> <test-cloud-team-api-key> --devices <device-selection-id> --assembly-dir <path-to-tests-containing-test-assemblies> --nunit-xml report.xml --user <email>
```

При выполнении теста результаты теста будет возвращаться в виде XML-файла NUnit стиль вызывается **report.xml**. TeamCity будет отображать сведения в журнале сборки.

Дополнительные сведения о том, как отправить UITests облако теста см. руководство по Xamarin на [Отправка тесты для Test Cloud](https://developer.xamarin.com/guides/testcloud/uitest/working-with/submitting-tests-to-xamarin-test-cloud/).

#### <a name="submitting-calabash-tests-to-test-cloud"></a>Отправка Calabash тесты для тестирования облака

Calabash тесты отправляются с помощью `test-cloud` gem, как показано в следующем фрагменте:

```bash
test-cloud submit /path/to/APK-or-IPA <test-cloud-team-api-key> --devices <device-id> --user <email>
```
Чтобы отправить приложение Android для тестирования облака, бывает необходимо перестроить apk-ФАЙЛ тестового сервера с помощью calabash android:

```bash
$ calabash-android build </path/to/signed/APK>
$ test-cloud submit /path/to/APK <test-cloud-team-api-key> --devices <ANDROID_DEVICE_ID> --profile=android --config=config/cucumber.yml --pretty
```
Дополнительные сведения по отправке Calabash тестов см. руководство по Xamarin на [Отправка Calabash тесты для Test Cloud](https://developer.xamarin.com/guides/testcloud/calabash/working-with/submitting-tests-to-xamarin-test-cloud/).

## <a name="creating-a-teamcity-project"></a>Создание проекта TeamCity

После установки TeamCity и проект Visual Studio для Mac можно построить, пришло время для создания проекта в TeamCity построение проекта и отправить его на Test Cloud.

1. Запущен, войдя в TeamCity в веб-браузере. Перейдите в корневой проект:

    ![](teamcity-images/image2.png "Перейдите к проекту корневой") под корневой проект, создайте новый проект вложенных:

    ![](teamcity-images/image3.png "Перейдите в корень проекта под корневой проект, создайте новый проект вложенные")
2. После создания вложенного проекта добавьте новую конфигурацию сборки:

    ![](teamcity-images/image5.png "После создания вложенного проекта добавьте новую конфигурацию построения")
3. Вложение VCS проекта конфигурации построения. Это выполняется через экран параметр управления версии:

    ![](teamcity-images/image6.png "Это выполняется через экран параметр версии элемента управления")

    Если нет VCS проекта создана, вы можете для создания нового корня VCS страницы, показано ниже:

    ![](teamcity-images/image7.png "Если отсутствует VCS проект создан, у вас есть параметр, чтобы создать новый корневой элемент VCS страницы")

    После прикрепления корневой VCS извлечения будет TeamCity проекта и повторите для автоматического обнаружения шаги построения. Если вы знакомы с TeamCity, затем выбирается один из обнаруженных этапов. Можно безопасно пропустить шаги обнаруженных построения.

4. Настройте триггер построения. Это будет очередь построение, при определенных условий, например когда пользователь вносит кода в репозиторий. Следующем снимке экрана показано, как добавить триггер построения:

    ![](teamcity-images/image8.png "На этом снимке экрана показано, как добавить триггер построения") пример настройки триггер построения можно увидеть на следующем снимке экрана:

    ![](teamcity-images/image9.png "На этом снимке экрана можно увидеть пример настройки триггер построения")

5. Предыдущего раздела, параметризация скрипт построения, предлагаемые хранение некоторых значений в переменных среды. Эти переменные можно добавить к конфигурации построения через параметры экрана. Добавьте переменные ключ API облачного тестирования, идентификатор устройства iOS и Android идентификатор устройства, как показано на снимке экрана ниже:

    ![](teamcity-images/image11.png "Добавьте переменные ключ API облачного тестирования, идентификатор устройства iOS и Android идентификатор устройства")

6. Последним шагом является добавление шаг построения, будет вызывать скрипт сборки для компиляции приложения и постановки в очередь приложения для Test Cloud. Снимке экрана ниже приведен пример шага построения, который использует Rakefile для построения приложения.

    ![](teamcity-images/image12.png "Этот снимок экрана с примером может служить шаг построения, использует Rakefile для построения приложения")

7. На этом этапе построения Настройка завершена. Рекомендуется запустить сборку для подтверждения того, что проект настроен должным образом. Хороший способ сделать это является фиксации маленькие, незначительные изменения в репозитории. TeamCity необходимо обнаружить фиксация и начать сборку.

8. После завершения построения, проверки журнала построения и есть ли неполадках или предупреждения со сборкой, требующих внимания.

## <a name="summary"></a>Сводка

В этом руководстве рассматривается использование TeamCity для построения Xamarin мобильных приложений и их отправки в Test Cloud. Мы говорили о создании сценария построения для автоматизации процесса построения. Берет на себя скрипт построения при компиляции приложения, отправка теста облако и ожидания результатов

Затем мы узнали, как создать проект в TeamCity, очередь сборку каждый раз, разработчик фиксирует код и скрипт сборки, будет вызываться.

## <a name="related-links"></a>Связанные ссылки

- [Отправка тесты для Xamarin Test Cloud (UITest)](https://developer.xamarin.com~/testcloud/uitest/working-with/submitting-tests-to-xamarin-test-cloud/)
- [Отправка тесты для Xamarin Test Cloud (Calabash)](https://developer.xamarin.com~/testcloud/calabash/working-with/submitting-tests-to-xamarin-test-cloud/)
- [Установка и настройка TeamCity](http://confluence.jetbrains.com/display/TCD8/Installing+and+Configuring+the+TeamCity+Server)
