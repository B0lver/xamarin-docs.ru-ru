---
title: "Процесс сборки"
ms.topic: article
ms.prod: xamarin
ms.assetid: 3BE5EE1E-3FF6-4E95-7C9F-7B443EE3E94C
ms.technology: xamarin-android
author: mgmclemore
ms.author: mamcle
ms.date: 02/15/2018
ms.openlocfilehash: 68ddb9baa008ec8222b4399a5ab25330fda2afd1
ms.sourcegitcommit: 6cd40d190abe38edd50fc74331be15324a845a28
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/27/2018
---
# <a name="build-process"></a>Процесс сборки

<a name="Overview" />

## <a name="overview"></a>Обзор

Процесс сборки Xamarin.Android отвечает за объединение процессов: [создание `Resource.designer.cs`](~/android/internals/api-design.md), поддержку действий сборки `AndroidAsset`, `AndroidResource` и [других](#Build_Actions), создание [вызываемых в Android оболочек](~/android/platform/java-integration/android-callable-wrappers.md) и файла `.apk` для выполнения на устройствах Android.

<a name="App_Packaging" />
<a name="Application_Packages" />

## <a name="application-packages"></a>Пакеты приложений

В широком смысле существует два типа пакетов приложений для Android (файлы `.apk`), которые может создавать система сборки Xamarin.Android:

-   Сборки **выпуска**, которые полностью автономны и не требуют дополнительных пакетов для выполнения. Это пакеты, которые будут предоставлены в магазин приложений.

-   Сборки **отладки**, которые противоположны сборкам выпуска.

Неслучайно они соответствуют свойству `Configuration` MSBuild, которое создает пакет.

<a name="Shared_Runtime" />

### <a name="shared-runtime"></a>Общая среда выполнения

*Общая среда выполнения* — это пара дополнительных пакетов Android, которые предоставляют библиотеку базовых классов (`mscorlib.dll` и т. д.) и библиотеку привязок Android (`Mono.Android.dll` и т. д.). Отладочные сборки используют общую среду выполнения вместо библиотеки базовых классов и привязок в пакете приложения для Android, благодаря чему размер пакета отладки меньше.

Общую среду выполнения можно отключить в отладочных сборках, установив для свойства `$(AndroidUseSharedRuntime)` значение `False`.

<a name="Fast_Deployment" />

### <a name="fast-deployment"></a>Быстрое развертывание

Процесс *быстрого развертывания* взаимодействует со средой выполнения для дальнейшего сокращения размера пакета приложения для Android. Для этого сборки приложения внутри пакета не объединяются. Они копируются в целевой объект с помощью `adb push`. Этот процесс ускоряет цикл сборки, развертывания и отладки, потому что, если изменяются *только* сборки, пакет не переустанавливается. Вместо этого только обновленные сборки повторно синхронизируются с целевым устройством.

Как известно, быстрое развертывание не работает на устройствах, которые блокируют синхронизацию `adb` с каталогом `/data/data/@PACKAGE_NAME@/files/.__override__`.

Быстрое развертывание включено по умолчанию. Чтобы отключить его в отладочных сборках, нужно установить для свойства `$(EmbedAssembliesIntoApk)` значение `True`.


<a name="MSBuild_Projects" />

## <a name="msbuild-projects"></a>Проекты MSBuild

Процесс сборки Xamarin.Android основан на MSBuild, который также является файлом проекта и используется в Visual Studio для Mac и Visual Studio.
Обычно пользователям не нужно вручную редактировать файлы MSBuild: IDE создает полностью функциональные проекты и обновляет их по мере внесения изменений, а также автоматически вызывает целевые объекты сборки по мере необходимости.

Опытным пользователям может потребоваться сделать что-то, не поддерживаемое графическим интерфейсом IDE, поэтому процесс сборки настраивается путем непосредственного редактирования файла проекта.
Здесь рассматриваются только специфические для Xamarin.Android функции и настройки. С обычными элементами, свойствами и целями MSBuild можно выполнять многие другие вещи.

<a name="Build_Targets" />

## <a name="build-targets"></a>Цели сборки

Для проектов Xamarin.Android определены следующие целевые объекты сборки:

-   **Build** — создает проект.

-   **Clean** — удаляет все файлы, созданные в процессе сборки.

-   **Install** — устанавливает пакет на виртуальное устройство или устройство по умолчанию.

-   **Uninstall** — удаляет пакет на виртуальном устройстве или устройстве по умолчанию.

-   **SignAndroidPackage** — создает и подписывает пакет (`.apk`). Используется с `/p:Configuration=Release` для создания автономных пакетов выпуска.

-   **UpdateAndroidResources** — обновляет файл `Resource.designer.cs`. Этот целевой объект обычно вызывается средой IDE при добавлении новых ресурсов в проект.

<a name="Build_Properties" />

## <a name="build-properties"></a>Свойства сборки

Свойства MSBuild управляют поведением целевых объектов. Они указаны в файле проекта, например **MyApp.csproj**, в элементе [MSBuild PropertyGroup](http://msdn.microsoft.com/en-us/library/t4w159bs.aspx).

-   **Configuration** — указывает конфигурацию сборки, например "отладка" или "выпуск". Свойство Configuration используется для определения значений по умолчанию для других свойств, которые определяют поведение целевого объекта. В вашей среде IDE можно создать дополнительные конфигурации.

    *По умолчанию* конфигурация `Debug` приведет к созданию меньшего пакета Android целевыми объектами `Install` и `SignAndroidPackage`, который требует наличия других файлов и пакетов для работы.

    Конфигурация по умолчанию `Release` приведет к тому, что целевые объекты `Install` и `SignAndroidPackage` создадут пакет Android, который является *автономным* и может использоваться без установки каких-либо других пакетов или файлов.

-    **DebugSymbols**  — логическое значение, которое определяет, является ли пакет Android *отлаживаемым*, в сочетании со свойством `$(DebugType)`. Отлаживаемый пакет содержит отладочные символы, устанавливает для атрибута `//application/@android:debuggable` значение `true` и автоматически добавляет разрешение `INTERNET`, чтобы отладчик мог подключиться к процессу. Приложение отлаживается, если `DebugSymbols` имеет значение `True` *, а* `DebugType` является пустой строкой или имеет значение `Full`.

-   **DebugType** — определяет &ndash;[тип отладочных символов ](http://msdn.microsoft.com/en-us/library/s5c8athz.aspx), которые следует создать как часть сборки, что также влияет на возможность отладки приложения. Возможные допустимые значения приведены ниже.

    - **Full**: создаются все символы. Если свойство `DebugSymbols` MSBuild также имеет значение `True`, то пакет приложения является отлаживаемым.

    - **PdbOnly**: создаются символы PDB. Пакет приложений *не* будет отлаживаться.

    Если свойство `DebugType` не задано или является пустой строкой, тогда свойство `DebugSymbols` определяет, является ли это приложение отлаживаемым.


### <a name="install-properties"></a>Свойства установки

Свойства MSBuild управляют поведением целевых объектов `Install` и `Uninstall`.

-   **AdbTarget** — указывает целевое устройство Android, где может быть установлен или удален пакет Android. Значение этого свойства совпадает с значением параметра [`adb` целевого устройства](http://developer.android.com/tools/help/adb.html#issuingcommands):

    ```bash
    # Install package onto emulator via -e
    # Use `/Library/Frameworks/Mono.framework/Commands/xbuild` on OS X
    MSBuild /t:Install ProjectName.csproj /p:AdbTarget=-e
    ```

<a name="App_Packaging" />

### <a name="packaging-properties"></a>Свойства упаковки

Свойства упаковки управляют созданием пакета Android и используются целевыми объектами `Install` и `SignAndroidPackage`.
[Свойства подписи](#Signing_Properties) также актуальны при упаковке приложений выпуска.


-   **AndroidApplication** — логическое значение, указывающее, для чего предназначен проект: для приложения Android (`True`) или для библиотеки Android (`False` или не задано).

    Только один проект со значением `<AndroidApplication>True</AndroidApplication>` может присутствовать в пакете Android. (К сожалению, это еще не проверено и может привести к различным ошибкам по отношению к ресурсам Android.)

-   **AndroidBuildApplicationPackage** — логическое значение, указывающее, следует ли создавать и подписывать пакет (APK-файл). Установка значения `True` эквивалентна использованию целевого объекта [SignAndroidPackage](#Build_Targets).

    Поддержка этого свойства была добавлена в Xamarin.Android ​​после версии 7.1.

    По умолчанию это свойство имеет значение `False`.

-   **AndroidEnableMultiDex**  — логическое свойство, которое определяет, будет ли поддерживаться Multi-DEX в окончательном файле `.apk`.

    Поддержка этого свойства была добавлена в Xamarin.Android версии 5.1.

    По умолчанию это свойство имеет значение `False`.

-   **AndroidEnableSGenConcurrent** — логическое свойство, которое определяет, будет ли использоваться [параллельный сборщик мусора](http://www.mono-project.com/docs/about-mono/releases/4.8.0/#concurrent-sgen) Mono.

    Поддержка этого свойства была добавлена в Xamarin.Android версии 7.2.

    По умолчанию это свойство имеет значение `False`.

-   **AndroidFastDeploymentType** — список разделенных двоеточиями (`:`) значений для управления типами, которые можно развернуть в [каталоге быстрого развертывания](#Fast_Deployment) на целевом устройстве, если свойство MSBuild [`$(EmbedAssembliesIntoApk)`](#EmbedAssembliesIntoApk) имеет значение `False`. Если ресурс быстро развернут, он *не* встраивается в создаваемый файл `.apk`, что может ускорить развертывание. (Чем быстрее выполняется развертывание, тем реже файл `.apk` необходимо перестраивать, что ускоряет процесс установки.) Допустимы следующие значения:

    - `Assemblies`: развертывание сборок приложения.

    - `Dexes`: развертывание файлов `.dex` и ресурсов Android. **: это значение можно использовать *только* на устройствах под управлением Android 4.4 или более поздней версии (API-19).** 

    Значение по умолчанию — `Assemblies`.

    **Экспериментальное**. Свойство добавлено в Xamarin.Android версии 6.1.

-   **AndroidApplicationJavaClass** — полное имя класса Java для использования вместо `android.app.Application`, когда класс наследуется от [Android.App.Application](https://developer.xamarin.com/api/type/Android.App.Application/).

    Это свойство обычно задается *другими* свойствами, такими как свойство [`$(AndroidEnableMultiDex)`](#AndroidEnableMultiDex) MSBuild.

    Свойство добавлено в Xamarin.Android версии 6.1.

-   **AndroidHttpClientHandlerType** — разрешает установить значение переменной среды [`XA_HTTP_CLIENT_HANDLER_TYPE`](~/android/deploy-test/environment.md).
    Это значение не будет переопределять явно заданное значение `XA_HTTP_CLIENT_HANDLER_TYPE`. Значение переменной среды `XA_HTTP_CLIENT_HANDLER_TYPE`, указанное в файле [`@(AndroidEnvironment)`](#AndroidEnvironment), будет иметь приоритет.

    Свойство добавлено в Xamarin.Android версии 6.1.

-   **AndroidTlsProvider** — строковое значение, которое указывает, какой поставщик TLS следует использовать в приложении. Возможными значениями являются:

    - `btls`: используется [Boring SSL](https://boringssl.googlesource.com/boringssl) для взаимодействия через TLS с [HttpWebRequest](https://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.aspx).
      Поддерживает использование TLS 1.2.

    - `legacy`: используется историческая управляемая реализация протокола SSL для взаимодействия по сети. TLS 1.2 *не* поддерживается.

    - `default`, не задавайте значение или укажите пустую строку. В Xamarin.Android 7.1 это эквивалентно значению `legacy`.

    Значение по умолчанию — пустая строка.

    **Экспериментальное**. Свойство добавлено в Xamarin.Android версии 7.1.

-   **AndroidLinkMode** — указывает, какой тип [компоновки](~/android/deploy-test/linker.md) должен быть применен для сборок, содержащихся в пакете Android. Используется только в проектах приложений Android. Значение по умолчанию: *SdkOnly*. Допустимые значения:

    - **None**: компоновка не будет выполнена.

    - **SdkOnly**: компоновка будет выполнена только для библиотеки базовых классов, но не сборок пользователя.

    - **Full**: компоновка будет выполнена для библиотеки базовых классов и сборок пользователя. **Примечание.** Использование для свойства `AndroidLinkMode` значения *Full* часто приводит к ненадлежащей работе приложений, особенно при использовании отражения. Используйте это значение, только если это *действительно* необходимо.

    ```xml
    <AndroidLinkMode>SdkOnly</AndroidLinkMode>
    ```

-   **AndroidLinkSkip** — указывает список разделенных точкой с запятой (`;`) имен сборок, которые не должны быть связаны, без расширений файлов. Используется только в проектах приложений Android.

    ```xml
    <AndroidLinkSkip>Assembly1;Assembly2</AndroidLinkSkip>
    ```

-   **AndroidManagedSymbols** — логическое свойство, которое определяет, создаются ли точки последовательности, чтобы можно было извлечь имя файла и номер строки из трассировки стека `Release`.

    Свойство добавлено в Xamarin.Android версии 6.1.

-   **AndroidManifest** — определяет имя файла, которое будет использоваться в качестве шаблона для манифеста [`AndroidManifest.xml`](~/android/platform/android-manifest.md) приложения.
    Во время сборки необходимые значения будут объединены для создания фактического файла `AndroidManifest.xml`.
    `$(AndroidManifest)` должен содержать имя пакета в атрибуте `/manifest/@package`.

-   **AndroidSdkBuildToolsVersion** — предоставляет версию пакета средств сборки SDK для Android, который помимо прочих включает средства **aapt** и **zipalign**. Одновременно могут быть установлены несколько различных версий пакета средств сборки. Пакет средств сборки, выбранный для упаковки, создается путем проверки и использования "предпочтительной" версии, если она присутствует. Если такая версия *отсутствует*, то используется установленный пакет средств сборки последней версии.

    Свойство MSBuild `$(AndroidSdkBuildToolsVersion)` содержит предпочтительную версию средств сборки. Система сборки Xamarin.Android предоставляет значение по умолчанию в `Xamarin.Android.Common.targets`, которое можно переопределить в файле проекта, чтобы выбрать альтернативную версию средств сборки, если (например) aapt последней версии завершается сбоем, а предыдущая версия aapt не работает.

-   **AndroidSupportedAbis** — строковое свойство, которое содержит разделенный точкой с запятой (`;`) список ABI, которые должны быть включены в файл `.apk`.

    Допустимые значения:

    -   `armeabi`
    -   `armeabi-v7a`
    -   `x86`
    -   `arm64-v8a`: требуется Xamarin.Android 5.1 и более поздней версии.
    -   `x86_64`: требуется Xamarin.Android 5.1 и более поздней версии.

-   **AndroidUseSharedRuntime** — логическое значение, определяющее, требуются ли *пакеты общей среды выполнения* для запуска приложения на целевом устройстве. Их использование позволяет уменьшить пакет приложения, что ускорит процесс создания и развертывания пакета, а также цикл разработки, развертывания и отладки.

    Это свойство должно иметь значение `True` для отладочных сборок и `False` для проектов выпуска.

-   **AotAssemblies** — логическое свойство, которое определяет, будут ли сборки скомпилированы в машинный код в режиме Ahead Of Time (AOT) и включены в `.apk`.

    Поддержка этого свойства была добавлена в Xamarin.Android версии 5.1.

    По умолчанию это свойство имеет значение `False`.

-   **EmbedAssembliesIntoApk** — логическое свойство, которое определяет, следует ли внедрять сборки приложения в пакет приложения.

    Это свойство должно иметь значение `True` для сборок выпуска и `False` для сборок отладки. В сборках отладки значение `True` *может* понадобиться, если быстрое развертывание не поддерживается для целевого устройства.

    Если этому свойству присвоено значение `False`, то свойство MSBuild `$(AndroidFastDeploymentType)` также определяет вложения в `.apk`, что может повлиять на время развертывания и повторной сборки.

-   **EnableLLVM** — логическое свойство, которое определяет, будет ли использована низкоуровневая виртуальная машина (LLVM) при АОТ-компиляции сборок в машинный код.

    Поддержка этого свойства была добавлена в Xamarin.Android версии 5.1.

    По умолчанию это свойство имеет значение `False`.

    Это свойство игнорируется, если только свойство MSBuild `$(AotAssemblies)` не имеет значение `True`.

-   **EnableProguard** — логическое свойство, которое определяет, выполняется ли [proguard](http://developer.android.com/tools/help/proguard.html) как часть процесса упаковки для связывания кода Java.

    Поддержка этого свойства была добавлена в Xamarin.Android версии 5.1.

    По умолчанию это свойство имеет значение `False`.

    Если установлено значение `True`, файлы [ProguardConfiguration](#ProguardConfiguration) будут использоваться для управления выполнением `proguard`.

-   **JavaMaximumHeapSize** — указывает значение параметра **java**
    `-Xmx` для использования при формировании файла `.dex` в процессе упаковки. Если значение не указано, то параметр `-Xmx` не используется для **java**.

    Это свойство требуется указывать, если целевой объект [`_CompileDex` вызывает ошибку `java.lang.OutOfMemoryError`](https://bugzilla.xamarin.com/show_bug.cgi?id=18327).

    ```xml
    <JavaMaximumHeapSize>1G</JavaMaximumHeapSize>
    ```

-   **JavaOptions** — указывает дополнительные параметры командной строки для передачи **java** при создании файла `.dex`.

-   **MandroidI18n** — указывает поддержку интернационализации в приложении, например параметры сортировки таблиц. Значение представляет собой список, разделенный запятой или точкой с запятой, из одного или нескольких следующих значений, не учитывающих регистр:

    -   **None**: не включать дополнительные кодировки.

    -   **All**: включить все доступные кодировки.

    -   **CJK**: включить китайские, японские и корейские кодировки, такие как *Японская (EUC)* \[enc-jp, CP51932\], *Японская (Shift-JIS)* \[iso-2022-jp, shift\_jis, CP932\], *Японская (JIS)* \[CP50220\], *Китайская упрощенная (GB2312)* \[gb2312, CP936\], *Корейская (UHC)* \[ks\_c\_5601-1987, CP949\], *Корейская (EUC)* \[euc-kr, CP51949\], *Китайская традиционная (Big5)* \[big5, CP950\] и *Китайская упрощенная (GB18030)* \[GB18030, CP54936\].

    -   **MidEast**: включить кодировки языков стран Ближнего Востока, такие как *Турецкая (Windows)* \[iso-8859-9, CP1254\], *Иврит (Windows)* \[windows-1255, CP1255\], *Арабская (Windows)* \[windows-1256, CP1256\], *Арабская (ISO)* \[iso-8859-6, CP28596\], *Иврит (ISO)* \[iso-8859-8, CP28598\], *Латиница 5 (ISO)* \[iso-8859-9, CP28599\] и *Иврит (Iso альтернативный)* \[iso-8859-8, CP38598\].

    -   **Other**: включить другие кодировки, такие как *Кириллица (Windows)* \[CP1251\], *Балтийская (Windows)* \[iso-8859-4, CP1257\], *Вьетнамская (Windows)* \[CP1258\], *Кириллица (KOI8-R)* \[koi8-r, CP1251\], *Украинская (KOI8-U)*  \[koi8-u, CP1251\], *Балтийская (ISO)* \[iso-8859-4, CP1257\], *Кириллица (ISO)* \[iso-8859-5, CP1251\], *ISCII - Деванагари* \[x-iscii-de, CP57002\], *ISCII - Бенгальская* \[x-iscii-be, CP57003 \], *ISCII - Тамильская* \[x-iscii-ta, CP57004\], *ISCII - Телугу* \[x-iscii-te, CP57005\], *ISCII - Ассамская* \[x-iscii-as, CP57006\], *ISCII - Ория* \[x-iscii-or, CP57007\], *ISCII - Каннада* \[x-iscii ка CP57008\], *ISCII - Малаялам* \[x-iscii-ka, CP57009\], *ISCII - Гуджарати* \[x-iscii-gu, CP57010\], *ISCII - Панджаби* \[x-iscii-pa, CP57011\] и *Тайская (Windows)*  \[CP874\].

    -   **Rare**: включить редкие кодировки, такие как *IBM EBCDIC (турецкий)* \[CP1026\], *IBM EBCDIC (латиница 1 Open Systems)* \[CP1047\], *IBM EBCDIC (США/Канада с евро)* \[CP1140\], *IBM EBCDIC (немецкая с евро)* \[CP1141\], *IBM EBCDIC (датская/норвежская с евро)* \[CP1142\], *IBM EBCDIC (финская/шведская с евро)* \[CP1143\], *IBM EBCDIC (итальянская с евро)* \[CP1144\], *IBM EBCDIC (латиноамериканская/испанская с евро)* \[CP1145\], *IBM EBCDIC (британская с евро)* \[CP1146\], *IBM EBCDIC (французская с евро)* \[CP1147\], *IBM EBCDIC (международная с евро)* \[CP1148\], *IBM EBCDIC (исландская с евро)* \[CP1149\], *IBM EBCDIC (Германия)* \[ CP20273\], *IBM EBCDIC (Дания и Норвегия)* \[CP20277\], *IBM EBCDIC (Финляндия и Швеция)* \[CP20278\], *IBM EBCDIC (Италия)* \[CP20280\], *IBM EBCDIC (латиноамериканская/испанская)* \[CP20284\], *IBM EBCDIC (британская)* \[CP20285\], *IBM EBCDIC (японская расширенная катакана)* \[CP20290\], *IBM EBCDIC (Франция)* \[CP20297\], *IBM EBCDIC (арабская)* \[CP20420\], *IBM EBCDIC (иврит)* \[CP20424\], *IBM EBCDIC (исландская)* \[CP20871\], *IBM EBCDIC (Кириллица сербско-болгарская)* \[CP21025\], *IBM EBCDIC (США и Канада)* \[ CP37\], *IBM EBCDIC (международная)* \[CP500\], *Арабская (ASMO 708)* \[CP708\], *Центральноевропейская (DOS)* \[CP852\]*, Кириллица (DOS)* \[CP855\], *Турецкая (DOS)* \[CP857\], *Западноевропейская (DOS с евро)* \[CP858\], *Иврит (DOS)* \[CP862\], *Арабская (DOS)* \[CP864\], *Русская (DOS)* \[CP866\], *Греческая (DOS)* \[CP869\], *IBM EBCDIC (латиница 2)* \[CP870\] и *IBM EBCDIC (греческая)* \[CP875\].

    -   **West**: включить западные кодировки, такие как *Западноевропейская (Mac)* \[macintosh, CP10000\], *Исландская (Mac)* \[x-mac-icelandic, CP10079\], *Центральноевропейская (Windows)* \[iso-8859-2, CP1250\], *Западноевропейская (Windows)* \[iso-8859-1, CP1252\], *Греческая (Windows)* \[iso-8859-7, CP1253\], *Центральноевропейская (ISO)* \[iso-8859-2, CP28592\], *Латиница 3 (ISO)* \[iso-8859-3, CP28593\], *Греческая (ISO)* \[iso-8859-7, CP28597\], *Латиница 9 (ISO)*  \[iso-8859-15, CP28605\], *OEM - США* \[CP437\], *Западноевропейская (DOS)* \[CP850\], *Португальская (DOS)* \[CP860\], *Исландская (DOS)* \[CP861\], *Французская канадская (DOS)* \[CP863\] и *Скандинавская (DOS)* \[CP865\].

    ```xml
    <MandroidI18n>West</MandroidI18n>
    ```

-   **MonoSymbolArchive** — логическое свойство, которое определяет, следует ли создавать артефакты `.mSYM` для последующего использования в `mono-symbolicate`, чтобы извлечь "реальные" имя файла и номер строки из трассировки стека выпуска.

    Для приложений "выпуска" значением по умолчанию является True с включенными отладочными символами: [`$(EmbedAssembliesIntoApk)`](#EmbedAssembliesIntoApk) — True, `$(DebugSymbols)` — True и `$(Optimize)` — True.

    Свойство добавлено в Xamarin.Android версии 7.1.

-   **AndroidVersionCodePattern** — строковое свойство, которое позволяет разработчикам настраивать `versionCode` в манифесте.
    Дополнительные сведения об определении `versionCode` см. в разделе [Создание версии кода для APK](~/android/deploy-test/building-apps/abi-specific-apks.md).

    Например, если `abi` имеет значение `armeabi`, а `versionCode` в манифесте — `123`, тогда `{abi}{versionCode}` выдает код версии `1123`, если `$(AndroidCreatePackagePerAbi)` имеет значение True, в противном случае будет создано значение 123.
    Если `abi` — `x86_64`, а `versionCode` в манифесте — `44`, будет получено значение `544`, если `$(AndroidCreatePackagePerAbi)` — True, в противном случае значением будет `44`.

    Если включить формат строки левого дополнения `{abi}{versionCode:0000}`, значением будет `50044`, так как слева к `versionCode` будет добавлен `0`. Можно также использовать десятичное дополнение, например `{abi}{versionCode:D4}`, которое делает то же, что и в предыдущем примере.

    Поддерживаются только строки формата дополнения "0" и "Dx", потому что значение ДОЛЖНО быть целым числом.

    Предварительно определенные ключевые элементы

    -   **ABI** — вставляет целевой ABI для приложения.
        -   1 — `armeabi`.
        -   2 — `armeabi-v7a`.
        -   3 — `x86`.
        -   4 — `arm64-v8a`.
        -   5 — `x86_64`.

    -   **minSDK** — вставляет минимальное поддерживаемое значение SDK из `AndroidManifest.xml` или `11`, если оно не определено.

    -   **versionCode** —использует код версии непосредственно из `Properties\AndroidManifest.xml`.

    Можно определить пользовательские элементы с помощью свойства [AndroidVersionCodeProperties](#AndroidVersionCodeProperties).

    Добавлено в Xamarin.Android версии 7.2.

-   **AndroidVersionCodeProperties** — строковое свойство, которое позволяет разработчику определить пользовательские элементы для использования с [AndroidVersionCodePattern](#AndroidVersionCodePattern).
    Они находятся в форме пары `key=value`. Все элементы в `value` должны быть целыми числами. Например, `screen=23;target=$(_SupportedApiLevel)`.
    Как видно, вы можете использовать существующие или пользовательские свойства MSBuild в строке.

    Добавлено в Xamarin.Android версии 7.2.


### <a name="binding-project-build-properties"></a>Свойства сборки проекта привязки

С [проектами привязки](~/android/platform/binding-java-library/index.md) используются следующие свойства MSBuild:

-   **AndroidClassParser** — строковое свойство, которое определяет способ синтаксического анализа файлов `.jar`. Возможные допустимые значения приведены ниже.

    - **class-parse**: использует `class-parse.exe` для непосредственного синтаксического анализа байт-кода Java без использования виртуальной машины Java. Это значение является экспериментальным.


    - **jar2xml**: использует `jar2xml.jar` для отражения Java, чтобы извлекать типы и элементы из файла `.jar`.

    Ниже приведены преимущества `class-parse` над `jar2xml`.

    - `class-parse` может извлекать имена параметров из байт-кода Java, который содержит *отладочные* символы (например, байт-код, скомпилированный с помощью `javac -g`).

    - `class-parse` не пропускает классы, которые наследуются от членов неразрешимых типов или содержат их.

    **Экспериментальное**. Добавлено в Xamarin.Android версии 6.0.

    Значение по умолчанию — `jar2xml`.

    Значение по умолчанию будет изменено в будущих выпусках.

-   **AndroidCodegenTarget** — строковое свойство, которое определяет целевой ABI создания кода. Возможные допустимые значения приведены ниже.

    - **XamarinAndroid**: использует API привязки JNI, представленный в Mono для Android 1.0. Сборки привязки, созданные с помощью Xamarin.Android 5.0 или более поздней версии, можно запускать только в Xamarin.Android 5.0 или более поздней версии (добавление API/ABI), но *источник* совместим с предыдущими версиями продукта.

    - **XAJavaInterop1**: использует Java.Interop для вызова JNI. Сборки привязки с `XAJavaInterop1` можно создавать и выполнять только с помощью Xamarin.Android 6.1 или более поздней версии. Xamarin.Android 6.1 и более поздних версий связывает `Mono.Android.dll` с этим значением.

      Ниже приведены преимущества `XAJavaInterop1`.

      - Сборки меньшего размера.

      - Кэширование `jmethodID` для вызова метода `base` при условии, что все прочие типы привязки в иерархии наследования созданы с помощью `XAJavaInterop1` или более поздней версии.

      - Кэширование `jmethodID` конструкторов JCW для управляемых подклассов.

    Значение по умолчанию — `XamarinAndroid`.

    Значение по умолчанию будет изменено в будущих выпусках.


<a name="Resgen" />
<a name="Resource_Properties" />

### <a name="resource-properties"></a>Свойства ресурса

Свойства ресурса управляют созданием файла `Resource.designer.cs`, который обеспечивает доступ к ресурсам Android.

-   **AndroidResgenExtraArgs** — указывает дополнительные параметры командной строки для передачи команды **aapt** при обработке активов и ресурсов Android.

-   **AndroidResgenFile** — задает имя создаваемого файла ресурсов. По умолчанию шаблон задает `Resource.designer.cs`.

-   **MonoAndroidResourcePrefix** — указывает *префикс пути*, который удаляется в начале имен файлов с помощью действия сборки `AndroidResource`. Это позволяет изменять расположение ресурсов.

    Значение по умолчанию — `Resources`. Установите значение `res` для структуры проекта Java.

-   **AndroidExplicitCrunch** — при создании приложения с очень большим числом локальных прорисовываемых ресурсов первоначальное создание (или перестроение) может занять несколько минут. Чтобы ускорить процесс сборки, попробуйте включить это свойство и установите для него значение `True`. Если это свойство задано, процесс сборки предварительно анализирует PNG-файлы.

    **Экспериментальное**. Добавлено в Xamarin.Android версии 7.0.


<a name="Signing" />
<a name="Signing_Properties" />

### <a name="signing-properties"></a>Свойства подписи

Свойства подписи контролируют, как подписывается пакет приложений, чтобы его можно было установить на устройство Android. Чтобы ускорить итерацию сборки, задачи Xamarin.Android не подписывают пакеты во время процесса сборки, потому что это выполняется довольно медленно. Вместо этого они подписываются (если необходимо) перед установкой или во время экспорта с помощью IDE или целевого объекта *Install*. Вызов целевого объекта *SignAndroidPackage* приведет к созданию пакета с суффиксом `-Signed.apk` в выходном каталоге.

По умолчанию целевой объект подписи генерирует ключ подписи отладки, если это необходимо. Если вы хотите использовать определенный ключ, например, на сервере сборки, можно использовать следующие свойства MSBuild:

-   **AndroidKeyStore** — логическое значение, указывающее, следует ли использовать пользовательские данные подписи. Значение по умолчанию — `False`. Это означает, что для подписания пакетов будет использоваться ключ подписи отладки по умолчанию.

-   **AndroidSigningKeyAlias** — указывает псевдоним для ключа в хранилище ключей. Это значение **keytool -alias**, используемое при создании хранилища ключей.

-   **AndroidSigningKeyPass** — указывает пароль для ключа в файле хранилища ключей. Это значение вводится, когда `keytool` запрашивает **ввести пароль ключа для $(AndroidSigningKeyAlias)**.

-   **AndroidSigningKeyStore** — указывает имя файла хранилища ключей, созданного с помощью `keytool`. Это соответствует значению, указанному для параметра **keytool -keystore**.

-   **AndroidSigningStorePass** — указывает пароль для `$(AndroidSigningKeyStore)`. Это значение, предоставляемое для `keytool` при создании файла хранилища ключей и запросе **ввести пароль хранилища ключей**.

Например, рассмотрим следующий вызов `keytool`.

```shell
$ keytool -genkey -v -keystore filename.keystore -alias keystore.alias -keyalg RSA -keysize 2048 -validity 10000
Enter keystore password: keystore.filename password
Re-enter new password: keystore.filename password
...
Is CN=... correct?
  [no]:  yes

Generating 2,048 bit RSA key pair and self-signed certificate (SHA1withRSA) with a validity of 10,000 days
        for: ...
Enter key password for keystore.alias
        (RETURN if same as keystore password): keystore.alias password
[Storing filename.keystore]
```

Чтобы использовать хранилище ключей, созданное выше, используйте группу свойств:

```xml
<PropertyGroup>
    <AndroidKeyStore>True</AndroidKeyStore>
    <AndroidSigningKeyStore>filename.keystore</AndroidSigningKeyStore>
    <AndroidSigningStorePass>keystore.filename password</AndroidSigningStorePass>
    <AndroidSigningKeyAlias>keystore.alias</AndroidSigningKeyAlias>
    <AndroidSigningKeyPass>keystore.alias password</AndroidSigningKeyPass>
</PropertyGroup>
```

<a name="Build_Actions" />

## <a name="build-actions"></a>Действия при сборке

*Действия сборки* [применяются к файлам](http://msdn.microsoft.com/en-us/library/bb629388.aspx) в рамках проекта и контролируют обработку файла.

<a name="AndroidEnvironment" />

### <a name="androidenvironment"></a>AndroidEnvironment

Файлы с действием сборки `AndroidEnvironment` используются для [инициализации переменных среды и свойств системы во время запуска процесса](~/android/deploy-test/environment.md).
Действие сборки `AndroidEnvironment` может быть применено к нескольким файлам, и они будут оцениваться без какого либо порядка (поэтому не указывайте одну и ту же переменную среды или системное свойство в нескольких файлах).

<a name="Java_Interop_Support" />
<a name="AndroidJavaSource" />

### <a name="androidjavasource"></a>AndroidJavaSource

Файлы с действием сборки `AndroidJavaSource` — это исходный код Java, который будет включен в окончательный пакет Android.

<a name="AndroidJavaLibrary" />

### <a name="androidjavalibrary"></a>AndroidJavaLibrary

Файлы с действием сборки `AndroidJavaLibrary` — это архивы Java (файлы `.jar`), которые будут включены в окончательный пакет Android.

<a name="Resources" />
<a name="AndroidResource" />

### <a name="androidresource"></a>AndroidResource

Все файлы с действием *AndroidResource* компилируются в ресурсы Android во время процесса сборки и становятся доступными с помощью `$(AndroidResgenFile)`.

```xml
<ItemGroup>
  <AndroidResource Include="Resources\values\strings.xml" />
</ItemGroup>
```

Более опытным пользователям может потребоваться использовать разные ресурсы в разных конфигурациях, но с тем же эффективным путем. Этого можно достичь за счет наличия нескольких каталогов ресурсов и файлов с одинаковыми относительными путями в этих каталогах и благодаря использованию условий MSBuild для условного включения разных файлов в различные конфигурации. Пример:

```xml
<ItemGroup Condition="'$(Configuration)'!='Debug'">
  <AndroidResource Include="Resources\values\strings.xml" />
</ItemGroup>
<ItemGroup  Condition="'$(Configuration)'=='Debug'">
  <AndroidResource Include="Resources-Debug\values\strings.xml"/>
</ItemGroup>
<PropertyGroup>
  <MonoAndroidResourcePrefix>Resources;Resources-Debug<MonoAndroidResourcePrefix>
</PropertyGroup>
```

**LogicalName** — явно указывает путь к ресурсу. Позволяет присваивать файлам псевдонимы, чтобы файлы были доступны как различные ресурсы.

```xml
<ItemGroup Condition="'$(Configuration)'!='Debug'">
  <AndroidResource Include="Resources/values/strings.xml"/>
</ItemGroup>
<ItemGroup Condition="'$(Configuration)'=='Debug'">
  <AndroidResource Include="Resources-Debug/values/strings.xml">
    <LogicalName>values/strings.xml</LogicalName>
  </AndroidResource>
</ItemGroup>
```

<a name="Native_Library_Support" />
<a name="AndroidNativeLibrary" />

### <a name="androidnativelibrary"></a>AndroidNativeLibrary

[Собственные библиотеки](~/android/platform/native-libraries.md) можно добавить в сборку, указав для них действие сборки `AndroidNativeLibrary`.

Так как Android поддерживает несколько бинарных интерфейсов приложений (ABI), система сборки должна знать, для какого ABI создана собственная библиотека. Это можно сделать двумя способами:

1.  Сканирование пути.
2.  С помощью атрибута элемента `Abi`.

При сканировании пути имя родительского каталога собственной библиотеки используется для указания целевого ABI библиотеки. Таким образом при добавлении `lib/armeabi/libfoo.so` к сборке ABI будет сканироваться как `armeabi`.


### <a name="item-attribute-name"></a>Имя атрибута элемента

**ABI** — указывает ABI собственной библиотеки.

```xml
<ItemGroup>
  <AndroidNativeLibrary Include="path/to/libfoo.so">
    <Abi>armeabi</Abi>
  </AndroidNativeLibrary>
</ItemGroup>
```

### <a name="content"></a>Content

Обычное действие сборки `Content` не поддерживается (потому что мы не выяснили, как его поддерживать без затратного шага первого запуска).

Начиная с Xamarin.Android 5.1, при попытке использования действия сборки `@(Content)` возникает предупреждение `XA0101`.

### <a name="linkdescription"></a>LinkDescription

Файлы с действием сборки *LinkDescription*  используются для [управления поведением компоновщика](~/cross-platform/deploy-test/linker.md).


<a name="ProguardConfiguration" />

### <a name="proguardconfiguration"></a>ProguardConfiguration

Файлы с действием сборки *ProguardConfiguration* содержат параметры, которые используются для управления поведением `proguard`. Дополнительные сведения об этом действии см. в разделе [ProGuard](~/android/deploy-test/release-prep/proguard.md).

Эти файлы игнорируются, только если свойство MSBuild `$(EnableProguard)` не имеет значение `True`.


<a name="Target_Definitions" />

## <a name="target-definitions"></a>Определения целевых объектов

Относящиеся к Xamarin.Android части процесса сборки определены в `$(MSBuildExtensionsPath)\Xamarin\Android\Xamarin.Android.CSharp.targets`, но для создания сборки также требуются обычные языковые файлы целей сборки, такие как *Microsoft.CSharp.targets*.

Следующие свойства сборки следует задать перед импортом языковых файлов целей сборки:

```xml
<PropertyGroup>
  <TargetFrameworkIdentifier>MonoDroid</TargetFrameworkIdentifier>
  <MonoDroidVersion>v1.0</MonoDroidVersion>
  <TargetFrameworkVersion>v2.2</TargetFrameworkVersion>
</PropertyGroup>
```

Все эти целевые объекты и свойства могут быть включены в C # путем импорта *Xamarin.Android.CSharp.targets*:

```xml
<Import Project="$(MSBuildExtensionsPath)\Xamarin\Android\Xamarin.Android.CSharp.targets" />
```

Этот файл можно легко адаптировать для других языков.
