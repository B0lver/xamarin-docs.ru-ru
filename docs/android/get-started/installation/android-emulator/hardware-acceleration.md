---
title: Аппаратное ускорение эмулятора Android
description: Сведения о подготовке компьютера для достижения максимальной производительности эмулятора SDK для Android
ms.prod: xamarin
ms.assetid: 915874C3-2F0F-4D83-9C39-ED6B90BB2C8E
ms.technology: xamarin-android
author: mgmclemore
ms.author: mamcle
ms.date: 04/04/2018
ms.openlocfilehash: d5921c549c299197bdc442c9b883b49064655f76
ms.sourcegitcommit: 6f7033a598407b3e77914a85a3f650544a4b6339
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
# <a name="android-emulator-hardware-acceleration"></a>Аппаратное ускорение эмулятора Android

Поскольку эмулятор SDK для Android демонстрирует крайне низкую производительность без аппаратного ускорения, для существенной оптимизации его работы рекомендуется использовать решение HAXM (Hardware Accelerated Execution Manager) от компании Intel.


## <a name="haxm-overview"></a>Обзор решения HAXM

HAXM представляет собой аппаратную подсистему виртуализации (гипервизор), которая использует технологию виртуализации Intel (VT) для ускорения эмуляции приложения Android на хост-компьютере. В сочетании с образами эмулятора Android x86, предоставляемыми компанией Intel, а также официальным диспетчером пакетов SDK для Android решение HAXM позволяет повысить производительность эмуляции Android в системах, поддерживающих технологию виртуализации. 

Если вы осуществляете разработку на компьютере с ЦП Intel с поддержкой технологии виртуализации, применение HAXM позволит значительно ускорить работу эмулятора SDK для Android (если вы не уверены, поддерживает ли ваш ЦП технологию виртуализации, ознакомьтесь с разделом [Как определить, поддерживает ли ваш процессор технологию виртуализации Intel](https://www.intel.com/content/www/us/en/support/processors/000005486.html)).

> [!NOTE]
> Вы не можете запускать эмулятор на базе ускоренной виртуальной машины внутри другой виртуальной машины, например ВМ под управлением VirtualBox, VMWare или Docker. Эмулятор Google Android следует запускать [непосредственно на системном оборудовании](https://developer.android.com/studio/run/emulator-acceleration.html#extensions).

Эмулятор SDK для Android автоматически использует решение HAXM, если оно доступно. Если выбрать виртуальное устройство с архитектурой **x86** (см. описание в разделе [Конфигурация и использование](~/android/deploy-test/debugging/android-sdk-emulator/index.md)), оно также будет использовать решение HAXM для аппаратного ускорения. Прежде чем использовать эмулятор SDK для Android в первый раз, рекомендуется проверить наличие установленного решения HAXM и его доступность для эмулятора SDK для Android.

## <a name="verifying-haxm-installation"></a>Проверка установки HAXM

Сведения о доступности решения HAXM приводятся в окне **Запуск эмулятора Android**, которое отображается во время запуска эмулятора. Чтобы запустить эмулятор SDK для Android, выполните следующие действия:

# <a name="visual-studiotabvswin"></a>[Visual Studio](#tab/vswin)

1. Запустите диспетчер эмуляторов Android, выбрав **Сервис > Android > Диспетчер эмуляторов Android**:

    [![Расположение элементов меню диспетчера эмуляторов Android](hardware-acceleration-images/win/01-avd-manager-menu-item-sml.png)](hardware-acceleration-images/win/01-avd-manager-menu-item.png#lightbox)

2. Если отображается аналогичное приведенному ниже диалоговое окно **Предупреждение о производительности**, значит, на вашем компьютере решение HAXM еще не установлено или настроено неправильно:

    ![Диалоговое окно "Предупреждение о производительности" с информацией об отсутствии готового решения HAXM](hardware-acceleration-images/win/11-perf-warn.png)

   Если выводится аналогичное показанному диалоговое окно **Предупреждение о производительности**, ознакомьтесь с разделом [Предупреждения о производительности](~/android/deploy-test/debugging/android-sdk-emulator/troubleshooting.md#perfwarn), чтобы выявить возможную проблему и устранить ее причину.

3. Выберите образ **x86** (например, **VisualStudio\_android-23\_x86\_phone**), нажмите кнопку **Пуск** и щелкните **Запустить**:

    ![Запуск эмулятора SDK для Android с использованием образа виртуального устройства по умолчанию](hardware-acceleration-images/win/02-start-default-avd.png)

4. Во время запуска эмулятора следите за содержимым диалогового окна **Запуск эмулятора Android**. Если решение HAXM установлено, появится сообщение **Решение HAXM установлено, и эмулятор работает в быстром режиме виртуализации**, как показано на следующем снимке экрана:

    ![Диалоговое окно "Запуск эмулятора Android" при наличии доступного решения HAXM](hardware-acceleration-images/win/03-haxm-detected.png)

   Если это сообщение не отображается, возможно, решение HAXM не установлено. Например, о такой ситуации может свидетельствовать сообщение, показанное на следующем снимке экрана:

    ![На этом компьютере решение HAXM недоступно](hardware-acceleration-images/win/04-haxm-error.png)

   Если решение HAXM на вашем компьютере недоступно, установите его, выполнив действия, приведенные в следующем разделе.

# <a name="visual-studio-for-mactabvsmac"></a>[Visual Studio для Mac](#tab/vsmac)

1. Запустите диспетчер эмуляторов Android, выбрав **Сервис > Google > Диспетчер эмуляторов**:

    [![Расположение элементов меню диспетчера эмуляторов Android](hardware-acceleration-images/mac/01-avd-manager-menu-item-sml.png)](hardware-acceleration-images/mac/01-avd-manager-menu-item.png#lightbox)

2. Если отображается аналогичное приведенному ниже диалоговое окно **Предупреждение о производительности**, значит, на вашем компьютере решение HAXM еще не установлено или настроено неправильно:

    ![Диалоговое окно "Предупреждение о производительности" с информацией об отсутствии готового решения HAXM](hardware-acceleration-images/mac/04-avd-warning.png)

   Если выводится аналогичное показанному диалоговое окно **Предупреждение о производительности**, ознакомьтесь с разделом [Предупреждения о производительности](~/android/deploy-test/debugging/android-sdk-emulator/troubleshooting.md#perfwarn), чтобы выявить возможную проблему и устранить ее причину.

3. Выберите образы **x86** (например, **Android\_Accelerated\_x86**), нажмите кнопку **Пуск** и щелкните **Запустить**:

    [![Запуск эмулятора SDK для Android с использованием образа виртуального устройства по умолчанию](hardware-acceleration-images/mac/02-start-default-avd-sml.png)](hardware-acceleration-images/mac/02-start-default-avd.png#lightbox)

3. Во время запуска эмулятора следите за содержимым диалогового окна **Запуск эмулятора Android**. Если решение HAXM установлено, появится сообщение **Решение HAXM установлено, и эмулятор работает в быстром режиме виртуализации**, как показано на следующем снимке экрана:

    ![Диалоговое окно "Запуск эмулятора Android" при наличии доступного решения HAXM](hardware-acceleration-images/mac/03-haxm-detected.png)

   Если на вашем компьютере решение HAXM недоступно (например, если отображается сообщение об ошибке вида _Проверьте правильность установки и работоспособность решения Intel HAXM_), установите его, выполнив действия, приведенные в следующем разделе.


-----

<a name="install-haxm" />

## <a name="installing-haxm"></a>Установка HAXM

Если эмулятор не запускается, возможно, решение HAXM придется установить вручную. Пакеты установки HAXM для ОС Windows и macOS можно найти на странице [Intel Hardware Accelerated Execution Manager](https://software.intel.com/en-us/android/articles/intel-hardware-accelerated-execution-manager). Чтобы вручную скачать и установить решение HAXM, выполните следующие действия:

# <a name="visual-studiotabvswin"></a>[Visual Studio](#tab/vswin)

1. Скачайте с веб-сайта Intel последнюю версию установщика [подсистемы виртуализации HAXM](https://software.intel.com/en-us/android/articles/intel-hardware-accelerated-execution-manager/) для ОС Windows. Скачивая установщик HAXM с веб-сайта Intel, вы гарантированно получаете последнюю версию этой программы.

   Также можно скачать установщик HAXM с помощью диспетчера пакетов SDK (в диспетчере пакетов SDK выберите **Сервис > Дополнения > Ускоритель эмулятора Intel x86 (установщик HAXM)**). Как правило, SDK для Android скачивает установщик HAXM в следующий каталог:

   **C:\\Program Files (x86)\\Android\\android-sdk\\extras\\intel\\Hardware\_Accelerated\_Execution\_Manager**

   Обратите внимание, что диспетчер пакетов SDK не устанавливает решение HAXM, а просто скачивает его установщик в указанный каталог. Запускать программу установки по-прежнему необходимо вручную.

2. Чтобы начать работу с установщиком HAXM, запустите файл **intelhaxm-android.exe**. Примите значения по умолчанию, предлагаемые в диалоговых окнах установщика:

   ![Окно программы установки Intel Hardware Accelerated Execution Manager](hardware-acceleration-images/win/05-haxm-installer.png)

Если отображается следующее диалоговое окно (_Компьютер не поддерживает технологию виртуализации Intel (VT-x) или используется исключительно технологией Hyper-V_), перед установкой HAXM необходимо отключить Hyper-V:

![Установка HAXM невозможна из-за конфликта с Hyper-V](hardware-acceleration-images/win/06-cant-install-haxm.png)

В следующем разделе показано, как отключить технологию Hyper-V.

<a name="disable-hyperv" />

## <a name="disabling-hyper-v"></a>Отключение Hyper-V

Если вы используете ОС Windows с включенной технологией Hyper-V, прежде чем устанавливать и использовать решение HAXM, необходимо отключить эту технологию и перезагрузить компьютер. Технологию Hyper-V можно отключить из панели управления, выполнив следующие действия:

1. В поле поиска Windows введите **Программы и**, после чего выберите элемент **Программы и компоненты**.

2. В диалоговом окне **Программы и компоненты** панели управления щелкните **Включение или отключение компонентов Windows**:

    ![Включение или отключение компонентов Windows](hardware-acceleration-images/win/07-turn-windows-features.png)

3. Снимите флажок **Hyper-V** и перезагрузите компьютер:

    ![Отключение технологии Hyper-V в диалоговом окне "Компоненты Windows"](hardware-acceleration-images/win/08-uncheck-hyper-v.png)

Также для отключения технологии Hyper-V можно использовать следующий командлет Powershell:

`Disable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V-Hypervisor`

Intel HAXM и Microsoft Hyper-V не могут быть активны одновременно. К сожалению, на данный момент переключение между технологиями Hyper-V и HAXM без перезагрузки компьютера невозможно. Если вы хотите использовать [эмулятор Visual Studio Emulator для Android](~/android/deploy-test/debugging/visual-studio-android-emulator.md), который работает на основе технологии Hyper-V, для работы с эмулятором SDK для Android вам потребуется перезагрузить компьютер. Одним из способов параллельной работы с технологиями Hyper-V и HAXM является создание многозагрузочной конфигурации, как описывается в разделе [Создание загрузочной записи без гипервизора](https://blogs.msdn.microsoft.com/virtual_pc_guy/2008/04/14/creating-a-no-hypervisor-boot-entry/).

В некоторых случаях выполнение описываемых выше действий не позволяет отключить технологию Hyper-V, если включены функции Device Guard и Credential Guard. Если вам не удается отключить Hyper-V (или по всем признакам эта технология отключена, но установка HAXM все равно завершается сбоем), отключите функции Device Guard и Credential Guard, выполнив действия, описываемые в следующем разделе.

<a name="disable-devguard" />

## <a name="disabling-device-guard"></a>Отключение функции Device Guard

Функции Device Guard и Credential Guard могут препятствовать отключению технологии Hyper-V на компьютерах под управлением ОС Windows. Это часто происходит на компьютерах, присоединенных к доменам, которые настраиваются и контролируются управляющей ими организацией.
Чтобы проверить, выполняется ли функция **Device Guard** в ОС Windows 10, выполните следующие действия:

1. В **поле поиска Windows** введите **Сведения о системе**, чтобы запустить приложение **Сведения о системе**.

2. В разделе **Сведения о системе** проверьте наличие службы **Безопасность на основе виртуализации Device Guard** и убедитесь, что она имеет состояние **Выполняется**:

   [![Функция Device Guard установлена и выполняется](hardware-acceleration-images/win/09-device-guard-sml.png)](hardware-acceleration-images/win/09-device-guard.png#lightbox)

Если функция Device Guard включена, выполните следующие действия для ее отключения:

1. Убедитесь, что технология **Hyper-V** отключена в окне **Включение или отключение компонентов Windows**, как описывается в предыдущих разделах.

2. В поле поиска Windows введите **gpedit** и выберите элемент **Изменение групповой политики**. Будет запущен **редактор локальных групповых политик**.

3. В **редакторе локальных групповых политик** выберите **Конфигурация компьютера > Административные шаблоны > Система > Device Guard**:

   [![Функция Device Guard в редакторе локальных групповых политик](hardware-acceleration-images/win/10-group-policy-editor-sml.png)](hardware-acceleration-images/win/10-group-policy-editor.png#lightbox)

4. Измените значение параметра **Включить средство обеспечения безопасности на основе виртуализации** на **Отключено** (как показано выше) и закройте **редактор локальных групповых политик**.

5. В поле поиска Windows введите **cmd**. Когда в результатах поиска появится элемент **Командная строка**, щелкните пункт **Командная строка** правой кнопкой мыши и выберите **Запустить от имени администратора**.

6. Скопируйте и вставьте следующие команды в окно командной строки (если диск **Z:** используется, выберите вместо него букву свободного диска):

        mountvol Z: /s
        copy %WINDIR%\System32\SecConfig.efi Z:\EFI\Microsoft\Boot\SecConfig.efi /Y
        bcdedit /create {0cb3b571-2f2e-4343-a879-d86a476d7215} /d "DebugTool" /application osloader
        bcdedit /set {0cb3b571-2f2e-4343-a879-d86a476d7215} path "\EFI\Microsoft\Boot\SecConfig.efi"
        bcdedit /set {bootmgr} bootsequence {0cb3b571-2f2e-4343-a879-d86a476d7215}
        bcdedit /set {0cb3b571-2f2e-4343-a879-d86a476d7215} loadoptions DISABLE-LSA-ISO,DISABLE-VBS
        bcdedit /set {0cb3b571-2f2e-4343-a879-d86a476d7215} device partition=Z:
        mountvol Z: /d

7. Перезапустите компьютер. На экране загрузки должен появиться запрос следующего вида:

   **Вы действительно хотите отключить Credential Guard?**

   Нажмите указанную в запросе клавишу, чтобы отключить Credential Guard.

8. После перезагрузки компьютера еще раз убедитесь, что технология Hyper-V отключена (см. ранее описываемые действия).

Если технология Hyper-V по-прежнему не отключена, значит, отключение функций Device Guard или Credential Guard запрещено политиками на вашем присоединенном к домену компьютере. В таком случае вы можете запросить у администратора домена исключение, которое позволит отключить Credential Guard. Кроме того, вы можете использовать для работы с HAXM компьютер, который не присоединен к домену.

## <a name="hardware-acceleration-and-amd-cpus"></a>Аппаратное ускорение и процессоры AMD

Так как эмулятор Android от Google сейчас поддерживает аппаратное ускорение AMD [только на Linux](https://developer.android.com/studio/run/emulator-acceleration.html#dependencies), аппаратное ускорение недоступно для компьютеров на платформе AMD под управлением Windows.


# <a name="visual-studio-for-mactabvsmac"></a>[Visual Studio для Mac](#tab/vsmac)

1. Скачайте с веб-сайта Intel последнюю версию установщика [подсистемы виртуализации HAXM](https://software.intel.com/en-us/android/articles/intel-hardware-accelerated-execution-manager/) для ОС macOS.

2. Запустите установщик HAXM. Примите значения по умолчанию, предлагаемые в диалоговых окнах установщика:

   [![Окно программы установки Intel Hardware Accelerated Execution Manager](hardware-acceleration-images/mac/05-haxm-installer-sml.png)](hardware-acceleration-images/win/05-haxm-installer.png#lightbox)

-----
