---
title: "Облако firebase обмена сообщениями"
description: "Обмен сообщениями firebase облака (FCM) — это служба, облегчает обмен сообщениями между мобильных приложений и серверных приложений. В этой статье содержатся общие сведения о том, как работает FCM, а также описание способов настройки службы Google, чтобы приложения могли использовать FCM."
ms.topic: article
ms.prod: xamarin
ms.assetid: E5314D7F-2AAC-40DA-BEBA-27C834F078DD
ms.technology: xamarin-android
author: mgmclemore
ms.author: mamcle
ms.date: 03/01/2018
ms.openlocfilehash: ef073999e10e184806089bed3ef9ab93e2f28dd6
ms.sourcegitcommit: 30055c534d9caf5dffcfdeafd6f08e666fb870a8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/09/2018
---
# <a name="firebase-cloud-messaging"></a>Облако firebase обмена сообщениями

_Обмен сообщениями firebase облака (FCM) — это служба, облегчает обмен сообщениями между мобильных приложений и серверных приложений. В этой статье содержатся общие сведения о том, как работает FCM, а также описание способов настройки службы Google, чтобы приложения могли использовать FCM._

[![Изображение героя Cloud Messaging firebase](firebase-cloud-messaging-images/preview.png)](firebase-cloud-messaging-images/preview.png#lightbox)

В этом разделе представлен общий обзор как Firebase Cloud Messaging маршрутизирует сообщения между Xamarin.Android приложения и серверов приложений, и предоставляет пошаговые процедуры для получения учетных данных, чтобы приложения могли использовать FCM служб.



## <a name="overview"></a>Обзор

Обмен сообщениями firebase облака (FCM) является кросс платформенных служба, которая обрабатывает отправки, маршрутизации и постановка в очередь сообщений приложениями мобильных клиентских и серверных приложений. FCM является последователем для Google Cloud Messaging (GCM), и она была основана на службы Google Play.

Как показано на следующей диаграмме, FCM действует как посредник между отправителей сообщений и клиентами. Объект *клиентское приложение* является поддержкой FCM приложение, которое выполняется на устройстве. *Сервером приложения* (предоставляемое вы или ваша организация) — это FCM включен сервер, клиентское приложение обменивается данными с помощью FCM. В отличие от GCM FCM дает возможность для отправки сообщений в клиентских приложениях непосредственно через графический пользовательский Интерфейс Firebase консоли уведомления:

[![FCM располагается между клиентского приложения и серверов приложений](firebase-cloud-messaging-images/01-server-fcm-app-sml.png)](firebase-cloud-messaging-images/01-server-fcm-app.png#lightbox)

Используя FCM, серверы приложений могут отправлять сообщения, одно устройство, к группе устройств или для нескольких устройств, которые подписаны на раздел. Клиентское приложение можно использовать FCM подписаться на подчиненные сообщения из серверов приложений (например, для получения удаленных уведомлений). Дополнительные сведения о различных типах Firebase сообщений см. в разделе [о FCM сообщения](https://firebase.google.com/docs/cloud-messaging/concept-options).



## <a name="firebase-cloud-messaging-in-action"></a>Облако firebase обмена сообщениями в действии

При отправке сообщения ниже в потоке для клиентского приложения из серверов приложений, сервер приложений отправляет сообщение *FCM соединения сервера* предоставляемый Google; FCM соединения сервера, в свою очередь пересылает сообщение на устройство, на котором выполняется клиентское приложение. Сообщения могут отправляться по протоколу HTTP или [XMPP](https://developers.google.com/cloud-messaging/ccs) (Extensible обмена сообщениями и протокол присутствия). Поскольку клиентские приложения не всегда подключен или выполнение FCM подключения ставит в очередь и сохраняет сообщения сервера, отправив клиентских приложений как повторного подключения и становятся доступными. Аналогичным образом FCM будет постановки в очередь вышестоящего сообщений из клиентского приложения на сервер приложений в случае недоступности сервера приложения. Для получения дополнительных сведений о серверах подключения FCM см [о Firebase обмена сообщениями сервера облака](https://firebase.google.com/docs/cloud-messaging/server).

FCM использует следующие учетные данные для идентификации сервера и клиентского приложения и использует эти учетные данные для авторизации транзакциями сообщений через FCM:

-   **Идентификатор отправителя** &ndash; *идентификатор отправителя* уникальное числовое значение, присвоенное при создании проекта Firebase. Идентификатор отправителя используется для идентификации каждого сервера приложений, который может отправлять сообщения в клиентское приложение. Идентификатор отправителя также имеет номер вашего проекта; Вы получите идентификатор отправителя из консоли Firebase при регистрации проекта. Примером идентификатора отправителя является `496915549731`.

-   **Ключ API** &ndash; *ключ API* предоставляет доступ к серверу приложений к Firebase службы; FCM использует этот ключ для проверки подлинности сервера приложения. Эти учетные данные также называется *ключа сервера* или *веб-API ключей*. Пример ключ API — `AJzbSyCTcpfRT1YRqbz-jIwp1h06YdauvewGDzk`.

-   **Идентификатор приложения** &ndash; удостоверение клиентского приложения (независимо от любого устройства), регистрация для получения сообщений от FCM. Идентификатор приложения является примером `1:415712510732:android:0e1eb7a661af2460`.

-   **Токен регистрации** &ndash; *токена регистрации* (также называется *идентификатор экземпляра*) FCM удостоверение клиентского приложения на данном устройстве. Во время выполнения создается маркер регистрации &ndash; приложение получает токен регистрации при ее первой регистрации FCM во время выполнения на устройстве. Токен регистрации разрешает экземпляр клиентского приложения (для этого конкретного устройства под управлением) для получения сообщений от FCM.
    Пример маркера регистрации — `fkBQTHxKKhs:AP91bHuEedxM4xFAUn0z ... JKZS` (слишком длинной строкой).

[Параметр вверх Firebase Cloud Messaging](#setup_fcm) (Далее в этом руководстве) содержатся подробные инструкции по созданию проекта и созданием эти учетные данные. При создании нового проекта в [консоли Firebase](https://console.firebase.google.com/), файл учетных данных с именем **google services.json** создается &ndash; добавьте этот файл в проект Xamarin.Android, как описано в [ Удаленный уведомления с FCM](~/android/data-cloud/google-messaging/remote-notifications-with-fcm.md).

В следующих разделах объясняется, как используются эти учетные данные, когда клиентские приложения взаимодействуют с серверами приложений через FCM.


<a name="registration" />

### <a name="registration-with-fcm"></a>Регистрация в FCM

Клиентское приложение сначала необходимо зарегистрировать FCM перед обмена сообщениями могут иметь место. Клиентское приложение необходимо выполнить действия по регистрации показано на следующей схеме:

[![Схема шаги регистрации приложения](firebase-cloud-messaging-images/02-app-registration-sml.png)](firebase-cloud-messaging-images/02-app-registration.png#lightbox)

1.  Клиентское приложение обращается FCM для получения токена регистрации, передача FCM идентификатор отправителя, ключ API и идентификатор приложения.

2.  FCM возвращает маркер регистрации клиентского приложения.

3.  Клиентское приложение (необязательно) пересылает маркер регистрации на сервер приложений.

Сервер приложений кэширует токен регистрации для последующих соединений с помощью клиентского приложения. Сервер приложений может отправить подтверждение обратно в клиентское приложение, чтобы указать, что был получен маркер регистрации. После внесения этого подтверждения, клиентское приложение может получать сообщения из (или отправки сообщений в) сервер приложений. Клиентское приложение может получить новый маркер регистрации компрометация старый токен (см. [удаленного уведомления с FCM](~/android/data-cloud/google-messaging/remote-notifications-with-fcm.md) пример как приложение получает токен обновления регистрации).

Когда клиентское приложение больше не хочет получать сообщения от приложений сервера, его можно отправить запрос на сервер приложений, чтобы удалить маркер регистрации. Если клиентское приложение удаляется с устройства, FCM обнаружит это и автоматически уведомляет серверу удалить маркер регистрации приложения.



### <a name="downstream-messaging"></a>Подчиненные обмена сообщениями

На следующей схеме показана как Firebase Cloud Messaging хранит и перенаправляет сообщения подчиненных:

[![FCM использует хранилища и передачи данных для подчиненных обмена сообщениями](firebase-cloud-messaging-images/03-downstream-sml.png)](firebase-cloud-messaging-images/03-downstream.png#lightbox)

Сервер приложений отправляет сообщение подчиненных в клиентское приложение, используется следующее как перечисленные в приведенной выше диаграмме:

1.  Сервер приложений отправляет сообщение FCM.

2.  Если клиентское устройство недоступен, сервер FCM хранит сообщения в очереди для последующей передачи. Сообщения хранятся в хранилище FCM более 4 недели (Дополнительные сведения см. в разделе [параметр времени существования сообщения](https://firebase.google.com/docs/cloud-messaging/concept-options#ttl)).

3.  Если клиентское устройство доступно, FCM пересылает сообщение в клиентское приложение на этом устройстве.

4.  Клиентское приложение получает сообщение из FCM, обрабатывает его и отображает его пользователю. Например если сообщение удаленного уведомления, оно выводится пользователю в области уведомлений.

В этом сценарии обмена сообщениями (где сервер приложений отправляет сообщение приложения одного клиента) сообщения могут быть длиной до 4 КБ.

Подробные сведения о получении подчиненных FCM сообщений на Android. в разделе [удаленного уведомления с FCM](~/android/data-cloud/google-messaging/remote-notifications-with-fcm.md).

### <a name="topic-messaging"></a>Обмен сообщениями в разделе

*Обмен сообщениями разделе* делает возможным для серверов приложений для отправки сообщения на несколько устройств, которые зарегистрировались в конкретном разделе. Можно также составить и отправляет сообщения раздела через графический пользовательский Интерфейс Firebase консоли уведомления. FCM обрабатывает маршрутизации и доставки сообщения раздела подписанных клиентов. Эта функция может использоваться для сообщения, такие как предупреждения погоды, биржевых котировок и заголовков новостей.

[![Схема обмена сообщениями раздела](firebase-cloud-messaging-images/04-topic-messaging-sml.png)](firebase-cloud-messaging-images/04-topic-messaging.png#lightbox)

(После клиентское приложение получает маркер регистрации, как было описано выше) в разделе обмена сообщениями используются следующие действия:

1.  Клиентское приложение подписывается на раздел, отправляя сообщение subscribe FCM.

2.  Сервер приложений отправляет сообщения раздела FCM для распространения.

3.  FCM пересылает сообщения раздела для клиентов, которые подписаны на этот раздел.

Дополнительные сведения об обмене сообщениями разделе Firebase см. в разделе Google [разделе обмена сообщениями на Android](https://firebase.google.com/docs/cloud-messaging/android/topic-messaging).


<a name="setup_fcm" />

## <a name="setting-up-firebase-cloud-messaging"></a>Настройка Firebase облако обмена сообщениями

Перед FCM службы можно использовать в приложении, необходимо создать новый проект (или импортировать существующий проект) через [Firebase консоли](https://console.firebase.google.com/). Создание проекта Firebase Cloud Messaging для вашего приложения, выполните следующие действия:

1.  Вход в [консоли Firebase](https://console.firebase.google.com/) с вашей учетной записи Google (т. е. ваш адрес Gmail) и нажмите кнопку **Создание нового проекта**:

    [![Кнопка «Создать новый проект»](firebase-cloud-messaging-images/05-firebase-console-sml.png)](firebase-cloud-messaging-images/05-firebase-console.png#lightbox)

    Если у вас есть существующий проект, нажмите кнопку **Импорт проекта Google**.

2.  В **Создание проекта** диалоговое окно, введите имя проекта и нажмите кнопку **Создание проекта**. В следующем примере вызывается новый проект **XamarinFCM** создается:

    [![Создать диалоговое окно проекта](firebase-cloud-messaging-images/06-create-a-project-sml.png)](firebase-cloud-messaging-images/06-create-a-project.png#lightbox)

3.  В консоли Firebase **Обзор**, нажмите кнопку **Firebase добавить в приложение Android**:

    [![Добавьте Firebase приложение Android](firebase-cloud-messaging-images/07-add-firebase-sml.png)](firebase-cloud-messaging-images/07-add-firebase.png#lightbox)

4.  На следующем экране введите имя пакета приложения. В этом примере имя пакета — **com.xamarin.fcmexample**. Это значение должно соответствовать имени пакета приложения Android. Также можно ввести псевдоним приложения в **псевдоним приложения** поля:

    [![Ввод FCM пример как приложение псевдоним](firebase-cloud-messaging-images/08-package-name-sml.png)](firebase-cloud-messaging-images/08-package-name.png#lightbox)

5.  Если ваше приложение использует динамических ссылок, приглашения или проверки подлинности Google, необходимо также ввести ваш отладки сертификата для подписи. Дополнительные сведения об обнаружении сертификата подписи см. в разделе [поиск MD5 или SHA1 подписи в хранилище ключей](~/android/deploy-test/signing/keystore-signature.md).
    В этом примере будет пустым сертификата подписи.

6.  Нажмите кнопку **добавить приложения**:

    [![Нажав кнопку "Добавить приложение"](firebase-cloud-messaging-images/09-add-app-sml.png)](firebase-cloud-messaging-images/09-add-app.png#lightbox)

    Ключ API сервера и идентификатор клиента, автоматически создаются для приложения. Эта информация помещается в **google services.json** файл, который автоматически загружается при нажатии кнопки **добавить приложение**.
    Обязательно сохраните этот файл в надежном месте.

Подробный пример добавления **google services.json** проекта приложения для получения сообщений уведомления FCM принудительной на Android, в разделе [удаленного уведомления с FCM](~/android/data-cloud/google-messaging/remote-notifications-with-fcm.md).



## <a name="for-further-reading"></a>Дополнительные сведения

-   Google [Firebase Cloud Messaging](https://firebase.google.com/docs/cloud-messaging/) предоставляет обзор Firebase Cloud Messaging его основные возможности, объяснение принцип работы и инструкции по установке.

-   Google [построения запросов отправки сервера приложения](https://firebase.google.com/docs/cloud-messaging/send-message) объясняется, как отправлять сообщения с сервером приложений.

-   [RFC 6120](https://tools.ietf.org/html/rfc6120) и [RFC 6121](https://tools.ietf.org/html/rfc6121) объясняется и определить расширяемый обмена сообщениями и протокол присутствия (XMPP).



## <a name="summary"></a>Сводка

В этой статье содержатся общие сведения для обмена сообщениями Firebase облака (FCM). Он описывается различные учетные данные, которые используются для идентификации и авторизации, обмен сообщениями между серверами приложений и клиентских приложений. Он показан регистрации и подчиненных сценариев обмена сообщениями, и его подробные инструкции по регистрации приложения в FCM для использования служб FCM.


## <a name="related-links"></a>Связанные ссылки

- [Обмен сообщениями Firebase Cloud](https://firebase.google.com/docs/cloud-messaging/)
