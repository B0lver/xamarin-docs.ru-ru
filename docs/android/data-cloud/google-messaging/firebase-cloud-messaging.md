---
title: Firebase Cloud Messaging
description: Firebase Cloud Messaging (FCM) — это служба, которая облегчает обмен сообщениями между мобильные приложения и серверные приложения. В этой статье представлен обзор принципов работы FCM и здесь объясняется, как настроить службы Google, чтобы ваше приложение может использовать FCM.
ms.prod: xamarin
ms.assetid: E5314D7F-2AAC-40DA-BEBA-27C834F078DD
ms.technology: xamarin-android
author: mgmclemore
ms.author: mamcle
ms.date: 07/31/2018
ms.openlocfilehash: 92c402085627bbe67d4cd8ccaf60a68aa979f3e7
ms.sourcegitcommit: bf05041cc74fb05fd906746b8ca4d1403fc5cc7a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/04/2018
ms.locfileid: "39514299"
---
# <a name="firebase-cloud-messaging"></a>Firebase Cloud Messaging

_Firebase Cloud Messaging (FCM) — это служба, которая облегчает обмен сообщениями между мобильные приложения и серверные приложения. В этой статье представлен обзор принципов работы FCM и здесь объясняется, как настроить службы Google, чтобы ваше приложение может использовать FCM._

[![Изображение с параметрами firebase Cloud Messaging](firebase-cloud-messaging-images/preview.png)](firebase-cloud-messaging-images/preview.png#lightbox)

В этом разделе представлен общий обзор как Firebase Cloud Messaging маршрутизирует сообщения между приложение Xamarin.Android и серверов приложений, а также пошаговые процедуры для получения учетных данных, таким образом, чтобы ваше приложение может использовать службы FCM.

## <a name="overview"></a>Обзор

Firebase Cloud Messaging (FCM) — это кроссплатформенная служба, которая обрабатывает отправки, маршрутизации и их постановку в очередь сообщений между серверных приложений и мобильных клиентских приложений. FCM является преемником для Google Cloud Messaging (GCM), и он был основан на сервисы Google Play.

Как показано на следующей схеме, FCM выступает в качестве посредника между отправителей и клиентами. Объект *клиентское приложение* — это приложение с поддержкой FCM, которое выполняется на устройстве. *Сервера приложений* (предоставляемое вы или ваша организация) — это сервер с поддержкой FCM, клиентское приложение обменивается данными с помощью FCM. В отличие от GCM FCM делает возможным для отправки сообщения к клиентским приложениям напрямую через графический Интерфейс уведомления консоли Firebase:

[![FCM располагается между клиентское приложение и серверов приложений](firebase-cloud-messaging-images/01-server-fcm-app-sml.png)](firebase-cloud-messaging-images/01-server-fcm-app.png#lightbox)

С использованием FCM, серверы приложений может отправлять сообщения, на одно устройство, в группу устройств или для нескольких устройств, которые подписаны на раздел. Клиентское приложение может использовать FCM подписаться на подчиненных сообщения с сервера приложений (например, для получения удаленных уведомлений). Дополнительные сведения о различных типах Firebase сообщений см. в разделе [о сообщениях FCM](https://firebase.google.com/docs/cloud-messaging/concept-options).

## <a name="fcm-in-action"></a>Firebase Cloud Messaging в действии

Когда сообщение нисходящего потока отправляется клиентского приложения с сервера приложений, сервера приложений отправляет сообщение, *FCM соединения сервера* предоставляемый Google; подключение сервера FCM, в свою очередь, перенаправляет сообщение на устройство, на котором выполняется клиентское приложение. Сообщения могут отправляться по протоколу HTTP или [XMPP](https://developers.google.com/cloud-messaging/ccs) (Extensible обмена сообщениями и присутствия протокол). Поскольку клиентские приложения не всегда подключен или под управлением, FCM подключения сервера ставит в очередь и сохраняет сообщения, отправкой к клиентским приложениям, повторное подключение и становятся доступными. Аналогичным образом FCM будет постановки в очередь вышестоящего сообщений из клиентского приложения для сервера приложений в случае недоступности сервера приложений. Дополнительные сведения о серверах FCM подключения, см. в разделе [о Firebase Cloud Messaging Server](https://firebase.google.com/docs/cloud-messaging/server).

FCM использует следующие учетные данные для идентификации сервера приложений и клиентского приложения и использует эти учетные данные для авторизации операций сообщения через FCM:

-   <a name="fcm-in-action-sender-id"></a>**Идентификатор отправителя** &ndash; *кода отправителя* — это уникальное числовое значение, присвоенное при создании проекта Firebase. Идентификатор отправителя, используется для идентификации каждого сервера приложений, который можно отправлять сообщения в клиентское приложение. Идентификатор отправителя также — номер проекта; Вы можете получить идентификатор отправителя в консоли Firebase, при регистрации проекта. Пример кода отправителя — `496915549731`.

-   <a name="fcm-in-action-api-key"></a>**Ключ API** &ndash; *ключ API* предоставляет приложению доступ сервера к службам Firebase; FCM использует этот ключ для проверки подлинности сервера приложений. Эти учетные данные также называется *ключ сервера* или *ключа веб-API*. Например, ключ API `AJzbSyCTcpfRT1YRqbz-jIwp1h06YdauvewGDzk`.

-   <a name="fcm-in-action-app-id"></a>**Идентификатор приложения** &ndash; удостоверение клиентского приложения (независимо от любого устройства), зарегистрированный на получение сообщений из FCM. Пример идентификатора приложения — `1:415712510732:android:0e1eb7a661af2460`.

-   <a name="fcm-in-action-registration-token"></a>**Маркер регистрации** &ndash; *токена регистрации* (называемый также *идентификатор экземпляра*) представляет собой FCM идентификатор клиентского приложения на данном устройстве. Маркер регистрации создается во время выполнения &ndash; приложение получает маркер регистрации, при ее первой регистрации в FCM во время выполнения на устройстве. Маркер регистрации авторизует экземпляр клиентского приложения (для запуска на этом конкретном устройстве) для получения сообщений из FCM.
    Пример маркера регистрации — `fkBQTHxKKhs:AP91bHuEedxM4xFAUn0z ... JKZS` (очень длинную строку).

[Параметр вверх Firebase Cloud Messaging](#setup_fcm) (Далее в этом руководстве) содержатся подробные инструкции по созданию проекта и создания этих учетных данных. При создании нового проекта в [консоли Firebase](https://console.firebase.google.com/), файл учетных данных с именем **google-services.json** создается &ndash; добавьте этот файл в проект Xamarin.Android, как описано в [ Удаленные уведомления с помощью FCM](~/android/data-cloud/google-messaging/remote-notifications-with-fcm.md).

В следующих разделах объясняется, как используются эти учетные данные, когда клиентские приложения взаимодействуют с серверами приложений через FCM.


<a name="registration" />

### <a name="registration-with-fcm"></a>Регистрация в FCM

Клиентское приложение, сначала необходимо зарегистрировать в FCM, прежде чем обмена сообщениями может выполняться. Клиентское приложение необходимо выполнить действия по регистрации, показано на следующей схеме:

[![Схема шаги регистрации приложений](firebase-cloud-messaging-images/02-app-registration-sml.png)](firebase-cloud-messaging-images/02-app-registration.png#lightbox)

1.  Клиентское приложение обращается FCM для получения маркера регистрации, передача кода отправителя, ключ API и идентификатор приложения FCM.

2.  FCM возвращает маркер регистрации в клиентское приложение.

3.  Клиентское приложение (необязательно) передает токен регистрации для сервера приложений.

Сервер приложений кэширует маркер регистрации для последующих соединений с клиентским приложением. Сервер приложений могли отправлять подтверждение клиентское приложение, чтобы указать, что маркер регистрации было получено. После внесения это подтверждение, клиентское приложение может получать сообщения из (или отправлять сообщения) сервера приложений. Клиентское приложение может получить новый маркер регистрации, если старый токен нарушена (см. в разделе [удаленные уведомления с помощью FCM](~/android/data-cloud/google-messaging/remote-notifications-with-fcm.md) пример как приложение получает маркер обновления регистрации).

Когда клиентское приложение больше не хочет получать сообщения с сервера приложений, он может отправить запрос к серверу приложений, чтобы удалить маркер регистрации. Если клиентское приложение удаляется с устройства, FCM обнаружит это и автоматически уведомляет о том, чтобы удалить маркер регистрации сервера приложений.



### <a name="downstream-messaging"></a>Более низком уровне обмена сообщениями

На схеме ниже как Firebase Cloud Messaging хранит и пересылает сообщения подчиненных:

[![FCM использует хранилище и вперед для подчиненных обмена сообщениями](firebase-cloud-messaging-images/03-downstream-sml.png)](firebase-cloud-messaging-images/03-downstream.png#lightbox)

Когда сервер приложение отправляет сообщение нисходящего потока в клиентское приложение, он выполняет указанные ниже действия как перечисленные в приведенной выше диаграмме:

1.  Сервер приложений отправляет сообщение FCM.

2.  Если клиентское устройство не доступен, на сервере FCM хранятся сообщения в очередь для последующей передачи. Сообщения хранятся в хранилище FCM более 4 недели (Дополнительные сведения см. в разделе [параметр времени существования сообщения](https://firebase.google.com/docs/cloud-messaging/concept-options#ttl)).

3.  Когда клиентское устройство станет доступным, FCM пересылает сообщение в клиентское приложение на этом устройстве.

4.  Клиентское приложение получает сообщение от FCM, обрабатывает его и отображает его пользователю. Например если сообщение является удаленного уведомления, оно выводится пользователю в области уведомлений.

В этом сценарии обмена сообщениями (где сервера приложений отправляет сообщение одного клиентского приложения) сообщения могут иметь длину до 4 КБ.

Подробные сведения о получении подчиненных FCM-сообщений на устройстве Android, см. в разделе [удаленные уведомления с помощью FCM](~/android/data-cloud/google-messaging/remote-notifications-with-fcm.md).

### <a name="topic-messaging"></a>Обмен сообщениями в разделе

*Раздел Messaging* делает возможным для серверов приложений для отправки сообщения на несколько устройств, которые зарегистрировались для определенного раздела. Можно также составлять и отправлять сообщения раздела через графический Интерфейс уведомления консоли Firebase. FCM обрабатывает маршрутизацией и доставкой сообщений раздела подписанных клиентам. Эта функция может использоваться для сообщения, такие как оповещения об изменении погоды, биржевых котировок и заголовков новостей.

[![Схема обмена сообщениями раздела](firebase-cloud-messaging-images/04-topic-messaging-sml.png)](firebase-cloud-messaging-images/04-topic-messaging.png#lightbox)

(После клиентское приложение получает маркер регистрации, как описано выше) в разделе обмена сообщениями используются следующие действия:

1.  Клиентское приложение подписывается на раздел, отправляя сообщение подписаться в FCM.

2.  Сервер приложений отправляет сообщения раздела FCM для распространения.

3.  FCM пересылает сообщения раздела для клиентов, которые подписаны на этот раздел.

Дополнительные сведения об обмене сообщениями через раздел Firebase, см. в разделе Google [разделе обмена сообщениями на устройстве Android](https://firebase.google.com/docs/cloud-messaging/android/topic-messaging).


<a name="setup_fcm" />

## <a name="setting-up-firebase-cloud-messaging"></a>Настройка Firebase Cloud Messaging

Перед использованием FCM служб в приложении, необходимо создать новый проект (или импортировать существующий проект) с помощью [консоли Firebase](https://console.firebase.google.com/). Следуйте инструкциям ниже, чтобы создать проект Firebase Cloud Messaging для вашего приложения:

1.  Войдите в [консоли Firebase](https://console.firebase.google.com/) с вашей учетной записи Google (т. е. ваш адрес электронной почты Gmail) и нажмите кнопку **создать новый ПРОЕКТ**:

    [![Кнопка "Создать новый проект"](firebase-cloud-messaging-images/05-firebase-console-sml.png)](firebase-cloud-messaging-images/05-firebase-console.png#lightbox)

    Если у вас есть существующий проект, нажмите кнопку **импортировать проект Google**.

2.  В **создайте проект** диалоговое окно, введите имя проекта и нажмите кнопку **Создание проекта**. В следующем примере вызывается проекта **XamarinFCM** создается:

    [![Создать диалоговое окно проекта](firebase-cloud-messaging-images/06-create-a-project-sml.png)](firebase-cloud-messaging-images/06-create-a-project.png#lightbox)

3.  В консоли Firebase **Обзор**, нажмите кнопку **Добавление Firebase в приложение Android**:

    [![Добавление Firebase в приложение Android](firebase-cloud-messaging-images/07-add-firebase-sml.png)](firebase-cloud-messaging-images/07-add-firebase.png#lightbox)

4.  На следующем экране введите имя пакета приложения. В этом примере имя пакета является **com.xamarin.fcmexample**. Это значение должно соответствовать имени пакета приложения Android. Также можно ввести псевдоним приложения в **псевдоним приложения** поля:

    [![Ввод примера FCM как псевдоним приложения](firebase-cloud-messaging-images/08-package-name-sml.png)](firebase-cloud-messaging-images/08-package-name.png#lightbox)

5.  Если приложение использует динамических ссылок, приглашения или проверки подлинности Google, необходимо также ввести отладки сертификат для подписи. Дополнительные сведения об обнаружении сертификата подписи см. в разделе [отображение MD5 и SHA1 сигнатур](~/android/deploy-test/signing/keystore-signature.md).
    В этом примере сертификат для подписи оставлено пустым.

6.  Нажмите кнопку **добавить приложение**:

    [![Нажмите кнопку Добавить приложение](firebase-cloud-messaging-images/09-add-app-sml.png)](firebase-cloud-messaging-images/09-add-app.png#lightbox)

    Ключ API сервера и идентификатор клиента, автоматически создаются для приложения. Эта информация помещается в **google-services.json** файл, который автоматически загружается при выборе **добавить приложение**.
    Обязательно сохраните этот файл в надежном месте.

Подробный пример добавления **google-services.json** в проект приложения для получения сообщений уведомления FCM Push-уведомлений в Android, см. в разделе [удаленные уведомления с помощью FCM](~/android/data-cloud/google-messaging/remote-notifications-with-fcm.md).



## <a name="for-further-reading"></a>Для дальнейшего изучения

-   Google [Firebase Cloud Messaging](https://firebase.google.com/docs/cloud-messaging/) предоставляет обзор Firebase Cloud Messaging основные возможности, объяснение того, как это работает, а также инструкции по настройке.

-   Google [построения запросов отправки для приложения сервера](https://firebase.google.com/docs/cloud-messaging/send-message) объясняется, как отправлять сообщения с помощью сервера приложений.

-   [RFC 6120](https://tools.ietf.org/html/rfc6120) и [RFC 6121](https://tools.ietf.org/html/rfc6121) объяснить и определить расширяемый обмена сообщениями и присутствия протокола (XMPP).

-   [Сведения о сообщениях FCM](https://firebase.google.com/docs/cloud-messaging/concept-options) описывает различные типы сообщений, которые могут быть отправлены с помощью Firebase Cloud Messaging.

## <a name="summary"></a>Сводка

В этой статье предоставляются общие сведения о из Firebase Cloud Messaging (FCM). Оно описывает различные учетные данные, которые используются для идентификации и авторизации, обмен сообщениями между серверами приложений и клиентских приложений. Она иллюстрирует регистрации и подчиненных сценарии обмена сообщениями, и его подробные инструкции по регистрации приложения в FCM для использования служб FCM.


## <a name="related-links"></a>Связанные ссылки

- [Обмен сообщениями Firebase Cloud](https://firebase.google.com/docs/cloud-messaging/)
