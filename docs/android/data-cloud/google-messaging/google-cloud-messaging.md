---
title: Google Cloud Messaging
description: "Google Cloud Messaging (GCM) является службой, которая обеспечивает обмен сообщениями между мобильных приложений и серверных приложений. В этой статье содержатся общие сведения о том, как работает GCM, а также описание способов настройки службы Google, чтобы приложения могли использовать GCM."
ms.topic: article
ms.prod: xamarin
ms.assetid: DF8EF401-F63D-4BA0-B2C6-B22DF8FD60CB
ms.technology: xamarin-android
author: mgmclemore
ms.author: mamcle
ms.date: 02/08/2018
ms.openlocfilehash: 225662fe64c92b77af3e75cbee865561118692a4
ms.sourcegitcommit: 6cd40d190abe38edd50fc74331be15324a845a28
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/27/2018
---
# <a name="google-cloud-messaging"></a>Google Cloud Messaging

_Google Cloud Messaging (GCM) является службой, которая обеспечивает обмен сообщениями между мобильных приложений и серверных приложений. В этой статье содержатся общие сведения о том, как работает GCM, а также описание способов настройки службы Google, чтобы приложения могли использовать GCM._

[![Эмблема Google Cloud Messaging](google-cloud-messaging-images/preview-sml.png)](google-cloud-messaging-images/preview.png)

В этом разделе представлен общий обзор как Google Cloud Messaging маршрутизирует сообщения между приложением и серверов приложений, и предоставляет пошаговые процедуры для получения учетных данных, чтобы приложения могли использовать службы GCM.

<a name="overview" />

## <a name="overview"></a>Обзор

Google Cloud Messaging (GCM) является служба, которая обрабатывает отправки, маршрутизации и постановка в очередь сообщений приложениями мобильных клиентских и серверных приложений. Объект *клиентское приложение* представляет приложение с поддержкой GCM, которое выполняется на устройстве. *Сервером приложения* (предоставляемое вы или ваша организация) сервер включен GCM, который клиентское приложение обменивается данными с помощью GCM:

[![GCM располагается между приложением клиента и сервера приложений](google-cloud-messaging-images/01-server-gcm-app-sml.png)](google-cloud-messaging-images/01-server-gcm-app.png)

Используя GCM, серверы приложений могут отправлять сообщения для одного устройства группе устройств и количество устройств, которые подписаны на раздел. Клиентское приложение можно использовать GCM подписаться на подчиненные сообщения из серверов приложений (например, для получения удаленных уведомлений). Кроме того GCM делает возможным для клиентских приложений для отправки сообщений вышестоящего обратно на сервер приложений.

Сведения о реализации серверов приложений для GCM см. в разделе [о GCM соединения сервера](https://developers.google.com/cloud-messaging/server).


<a name="inaction" />

## <a name="google-cloud-messaging-in-action"></a>Google Cloud Messaging в действии

При отправке сообщений подчиненным сервером приложения для клиентского приложения, сервер приложений отправляет сообщение *GCM соединения сервера*; GCM соединения сервера, в свою очередь пересылает сообщение на устройство, на котором работает клиентское приложение. Сообщения могут отправляться по протоколу HTTP или [XMPP](https://developers.google.com/cloud-messaging/ccs) (Extensible обмена сообщениями и протокол присутствия). Поскольку клиентские приложения не всегда подключен или выполнении GCM подключения ставит в очередь и сохраняет сообщения сервера, отправив клиентских приложений как повторного подключения и становятся доступными. Аналогичным образом GCM будет постановки в очередь вышестоящего сообщений из клиентского приложения на сервер приложений в случае недоступности сервера приложения.

GCM использует следующие учетные данные для идентификации сервера и клиентского приложения и использует эти учетные данные для авторизации транзакциями сообщений через GCM:

-   **Ключ API** &ndash; *ключ API* позволяет получать доступ сервера приложений для служб Google. GCM использует этот ключ для проверки подлинности сервера приложения.
    Прежде чем использовать службы GCM, необходимо сначала получить ключ API из [Google Developer Console](https://console.developers.google.com/) путем создания *проекта*. Ключ API необходимо обеспечить безопасность; Дополнительные сведения о защите ключа API см. в разделе [рекомендаций по безопасным способом с помощью ключей API](https://support.google.com/cloud/answer/6310037?hl=en).

-   **Идентификатор отправителя** &ndash; *идентификатор отправителя* авторизует сервером приложения для клиентского приложения &ndash; это уникальный номер, идентифицирующий сервер приложений, разрешенное для отправки сообщений в клиентское приложение.
    Идентификатор отправителя также имеет номер вашего проекта; При регистрации проекта вы получите идентификатор отправителя из Google Developers Console.

-   **Токен регистрации** &ndash; *токена регистрации* GCM удостоверение клиентского приложения на данном устройстве. Во время выполнения создается маркер регистрации &ndash; приложение получает токен регистрации при ее первой регистрации GCM при выполнении на устройстве. Токен регистрации разрешает экземпляр клиентского приложения (для этого конкретного устройства под управлением) для получения сообщений из GCM.

-   **Идентификатор приложения** &ndash; удостоверение клиентского приложения (независимо от любого устройства), зарегистрированный на получение сообщений из GCM. В Android идентификатор приложения — это имя пакета, записанные в **AndroidManifest.xml**, такие как `com.xamarin.gcmexample`.

[Параметр вверх Google Cloud Messaging](#settingup) (Далее в этом руководстве) содержатся подробные инструкции по созданию проекта и созданием эти учетные данные.

В следующих разделах объясняется, как используются эти учетные данные, когда клиентские приложения взаимодействуют с серверами приложений через GCM.


<a name="registration" />

### <a name="registration-with-gcm"></a>Регистрации GCM

Клиентское приложение, установленное на устройстве необходимо выполнить регистрацию GCM перед обмена сообщениями могут иметь место. Клиентское приложение необходимо выполнить действия по регистрации показано на следующей схеме:

[![Шаги регистрации приложения](google-cloud-messaging-images/02-app-registration-sml.png)](google-cloud-messaging-images/02-app-registration.png)

1.  Клиентское приложение обращается GCM для получения токена регистрации, передавая идентификатор отправителя для GCM.

2.  GCM возвращает маркер регистрации клиентского приложения.

3.  Клиентское приложение отправляет маркер регистрации на сервер приложений.

Сервер приложений кэширует токен регистрации для последующих соединений с помощью клиентского приложения. При необходимости сервер приложений может отправить подтверждение обратно в клиентское приложение, чтобы указать, что был получен маркер регистрации. После внесения этого подтверждения, клиентское приложение может получать сообщения из (или отправки сообщений в) сервер приложений.

Когда клиентское приложение больше не хочет получать сообщения от приложений сервера, его можно отправить запрос на сервер приложений, чтобы удалить маркер регистрации. Если клиентское приложение получает сообщения раздела (описано ниже в этой статье), позволяет отменить подписку на раздел.
Если клиентское приложение удаляется с устройства, GCM обнаружит это и автоматически уведомляет серверу удалить маркер регистрации приложения.

Google [регистрации клиентского приложения](https://developers.google.com/cloud-messaging/registration) описание процесса регистрации более подробно; объясняется, отмены регистрации и отмены подписки и описывает процесс удаления регистрации, при удалении клиентского приложения.


<a name="downstream" />

### <a name="downstream-messaging"></a>Подчиненные обмена сообщениями

Сервер приложений отправляет сообщение подчиненных для клиентского приложения, следует шаги показаны на следующей схеме:

[![Подчиненные хранилища обмена сообщениями и прямой схема](google-cloud-messaging-images/03-downstream-sml.png)](google-cloud-messaging-images/03-downstream.png)

1.  Сервер приложений отправляет сообщение GCM.

2.  Если клиентское устройство недоступен, сервер GCM хранит сообщения в очереди для последующей передачи.

3.  Если клиентское устройство доступно, GCM отправляет сообщение в клиентское приложение на этом устройстве.

4.  Клиентское приложение получает сообщение из GCM и обрабатывает ее соответствующим образом. Например если сообщение удаленного уведомления, оно выводится пользователю.

В этом сценарии обмена сообщениями (где сервер приложений отправляет сообщение приложения одного клиента) сообщения могут быть длиной до 4 КБ.

Подробные сведения (в том числе примеры кода) о получении подчиненный сообщений GCM в Android см. в разделе [удаленного уведомления](~/android/data-cloud/google-messaging/remote-notifications-with-gcm.md).


<a name="topic" />

#### <a name="topic-messaging"></a>Обмен сообщениями в разделе

*Обмен сообщениями разделе* является типом подчиненных обмена сообщениями, где сервер приложений отправляет одно сообщение несколько клиентских устройствах приложения, подписанные на раздел (например, прогноз погоды). Раздел сообщения могут быть длиной до 2 КБ и обмен сообщениями раздел поддерживает до миллиона подписок для каждого приложения. Если GCM используется только для раздела обмена сообщениями, в клиентском приложении не требуется для отправки токена регистрации на сервер приложений. Google [реализации системы обмена сообщениями разделе](https://developers.google.com/cloud-messaging/topic-messaging) объясняется, как отправлять сообщения из серверов приложений на несколько устройств, которые подписаны на определенного раздела.


<a name="group" />

#### <a name="group-messaging"></a>Группы сообщений

*Группировать обмен сообщениями* является типом подчиненных обмена сообщениями, где сервер приложений отправляет одно сообщение несколько приложений клиентских устройств, принадлежащих группе (например, группа устройств, принадлежащих одному пользователю). Группа сообщений может быть до 2 KБ для устройств iOS и до 4 КБ в длину для устройств Android. Группа — ограничение составляет 20 элементов. Google [обмена сообщениями на устройстве группы](https://developers.google.com/cloud-messaging/notifications) объясняет, как серверы приложений можно отправлять одно сообщение несколько экземпляров клиента приложения, работающие на устройствах, принадлежащих группе.


<a name="upstream" />

### <a name="upstream-messaging"></a>Вышестоящий обмена сообщениями

Если клиентское приложение подключается к серверу, который поддерживает [XMPP](https://developers.google.com/cloud-messaging/ccs), его могут отправлять сообщения обратно на сервер приложений, как показано на следующей схеме:

[![Вышестоящий схемы обмена сообщениями](google-cloud-messaging-images/04-upstream-sml.png)](google-cloud-messaging-images/04-upstream.png)

1.  Клиентское приложение отправляет сообщение на сервер GCM XMPP соединения.

2.  При отключении сервера приложения на сервере GCM хранятся сообщения в очереди для пересылки, более поздней версии.

3.  При повторно подключенный сервер приложений GCM пересылает сообщение на сервер приложений.

4.  Сервер приложений выполняет синтаксический анализ сообщения, чтобы проверить подлинность клиентского приложения, а затем отправляет «подтверждение» GCM для подтверждения получения сообщения.

5.  Сервер приложений обрабатывает сообщение.

Google [вышестоящего сообщения](https://developers.google.com/cloud-messaging/ccs#upstream) описывается структура сообщения с кодировкой JSON и отправляют их серверам приложений под управлением Google на основе XMPP облака соединения сервера.


<a name="settingup" />

## <a name="setting-up-google-cloud-messaging"></a>Настройка Google Cloud Messaging

Перед использованием службы GCM в приложении, сначала необходимо получить учетные данные для доступа к серверам GCM Google. В следующих разделах описаны шаги, необходимые для завершения этого процесса:


<a name="googleservices" />

### <a name="enable-google-services-for-your-app"></a>Включение служб Google для приложения

1.  Вход в [Google Developers Console](https://developers.google.com/mobile/add?platform=android) с Google вашей учетной записи (т. е., ваш адрес gmail) или создайте новый проект. При наличии существующего проекта, выберите проект, который вы хотите стать поддержкой GCM. В следующем примере вызывается новый проект **XamarinGCM** создается:

    [![Создание проекта XamarinGCM](google-cloud-messaging-images/05-create-gcm-app-sml.png)](google-cloud-messaging-images/05-create-gcm-app.png)

2.  Затем введите имя пакета для приложения (в данном примере имя пакета — **com.xamarin.gcmexample**) и нажмите кнопку **продолжить выбор и настройка служб**:

    [![Введите имя пакета](google-cloud-messaging-images/06-package-name-sml.png)](google-cloud-messaging-images/06-package-name.png)

    Обратите внимание, что это имя пакета также идентификатор приложения для приложения.

3.  **Выбор и настройка служб** разделе перечислены службы Google, которые можно добавить в приложение. Нажмите кнопку **облако обмена сообщениями**:

    [![Выберите облако, обмен сообщениями](google-cloud-messaging-images/07-choose-gcm-service-sml.png)](google-cloud-messaging-images/07-choose-gcm-service.png)

4.  Далее щелкните **ВКЛЮЧИТЬ GOOGLE CLOUD MESSAGING**:

    [![Включить Google Cloud Messaging](google-cloud-messaging-images/08-enable-gcm-sml.png)](google-cloud-messaging-images/08-enable-gcm.png)

5.  Объект **ключ API сервера** и **идентификатор отправителя** создаются для вашего приложения. Запишите эти значения и нажмите кнопку **ЗАКРЫТЬ**:

    [![Ключ API сервера и отображается идентификатор отправителя](google-cloud-messaging-images/09-get-api-key-and-id-sml.png)](google-cloud-messaging-images/09-get-api-key-and-id.png)

    Защитить ключ API &ndash; не предназначен для общего использования. В случае компрометации ключа API неавторизованных серверов удалось опубликовать сообщения для клиентских приложений.
    [Советы и рекомендации для безопасным способом с помощью ключей API](https://support.google.com/cloud/answer/6310037?hl=en) предоставляет полезные рекомендации для защиты ключа API.


<a name="projectsettings" />

### <a name="view-your-project-settings"></a>Просмотр параметров проекта

Параметры проекта можно просмотреть в любое время при входе в [облачной консоли Google](https://console.cloud.google.com/) и выбрав проект. Например, можно просмотреть **идентификатор отправителя** , выбрав проект в раскрывающемся меню в верхней части страницы (в этом примере используется проект с именем **XamarinGCM**). Идентификатор отправителя является номером проекта, как показано на этом снимке экрана (идентификатор отправителя является **9349932736**):

[![Просмотр идентификатор отправителя](google-cloud-messaging-images/10-view-server-id-sml.png)](google-cloud-messaging-images/10-view-server-id.png)

Чтобы просмотреть **ключ API**, нажмите кнопку **API диспетчера** и нажмите кнопку **учетные данные**:

[![Просмотр ключ API](google-cloud-messaging-images/11-view-credentials-sml.png)](google-cloud-messaging-images/11-view-credentials.png)


<a name="furtherreading" />

## <a name="for-further-reading"></a>Дополнительные сведения

-   Google [регистрации клиентского приложения](https://developers.google.com/cloud-messaging/registration) описывается процесс регистрации клиента более подробно и предоставляет сведения о настройке автоматического повтора и синхронизация состояние регистрации.

-   [RFC 6120](https://tools.ietf.org/html/rfc6120) и [RFC 6121](https://tools.ietf.org/html/rfc6121) объясняется и определить расширяемый обмена сообщениями и протокол присутствия (XMPP).


<a name="summary" />

## <a name="summary"></a>Сводка

В этой статье содержатся общие сведения из Google Cloud Messaging (GCM). Он описывается различные учетные данные, которые используются для идентификации и авторизации, обмен сообщениями между серверами приложений и клиентских приложений. Он показаны наиболее распространенные сценарии обмена сообщениями, и его подробные инструкции по регистрации приложения в GCM для использования служб GCM.


## <a name="related-links"></a>Связанные ссылки

- [Облачные системы обмена сообщениями](https://developers.google.com/cloud-messaging/)
