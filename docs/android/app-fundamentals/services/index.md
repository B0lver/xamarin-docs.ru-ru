---
title: "Создание Android служб"
description: "В этом руководстве рассматриваются Xamarin.Android службы, являющиеся Android компонентов, которые позволяют выполнить без активных пользовательский интерфейс. Службы очень часто используются для задач, выполняемых в фоновом режиме, например много времени вычислений, загрузка файлов, музыка и т. д. Он описаны различные сценарии, подходящие для службы и показано, как реализовать их как для выполнения фоновой длительно выполняемых задач, а также для предоставления интерфейса для удаленных вызовов процедур."
ms.topic: article
ms.prod: xamarin
ms.assetid: BA371A59-6F7A-F62A-02FC-28253504ACC9
ms.technology: xamarin-android
author: topgenorth
ms.author: toopge
ms.date: 02/16/2018
ms.openlocfilehash: 5dc1fb0fb02014e123b3a161394155bde725f288
ms.sourcegitcommit: 0fdb243b46cf21be47584900805cadcd077121bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2018
---
# <a name="creating-android-services"></a>Создание Android служб

_В этом руководстве рассматриваются Xamarin.Android службы, являющиеся Android компонентов, которые позволяют выполнить без активных пользовательский интерфейс. Службы очень часто используются для задач, выполняемых в фоновом режиме, например много времени вычислений, загрузка файлов, музыка и т. д. Он описаны различные сценарии, подходящие для службы и показано, как реализовать их как для выполнения фоновой длительно выполняемых задач, а также для предоставления интерфейса для удаленных вызовов процедур._

## <a name="android-services-overview"></a>Общие сведения о службах Android

Мобильные приложения не похожи на классических приложениях. Настольные компьютеры имеют большое количество ресурсов, например площадь экрана, память, дисковое пространство и подключенный источник питания, мобильных устройств нет. Эти ограничения принудительное мобильных приложений ведут себя по-разному. Например маленьком экране на мобильном устройстве обычно означает, что одновременно отображается, только одно приложение (т. е. действие). Другие действия перемещения в фоновом режиме и передаче в приостановленном состоянии, когда они не могут выполнять никаких действий. Тем не менее только потому, что приложение находится в фоновом режиме означает, что его невозможно для приложения продолжить работу. 

Приложения Android состоят из по крайней мере один следующие основные компоненты: _действия_, _широковещательных приемники_, _поставщики содержимого_и _Службы_. Действия лежат в основе многих значительные приложений Android, так как они предоставляют пользовательский Интерфейс, позволяющий пользователю взаимодействовать с приложением. Тем не менее когда дело доходит до выполнения параллельной или фоновой работы, действий не всегда являются лучшим вариантом.
 
Является основным механизмом фоновой работы в Android _службы_. Android службы — это компонент, предназначенный для выполнения некоторых задач без пользовательского интерфейса. Служба может загрузить файл, послушать музыку или применить фильтр к изображению. Службы могут также использоваться для взаимодействия между процессами (_IPC_) между приложениями для Android. Например одно приложение Android с помощью музыка player — это служба, другое приложение или приложение может предоставлять данные (например, контактные данные человека) в другие приложения с помощью службы. 

Службы и возможности для выполнения фоновой работы чрезвычайно важны для предоставление smooth и жидкости пользовательского интерфейса. Все приложения Android имеют _основной поток_ (также известный как _поток пользовательского интерфейса_), на котором выполняются действия. Для обеспечения быстрого реагирования устройства, Android должны иметь возможность обновить пользовательский интерфейс с частотой 60 кадров в секунду. Если приложение Android выполняет объем работы в основном потоке, а затем Android приводит к потере кадров, что в свою очередь вызывает пользовательский Интерфейс для отображения рывками (иногда также называют _janky_). Это означает, что вся работа выполняется в потоке пользовательского интерфейса должна завершиться в промежутке времени между двумя кадрами, приблизительно 16 миллисекунд (1 второй каждые 60 кадров). 

Чтобы устранить эту проблему, разработчик может использовать потоки в действии для выполнения части работы, которая может блокировать пользовательский Интерфейс. Тем не менее это может вызвать проблемы. Это вполне вероятно, что Android уничтожит и повторно создать несколько экземпляров действия. Однако Android не приведет к удалению автоматически потоки, которые могут стать причиной утечки памяти. Простым примером этого является при [повороте устройства](~/android/app-fundamentals/handling-rotation.md) &ndash; Android попытается удалить экземпляр действия и затем повторно создать новый:

![При повороте устройства, 1 экземпляр уничтожается и создается экземпляр 2](images/image-01.png)

Это представляет потенциальную утечку памяти &ndash; по-прежнему будут выполняться потока, созданного первого экземпляра действия. Если поток имеет ссылку на первый экземпляр действия, это будет препятствовать Android объект сбор мусора. Однако второй экземпляр действия по-прежнему создается (который в свою очередь может создать новый поток). Поворот устройства несколько раз в течение короткого промежутка времени может исчерпать всю ПАМЯТЬ и принудительно Android завершить работу всего приложения для освобождения памяти.

Как правило если выполняемой работы следует пережить действия, затем службы должны создаваться для выполнения этой работы. Тем не менее если работу применим только в контексте действия, затем создание потока для выполнения работы может оказаться более подходящей. Например Создание эскиза для фотографий, добавленный к приложению коллекции фотографий, скорее всего, произойдет в службе. Тем не менее поток может быть более удобным использовать для воспроизведения некоторые музыка, следует слышали только во время действия находится на переднем плане.

Фоновая операция можно разделить на две широкие категории:

1. **Длинные выполняемая задача** &ndash; это работы, еще выполняется, пока не будет остановлен. Пример _долго выполняющихся задач_ — это приложение, которое выполняет потоковую передачу музыки или, необходимо отслеживать данные, собранные из датчика. Эти задачи необходимо запустить, даже если приложение не имеет видимого пользовательского интерфейса.
2. **Периодические задачи** &ndash; (иногда называют _задания_) периодической задачи — задача, которая имеет короткое длительность (несколько секунд) и запускается по расписанию (т. е. один раз в день, неделю или, возможно, только один раз в Далее 60 секунд). Примером этого загрузки файла из Интернета или Создание эскиза для изображения.

Существует четыре различных типа Android служб:

* **Привязать службы** &ndash; A _привязан службы_ — это служба, с какой-либо компонент (обычно действия) привязанным к нему. Связанные службы предоставляет интерфейс, который позволяет связанный компонент и службы для взаимодействия друг с другом. Как только появятся дополнительные клиенты не привязан к службе, Android завершит работу службы.

* **`IntentService`** &ndash;  _`IntentService`_  Является специализированным подклассом `Service` класс, который упрощает создание службы и использования. `IntentService` Предназначен для обработки отдельных вызовов автономной. В отличие от службы, которая может одновременно обрабатывать несколько вызовов, `IntentService` , больше напоминает _работы очереди процессора_ &ndash; помещено рабочих и `IntentService` обрабатывает каждое задание один одновременно в одном рабочем потоке. Как правило`IntentService` не привязан к действию или фрагмент. 

* **Служба запущена** &ndash; A _запустил службу_ — служба, которая была запущена с какой-либо Android компонент (например, действия) и выполняется непрерывное в фоновом режиме, пока что-то явно указывает остановку службы. В отличие от привязанной службы служба, запускаемая не имеет любых клиентов, которые привязаны непосредственно к нему. По этой причине важно разработать запущенные службы, таким образом, чтобы они могут правильно перезапущены при необходимости.

* **Гибридная служба** &ndash; A _гибридная служба_ — это служба, имеющий характеристики _запустил службу_ и _привязан службы_. Гибридная служба запускается при привязывает к этому экземпляру компонента, или оно может начаться либо событием. Клиентский компонент может или не может быть привязан к службе гибридной. Гибридная служба будут продолжать работать до его явным образом сообщать, чтобы остановить или Дополнительные клиенты отсутствуют связанные с ним.

Какой тип службы, очень зависит от требований приложения. Как правило `IntentService` или связанные службы достаточно для большинства задач, которые должен выполнять приложения, поэтому предпочтений должен быть предоставлен для одного из этих двух типов служб. `IntentService` Лучше всего подойдет для «одноступенчатая» задачи, такие как загрузки файла, а привязанной службы будет подходит при необходимости частого взаимодействия с действие/фрагмент. 

Хотя большинство служб выполняется в фоновом режиме, есть специальные подкатегорий, известный как _службы переднего плана_. Это служба, которая имеет более высокий приоритет (по сравнению с обычным) для выполнения некоторых операций для пользователя (например, при воспроизведении музыки). 

Можно также для запуска службы в собственный процесс на одном устройстве, это иногда называется _удаленной службы_ или как _out of process службы_. Для этого требуются дополнительные усилия, чтобы создать, но может быть полезным для, когда приложению требуется совместного использования функциональных возможностей с другими приложениями и в некоторых случаях повышения удобства работы пользователей приложения. 

Каждая из этих служб имеет свои собственные характеристики и настройки и поэтому рассматриваются более подробно в своих собственных руководства.
