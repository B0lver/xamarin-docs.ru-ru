---
title: Введение в Рендерскрипт
description: В этом руководство рассказывается о Рендерскрипт и объясняется, как использовать встроенный API Рендерскрипт в приложении Xamarin. Android, ориентированном на уровень API 17 или выше.
ms.prod: xamarin
ms.assetid: 378793C7-5E3E-40E6-ABEE-BEAEF64E6A47
ms.technology: xamarin-android
author: davidortinau
ms.author: daortin
ms.date: 02/06/2018
ms.openlocfilehash: 884b69b0cdecf4f979cec314b6440974c5bac97d
ms.sourcegitcommit: 2fbe4932a319af4ebc829f65eb1fb1816ba305d3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2019
ms.locfileid: "73019798"
---
# <a name="an-introduction-to-renderscript"></a>Введение в Рендерскрипт

_В этом руководство рассказывается о Рендерскрипт и объясняется, как использовать встроенный API Рендерскрипт в приложении Xamarin. Android, ориентированном на уровень API 17 или выше._

## <a name="overview"></a>Обзор

Рендерскрипт — это платформа программирования, созданная Google в целях повышения производительности приложений Android, требующих обширных вычислительных ресурсов. Это высокопроизводительный API с низким уровнем производительности, основанный на [C99](https://en.wikipedia.org/wiki/C99). Поскольку это интерфейс API низкого уровня, который будет работать на ЦП, GPU или DSP, Рендерскрипт хорошо подходит для приложений Android, которые могут потребоваться для выполнения следующих действий:

- Графика
- Обработка изображений
- Шифрование
- Обработка сигнала
- Математические подпрограммы

Рендерскрипт будет использовать `clang` и компилировать скрипты для LLVM байтового кода, Объединенного в APK. При первом запуске приложения код байта LLVM будет компилироваться в машинный код для процессоров на устройстве. Эта архитектура позволяет приложению Android использовать преимущества машинного кода, не требуя от разработчика самостоятельно писать его для каждого процессора на самом устройстве.

Существует два компонента подпрограммы Рендерскрипт:

1. **Среда выполнения рендерскрипт** &ndash; это собственные API, отвечающие за выполнение рендерскрипт. Сюда входят все Рендерскриптс, написанные для приложения.

2. **Управляемые оболочки из платформы Android** &ndash; управляемые классы, позволяющие приложению Android управлять средой выполнения и скриптами рендерскрипт и взаимодействовать с ними. В дополнение к классам, предоставляемым платформой для управления средой выполнения Рендерскрипт, Android цепочки инструментов будет проверять исходный код Рендерскрипт и создавать управляемые классы-оболочки для использования приложением Android.

На следующей схеме показано, как связаны эти компоненты.

![Схема взаимодействия платформы Android с средой выполнения Рендерскрипт](renderscript-images/renderscript-01.png)

Существует три важных понятия использования Рендерскриптс в приложении Android:

1. **Контекст** &ndash; УПРАВЛЯЕМый API, предоставляемый пакет SDK для Android, который выделяет ресурсы для рендерскрипт и позволяет приложению Android передавать и принимать данные из рендерскрипт.

2. **_Ядро вычислений_** , &ndash; также называемое _корневым ядром_ или _ядром_, это подпрограммы, выполняющие работу. Ядро очень похоже на функцию C; Это подпрограммы параллелизуемые, которые будут выполняться для всех данных в выделенной памяти.

3. **Выделенная память** &ndash; данные передаются в ядро и из него через _[выделение](xref:Android.Renderscripts.Allocation)_ памяти. Ядро может иметь один вход и (или) одно выделение выходных данных.

Пространство имен [Android. рендерскриптс](xref:Android.Renderscripts) содержит классы для взаимодействия со средой выполнения рендерскрипт. В частности, класс [`Renderscript`](xref:Android.Renderscripts.RenderScript) будет управлять жизненным циклом и ресурсами подсистемы рендерскрипт. Приложение Android должно инициализировать один или несколько [`Android.Renderscripts.Allocation`](xref:Android.Renderscripts.Allocation)
объект. Выделение — это управляемый API, который отвечает за выделение и доступ к памяти, которая совместно используется приложением Android и средой выполнения Рендерскрипт. Как правило, для входных данных создается одно выделение, и при необходимости создается другое выделение для хранения выходных данных ядра. Механизм среды выполнения Рендерскрипт и связанные управляемые классы-оболочки будут управлять доступом к памяти, удерживаемой выделениями. разработчику приложения Android не нужно выполнять дополнительную работу.

Выделение будет содержать один или несколько [элементов Android. рендерскриптс. Elements](xref:Android.Renderscripts.Element).
Элементы — это специализированный тип, описывающий данные в каждом выделении.
Типы элементов для выделения выходных данных должны соответствовать типам входного элемента. При выполнении Рендерскрипт будет циклически перебирать каждый элемент во входном распределении и записывать результаты в выделение выходных данных. Существует два типа элементов:

- **простой тип** &ndash; концептуально, это то же самое, что и тип данных C, `float` или `char`.

- **сложный тип** &ndash; этот тип аналогичен `struct`у C.

Подсистема Рендерскрипт выполнит проверку среды выполнения, чтобы убедиться, что элементы в каждом выделении совместимы с требованиями ядра. Если тип данных элементов в выделении не соответствует типу данных, ожидаемому ядром, будет создано исключение.

Все ядра Рендерскрипт будут обернуты типом, который является потомком [`Android.Renderscripts.Script`](xref:Android.Renderscripts.Script)
. Класс `Script` используется для задания параметров для Рендерскрипт, установки соответствующих `Allocations`и запуска Рендерскрипт. В пакет SDK для Android есть два `Script` подкласса:

- **`Android.Renderscripts.ScriptIntrinsic`** &ndash; некоторые из наиболее распространенных задач рендерскрипт объединены в пакет SDK для Android и доступны подклассу класса [скриптинтринсик](xref:Android.Renderscripts.ScriptIntrinsic) . Разработчику не нужно предпринимать никаких дополнительных действий, чтобы использовать эти сценарии в своем приложении, так как они уже предоставлены.

- **`ScriptC_XXXXX`** &ndash; также известные как _пользовательские сценарии_, это сценарии, написанные разработчиками и упакованные в apk. Во время компиляции Android цепочки инструментов создаст управляемые классы-оболочки, которые позволят использовать скрипты в приложении Android.
  Имена создаваемых классов — это имя файла Рендерскрипт с префиксом `ScriptC_`. Написание и внедрение пользовательских сценариев официально не поддерживается в Xamarin. Android и не входит в состав этого руководства.

Из этих двух типов в Xamarin. Android поддерживается только `StringIntrinsic`. В этом руководство рассказывается, как использовать встроенные скрипты в приложении Xamarin. Android.

## <a name="requirements"></a>Требования

Это руководством для приложений Xamarin. Android, предназначенных для API уровня 17 или выше. Использование _пользовательских сценариев_ не рассматривается в этом руководством.

[Библиотека поддержки Xamarin. Android V8 поддерживает](https://www.nuget.org/packages/Xamarin.Android.Support.v8.RenderScript/) интерфейс API встроенных рендерскрипт для приложений, предназначенных для более ранних версий пакет SDK для Android. Добавление этого пакета в проект Xamarin. Android должно позволить приложениям, предназначенным для более ранних версий пакет SDK для Android, использовать встроенные скрипты.

## <a name="using-intrinsic-renderscripts-in-xamarinandroid"></a>Использование встроенных Рендерскриптс в Xamarin. Android

Встроенные сценарии — это отличный способ выполнения ресурсоемких задач с минимальным объемом дополнительного кода. Они были настроены таким образом, чтобы обеспечить оптимальную производительность для больших перекрестных разделов устройств.
Нередко встроенный скрипт для выполнения 10 раз быстрее, чем управляемый код, и 2 3 раза раз после, чем пользовательская реализация C. Многие типичные сценарии обработки охватываются встроенными сценариями. Этот список встроенных скриптов описывает текущие скрипты в Xamarin. Android:

- [ScriptIntrinsic3DLUT](xref:Android.Renderscripts.ScriptIntrinsic3DLUT) &ndash; преобразует RGB в RGBA с помощью таблицы подстановки объемного объема. 

- [Скриптинтринсикблас](https://developer.android.com/reference/android/renderscript/ScriptIntrinsicBLAS.html) &ndash; Провидешигх Performance рендерскрипт API to [Блас](http://www.netlib.org/blas/). БЛАС (основные подпрограммы линейной перестройки) — это подпрограммы, которые предоставляют стандартные строительные блоки для выполнения базовых операций вектора и матрицы. 

- [Скриптинтринсикбленд](xref:Android.Renderscripts.ScriptIntrinsicBlend) &ndash; объединяет два выделения.

- [Скриптинтринсикблур](xref:Android.Renderscripts.ScriptIntrinsicBlur) &ndash; применяет размытие по Гауссу к выделению.

- [Скриптинтринсикколорматрикс](xref:Android.Renderscripts.ScriptIntrinsicColorMatrix) &ndash; применяет матрицу цветов к выделению (т. е. изменить цвета, настроить оттенок).

- [ScriptIntrinsicConvolve3x3](xref:Android.Renderscripts.ScriptIntrinsicConvolve3x3) &ndash; применяет матрицу цветов 3x3 к выделению.

- [ScriptIntrinsicConvolve5x5](xref:Android.Renderscripts.ScriptIntrinsicConvolve5x5) &ndash; применяет матрицу цветов 5X5 к выделению.

- [Скриптинтринсичистограм](xref:Android.Renderscripts.ScriptIntrinsicHistogram) &ndash; встроенный фильтр гистограммы.

- [Скриптинтринсиклут](xref:Android.Renderscripts.ScriptIntrinsicLUT) &ndash; применяет таблицу подстановки для каждого канала к буферу.

- [Скриптинтринсикресизе](xref:Android.Renderscripts.ScriptIntrinsicResize) &ndash; скрипт для выполнения изменения размера 2D-выделения.

- [Скриптинтринсициувторгб](xref:Android.Renderscripts.ScriptIntrinsicYuvToRGB) &ndash; ПРЕОБРАЗУЕТ буфер YUV в RGB.

Дополнительные сведения о каждом из встроенных скриптов см. в документации по API.

Ниже описаны основные шаги по использованию Рендерскрипт в приложении Android.

**Создание контекста рендерскрипт** &ndash; [`Renderscript`](xref:Android.Renderscripts.RenderScript)
класс является управляемой оболочкой для контекста Рендерскрипт и будет управлять инициализацией, управлением ресурсами и очисткой. Объект Рендерскрипт создается с помощью метода фабрики `RenderScript.Create`, который принимает контекст Android (например, действие) в качестве параметра. В следующей строке кода показано, как инициализировать контекст Рендерскрипт:

```csharp
Android.Renderscripts.RenderScript renderScript = RenderScript.Create(this);
```

**Создание распределений** &ndash; в зависимости от встроенного скрипта может потребоваться создать один или два `Allocation`s. [`Android.Renderscripts.Allocation`](xref:Android.Renderscripts.Allocation)
класс имеет несколько фабричных методов, помогающих создать экземпляр выделения для внутреннего объекта. Например, в следующем фрагменте кода показано, как создать выделение для растровых изображений.

```csharp
Android.Graphics.Bitmap originalBitmap;
Android.Renderscripts.Allocation inputAllocation = Allocation.CreateFromBitmap(renderScript,
                                                     originalBitmap,
                                                     Allocation.MipmapControl.MipmapFull,
                                                     AllocationUsage.Script);
```

Часто требуется создать `Allocation` для хранения выходных данных скрипта. В следующем фрагменте кода показано, как использовать вспомогательный метод `Allocation.CreateTyped` для создания экземпляра второй `Allocation` того же типа, что и у исходного:

```csharp
Android.Renderscripts.Allocation outputAllocation = Allocation.CreateTyped(renderScript, inputAllocation.Type);
```

**Создайте экземпляр оболочки скрипта** &ndash; каждый из классов оболочек скриптов должен иметь вспомогательные методы (обычно называемые `Create`) для создания экземпляра объекта-оболочки для этого скрипта. В следующем фрагменте кода приведен пример того, как создать объект `ScriptIntrinsicBlur` размытия. Вспомогательный метод `Element.U8_4` создаст элемент, описывающий тип данных, который равен 4 полям 8-разрядных целочисленных значений без знака, подходящих для хранения данных объекта `Bitmap`:

```csharp
Android.Renderscripts.ScriptIntrinsicBlur blurScript = ScriptIntrinsicBlur.Create(renderScript, Element.U8_4(renderScript));
```

**Назначение выделений, параметров SET, & выполнения скрипта** &ndash; класс `Script` предоставляет метод `ForEach` для фактического запуска рендерскрипт. Этот метод выполняет итерацию каждого `Element` в `Allocation` хранения входных данных. В некоторых случаях может потребоваться предоставить `Allocation`, содержащий выходные данные.
`ForEach` будет перезаписывать содержимое выделения выходных данных. Чтобы перенести фрагменты кода из предыдущих шагов, в этом примере показано, как назначить входное размещение, задать параметр, а затем запустить сценарий (скопировать результаты в выделение выходных данных):

```csharp
blurScript.SetInput(inputAllocation);
blurScript.SetRadius(25);  // Set a pamaeter
blurScript.ForEach(outputAllocation);
```

Вы можете извлекать [размытие образа с помощью](https://github.com/xamarin/recipes/tree/master/Recipes/android/other_ux/drawing/blur_an_image_with_renderscript) рецепта рендерскрипт. это полный пример использования встроенного сценария в Xamarin. Android.

## <a name="summary"></a>Сводка

В этом руководство введено Рендерскрипт и способы его использования в приложении Xamarin. Android. В нем кратко обсуждается, что такое Рендерскрипт и как оно работает в приложении Android. В нем описаны некоторые ключевые компоненты Рендерскрипт и различия между _пользовательскими скриптами_ и _сценариями встроенных_. Наконец, в этом руководстве обсуждаются шаги использования встроенного скрипта в приложении Xamarin. Android.

## <a name="related-links"></a>Связанные ссылки

- [Пространство имен Android. Рендерскриптс](xref:Android.Renderscripts)
- [Размытие изображения с помощью Рендерскрипт](https://github.com/xamarin/recipes/tree/master/Recipes/android/other_ux/drawing/blur_an_image_with_renderscript)
- [Renderscript](https://developer.android.com/guide/topics/renderscript/compute.html)
- [Учебник. начало работы с Рендерскрипт](https://software.intel.com/en-us/articles/renderscript-basic-sample-for-android-os)
