---
title: Связывание приложений в Android
description: В этом руководство показано, как в Android 6.0 используется методика связывания приложений, что позволяет мобильным приложениям реагировать на URL-адреса веб-сайтов. Вы узнаете, что такое связывание приложений, как реализовать связывание приложений в приложении Android 6.0 и как настроить на веб-сайте доступ к домену для мобильного приложения.
ms.prod: xamarin
ms.assetid: 48174E39-19FD-43BC-B54C-9AF11D4B1F91
ms.technology: xamarin-android
author: davidortinau
ms.author: daortin
ms.date: 02/16/2018
ms.openlocfilehash: af90c286d2bb960a9f78547dd15c3d98a69529ae
ms.sourcegitcommit: b0ea451e18504e6267b896732dd26df64ddfa843
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2020
ms.locfileid: "75487832"
---
# <a name="app-linking-in-android"></a>Связывание приложений в Android

_В этом руководство показано, как в Android 6.0 используется методика связывания приложений, что позволяет мобильным приложениям реагировать на URL-адреса веб-сайтов. Вы узнаете, что такое связывание приложений, как реализовать связывание приложений в приложении Android 6.0 и как настроить на веб-сайте доступ к домену для мобильного приложения._

## <a name="app-linking-overview"></a>Общие сведения о связывании приложений

Мобильные приложения прочно вошли в обиход — во многих случаях это важные компоненты бизнеса наряду с веб-сайтом компании. Предприятиям нужна возможно легко объединять решения для веб-репрезентации с мобильными приложениями, чтобы ссылки на веб-сайте могли запускать мобильные приложения и отображать в них соответствующее содержимое. *Связывание приложений* (также называется *глубинное связывание*) — это один из методов, позволяющих мобильному устройству реагировать на URI и запускать соответствующее мобильное приложение.

Android обрабатывает связывание приложений с помощью *системы намерений*. Когда пользователь щелкает ссылку в браузере мобильного устройства, этот браузер отправляет в систему Android намерение, которое она делегирует зарегистрированному приложению. Например, щелчок по ссылке на кулинарном веб-сайте открывает мобильное приложение, связанное с этим веб-сайтом, и отображает для пользователя конкретный рецепт. Если для работы с этим намерением зарегистрировано несколько приложений, Android отобразит так называемый *диалог устранения неоднозначности*, в котором пользователю предлагается выбрать приложение, которое будет обрабатывать это намерение, например так:

![Пример снимка экрана с диалогом устранения неоднозначности](app-linking-images/01-disambiguation-dialog.png)

Android 6.0 улучшает этот механизм, применяя автоматическую обработку ссылок. Android может автоматически регистрировать приложение в качестве обработчика по умолчанию для URI, и тогда это приложение запустится автоматически и сразу перейдет к соответствующему действию. Android 6.0 принимает решения об обработке URI по следующим критериям:

1. **Есть существующее приложение, уже связанное с этим URI** — возможно, пользователь уже сопоставил с этим URI существующее приложение. В этом случае Android продолжит использовать это приложение.
2. **Нет существующего приложения, связанного с этим URI, но установлено одно совместимое с ним приложение** — в этом случае, хотя пользователь и не указал существующее приложение, Android вызовет установленное совместимое приложение для обработки запроса.
3. **Нет существующего приложения, связанного с этим URI, но установлено несколько совместимых с ним приложений** — так как сразу несколько приложений поддерживают обработку этого URI, откроется диалоговое окно для устранения неоднозначности, где пользователю нужно выбрать одно приложение для обработки URI.

Если у пользователя нет ни одного приложения, совместимого с этим URI, но оно будет установлено позже, система Android автоматически назначит это приложение как обработчик по умолчанию для этого URI, предварительно проверив его связь с веб-сайтом, которому принадлежит URI.

В этом руководстве показано, как настроить приложение Android 6.0, а также создать и опубликовать файл ссылок на цифровые ресурсы для поддержки связывания приложений в Android 6.0.

## <a name="requirements"></a>Требования

Для работы с этим руководством требуется Xamarin.Android 6.1 и приложение, предназначенное для использования Android 6.0 (API уровня 23) или выше.

Связывание приложений в более ранних версиях Android реализуется через [пакет NuGet Rivets](https://www.nuget.org/packages/Rivets/) из магазина компонентов для Xamarin. Пакет Rivets не совместим с механизмом связывания приложений в Android 6.0 и не поддерживает этот механизм.

## <a name="configuring-app-linking-in-android-60"></a>Настройка связывания приложений в Android 6.0

Настройка связывания приложений в Android 6.0 включает два основных этапа.

1. **Добавление одного или нескольких фильтров намерений для URI веб-сайта** — фильтр намерений позволяет Android понять, как обрабатывать щелчок по ссылке в мобильном браузере.
2. **Публикация *JSON-файла ссылок на цифровые ресурсы* на веб-сайте** — это файл, который загружается на веб-сайт и используется платформой Android для проверки взаимосвязи между мобильным приложением и домена этого веб-сайта. Без этой проверки Android не будет устанавливать приложение как обработчик по умолчанию для URI, и пользователю придется выполнить это вручную.

<a name="configure-intent-filter" />

### <a name="configuring-the-intent-filter"></a>Настройка фильтра намерений

Вам нужно настроить фильтр намерений, который сопоставляет URI (или даже набор из нескольких URI) некоторого веб-сайта с действием в приложении Android. В Xamarin.Android такое сопоставление устанавливается путем назначения действию атрибута [IntentFilterAttribute](xref:Android.App.IntentFilterAttribute). Фильтр намерений должен объявлять следующую информацию:

- **`Intent.ActionView`**  — регистрация фильтра намерений для реагирования на запросы просмотра информации.
- **`Categories`**  — фильтр намерений должен регистрировать **[Intent.CategoryBrowsable](xref:Android.Content.Intent.CategoryBrowsable)** и **[Intent.CategoryDefault](xref:Android.Content.Intent.CategoryDefault)** , чтобы правильно обрабатывать URI веб-сайта.
- **`DataScheme`**  — фильтр намерений должен объявлять `http` и (или) `https`. Существует только две допустимые схемы.
- **`DataHost`**  — это домен, к которому относятся URI.
- **`DataPathPrefix`**  — это необязательный путь к ресурсам на веб-сайте.
- **`AutoVerify`**  — атрибут `autoVerify` сообщает системе Android, что нужно проверить отношение между приложением и веб-сайтом. Этот механизм мы подробнее обсудим позже.

В следующем примере показано, как применить [IntentFilterAttribute](xref:Android.App.IntentFilterAttribute) для обработки ссылок от `https://www.recipe-app.com/recipes` и `http://www.recipe-app.com/recipes`.

```csharp
[IntentFilter(new [] { Intent.ActionView },
              Categories = new[] { Intent.CategoryBrowsable, Intent.CategoryDefault },
              DataScheme = "http",
              DataHost = "recipe-app.com",
              DataPathPrefix = "/recipe",
              AutoVerify=true)]
public class RecipeActivity : Activity
{
    // Code for the activity omitted
}
```

Android сверит все узлы, которые указаны в фильтрах намерений, с файлом цифровых ресурсов на веб-сайте, прежде чем зарегистрировать приложение в качестве обработчика по умолчанию для этого URI. Все фильтры намерений должны пройти проверку, прежде чем Android применит приложение как обработчик по умолчанию.

### <a name="creating-the-digital-assets-link-file"></a>Создание файла ссылок на цифровые ресурсы

Для связывания приложений в Android 6.0 требуется, чтобы Android проверял все связи между приложением и веб-сайтом, прежде чем устанавливать приложение в качестве обработчика по умолчанию для URI. Такая проверка выполняется при первой установке приложения. Файл *ссылок на цифровые ресурсы* имеет формат JSON и размещается на всех соответствующих поддоменах.

> [!NOTE]
> Фильтр намерений &ndash; должен установить атрибут `android:autoVerify`, иначе Android не будет выполнять проверку.

Этот файл размещается веб-мастером домена по адресу **https://domain/.well-known/assetlinks.json** .

Файл цифровых ресурсов содержит метаданные, необходимые для проверки связи платформой Android. Файл **assetlinks.json** содержит следующие пары "ключ — значение":

- `namespace` — пространство имен приложения Android;
- `package_name` — имя пакета для приложения Android (объявляется в манифесте приложения);
- `sha256_cert_fingerprints` — отпечаток SHA256 для подписанного приложения. Дополнительные сведения о получении отпечатков SHA1 для приложения см. в статье [Отображение MD5 и SHA1 сигнатур хранилища ключей](~/android/deploy-test/signing/keystore-signature.md).

Ниже приведен пример файла **assetlinks.json**, где указано одно приложение:

```json
[
   {
      "relation":[
         "delegate_permission/common.handle_all_urls"
      ],
      "target":{
         "namespace":"android_app",
         "package_name":"com.example",
         "sha256_cert_fingerprints":[
            "14:6D:E9:83:C5:73:06:50:D8:EE:B9:95:2F:34:FC:64:16:A0:83:42:E6:1D:BE:A8:8A:04:96:B2:3F:CF:44:E5"
         ]
      }
   }
]
```

Вы можете зарегистрировать боле одного отпечатка SHA256, чтобы поддерживать несколько версий или сборок приложения. В следующем файле **assetlinks.json** представлен пример регистрации нескольких приложений:

```json
[
   {
      "relation":[
         "delegate_permission/common.handle_all_urls"
      ],
      "target":{
         "namespace":"android_app",
         "package_name":"example.com.puppies.app",
         "sha256_cert_fingerprints":[
            "14:6D:E9:83:C5:73:06:50:D8:EE:B9:95:2F:34:FC:64:16:A0:83:42:E6:1D:BE:A8:8A:04:96:B2:3F:CF:44:E5"
         ]
      }
   },
   {
      "relation":[
         "delegate_permission/common.handle_all_urls"
      ],
      "target":{
         "namespace":"android_app",
         "package_name":"example.com.monkeys.app",
         "sha256_cert_fingerprints":[
            "14:6D:E9:83:C5:73:06:50:D8:EE:B9:95:2F:34:FC:64:16:A0:83:42:E6:1D:BE:A8:8A:04:96:B2:3F:CF:44:E5"
         ]
      }
   }
]
```

[Веб-сайт Google по ссылкам на цифровые ресурсы](https://developers.google.com/digital-asset-links/tools/generator) предоставляет онлайн-средство для создания и тестирования файла цифровых ресурсов.

### <a name="testing-app-links"></a>Тестирование связывания приложений

Реализовав связывание приложения, следует проверить разные элементы этого механизма и убедиться, что они работают должным образом.

Вы можете убедиться, что файл цифровых ресурсов имеет правильный формат и правильно размещен, используя API Google для ссылок на цифровые ресурсы, как показано в этом примере:

```html
https://digitalassetlinks.googleapis.com/v1/statements:list?source.web.site=
  https://<WEB SITE ADDRESS>:&relation=delegate_permission/common.handle_all_urls
```

Существует два теста, которые можно выполнить для проверки правильности фильтров намерений и настройки приложения в качестве обработчика по умолчанию для URI.

1. Файл цифровых ресурсов правильно размещен, как описано выше. Первый тест отправляет намерение, которое система Android должна передать мобильному приложению. Приложение Android должно открыться и отобразить действие, зарегистрированное для этого URL-адреса. В командной строке введите следующее:

    ```shell
    $ adb shell am start -a android.intent.action.VIEW \
        -c android.intent.category.BROWSABLE \
        -d "http://<domain1>/recipe/scalloped-potato"
    ```

2. Отобразите существующие политики обработки ссылок для приложений, установленных на конкретном устройстве. Следующая команда выводит список политик для каждого пользователя на устройстве с указанной здесь информацией. В командной строке введите следующую команду:

    ```shell
    $ adb shell dumpsys package domain-preferred-apps
    ```

    - **`Package`**  — имя пакета для приложения.
    - **`Domain`**  — домены, разделенные пробелами, ссылки для которых будут обрабатываться этим приложением.
    - **`Status`**  — текущее состояние обработки ссылок для этого приложения. Значение **always** означает, что приложение объявило `android:autoVerify=true` и прошло проверку в системе. После него указывается шестнадцатеричное число, обозначающее запись приоритета в системе Android.

    Пример:

    ```shell
    $ adb shell dumpsys package domain-preferred-apps

    App linkages for user 0:
    Package: com.android.vending
    Domains: play.google.com market.android.com
    Status: always : 200000002
    ```

## <a name="summary"></a>Сводка

В этом руководстве описана методика связывания приложений в Android 6.0. Затем мы описали, как правильно настроить приложение Android 6.0 для включения поддержки ссылок и реагирования на них. Мы также обсудили, как протестировать связывание приложений для приложения Android.

## <a name="related-links"></a>Связанные ссылки

- [Отображение MD5 и SHA1 сигнатур хранилища ключей](~/android/deploy-test/signing/keystore-signature.md)
- [AppLinks](https://developers.facebook.com/docs/applinks)
- [Ссылки на цифровые ресурсы Google](https://developers.google.com/digital-asset-links/)
- [Генерирование и тестирование списка инструкций](https://developers.google.com/digital-asset-links/tools/generator)
