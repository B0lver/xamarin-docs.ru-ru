---
title: Связывание приложений в Android
description: В этом руководство объясняется, как Android 6,0 поддерживает связывание приложений, методику, которая позволяет мобильным приложениям отвечать на URL-адреса на веб-сайтах. Здесь обсуждается, что такое связывание приложений, как реализовать компоновку приложений в приложении Android 6,0 и как настроить веб-сайт для предоставления разрешений на доступ к мобильному приложению для домена.
ms.prod: xamarin
ms.assetid: 48174E39-19FD-43BC-B54C-9AF11D4B1F91
ms.technology: xamarin-android
author: conceptdev
ms.author: crdun
ms.date: 02/16/2018
ms.openlocfilehash: 2256e52e1b2a468ecbed97d5c7ed2d0a05f6cc4e
ms.sourcegitcommit: b07e0259d7b30413673a793ebf4aec2b75bb9285
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/26/2019
ms.locfileid: "68510750"
---
# <a name="app-linking-in-android"></a>Связывание приложений в Android

_В этом руководство объясняется, как Android 6,0 поддерживает связывание приложений, методику, которая позволяет мобильным приложениям отвечать на URL-адреса на веб-сайтах. Здесь обсуждается, что такое связывание приложений, как реализовать компоновку приложений в приложении Android 6,0 и как настроить веб-сайт для предоставления разрешений на доступ к мобильному приложению для домена._

## <a name="app-linking-overview"></a>Общие сведения о связывании приложений

Мобильные приложения больше не находятся в приемнике &ndash; . во многих случаях они являются важными компонентами их бизнеса, а также их веб-сайтом. Желательно, чтобы предприятия легко подключались к мобильным приложениям и веб-узлам, а ссылки на веб-сайте запускают мобильные приложения и отображали соответствующее содержимое в мобильном приложении. *Связывание приложений* (также называется глубокой *компоновкой*) — один из методов, позволяющих мобильному устройству реагировать на URI и запускать мобильное приложение, соответствующее этому универсальному коду ресурса (URI).

Android управляет компоновкой приложений через *систему* &ndash; с намерением, когда пользователь щелкает ссылку в браузере мобильного устройства, браузер мобильных устройств будет отправлять намерение, что Android будет делегировать зарегистрированному приложению. Например, если щелкнуть ссылку на веб-сайте кулинар, откроется мобильное приложение, связанное с этим веб-сайтом, и будет отображен конкретный рецепт для пользователя. Если для работы с этим намерением зарегистрировано несколько приложений, то Android будет вызывать то, что известно как *диалоговое окно* устранения неоднозначности, которое запрашивает у пользователя какое приложение выбрать приложение, которое должно справиться с намерением, например:

![Пример снимка экрана с диалоговым окном устранения неоднозначности](app-linking-images/01-disambiguation-dialog.png)

Android 6,0 улучшает эту работу, используя автоматическую обработку ссылок. В Android можно автоматически зарегистрировать приложение в качестве обработчика по умолчанию для URI &ndash; , который приложение будет автоматически запускать, и перейти непосредственно к соответствующему действию. Решение о том, как Android 6,0 решает обработку универсального кода ресурса (URI), зависит от следующих критериев.

1. **Существующее приложение уже связано с URI** &ndash; Возможно, пользователь уже связан с существующим приложением с URI. В этом случае Android продолжит использовать это приложение.
2. **Нет существующих приложений, связанных с URI, но установлено вспомогательное приложение** &ndash; В этом сценарии пользователь не указал существующее приложение, поэтому Android будет использовать установленное поддерживающее приложение для выполнения запроса.
3. **С URI не связано существующее приложение, но установлены многие вспомогательные приложения** . &ndash; Поскольку существует несколько приложений, поддерживающих универсальный код ресурса (URI), отображается диалоговое окно устранения неоднозначности, и пользователь должен выбрать приложение, которое будет обрабатывать универсальный код ресурса (URI).

Если у пользователя нет установленных приложений, поддерживающих универсальный код ресурса (URI), а затем он установлен, то Android задаст это приложение как обработчик по умолчанию для URI после проверки связи с веб-сайтом, связанным с URI.

В этом руководство рассказывается, как настроить приложение Android 6,0 и как создать и опубликовать файл ссылок Digital Asset для поддержки компоновки приложений в Android 6,0.

## <a name="requirements"></a>Требования

Для работы с этим руководством требуется Xamarin. Android 6,1 и приложение, предназначенное для Android 6,0 (API уровня 23) или более поздней версии.

Связывание приложений возможно в более ранних версиях Android, используя [пакет NuGet](https://www.nuget.org/packages/Rivets/) для размещения из хранилища компонентов Xamarin. Пакет "Лаб" несовместим с компоновкой приложений в Android 6,0; Он не поддерживает связывание приложений Android 6,0.

## <a name="configuring-app-linking-in-android-60"></a>Настройка компоновки приложений в Android 6,0

Настройка ссылок на приложения в Android 6,0 включает в себя два основных этапа:

1. **Добавление одного или нескольких фильтров намерения для URI веб-сайта** &ndash; фильтры по намерениям Android в разделе как управлять URL-адресом щелкните в браузере мобильного устройства.
2. **Публикация *JSON* -файла с ссылками на** &ndash; цифровые ресурсы. это файл, который загружается на веб-сайт и используется Android для проверки связи между мобильным приложением и доменом веб-сайта. Без этого Android не сможет установить приложение в качестве маркера по умолчанию для URI; пользователь должен сделать это вручную.

<a name="configure-intent-filter" />

### <a name="configuring-the-intent-filter"></a>Настройка фильтра намерения

Необходимо настроить фильтр намерения, который сопоставляет URI (или набор URI) от веб-сайта с действием в приложении Android. В Xamarin. Android это отношение устанавливается путем оформления действия с помощью [интентфилтераттрибуте](xref:Android.App.IntentFilterAttribute). Фильтр намерения должен объявлять следующие сведения:

* **`Intent.ActionView`** &ndash; Фильтр намерения будет зарегистрирован для реагирования на запросы на просмотр сведений.
* **`Categories`** Фильтр намерения должен зарегистрировать **[цели. категорибровсабле](xref:Android.Content.Intent.CategoryBrowsable)** и **[намерения. категоридефаулт](xref:Android.Content.Intent.CategoryDefault)** , чтобы иметь возможность правильно обрабатывать URI веб-сайта. &ndash;
* **`DataScheme`** Фильтр намерения должен объявлять `http` и (или `https`). &ndash; Это единственные допустимые схемы.
* **`DataHost`** &ndash; Это домен, из которого берутся URI.
* **`DataPathPrefix`** &ndash; Это необязательный путь к ресурсам на веб-сайте.
* **`AutoVerify`** &ndash; АтрибутуказываетAndroidпроверитьсвязьмеждуприложением`autoVerify` и веб-сайтом. Это будет рассмотрено ниже.

В следующем примере показано, как использовать [интентфилтераттрибуте](xref:Android.App.IntentFilterAttribute) для управления ссылками из `https://www.recipe-app.com/recipes` и из `http://www.recipe-app.com/recipes`:

```csharp
[IntentFilter(new [] { Intent.ActionView },
              Categories = new[] { Intent.CategoryBrowsable, Intent.CategoryDefault },
              DataScheme = "http",
              DataHost = "recipe-app.com",
              DataPathPrefix = "/recipe",
              AutoVerify=true)]
public class RecipeActivity : Activity
{
    // Code for the activity omitted
}
```

Перед регистрацией приложения в качестве обработчика по умолчанию для URI Android проверяет каждый узел, идентифицируемый фильтрами намерения, на файл цифровых ресурсов на веб-сайте. Все фильтры намерения должны пройти проверку, прежде чем Android сможет установить приложение в качестве обработчика по умолчанию.

### <a name="creating-the-digital-assets-link-file"></a>Создание файла связи с цифровыми ресурсами

Для связи приложений Android 6,0 требуется, чтобы Android проверял связь между приложением и веб-сайтом перед установкой приложения в качестве обработчика по умолчанию для URI. Эта проверка произойдет при первой установке приложения. Файл *ссылок Digital Assets* — это JSON-файл, размещенный в соответствующих Интернет-доменах.

> [!NOTE]
> Атрибут должен быть задан фильтром &ndash; намерения, иначе Android не будет выполнять проверку. `android:autoVerify`

Файл помещается веб-мастером домена в расположение **https://domain/.well-known/assetlinks.json** .

Файл цифрового ресурса содержит метаданные, необходимые для проверки связи с Android. Файл **ассетлинкс. JSON** содержит следующие пары "ключ-значение":

* `namespace`&ndash; пространство имен приложения Android.
* `package_name`&ndash; имя пакета приложения Android (объявлено в манифесте приложения).
* `sha256_cert_fingerprints`&ndash; отпечатки SHA256 подписанного приложения. Дополнительные сведения о получении отпечатка SHA1 для приложения см. в [этом руководства.](~/android/deploy-test/signing/keystore-signature.md)

В следующем фрагменте кода приведен пример **ассетлинкс. JSON** с одним приложением:

```json
[
   {
      "relation":[
         "delegate_permission/common.handle_all_urls"
      ],
      "target":{
         "namespace":"android_app",
         "package_name":"com.example",
         "sha256_cert_fingerprints":[
            "14:6D:E9:83:C5:73:06:50:D8:EE:B9:95:2F:34:FC:64:16:A0:83:42:E6:1D:BE:A8:8A:04:96:B2:3F:CF:44:E5"
         ]
      }
   }
]
```

Можно зарегистрировать более одного отпечатка SHA256 для поддержки различных версий или сборок приложения. Следующий файл **ассетлинкс. JSON** является примером регистрации нескольких приложений:

```json
[
   {
      "relation":[
         "delegate_permission/common.handle_all_urls"
      ],
      "target":{
         "namespace":"android_app",
         "package_name":"example.com.puppies.app",
         "sha256_cert_fingerprints":[
            "14:6D:E9:83:C5:73:06:50:D8:EE:B9:95:2F:34:FC:64:16:A0:83:42:E6:1D:BE:A8:8A:04:96:B2:3F:CF:44:E5"
         ]
      }
   },
   {
      "relation":[
         "delegate_permission/common.handle_all_urls"
      ],
      "target":{
         "namespace":"android_app",
         "package_name":"example.com.monkeys.app",
         "sha256_cert_fingerprints":[
            "14:6D:E9:83:C5:73:06:50:D8:EE:B9:95:2F:34:FC:64:16:A0:83:42:E6:1D:BE:A8:8A:04:96:B2:3F:CF:44:E5"
         ]
      }
   }
]
```

На [веб-сайте с ссылками на цифровой ресурс Google](https://developers.google.com/digital-asset-links/tools/generator) имеется онлайн-инструмент, который может помочь при создании и тестировании файла цифровых активов.

### <a name="testing-app-links"></a>Тестирование ссылок на приложения

После реализации связей между приложениями необходимо проверить различные части, чтобы убедиться, что они работают должным образом.

Можно убедиться, что файл цифровых активов правильно отформатирован и размещен с помощью API ссылок на цифровые активы Google, как показано в следующем примере:

```html
https://digitalassetlinks.googleapis.com/v1/statements:list?source.web.site=
  https://<WEB SITE ADDRESS>:&relation=delegate_permission/common.handle_all_urls
```

Существует два теста, которые можно выполнить, чтобы убедиться, что фильтры намерения правильно настроены и что приложение установлено в качестве обработчика по умолчанию для URI:

1.  Файл цифрового ресурса правильно размещен, как описано выше. Первый тест отправит цель, которую Android должен перенаправить в мобильное приложение. Приложение Android должно запуститься и отобразить действие, зарегистрированное для URL-адреса. В командной строке введите:

    ```shell
    $ adb shell am start -a android.intent.action.VIEW \
        -c android.intent.category.BROWSABLE \
        -d "http://<domain1>/recipe/scalloped-potato"
    ```

2.  Отображение существующих политик обработки ссылок для приложений, установленных на данном устройстве. Следующая команда выводит список политик ссылок для каждого пользователя на устройстве со следующими сведениями. В командной строке введите следующую команду:

    ```shell
    $ adb shell dumpsys package domain-preferred-apps
    ```

    * **`Package`** &ndash; Имя пакета приложения.
    * **`Domain`** &ndash; Домены (разделенные пробелами), веб-ссылки которых будут обрабатываться приложением.
    * **`Status`** &ndash; Текущее состояние обработки ссылок для приложения. Значение **всегда** означает, что приложение `android:autoVerify=true` объявило и прошло проверку системы. За ним следует шестнадцатеричное число, представляющее запись о настройках системы Android.

    Например:

    ```shell
    $ adb shell dumpsys package domain-preferred-apps

    App linkages for user 0:
    Package: com.android.vending
    Domains: play.google.com market.android.com
    Status: always : 200000002
    ```

## <a name="summary"></a>Сводка

В этом руководство обсуждалось, как работает связывание приложений в Android 6,0. Затем мы рассмотрели, как настроить приложение Android 6,0 для поддержки и реагирования на связи приложений. В нем также обсуждалось, как тестировать компоновку приложений в приложении Android.


## <a name="related-links"></a>Связанные ссылки

- [Поиск подписи MD5 или SHA1 для хранилища ключей](~/android/deploy-test/signing/keystore-signature.md)
- [Действия и удержания](https://university.xamarin.com/classes#4)
- [апплинкс](http://applinks.org/)
- [Ссылки на цифровые активы Google](https://developers.google.com/digital-asset-links/)
- [Генератор списка инструкций и тестер](https://developers.google.com/digital-asset-links/tools/generator)
