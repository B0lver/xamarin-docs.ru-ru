---
title: Возможности Marshmallow
description: Эта статья поможет вам начать использовать Xamarin.Android при разработке приложений для Android 6.0 Marshmallow.
ms.prod: xamarin
ms.assetid: E4D6F183-98D2-460A-9D65-937639A899E0
ms.technology: xamarin-android
author: davidortinau
ms.author: daortin
ms.date: 03/01/2018
ms.openlocfilehash: fb1ba92be9527d490b3d34bd4c0e454b0a750837
ms.sourcegitcommit: b0ea451e18504e6267b896732dd26df64ddfa843
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2020
ms.locfileid: "73019991"
---
# <a name="marshmallow-features"></a>Возможности Marshmallow

_Эта статья поможет вам начать использовать Xamarin.Android при разработке приложений для Android 6.0 Marshmallow._

В этой статье представлен обзор новых возможностей Android 6.0 Marshmallow, описывается подготовка Xamarin.Android для разработки приложений Android Marshmallow и приводятся ссылки на примеры приложений, иллюстрирующие использование новых возможностей Android Marshmallow в приложениях Xamarin.Android. 

## <a name="overview"></a>Обзор

[Android 6.0 Marshmallow](https://developer.android.com/about/versions/marshmallow/index.html) — это следующий основной выпуск Android после Android Lollipop.
Xamarin.Android поддерживает Android Marshmallow и включает в себя:

- **Привязки API 23 для Android 6.0** — Android 6.0 предусматривает множество новых API для новых возможностей, описанных ниже. Эти API доступны для приложений Xamarin.Android при использовании API уровня 23. Дополнительные сведения об API Android 6.0 см. [здесь](https://developer.android.com/preview/api-overview.html). 

[![Главный имиджевый баннер с изображением планшета и телефонов с Marshmallow](marshmallow-images/android-m-hero-sml.png)](marshmallow-images/android-m-hero.png#lightbox)

Хотя главной целью выпуска Marshmallow являются "блеск и качество", он также предоставляет множество новых возможностей, представляющих интерес для разработчиков Xamarin.Android. Эти функции включают перечисленные ниже. 

- **Разрешения среды выполнения** — это улучшение позволяет пользователям утверждать разрешения безопасности в каждом конкретном случае во время выполнения. 

- **Улучшенная проверка подлинности** — начиная с Android Marshmallow, приложения могут использовать датчики отпечатка пальца для аутентификации пользователей, а новая возможность *подтверждения учетных данных* позволяет избежать необходимости вводить пароли. 

- **Связывание приложений** — эта возможность помогает устранить необходимость во всплывающих окнах для **выбора приложений** за счет автоматического связывания приложений с веб-доменами. 

- **Direct Share** — вы можете определять *целевые объекты для прямой отправки*, что делает обмен быстрее и интуитивно понятнее для пользователей. Эта функция позволяет пользователям обмениваться содержимым с помощью других приложений. 

- **Голосовые взаимодействия** — этот новый API позволяет реализовать для приложения возможность голосового общения. 

- **Режим отображения 4K** — в Android Marshmallow приложение может запрашивать разрешение экрана 4K на оборудовании, которое его поддерживает. 

- **Новые аудиовозможности** — начиная с Marshmallow, Android теперь поддерживает протокол MIDI. Также предоставляются новые классы для создания объектов записи и воспроизведения цифрового звука и предлагаются новые обработчики API для связывания аудиоуствройств и устройств ввода. 

- **Новые возможности видео** — Marshmallow предоставляет новый класс, который помогает приложениям синхронно воспроизводить аудио- и видеопотоки. Этот класс также обеспечивает поддержку скорости динамического воспроизведения. 

- **Android for Work** — Marshmallow содержит расширенные элементы управления для корпоративных устройств и устройств с одним пользователем. ОС поддерживает автоматическую установку и удаление приложений владельцем устройства, автоматическое принятие обновлений системы, улучшенное управление сертификатами, отслеживание использования данных, управление разрешениями и уведомления о состоянии работы. 

- **Библиотека поддержки материального дизайна** — новая *библиотека поддержки дизайна* предоставляет компоненты дизайна и шаблоны, облегчающие создание внешнего вида материального дизайна в приложении. 

Кроме того, многие основные обновления библиотеки Android выпущены в Android M, и эти обновления предоставляют новые возможности как для Android M, так и для более ранних версий Android.

Кроме того, многие основные обновления библиотеки Android выпущены в Android Marshmallow, и эти обновления предоставляют новые возможности как для Android Marshmallow, так и для более ранних версий Android. В этой статье объясняется, как приступить к созданию приложений Android Marshmallow, и содержатся общие сведения о новых возможностях Android 6.0. 

## <a name="requirements"></a>Требования

Для использования новых возможностей Android Marshmallow в приложениях на основе Xamarin требуется следующее: 

- **Xamarin.Android** — расширение Xamarin.Android 5.1.7.12 или более поздней версии должно быть установлено и настроено в Visual Studio или Xamarin Studio.

- **Visual Studio для Mac** или **Visual Studio** — если вы используете Visual Studio для Mac, требуется версия 5.9.7.22 или более поздняя. Если вы используете Visual Studio, требуется версия 3.11.1537 или более поздняя версия средств Xamarin для Visual Studio. 

- **Пакет SDK для Android** — нужно установить пакет SDK для Android 6.0 (API 23) или более поздней версии через Диспетчер SDK Android.

- **Java Developer Kit** — для Xamarin.Android требуется [JDK 1.8](https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html) или более поздней версии при разработке API уровня 24 или выше (JDK 1.8 также поддерживает уровни API ниже 24, в том числе Marshmallow). 64-разрядная версия JDK 1.8 необходима, если используются пользовательские элементы управления или средство предварительного просмотра Forms.

При разработке специально для уровня API 23 или ниже можно продолжать использовать пакет [JDK 1.7](https://www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260.html). 

## <a name="getting-started"></a>Начало работы

Чтобы приступить к использованию Android Marshmallow с расширением Xamarin.Android, необходимо скачать и установить последние версии средств и пакетов SDK до создания проекта для Android Marshmallow. 

1. Установите последние обновления Xamarin через **стабильный** канал. 

2. Установите пакеты и средства Android 6.0 Marshmallow.

3. Создайте проект Xamarin.Android, предназначенный для Android 6.0 Marshmallow (API уровня 23). 

4. Настройте Android Marshmallow в эмуляторе или устройстве.

В разделах ниже отдельно рассматривается каждый шаг.

### <a name="install-xamarin-updates"></a>Установка обновлений Xamarin

Чтобы обновить Xamarin с целью включения поддержки Android 6.0 Marshmallow, измените канал обновления на **стабильный** и установите все обновления. Дополнительные сведения об установке обновлений из канала см. [здесь](https://github.com/xamarin/recipes/tree/master/Recipes/cross-platform/ide/change_updates_channel). 

### <a name="install-the-android-60-sdk"></a>Установка пакета SDK для Android 6.0

Чтобы создать проект Xamarin.Android для Android Marshmallow, необходимо сначала использовать Диспетчер SDK Android, чтобы установить пакет SDK для Android 6.0.

- Запустите Диспетчер SDK Android (в Visual Studio для Mac выберите элементы **Сервис > Диспетчер пакетов SDK**; в Visual Studio — **Сервис > Android > Диспетчер пакетов SDK Android**) и установите Android SDK Tools последней версии:

    [![Выбор Android SDK Tools в Диспетчере SDK Android](marshmallow-images/mnc-preview-tools.png)](marshmallow-images/mnc-preview-tools.png#lightbox)

- Установите также последнюю версию пакетов SDK для **Android 6.0**:

    [![Выбор пакетов SDK Android 6.0 в Диспетчере SDK Android](marshmallow-images/mnc-preview-packages.png)](marshmallow-images/mnc-preview-packages.png#lightbox)

Необходимо установить Android SDK Tools редакции 24.3.4 или более поздней.
Дополнительные сведения об использовании Диспетчера SDK Android для установки пакета SDK для Android 6.0 см. [здесь](https://developer.android.com/tools/help/sdk-manager.html).

### <a name="start-a-xamarinandroid-project"></a>Запуск проекта Xamarin.Android

Создайте проект Xamarin.Android. Если ранее вы не разрабатывали приложения Android с использованием Xamarin, ознакомьтесь с [этим руководством](~/android/get-started/hello-android/index.md), чтобы узнать о создании проектов Android. 

При создании проекта Android необходимо настроить параметры версии для целевой версии Android 6.0 Marshmallow. Чтобы создать проект для Marshmallow, необходимо настроить в нем **API уровня 23 (поддержка Xamarin.Android версии 6.0)** . Дополнительные сведения о настройке уровней API Android см. в [этой статье](~/android/app-fundamentals/android-api-levels.md).

### <a name="configure-an-emulator-or-device"></a>Настройка эмулятора или устройства

Если вы используете эмулятор, запустите AVD Manager (диспетчер виртуальных устройств Android) и создайте устройство, используя следующие параметры:

- Устройство: Nexus 5, 6 или 9.
- Цель: Android 6.0 с API уровня 23.
- ABI: x86.

Например, это виртуальное устройство настроено для эмуляции Nexus 5:

[![Настройка в AVD устройства Nexus 5, целевой ОС Android 6.0 и Intel Atom (x86)](marshmallow-images/android-m-avd.png)](marshmallow-images/android-m-avd.png#lightbox)

При использовании физического устройства, например Nexus 5, 6 или 9, можно установить образ Android Marshmallow для предварительного просмотра. Дополнительные сведения об обновлении устройства до Android Marshmallow см. в [Системные образы для оборудования](https://developer.android.com/preview/download.html#images).

## <a name="new-features"></a>Новые функции

Многие изменения, появившиеся в Android Marshmallow, сосредоточены на улучшении впечатлений от использования, увеличении производительности и исправлении ошибок в Android. Но в Marshmallow также появились некоторые существенные изменения основ платформы Android. В следующих разделах описаны эти улучшения и приведены ссылки, которые помогут приступить к использованию улучшенных возможностей в приложении. 

### <a name="runtime-permissions"></a>Разрешения среды выполнения

Система разрешений Android значительно оптимизирована и упрощена со времени выпуска Android Lollipop. В Android Marshmallow пользователи предоставляют разрешения в каждом конкретном случае во время выполнения, а не во время установки. Для поддержки этой возможности в Android Marshmallow и более поздних версиях вы разрабатываете приложение с учетом запроса у пользователя разрешений во время выполнения (в контексте, когда разрешения требуются). Это изменение позволяет пользователям быстрее начать работу с приложением, так как упрощает процесс установки и обновления приложения. 

Дополнительные сведения о реализации разрешений в среде выполнения в приложениях Xamarin.Android (в том числе примеры кода) см. в [этом блоге](https://blog.xamarin.com/requesting-runtime-permissions-in-android-marshmallow/).
Xamarin также предоставляет пример приложения, который показывает, как работают разрешения среды выполнения в Android Marshmallow (и более поздних версиях): [RuntimePermissions](https://docs.microsoft.com/samples/xamarin/monodroid-samples/android-m-runtimepermissions).

В этом примере приложения показано следующее:

- Проверка и запрос разрешений во время выполнения.
- Объявление разрешений для устройств Android M.

Чтобы использовать этот пример приложения, сделайте следующее:

1. Коснитесь значка **Камера** или **Контакты**, чтобы открылось диалоговое окно запроса разрешений.
2. Предоставьте разрешение на просмотр фрагментов приложений "Камера" или "Контакты".

Дополнительные сведения о новых возможностях разрешений среды выполнения в Android Marshmallow см. в статье [Работа с системными разрешениями](https://developer.android.com/preview/features/runtime-permissions.html).

### <a name="authentication-enhancements"></a>Усовершенствованная проверка подлинности

В Android Marshmallow введены два улучшения аутентификации, которые позволяют обойтись без паролей:

- **Проверка подлинности по отпечатку пальца** — предполагает сканирование отпечатка пальца для аутентификации пользователей.

- **Подтверждение учетных данных** — предусматривает аутентификацию пользователей в зависимости от того, как долго устройство разблокировано.

Ссылки и примеры приложений, описанные далее, помогут вам ознакомиться с этими новыми возможностями.

#### <a name="fingerprint-authentication"></a>Проверка подлинности по отпечаткам

На устройствах, поддерживающих сканирование отпечатка пальца, можно использовать новый класс `FingerPrintManager` для проверки подлинности пользователя.
Дополнительные сведения о функции проверки подлинности отпечатка пальца в Android Marshmallow см. [здесь](https://developer.android.com/preview/api-overview.html#fingerprint-authentication).

Xamarin предоставляет пример приложения, демонстрирующий использование зарегистрированных отпечатков пальцев для проверки подлинности пользователя в приложении: [Диалоговое окно отпечатка](https://docs.microsoft.com/samples/xamarin/monodroid-samples/android-m-fingerprintdialog).

Чтобы использовать этот пример приложения, сделайте следующее:

1. Коснитесь кнопки **Purchase** (Приобрести), чтобы открыть диалоговое окно проверки подлинности отпечатка пальца.
2. Просканируйте зарегистрированный отпечаток пальца для проверки подлинности.

Обратите внимание, что для этого примера приложения требуется устройство с модулем чтения отпечатка пальца.
Это приложение не сохраняет ваш отпечаток пальца (или пароль).

#### <a name="voice-interactions"></a>Голосовые взаимодействия

Новая возможность голосовых взаимодействий, появившаяся в Android Marshmallow, позволяет пользователям приложения использовать свой голос для подтверждения действий и выбора из списка. Дополнительные сведения о голосовых взаимодействиях см. в статье [Обзор API голосового взаимодействия](https://developers.google.com/voice-actions/interaction/). 

Дополнительные сведения о реализации голосовых взаимодействий в приложениях Xamarin.Android (в том числе примеры кода) см. [здесь](https://blog.xamarin.com/add-a-conversation-to-your-android-app-with-voice-interactions/).
Пример приложения, в котором показано, как использовать API голосового взаимодействия в приложении Xamarin.Android: [Голосовые взаимодействия](https://github.com/jamesmontemagno/MarshmallowSamples/tree/master/VoiceInteractions).

#### <a name="confirm-credential"></a>Подтверждение учетных данных

Благодаря новой возможности *подтверждения учетных данных* в Android Marshmallow пользователям нет необходимости запоминать и вводить пароли для конкретных приложений, потому что аутентификация происходит в зависимости от того, как долго устройство разблокировано.
Для этого используется новый метод `SetUserAuthenticationValidityDurationSeconds` для `KeyGenerator`. Используйте метод `CreateConfirmDeviceCredentialIntent` для `KeyGuardManager`, чтобы повторно проверять подлинность пользователя в приложении. Дополнительные сведения об этой новой возможности в Android Marshmallow см. в разделе [Подтверждение учетных данных](https://developer.android.com/preview/api-overview.html#confirm-credential).

Xamarin предоставляет пример приложения, демонстрирующий использование учетных данных в устройстве (например, ПИН-кода, рисунка или пароля) в приложении: [ConfirmCredential](https://docs.microsoft.com/samples/xamarin/monodroid-samples/android-m-confirmcredential)

Чтобы использовать этот пример приложения, сделайте следующее:

1. Настройте экран защищенной блокировки на устройстве (**Защита > Безопасность > Блокировка экрана**).
2. Коснитесь кнопки **Purchase** (Приобрести) и подтвердите учетные данные для экрана защищенной блокировки.

### <a name="chrome-custom-tabs"></a>Пользовательские вкладки Chrome

Разработчики приложений сталкиваются с выбором действия, выполняемого, когда пользователь касается URL-адреса: приложение может запустить браузер или использовать браузер в приложении на основе `WebView`. Оба варианта сопряжены с трудностями, так как запуск браузера — очень сложное переключение контекста, которое не настраивается, а несколько `WebView` не могут обмениваться данными о состоянии с браузером. Кроме того, использование нескольких `WebView` может добавить дополнительную нагрузку при их обслуживании. 

*Пользовательские вкладки Chrome* позволяют легко и эффективно показывать веб-сайты со всеми возможностями Chrome, оставляя пользователей в приложении. Эта возможность предоставляет приложению больший контроль над веб-интерфейсом пользователя, что позволяет делать переходы между собственным и веб-содержимым более плавными, не прибегая к `WebView`. Приложение также может влиять на внешний вид Chrome с помощью следующих настроек: 

- цвет панели инструментов;

- анимации входа и выхода;

- настраиваемые действия на панели инструментов Chrome и в дополнительном меню;

- предварительный запуск Chrome и предварительная загрузка содержимого (для ускорения загрузки).

Чтобы воспользоваться преимуществами этой возможности в приложении Xamarin.Android, скачайте и установите [библиотеку пользовательских вкладок поддержки Android](https://www.nuget.org/packages/Xamarin.Android.Support.CustomTabs/).
Дополнительные сведения об этой возможности см. в статье [Пользовательские вкладки Chrome](https://developer.chrome.com/multidevice/android/customtabs).

### <a name="material-design-support-library"></a>Библиотека поддержки материального дизайна

В Android Lollipop представлен [материальный дизайн](https://www.google.com/design/spec/material-design/introduction.html) как новый язык разработки, чтобы обновить взаимодействие с Android (дополнительные сведения об использовании материального дизайна в приложениях Xamarin.Android см. [здесь](~/android/user-interface/material-theme.md)). С Android Marshmallow компания Google представила *библиотеку поддержки дизайна Android*, которая упрощает разработчикам приложений внедрение внешнего вида материального дизайна. Эта библиотека содержит следующие компоненты:

- **CoordinatorLayout** — новое мини-приложение `CoordinatorLayout`, похожее на `FrameLayout`, но более мощное. `CoordinatorLayout` можно использовать как контейнер для дочерних представлений или как макет верхнего уровня. Это мини-приложение предоставляет атрибут `layout_anchor`, который можно использовать для привязки представлений относительно других представлений.

- **Свертывание панелей инструментов** — новое мини-приложение `CollapsingToolbarLayout` представляет собой сворачиваемую панель приложения и программу-оболочку для `Toolbar`. (Обратите внимание, что *панель приложения* ранее называлась *панель действий*.)

- **Плавающая кнопка действия** — круглая кнопка, которая обозначает основное действие в интерфейсе приложения.

- **Плавающие метки для редактирования текста** — используется новое мини-приложение `TextInputLayout` (которое создает оболочку для `EditText`), чтобы отображать плавающую метку, если подсказка скрыта при вводе текста пользователем.

- **Представление навигации** — новое мини-приложение `NavigationView` помогает использовать панель навигации так, чтобы пользователям было проще перемещаться.

- **Snackbar** — новое мини-приложение `SnackBar` является облегченным механизмом обратной связи (аналогичный всплывающему), который показывает короткое сообщение в нижней части экрана поверх других элементов на экране.

- **Вкладки материалов** — новое мини-приложение `TabLayout` предоставляет горизонтальный макет для отображения вкладок как способ реализации навигации верхнего уровня в приложении.

Чтобы наделить приложение Xamarin.Android преимуществами [библиотеки поддержки дизайна](https://developer.android.com/tools/support-library/features.html#design), скачайте и установите пакет NuGet [библиотеки поддержки дизайна Xamarin](https://www.nuget.org/packages/Xamarin.Android.Support.Design/).

Дополнительные сведения об использовании библиотеки поддержки материального дизайна в приложениях Xamarin.Android (в том числе примеры кода) см. в записи блога [здесь](https://blog.xamarin.com/add-beautiful-material-design-with-the-android-support-design-library/).
Xamarin предоставляет пример приложения, которое демонстрирует новую библиотеку дизайна Android в Xamarin.Android — [Cheesesquare](https://docs.microsoft.com/samples/xamarin/monodroid-samples/android50-cheesesquare).
Этот пример демонстрирует следующие возможности библиотеки дизайна:

- свертывание панели инструментов;
- плавающая кнопка действия;
- привязка представления;
- представление навигации;
- Snackbar.

Дополнительные сведения о библиотеке дизайна см. в блоге для разработчиков Android [здесь](https://android-developers.googleblog.com/2015/05/android-design-support-library.html).

### <a name="additional-library-updates"></a>Дополнительные обновления библиотек

Помимо Android Marshmallow, Google объявил о связанных обновлениях нескольких основных библиотек Android. Xamarin предоставляет поддержку Xamarin.Android для этих обновлений в виде нескольких предварительных выпусков пакетов NuGet: 

- [Сервисы Google Play](https://www.nuget.org/packages?q=Xamarin+Google+Play+Services) — последняя версия Сервисов Google Play включает в себя новую возможность *App Invites*, благодаря которой пользователи могут делиться своим приложением с друзьями. Дополнительные сведения об этой возможности см. в статье блога [Расширение доступности приложения с помощью App Invites Google](https://blog.xamarin.com/expand-your-apps-reach-with-googles-app-invites/). 

- [Библиотеки поддержки Android](https://www.nuget.org/packages?q=xamarin+support+library) — эти пакеты NuGet предлагают возможности, которые доступны только для API библиотек, при этом обеспечивается обратная совместимость версий API платформы Android. 

- [Библиотеки для нательных технологий Android](https://www.nuget.org/packages/Xamarin.Android.Wear) — этот пакет NuGet содержит привязки Сервисов Google Play. Последняя версия библиотеки для нательных технологий предоставляет новые возможности (в том числе упрощенную навигацию для пользовательских приложений) для платформы Android Wear. 

## <a name="summary"></a>Сводка

Из этой статьи вы узнали об Android Marshmallow, установке и настройке новейших средств и пакетов для разработки приложений Xamarin.Android на Marshmallow. Также предоставлен обзор самых интересных новых возможностей Android Marshmallow для разработки приложений Xamarin.Android.

## <a name="related-links"></a>Связанные ссылки

- [Android 6.0 Marshmallow](https://developer.android.com/about/versions/marshmallow/index.html)
- [Скачивание пакета SDK для Android](https://developer.android.com/sdk/index.html#Other)
- [Общие сведения о функциях](https://developer.android.com/preview/api-overview.html)
- [Заметки о выпуске](https://github.com/xamarin/release-notes-archive/blob/master/release-notes/android/xamarin.android_5/xamarin.android_5.1.99/index.md)
- [RuntimePermissions (пример)](https://docs.microsoft.com/samples/xamarin/monodroid-samples/android-m-runtimepermissions)
- [ConfirmCredential (пример)](https://docs.microsoft.com/samples/xamarin/monodroid-samples/android-m-confirmcredential)
- [Диалоговое окно отпечатка (пример)](https://docs.microsoft.com/samples/xamarin/monodroid-samples/android-m-fingerprintdialog)
