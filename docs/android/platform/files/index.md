---
title: Доступ к файлам с помощью Xamarin.Android
description: В этом руководстве содержатся доступ к файлам в Xamarin.Android
ms.prod: xamarin
ms.assetid: FC1CFC58-B799-4DD6-8ED1-DE36B0E56856
ms.technology: xamarin-android
author: conceptdev
ms.author: crdun
ms.date: 07/23/2018
ms.openlocfilehash: 476f1c50a2f1a4199dfaf1996fc9c16615b40598
ms.sourcegitcommit: e268fd44422d0bbc7c944a678e2cc633a0493122
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2018
ms.locfileid: "50116801"
---
# <a name="file-storage-and-access-with-xamarinandroid"></a>Хранилище файлов и доступа с помощью Xamarin.Android

Является общим требованием для приложений Android для управления файлами &ndash; Сохранение изображения, загрузка документов или экспорт данных для совместного использования с другими программами. Android (который основан на платформе Linux) поддерживает это, предоставляя места для хранения файлов. Android группирует файловой системы в два различных типа хранилища:

* **Внутреннее хранилище** &ndash; это часть файловой системы, может осуществляться только с помощью приложения или операционной системы.
* **Внешнее хранилище** &ndash; это раздел для хранения файлов, доступном для всех приложений, пользователя и, возможно, другие устройства. На некоторых устройствах внешнее хранилище может быть съемный (например, на SD-карте).

Эти группы являются только концептуальной и не обязательно ссылается на одну секцию или каталог на устройстве. Устройство Android будет всегда предоставлять секции внутренние и внешние хранилища. Вполне возможно, что некоторые устройства могут иметь несколько секций, которые рассматриваются как внешнее хранилище. Независимо от того, раздел API-интерфейсы для чтения записи или создание файлов совпадает. Существует два набора API, который приложение Xamarin.Android может использовать для доступа к файлам.

1. **API-интерфейсы .NET (предоставляемые Mono и инкапсулируется Xamarin.Android)** &ndash; включают в себя [файл вспомогательных функций системы](~/essentials/file-system-helpers.md?context=xamarin/android) предоставляемые [Xamarin.Essentials](~/essentials/index.md?context=xamarin/android). API-интерфейсы .NET предоставляют лучшие кросс платформенной совместимости и таким образом в этом руководстве основное внимание на эти API-интерфейсы.
1. **Внутренний доступ файл Java API (предоставляемый Java и инкапсулируется Xamarin.Android)** &ndash; Java предоставляет свои собственные интерфейсы API для чтения и записи файлов. Они являются полностью приемлемым альтернативой API-интерфейсы .NET, но относятся к Android и не подходят для приложений, которые должны быть кросс платформенных.

Чтение и запись в файлы практически идентичны в Xamarin.Android, как любое другое приложение .NET. Приложение Xamarin.Android определяет путь к файлу, который будет производиться работа, затем использует стандартный .NET идиомы для доступа к файлам. Так как фактические пути, для внутреннего и внешнего хранения зависит от устройства к устройству с Android версии до версии Android, не рекомендуется явно указывать путь к файлам. Вместо этого используйте API-интерфейсы Xamarin.Android для определения пути к файлам. Таким образом, интерфейсы API .NET для чтения и записи файлов предоставляет собственных API Android, призванная помочь определить путь к файлам на внутренние и внешние хранилища.

Прежде чем обсуждать API-интерфейсы, связанные с доступ к файлам, важно понять некоторые сведения, относящиеся внутреннего и внешнего хранения. Эти компоненты рассматривается в следующем разделе.

## <a name="internal-vs-external-storage"></a>Внутреннего внешнего хранилища

По существу, внутреннее хранилище и внешнее хранилище очень похожи &ndash; они находятся в обоих местах, в которых приложение Xamarin.Android может сохранять файлы. Возможно, это сходство с толку для разработчиков, незнакомых с Android, так как неясно, когда приложение должно использовать внешнее хранилище vs внутреннего хранилища.

Внутреннее хранилище ссылается на энергонезависимой памяти, выделяемый Android в операционную систему, apk-файлов и для отдельных приложений. Это пространство не является доступным только для операционной системы или приложения. Android выделит каталога в разделе внутреннее хранилище для каждого приложения. При удалении приложения также удаляются все файлы, которые хранятся на внутреннее хранилище в этом каталоге. Внутреннее хранилище лучше всего подходит для файлов, доступных только для приложения и не будет использоваться совместно с другими приложениями или будет иметь очень мало пользы, после удаления приложения. На базе Android 6.0 или более поздней версии, на внутреннее хранилище может быть автоматически резервные копии файлов с помощью Google [функция автоматическое резервное копирование в Android 6.0](https://developer.android.com/guide/topics/data/autobackup). Внутреннее хранилище имеет следующие недостатки:

* Файлы станут недоступны.
* Файлы будут удалены при удалении приложения.
* Свободное место на внутреннее хранилище может быть ограничено.

Внешнее хранилище ссылается на хранилище файлов, не внутреннего хранилища или исключительно недоступен для приложения. Основная цель внешнего хранилища является предоставление места для размещения файлов, предназначены для совместно использоваться приложениями или таблицы, слишком велик для внутреннего хранилища. Внешнее хранилище удобен тем, что обычно он имеет гораздо больше места для файлов, чем внутреннего хранилища. Тем не менее внешнее хранилище не всегда обязательно присутствовать на устройстве и может потребоваться специальное разрешение от пользователя на доступ к нему.

> [!NOTE]
> Для устройств, которые поддерживают несколько пользователей Android будет предоставлять каждому пользователю своего каталога на внутренние и внешние хранилища. Этот каталог является недоступным для других пользователей на устройстве. Это разделение является невидимым для приложения до тех пор, пока это не следует жестко кодировать пути файлов в хранилище внутренними или внешними.

Как правило приложений Xamarin.Android следует предпочитать сохранение своих файлов на внутреннее хранилище, когда имеет смысл и полагаться на внешних носителях, когда файлы должны совместно с другими приложениями, имеют очень большой размер или следует сохранить, даже если приложение удаляется. Например файл конфигурации лучше всего подходит для внутреннего хранения, поскольку в нем не столь важно за исключением к приложению, которое создает ее.  Напротив фотографии являются хорошими кандидатами для внешнего хранилища. Они могут быть очень большими и во многих случаях пользователю может потребоваться совместно использовать их или получить к ним доступ, даже если приложение удаляется.

В этом руководстве основное внимание уделяется внутреннего хранилища. Можно найти в руководстве [внешнее хранилище](~/android/platform/files/external-storage.md) сведения об использовании внешнего хранилища в приложениях Xamarin.Android.

## <a name="working-with-internal-storage"></a>Работа с внутреннего хранилища

Внутреннее хранилище каталога приложения, определяется операционной системой, а также предоставления приложения для Android по `Android.Content.Context.FilesDir` свойство. Эта команда возвращает `Java.IO.File` объект, представляющий каталог, который был специально посвящен исключительно для приложения Android.  Например, это приложение с именем пакета **com.companyname** каталог внутреннее хранилище может быть:

```bash
/data/user/0/com.companyname/files
```

В этом документе будет ссылаться в каталог внутреннее хранилище как _ВНУТРЕННИЙ\_ХРАНЕНИЯ_.

> [!IMPORTANT]
> Точный путь к каталогу внутреннее хранилище может варьироваться от устройства к устройству, а также между версиях Android. По этой причине приложения должен не жестко кода путь к каталогу хранения внутренних файлов и вместо этого используйте API Xamarin.Android, например `System.Environment.GetFolderPath()`.

Чтобы добиться максимальной совместного использования кода, следует использовать приложения Xamarin.Android (или приложения Xamarin.Forms, предназначенные для Xamarin.Android) [ `System.Environment.GetFolderPath()` ](xref:System.Environment.GetFolderPath*) метод. В Xamarin.Android, этот метод будет возвращать строку для каталога, который имеет то же расположение, что `Android.Content.Context.FilesDir`. Этот метод принимает перечисления, `System.Environment.SpecialFolder`, который используется для идентификации набора перечислимых констант, которые представляют пути к папкам, используемые операционной системой. Не все `System.Environment.SpecialFolder` значений сопоставляется допустимый каталог на Xamarin.Android. В следующей таблице описаны, какие пути можно ожидать от данного значения `System.Environment.SpecialFolder`:

| System.Environment.SpecialFolder | Путь  |
|----------------------|---|
| `ApplicationData` | **_Внутренняя\_ХРАНЕНИЯ_/.config** |
| `Desktop` | **_Внутренняя\_ХРАНЕНИЯ_  /Desktop** |
| `LocalApplicationData` | **_Внутренняя\_ХРАНЕНИЯ_/.local/share** |
| `MyComputer` | **_Внутренняя\_ХРАНЕНИЯ_/.local/share** |
| `MyDocuments` | **_ВНУТРЕННЯЯ\_ХРАНИЛИЩА_** |
| `MyMusic` | **_Внутренняя\_ХРАНЕНИЯ_/Music** |
| `MyPictures` | **_Внутренняя\_ХРАНЕНИЯ_/Music** |
| `MyVideos` | **_Внутренняя\_ХРАНЕНИЯ_/Videos** |
| `Personal` | **_ВНУТРЕННЯЯ\_ХРАНИЛИЩА_** |


### <a name="reading-or-writing-to-files-on-internal-storage"></a>Чтение или запись в файлы на внутреннее хранилище

Любой из [ C# API-интерфейсы для записи](https://docs.microsoft.com/dotnet/csharp/programming-guide/file-system/how-to-write-to-a-text-file) в файл, достаточно; все, что необходимо — для получения пути к файлу, который находится в каталоге, выделенных для приложения. Настоятельно рекомендуется привязать async, которые используются версии API-интерфейсы .NET, чтобы свести к минимуму проблемы, которые могут быть доступа к файлам, блокирования основного потока.

В этом фрагменте кода приведен пример написания целое число в UTF-8 текстовый файл в каталог внутреннее хранилище приложения:

```csharp
public async Task SaveCountAsync(int count)
{
    var backingFile = Path.Combine(System.Environment.GetFolderPath(System.Environment.SpecialFolder.Personal), "count.txt");
    using (var writer = File.CreateText(backingFile))
    {
        await writer.WriteLineAsync(count.ToString());
    }
}
```

В следующем фрагменте кода описывается один из способов для чтения целочисленное значение, которое было сохранено в текстовом файле:

```csharp
public async Task<int> ReadCountAsync()
{
    var backingFile = Path.Combine(System.Environment.GetFolderPath(System.Environment.SpecialFolder.Personal), "count.txt");

    if (backingFile == null || !File.Exists(backingFile))
    {
        return 0;
    }

    var count = 0;
    using (var reader = new StreamReader(backingFile, true))
    {
        string line;
        while ((line = await reader.ReadLineAsync()) != null)
        {
            if (int.TryParse(line, out var newcount))
            {
                count = newcount;
            }
        }
    }

    return count;
}
```

## <a name="using--xamarinessentials-ndash-file-system-helpers"></a>С помощью Xamarin.Essentials &ndash; файл вспомогательных функций системы

[Xamarin.Essentials](~/essentials/file-system-helpers.md?context=xamarin/android) — это набор API-интерфейсов для написания кода совместимы между различными платформами. [Вспомогательных функций системы файл](~/essentials/file-system-helpers.md?context=xamarin/android) — это класс, содержащий ряд вспомогательных функций, чтобы упростить поиск каталогов кэша и данные приложения. В этом фрагменте кода приведен пример того, как найти внутреннее хранилище каталога и каталога кэша для приложения.

```csharp
// Get the path to a file on internal storage
var backingFile = Path.Combine(Xamarin.Essentials.FileSystem.AppDataDirectory, "count.txt");

// Get the path to a file in the cache directory
var cacheFile = Path.Combine(Xamarin.Essentials.FileSystem.CacheDirectory, "count.txt");
```

## <a name="hiding-files-from-the-mediastore"></a>Скрытие файлы из `MediaStore`

`MediaStore` — Это Android компонент, который собирает метаданные о файлов мультимедиа (видео, музыка, изображения) на устройстве Android. Его цель упростить совместное использование этих файлов для всех приложений Android на устройстве.

Личные файлы не будут отображаться в качестве совместного использования носителя. Например, если приложение сохраняет изображение его закрытого внешнее хранилище, затем этот файл не считываются сканером мультимедиа (`MediaStore`).

Общедоступные файлы будут использоваться при `MediaStore`. Каталоги с именами ноль байтов файла **. NOMEDIA** не будут проверены по `MediaStore`.

## <a name="related-links"></a>Связанные ссылки

* [Внешнее хранилище](~/android/platform/files/external-storage.md)
* [Сохранение файлов в хранилище устройства](https://developer.android.com/training/data-storage/files)
* [Вспомогательные функции системы Xamarin.Essentials файла](~/essentials/file-system-helpers.md?context=xamarin/android)
* [Запись резервного копирования данных с помощью автоматического резервного копирования](https://developer.android.com/guide/topics/data/autobackup)
* [Adoptable хранилища](https://source.android.com/devices/storage/adoptable)
