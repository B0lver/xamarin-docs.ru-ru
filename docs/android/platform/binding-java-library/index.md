---
title: Привязка библиотеки Java
description: Сообщество Android имеет множество библиотек Java, которые можно использовать в приложении; в этом руководство объясняется, как внедрить библиотеки Java в приложение Xamarin. Android, создав библиотеку привязок.
ms.prod: xamarin
ms.assetid: B39FF1D5-69C3-8A76-D268-C227A23C9485
ms.technology: xamarin-android
author: conceptdev
ms.author: crdun
ms.date: 05/01/2017
ms.openlocfilehash: e829c953278d8edeb697d27da8e3707ee1c91784
ms.sourcegitcommit: 57f815bf0024b1afe9754c0e28054fc0a53ce302
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/06/2019
ms.locfileid: "70757587"
---
# <a name="binding-a-java-library"></a>Привязка библиотеки Java

_Сообщество Android имеет множество библиотек Java, которые можно использовать в приложении; в этом руководство объясняется, как внедрить библиотеки Java в приложение Xamarin. Android, создав библиотеку привязок._

## <a name="overview"></a>Обзор

Экосистема библиотеки сторонних производителей для Android является большой. Поэтому часто имеет смысл использовать существующую библиотеку Android, чем создать новую. Xamarin. Android предлагает два способа использования этих библиотек:

- Создайте *библиотеку привязок* , которая автоматически заключает библиотеку в C# оболочку, чтобы можно было вызывать код Java через C# вызовы.

- Используйте *собственный интерфейс Java* (*JNI*) для непосредственного вызова вызовов в библиотеке Java. JNI — это платформа программирования, которая позволяет коду Java вызываться и вызываться собственными приложениями или библиотеками.

В этом руководство объясняется первый вариант: создание *библиотеки привязок* , которая заключает одну или несколько существующих библиотек Java в сборку, к которой можно установить связь в приложении. Дополнительные сведения об использовании JNI см. [в разделе Работа с JNI](~/android/platform/java-integration/working-with-jni.md).

Xamarin. Android реализует привязки с помощью *управляемых вызываемых оболочек* (*MCW*). MCW — это мост JNI, который используется, когда управляемому коду необходимо вызывать код Java. Управляемые вызываемые оболочки также предоставляют поддержку для подклассов типов Java и переопределения виртуальных методов для типов Java. Аналогичным образом, каждый раз, когда коду среды выполнения Android (ART) нужно вызвать управляемый код, он делает это с помощью другого моста JNI, известного как вызываемые оболочки Android (АКВ). Эта [архитектура](~/android/internals/architecture.md) показана на схеме ниже.

[![Архитектура моста JNI для Android](images/architecture.png)](images/architecture.png#lightbox)

Библиотека привязок — это сборка, содержащая управляемые вызываемые оболочки для типов Java. Например, вот тип Java, `MyClass`который мы хотим перенести в библиотеку привязок:

```java
package com.xamarin.mycode;

public class MyClass
{
    public String myMethod (int i) { ... }
}
```

После создания библиотеки привязок для **JAR** -файла, который содержит `MyClass`, мы можем создать его экземпляр и вызвать методы из: C#

```csharp
var instance = new MyClass ();

string result = instance.MyMethod (42);
```

Чтобы создать эту библиотеку привязок, используйте шаблон *библиотеки привязок Java* для Xamarin. Android. Полученный проект привязки создает сборку .NET с классами MCW, **JAR** -файлами и ресурсами для проектов библиотек Android, внедренных в него. Также можно создать библиотеки привязок для архива Android (. AAR) файлы и проекты библиотеки Android для Eclipse. Ссылаясь на сборку библиотеки DLL результирующей привязки, можно повторно использовать существующую библиотеку Java в проекте Xamarin. Android.

При ссылке на типы в библиотеке привязки необходимо использовать пространство имен библиотеки привязки. Как правило, в верхней `using` части C# исходных файлов добавляется директива, которая представляет собой версию имени пакета Java для пространства имен .NET. Например, если имя пакета Java для связанного **. jar** имеет следующий код:

```csharp
com.company.package
```

Затем следует добавить следующую `using` инструкцию в начало C# исходных файлов, чтобы получить доступ к типам в связанном **JAR** -файле:

```csharp
using Com.Company.Package;
```

При привязке существующей библиотеки Android необходимо помнить о следующих моментах.

- **Существуют ли какие либо внешние зависимости для библиотеки?** &ndash;Все зависимости Java, необходимые для библиотеки Android, должны быть добавлены в проект Xamarin. Android как **референцежар** или как **ембеддедреференцежар**. Все сборки машинного кода должны быть добавлены в проект привязки в качестве **ембеддеднативелибрари**.  

- **Какая версия API Android поддерживает платформу Android Library?** &ndash;Невозможно понизить уровень API Android. Убедитесь, что в проекте привязки Xamarin. Android используется тот же уровень API (или выше), что и в библиотеке Android.

- **Какая версия JDK использовалась для компиляции библиотеки?** &ndash;Ошибки привязки могут возникать, если библиотека Android была построена с использованием другой версии JDK, чем используется Xamarin. Android. Если возможно, перескомпилируйте библиотеку Android с использованием той же версии JDK, которая используется в вашей установке Xamarin. Android.

## <a name="build-actions"></a>Действия при сборке

При создании библиотеки привязок необходимо задать *действия сборки* для **JAR** -файла или. AAR файлы, которые вы включили в проект &ndash; библиотеки привязок, каждое действие сборки определяет, как **. jar** или. Файл AAR будет внедрен в библиотеку привязок (или ссылается на нее). В следующем списке перечислены следующие действия сборки:

- `EmbeddedJar`Внедряет JAR-файл в результирующую библиотеку DLL-библиотеки привязок в качестве внедренного ресурса. &ndash; Это простейшее и наиболее часто используемое действие сборки. Используйте этот параметр, если нужно, чтобы **JAR** -файл автоматически компилировался в байтовый код и упакован в библиотеку привязок.

- `InputJar`Не внедряет JAR-файл в результирующую библиотеку привязок. &ndash; Компоновки. Библиотека привязок. DLL будет иметь зависимость от этого **JAR** -файла во время выполнения. Используйте этот параметр, если не нужно включать **JAR** -файл в библиотеку привязок (например, по соображениям лицензирования). При использовании этого параметра необходимо убедиться, что входной **. jar** доступен на устройстве, где выполняется приложение.

- `LibraryProjectZip`&ndash; Внедряет. AAR файл в результирующую библиотеку привязок. Компоновки. Это похоже на Ембеддеджар, за исключением того, что вы можете получить доступ к ресурсам (а также к коду) в привязке. Файл AAR. Используйте этот параметр, если нужно внедрить. AAR в библиотеку привязок.

- `ReferenceJar`Указывает ссылку. jar — файл Reference. jar — это файл JAR, который является одним из ваших привязанных JAR-файлов или. &ndash; Файлы AAR зависят от. Этот файл Reference **. jar** используется только для соблюдения зависимостей времени компиляции. При использовании этого действия сборки C# привязки не создаются для Reference **. jar** и не внедряются в итоговую библиотеку привязок. Компоновки. Используйте этот параметр, если вы сделаете библиотеку привязок для Reference **. jar** , но еще не сделали этого. Это действие сборки полезно для упаковки нескольких **JAR**-файлов (и/или). Аарс) в несколько библиотек привязок, взаимозависимых с.

- `EmbeddedReferenceJar`Внедряет файл Reference **. jar** в полученную библиотеку привязок. &ndash; Компоновки. Используйте это действие сборки, если требуется создать C# привязки для входного **JAR** -файла (или. AAR) и все его ссылки ( **JAR**-файл) в библиотеке привязок.

- `EmbeddedNativeLibrary`Внедряет собственный объект **. Поэтому** в привязку. &ndash; Это действие сборки используется для **.** файлы, необходимые для привязки **JAR** -файла. Может потребоваться вручную загрузить библиотеку **. Итак** , прежде чем выполнять код из библиотеки Java. Это описано ниже.

Эти действия по сборке более подробно описаны в следующих руководствах.

Кроме того, следующие действия сборки используются для импорта документации по API Java и преобразования их в C# XML-документацию:

- `JavaDocJar`используется для указания Javadoc Archive JAR для библиотеки Java, которая соответствует стилю пакета Maven (обычно `FOOBAR-javadoc**.jar**`).
- `JavaDocIndex`используется для указания `index.html` файла в HTML справочной документации по API.
- `JavaSourceJar`используется для дополнения `JavaDocJar`, чтобы сначала создать Javadoc из источников, а затем обрабатывать результаты как `JavaDocIndex`, для библиотеки Java, которая соответствует стилю пакета Maven (обычно `FOOBAR-sources**.jar**`).

Документация по API должна быть Доклет по умолчанию из пакета SDK Java8, Java7 или java6 (все они имеют разный формат) или в стиле Дроиддок.

## <a name="including-a-native-library-in-a-binding"></a>Включение собственной библиотеки в привязку

Может потребоваться включить библиотеку **. so** в проект привязки Xamarin. Android как часть привязки библиотеки Java. При выполнении упакованного кода Java Xamarin. Android не сможет выполнить вызов JNI и сообщение _об ошибке Java. lang. унсатисфиедлинкеррор: Собственный метод не найден:_ будет отображаться в logcat out для приложения.

Исправление для этого — вручную загрузить библиотеку **. так** , чтобы библиотека вызывала вызов `Java.Lang.JavaSystem.LoadLibrary`. Например, предположим, что проект Xamarin. Android имеет общую библиотеку **libpocketsphinx_jni. Поэтому он** включается в проект привязки с действием сборки **ембеддеднативелибрари**, приведенным ниже фрагментом кода (выполняется перед использованием общей библиотеки). загрузит библиотеку **. так** :

```csharp
Java.Lang.JavaSystem.LoadLibrary("pocketsphinx_jni");
```

## <a name="adapting-java-apis-to-ceparsl"></a>Адаптация API-интерфейсов Java к C&eparsl;

Генератор привязки Xamarin. Android изменит некоторые стили и закономерности Java в соответствии с шаблонами .NET. В следующем списке описано, как Java сопоставляется C#с/.NET:

- _Методы задания и считывания_ в Java являются _свойствами_ в .NET.

- _Поля_ в Java являются _свойствами_ в .NET.

- _Прослушиватели и интерфейсы прослушивателя_ в Java — это _события_ в .NET. Параметры методов в интерфейсах обратного вызова будут представлены `EventArgs` подклассом.

- _Статический вложенный класс_ в Java — это _вложенный класс_ в .NET.

- _Внутренний класс_ в Java является _вложенным классом_ с конструктором экземпляра в C#.

## <a name="binding-scenarios"></a>Сценарии привязки

Следующие руководства по сценариям привязки помогут привязать библиотеку (или библиотеки) Java для взаимодействия с приложением.

- [Привязка. JAR](~/android/platform/binding-java-library/binding-a-jar.md) — это пошаговое руководство по созданию библиотек привязок для **JAR** -файлов.

- [Привязка объекта. AAR](~/android/platform/binding-java-library/binding-an-aar.md) — это пошаговое руководство по созданию библиотек привязок для. AAR файлы. Ознакомьтесь с этим пошаговым руководством, чтобы узнать, как привязать Android Studio библиотеки.

- [Привязка проекта библиотеки Eclipse](~/android/platform/binding-java-library/binding-a-library-project.md) — это пошаговое руководство по созданию библиотек привязки из проектов библиотек Android. Ознакомьтесь с этим пошаговым руководством, чтобы узнать, как привязать проекты библиотеки Android Eclipse.

- [Настройка привязок](~/android/platform/binding-java-library/customizing-bindings/index.md) объясняет, как вносить изменения в привязку вручную для разрешения ошибок сборки и формирования РЕЗУЛЬТИРУЮЩего API, чтобы он был больше "C#-Like".

- В разделе [Устранение неполадок](~/android/platform/binding-java-library/troubleshooting-bindings.md) приводятся распространенные сценарии ошибок привязки, объясняются возможные причины и предлагаются предложения по устранению этих ошибок.

## <a name="related-links"></a>Связанные ссылки

- [Работа с JNI](~/android/platform/java-integration/working-with-jni.md)
- [Метаданные ГАПИ](https://www.mono-project.com/docs/gui/gtksharp/gapi/#metadata)
- [Использование собственных библиотек](~/android/platform/native-libraries.md)
