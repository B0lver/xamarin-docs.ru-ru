---
title: Привязка библиотеки Java
description: Android сообщество имеет множество библиотек Java, которые можно использовать в приложении; в этом руководстве объясняется, как включить библиотеки Java в приложение Xamarin.Android, создавая библиотеку привязок.
ms.prod: xamarin
ms.assetid: B39FF1D5-69C3-8A76-D268-C227A23C9485
ms.technology: xamarin-android
author: conceptdev
ms.author: crdun
ms.date: 05/01/2017
ms.openlocfilehash: 0f4ec3cfd7c154e43db9f8e123259317c0d17e21
ms.sourcegitcommit: 57e8a0a10246ff9a4bd37f01d67ddc635f81e723
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/08/2019
ms.locfileid: "57670536"
---
# <a name="binding-a-java-library"></a>Привязка библиотеки Java

_Android сообщество имеет множество библиотек Java, которые можно использовать в приложении; в этом руководстве объясняется, как включить библиотеки Java в приложение Xamarin.Android, создавая библиотеку привязок._

## <a name="overview"></a>Обзор

С экосистемой сторонние библиотеки для Android — большие. По этой причине часто имеет смысл использовать существующую библиотеку Android чем Чтобы создать новую. Xamarin.Android поддерживает два способа для использования этих библиотек.

-   Создание *библиотека привязок* , автоматически включает библиотеку с C# код оболочки, поэтому можно вызвать Java с помощью C# вызовов.

-   Используйте *Java Native Interface* (*JNI*) для вызова в коде библиотеки Java напрямую. JNI — это платформа программирования, позволяющий код Java для вызова и вызывать в собственных приложений или библиотек.

Это руководство описывает первый вариант: создание *библиотека привязок* , который создает оболочку одну или несколько существующих библиотек Java в сборку, можно связать в приложении. Дополнительные сведения об использовании JNI, см. в разделе [работа с JNI](~/android/platform/java-integration/working-with-jni.md).

Xamarin.Android реализует привязки с помощью *управляемых вызываемых оболочек* (*MCW*). Компании MCW представляет собой мост JNI, который используется, когда управляемый код должен вызывать код Java. Управляемые вызываемой оболочки также предоставляют поддержку для создания подклассов типов Java, а также для переопределения виртуальных методов для типов Java. Аналогичным образом каждый раз, когда код среды выполнения Android (ГРАФИКА) хочет вызывать управляемый код, она делает это с помощью другой мост JNI, известные как Android вызываемой оболочки (ACW). Это [архитектура](~/android/internals/architecture.md) проиллюстрирован на следующей схеме:

[![Мост архитектуры Android JNI](images/architecture.png)](images/architecture.png#lightbox)

Библиотека привязок — это сборка, содержащая управляемые вызываемых оболочек для типов Java. Например, здесь является типом Java, `MyClass`, которую необходимо поместить в библиотеку привязок:

```java
package com.xamarin.mycode;

public class MyClass
{
    public String myMethod (int i) { ... }
}
```

Мы создали библиотеку привязок для внесли **.jar** , содержащий `MyClass`, можно создать его экземпляр и вызовах методов из C#:

```csharp
var instance = new MyClass ();

string result = instance.MyMethod (42);
```

Чтобы создать эту библиотеку привязок, используйте Xamarin.Android *библиотека Java Bindings* шаблона. Итоговый проект привязки создается сборка .NET классы MCW **.jar** файлы и ресурсы для проектов библиотек Android, внедренный в него. Можно также создать привязки библиотеки для Android архива (. Файлы AAR) и проектов библиотек Android Eclipse. Ссылаясь на сборку привязки библиотеки DLL, можно повторно использовать существующую библиотеку Java в проект Xamarin.Android.

При ссылке на типы в библиотеке привязки, необходимо использовать пространство имен библиотеки привязки. Как правило, добавляется `using` директив в верхней части вашего C# исходные файлы, то есть, имя пакета Java версии пространства имен .NET. Например, если имя пакета Java для привязанных **.jar** представляет собой следующее:

```csharp
com.company.package
```

Затем можно поместить следующие `using` инструкция в верхней части вашего C# исходных файлов для доступа к типам в качестве границы **.jar** файла:

```csharp
using Com.Company.Package;
```


Во время привязки существующей библиотеки Android, бывает необходимо помнить следующее:

* **Существуют ли любых внешних зависимостей для библиотеки?** &ndash; Любые зависимости Java, необходимые для библиотеки Android должен быть включен в проект Xamarin.Android, как **ReferenceJar** или как **EmbeddedReferenceJar**. Все собственные сборки необходимо добавить в проект привязки, как **EmbeddedNativeLibrary**.  

* **Какая версия Android API поддерживает целевой библиотеки Android?** &ndash; Невозможно «понизить» уровня Android API; Убедитесь, что проект привязки Xamarin.Android предназначен тот же API, уровень (или выше) как библиотеки Android.

* **Какую версию JDK использовалась для компиляции библиотеки?** &ndash; Ошибок привязки может возникнуть, если библиотеки Android создана с помощью другой версии JDK, чем используется для Xamarin.Android. Если это возможно выполните повторную компиляцию библиотеки Android, используя ту же версию JDK, который используется для установки Xamarin.Android.


## <a name="build-actions"></a>Действия при сборке

При создании библиотеки привязки задаются *действия при сборке* на **.jar** или. Aar-файлы, которые включить в ваш проект библиотеки привязки &ndash; каждое действие сборки определяет, каким образом **.jar** или. Файл AAR будут внедрены в (или ссылается) библиотеку привязок. В следующем списке перечислены эти действия при сборке:

* `EmbeddedJar` &ndash; Внедряет **.jar** в итоговому файлу DLL библиотеки привязки в качестве внедренного ресурса. Это самый простой и большинство действий часто используемые сборки. Используйте этот параметр, **.jar** автоматически скомпилировать в байтовый код и упакован в библиотеку привязок.

* `InputJar` &ndash; Не внедряет **.jar** в итоговый библиотеку привязок. БИБЛИОТЕКА DLL. Библиотека привязок. Библиотека DLL будет иметь зависимость на это **.jar** во время выполнения. Используйте этот параметр, если вы не хотите включать **.jar** библиотеки привязки (например, для лицензирования причинам). Если вы используете этот параметр, необходимо убедиться, что входные данные **.jar** на устройства, которое запускает приложение.

* `LibraryProjectZip` &ndash; Внедряет. Файл AAR в итоговый библиотеку привязок. БИБЛИОТЕКА DLL. Это похоже на EmbeddedJar, за исключением того, что можно доступ к ресурсам (а также код) в качестве границы. AAR-файла. Используйте этот параметр, если вы хотите внедрить. AAR в библиотеку привязок.

* `ReferenceJar` &ndash; Задает ссылку **.jar**: ссылка **.jar** — **.jar** что один из привязанных **.jar** или. Зависит от aar-файлы. Эта ссылка **.jar** используется только для удовлетворения зависимостей во время компиляции. При использовании действие построения C# привязки не создаются для ссылки на **.jar** и он не встроен в итоговый библиотека привязок. БИБЛИОТЕКА DLL. Используйте этот параметр, при внесении библиотека привязок для ссылки на **.jar** , но этого не сделали еще. Действие построения полезен для упаковки несколько **.jar**s (и (или). AARs) в нескольких независимых библиотек привязки.

* `EmbeddedReferenceJar` &ndash; Внедряет ссылку **.jar** в итоговый библиотеку привязок. БИБЛИОТЕКА DLL. Это действие построения используется, если вы хотите создать C# привязки для входной, так **.jar** (или). AAR) и все его ссылку **.jar**(s) в библиотеке привязки.

* `EmbeddedNativeLibrary` &ndash; Внедряет собственный **.so** в привязку. Это действие построения используется для **.so** файлы, которые требуются **.jar** файл привязки. Может потребоваться вручную загрузить **.so** библиотеки перед выполнением кода из библиотеки Java. Это описано ниже.

Эти сборки, действия описаны более подробно в следующих руководствах.

Кроме того, следующие действия сборки используются для импорта документации по Java API и их преобразования в C# XML-документации:

* `JavaDocJar` используется для указания на архивный Javadoc JAR-файл для библиотеки Java, который соответствует стиль пакет Maven (обычно `FOOBAR-javadoc**.jar**`).
* `JavaDocIndex` используется для указания `index.html` файла в справочную документацию по API HTML.
* `JavaSourceJar` используется в дополнение к `JavaDocJar`, чтобы сначала создать JavaDoc из источников и затем обрабатывать результаты как `JavaDocIndex`, для библиотеки Java, который соответствует Maven упаковать стиля (обычно `FOOBAR-sources**.jar**`).

Документация по API должен быть doclet по умолчанию из Java8, Java7 или Java6 SDK (они все другой формат), или DroidDoc стиль.

## <a name="including-a-native-library-in-a-binding"></a>Включая собственной библиотеки в привязке

Может потребоваться включить **.so** библиотеки в проект Xamarin.Android привязки в составе привязка библиотеки Java. При выполнении упакованного кода Java для вызова JNI и сообщение об ошибке не удастся Xamarin.Android _java.lang.UnsatisfiedLinkError: Собственный метод, не найден:_ будет отображаться в logcat out для приложения.

Способ устранения этой проблемы является вручную загрузить **.so** библиотеки с помощью вызова `Java.Lang.JavaSystem.LoadLibrary`. Например при условии, что проект Xamarin.Android общая библиотека **libpocketsphinx_jni.so** включен в проект привязки с действием сборки **EmbeddedNativeLibrary**, следующий фрагмент кода (выполняется перед использованием общей библиотеки) будет загружать **.so** библиотеки:

```csharp
Java.Lang.JavaSystem.LoadLibrary("pocketsphinx_jni");
```

## <a name="adapting-java-apis-to-ceparsl"></a>Адаптация API-интерфейсы Java в C&eparsl;

Генератор привязки Xamarin.Android изменит некоторые Java стили и шаблоны в соответствии с шаблоны .NET. В следующем списке описываются, как Java сопоставляется C#/.NET:

-   _Методы задания и считывания_ в Java являются _свойства_ в .NET.

-   _Поля_ в Java являются _свойства_ в .NET.

-   _Интерфейсы прослушиватели/Listener_ в Java являются _события_ в .NET. Получает параметры из методов в интерфейсах обратного вызова `EventArgs` подкласс.

-   Объект _вложенные статический класс_ в Java является _вложенных классов_ в .NET.

-   _Внутреннего класса_ в Java является _вложенных классов_ с помощью конструктора экземпляра в C#.



## <a name="binding-scenarios"></a>Сценарии привязки

Следующие руководства по сценариям привязки может помочь привязка библиотеки Java (или библиотеки) для внесения в приложении:

-   [Привязка. JAR-](~/android/platform/binding-java-library/binding-a-jar.md) приведено пошаговое руководство по созданию библиотеки привязки для **.jar** файлов.

-   [Привязка. AAR](~/android/platform/binding-java-library/binding-an-aar.md) представлено пошаговое руководство по созданию библиотеки привязки для. Aar-файлы. Чтение в этом пошаговом руководстве, чтобы узнать, как выполнить привязку библиотеки Android Studio.

-   [Привязка проекта библиотеки Eclipse](~/android/platform/binding-java-library/binding-a-library-project.md) представлено пошаговое руководство для создания библиотек привязки из проектов библиотеки Android. Чтение в этом пошаговом руководстве, чтобы узнать, как выполнить привязку библиотеки проектов Eclipse для Android.

-   [Настройка привязок](~/android/platform/binding-java-library/customizing-bindings/index.md) объясняет, как вручную изменить привязки для устранения ошибок сборки и пожелания получающийся API, так как это дополнительные "C#-как».

-   [Устранение неполадок с привязками](~/android/platform/binding-java-library/troubleshooting-bindings.md) перечислены распространенные ошибки привязки, рассмотрены возможные причины и предлагает варианты для устранения этих ошибок.


## <a name="related-links"></a>Связанные ссылки

- [Работа с JNI](~/android/platform/java-integration/working-with-jni.md)
- [GAPI Используются метаданные](https://www.mono-project.com/docs/gui/gtksharp/gapi/#metadata)
- [Использование собственных библиотек](~/android/platform/native-libraries.md)
