---
title: Привязка JAR-файла
description: Это пошаговое руководство содержит пошаговые инструкции по созданию библиотеки привязок Java для Xamarin. Android из Android. JAR-файл.
ms.prod: xamarin
ms.assetid: 93F1D5C5-E2AF-46EA-8460-485A0860C176
ms.technology: xamarin-android
author: conceptdev
ms.author: crdun
ms.date: 04/11/2018
ms.openlocfilehash: 9a9e7e9c5d189527d4fbdcc2001d6f003fa63dd7
ms.sourcegitcommit: 57f815bf0024b1afe9754c0e28054fc0a53ce302
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/06/2019
ms.locfileid: "70757874"
---
# <a name="binding-a-jar"></a>Привязка JAR-файла

_Это пошаговое руководство содержит пошаговые инструкции по созданию библиотеки привязок Java для Xamarin. Android из Android. JAR-файл._

## <a name="overview"></a>Обзор

Сообщество Android предлагает множество библиотек Java, которые можно использовать в приложении. Эти библиотеки Java часто упаковываются в. Формат JAR (Архив Java), но можно упаковать. JAR-файл в *библиотеку привязок Java* , чтобы обеспечить доступность его функциональных возможностей для приложений Xamarin. Android. Цель библиотеки привязок Java — сделать API-интерфейсы в. JAR-файл доступен C# для кода через автоматически создаваемые оболочки кода.

Средства Xamarin могут формировать библиотеку привязок из одного или нескольких входных данных. JAR-файлы. Библиотека привязок (. Сборка DLL) содержит следующие сведения: 

- Содержимое исходного объекта. JAR-файлы.

- Управляемые вызываемые оболочки (MCW), которые C# являются типами, которые переносят соответствующие типы Java в. JAR-файлы.

Созданный код MCW использует JNI (собственный интерфейс Java) для переадресации вызовов API к базовому. JAR-файл. Можно создавать библиотеки привязок для любого. JAR-файл, изначально предназначенный для использования с Android (Обратите внимание, что средства Xamarin в настоящее время не поддерживают привязку библиотек Java, отличных от Android). Можно также выбрать построение библиотеки привязок, не включая содержимое. JAR-файл, чтобы библиотека DLL заработала зависимость от. JAR во время выполнения.

В этом пошаговом руководством мы рассмотрим основы создания библиотеки привязок для одного. JAR-файл. Мы продемонстрируем пример, в котором все выглядит правильно &ndash; , если не требуется настройка или Отладка привязок. 
[Создание привязок с помощью метаданных](~/android/platform/binding-java-library/customizing-bindings/java-bindings-metadata.md) представляет собой пример более сложного сценария, в котором процесс привязки не полностью автоматизирован и требуется вмешательство вручную. Общие сведения о привязке библиотеки Java в целом (с примером базового кода) см. в разделе [Привязка библиотеки Java](~/android/platform/binding-java-library/index.md). 

## <a name="walkthrough"></a>Пошаговое руководство

В следующем пошаговом руководстве мы создадим библиотеку привязок для [принцессу](http://square.github.io/picasso/), популярного Android. JAR, предоставляющий функции загрузки и кэширования образов. Для привязки **Picasso-2. x. x. jar** и создания новой сборки .NET, которую можно использовать в проекте Xamarin. Android, мы будем использовать следующие шаги: 

1. Создайте новый проект библиотеки привязок Java.

2. Добавьте. JAR-файл в проект.

3. Задайте соответствующее действие сборки для. JAR-файл.

4. Выберите целевую платформу, которую. JAR поддерживает.

5. Создайте библиотеку привязок.

После создания библиотеки привязок мы создадим небольшое приложение Android, которое демонстрирует возможность вызова API в библиотеке привязок. В этом примере мы хотим получить доступ к методам **Picasso-2. x. x. jar**:

```java
package com.squareup.picasso

public class Picasso
{ 
    ...
    public static Picasso with (Context context) { ... };
    ...
    public RequestCreator load (String path) { ... };
    ...
}
```

После создания библиотеки привязок для **Picasso-2. x. x. jar**мы можем вызывать эти методы из C#. Например:

```csharp
using Com.Squareup.Picasso;
...
Picasso.With (this)
    .Load ("http://mydomain.myimage.jpg")
    .Into (imageView);

```

### <a name="creating-the-bindings-library"></a>Создание библиотеки привязок

Прежде чем началом, выполните следующие действия, скачайте [Picasso-2. x. x. jar](http://repo1.maven.org/maven2/com/squareup/picasso/picasso/2.5.2/picasso-2.5.2.jar).

Сначала создайте новый проект библиотеки привязок. В Visual Studio для Mac или Visual Studio создайте новое решение и выберите шаблон *Библиотека привязок Android* . (Снимки экрана в этом пошаговом руководстве используют Visual Studio, но Visual Studio для Mac очень похожа.) Назовите решение **жарбиндинг**: 

[![Создать проект библиотеки Жарбиндинг](binding-a-jar-images/01-new-bindings-library-sml.w157.png)](binding-a-jar-images/01-new-bindings-library.w157.png#lightbox)

Шаблон содержит папку **JAR** , в которую вы добавляете. JAR-файл (ы) в проект библиотеки привязок. Щелкните правой кнопкой мыши папку **JAR** и выберите **Добавить > существующий элемент**: 

[![Добавить существующий элемент](binding-a-jar-images/02-add-existing-item-sml.png)](binding-a-jar-images/02-add-existing-item.png#lightbox)

Перейдите к файлу **Picasso-2. x. x. jar** , скачанному ранее, выберите его и нажмите кнопку **Добавить**: 

[![Выберите JAR-файл и нажмите кнопку Добавить.](binding-a-jar-images/03-select-jar-file-sml.png)](binding-a-jar-images/03-select-jar-file.png#lightbox)

Убедитесь, что файл **Picasso-2. x. x. jar** был успешно добавлен в проект: 

[![JAR-файл добавлен в проект](binding-a-jar-images/04-jar-added-sml.png)](binding-a-jar-images/04-jar-added.png#lightbox)

При создании проекта библиотеки привязок Java необходимо указать, следует ли. JAR необходимо внедрить в библиотеку привязок или упаковать отдельно. Для этого необходимо указать одно из следующих *действий сборки*: 

- **Ембеддеджар** &ndash; объект. JAR будет внедрен в библиотеку привязок.

- **Инпутжар** &ndash; объект. JAR-файл будет храниться отдельно от библиотеки привязок.

Как правило, используется действие сборки **ембеддеджар** , чтобы. JAR автоматически упаковывается в библиотеку привязок. Это простейший параметр &ndash; байт-кода Java в. JAR преобразуется в байтовый код DEX и внедряется (вместе с управляемыми вызываемыми оболочками) в APK. Для сохранения. JAR-файл, отделенный от библиотеки привязок, можно использовать параметр **инпутжар** . Однако необходимо убедиться, что. JAR-файл доступен на устройстве, на котором выполняется приложение. 

Задайте для действия сборки значение **ембеддеджар**: 

[![Выбор действия сборки Ембеддеджар](binding-a-jar-images/05-embeddedjar-sml.png)](binding-a-jar-images/05-embeddedjar.png#lightbox)

Затем откройте свойства проекта, чтобы настроить *требуемую платформу*. Если. JAR использует все API-интерфейсы Android, задайте для целевой платформы уровень API, который. Для JAR-файла. Как правило, разработчик объекта. JAR-файл будет указывать уровень API (или уровни), который. JAR-файл совместим с. (Дополнительные сведения о параметрах целевой платформы и уровнях API Android см. в разделе [Основные сведения об уровнях API Android](~/android/app-fundamentals/android-api-levels.md).)

Задайте целевой уровень API для библиотеки привязок (в этом примере мы используем API уровня 19): 

[![Для целевого уровня API задано значение API 19](binding-a-jar-images/06-set-target-framework-sml.png)](binding-a-jar-images/06-set-target-framework.png#lightbox)

Наконец, создайте библиотеку привязок. Хотя могут отображаться некоторые предупреждающие сообщения, проект библиотеки привязок должен быть успешно построен и выдавать выходные данные. DLL по следующему адресу: **Жарбиндинг/bin/debug/Жарбиндинг. dll**

### <a name="using-the-bindings-library"></a>Использование библиотеки привязок

Для использования. DLL в приложении Xamarin. Android выполните следующие действия.

1. Добавьте ссылку на библиотеку привязок.

2. Выполните вызовы к. JAR через управляемые вызываемые оболочки. 

В следующих шагах мы создадим минимальное приложение, которое использует библиотеку привязок для скачивания и вывода изображения в `ImageView`; «тяжелая работа» выполняется кодом, который находится в. JAR-файл. 

Сначала создайте новое приложение Xamarin. Android, которое использует библиотеку привязок. Щелкните решение правой кнопкой мыши и выберите команду **Добавить новый проект**. Назовите новый проект **биндингтест**. Мы создаем это приложение в том же решении, что и библиотека привязок, чтобы упростить это пошаговое руководство. Тем не менее приложение, использующее библиотеку привязок, может находиться в другом решении: 

[![Добавить новый проект Биндингтест](binding-a-jar-images/07-add-new-project-sml.w157.png)](binding-a-jar-images/07-add-new-project.w157.png#lightbox)

Щелкните правой кнопкой мыши узел **ссылки** проекта **биндингтест** и выберите команду **Добавить ссылку...** :

[![Добавить ссылку справа](binding-a-jar-images/08-add-reference.png)](binding-a-jar-images/08-add-reference.png#lightbox)

Проверьте проект **жарбиндинг** , созданный ранее, и нажмите кнопку " **ОК**":

[![Выбор проекта Жарбиндинг](binding-a-jar-images/09-choose-jar-binding-sml.png)](binding-a-jar-images/09-choose-jar-binding.png#lightbox)

Откройте узел **References** проекта **биндингтест** и убедитесь, что указана ссылка **жарбиндинг** : 

[![Жарбиндинг отображается в разделе ссылки](binding-a-jar-images/10-references-shows-jarbinding-sml.png)](binding-a-jar-images/10-references-shows-jarbinding.png#lightbox)

Измените макет **биндингтест** (**Main. axml**), чтобы он был одним `ImageView`из следующих:

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="vertical"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:minWidth="25px"
    android:minHeight="25px">
    <ImageView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:id="@+id/imageView" />
</LinearLayout>
```

Добавьте следующую `using` инструкцию для **MainActivity.CS** &ndash; , чтобы можно было легко получить доступ к методам класса на основе `Picasso` Java, находящегося в библиотеке привязок:

```csharp
using Com.Squareup.Picasso;
```

Измените метод так, чтобы он `Picasso` использовал класс для загрузки изображения из URL-адреса `ImageView`и его вывода в: `OnCreate` 

```csharp
public class MainActivity : Activity
{
    protected override void OnCreate(Bundle bundle)
    {
        base.OnCreate(bundle);
        SetContentView(Resource.Layout.Main);
        ImageView imageView = FindViewById<ImageView>(Resource.Id.imageView);

        // Use the Picasso jar library to load and display this image:
        Picasso.With (this)
            .Load ("http://i.imgur.com/DvpvklR.jpg")
            .Into (imageView);
    }
}
```

Скомпилируйте и запустите проект **биндингтест** . Приложение будет запускаться, и после небольшой задержки (в зависимости от условий сети) будет загружен и отображен образ, аналогичный следующему снимку экрана:

[![Снимок экрана с Биндингтест](binding-a-jar-images/11-result-sml.png)](binding-a-jar-images/11-result.png#lightbox)

Поздравляем! Вы успешно привязываете библиотеку Java. JAR и использовали его в приложении Xamarin. Android.

## <a name="summary"></a>Сводка

В этом пошаговом руководстве мы создали библиотеку привязок для стороннего производителя. JAR-файл, добавлена библиотека привязок к минимальному тестовому приложению, а затем запущено приложение, чтобы убедиться C# , что наш код может вызывать код Java, находящийся в. JAR-файл. 

## <a name="related-links"></a>Связанные ссылки

- [Создание библиотеки привязок Java (видео)](https://university.xamarin.com/classes#10090)
- [Привязка библиотеки Java](~/android/platform/binding-java-library/index.md)
