---
title: Оптимизированные пакеты NuGet поддержки Android v4 и v13 в Xamarin
ms.topic: troubleshooting
ms.prod: xamarin
ms.assetid: FE66A82A-6C05-4646-BC52-E806F5DC606C
ms.technology: xamarin-android
author: davidortinau
ms.author: daortin
ms.date: 03/09/2018
ms.openlocfilehash: c74cac6a6d669385855999a565711a3fdc85f3b7
ms.sourcegitcommit: 2fbe4932a319af4ebc829f65eb1fb1816ba305d3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2019
ms.locfileid: "73019542"
---
# <a name="smarter-xamarin-android-support-v4--v13-nuget-packages"></a>Оптимизированные пакеты NuGet поддержки Android v4 и v13 в Xamarin

## <a name="about-the-android-support-libraries"></a>Сведения о библиотеках поддержки Android

Google создал библиотеки поддержки, чтобы сделать новые функции доступными для старых версий Android. Как правило, библиотекам поддержки предоставляется номер версии, который является самым низким уровнем API Android, с которым они совместимы (например, support-v4 можно использовать только на API уровня 4 и выше). Дополнительные сведения см. в этом [Stack overflow обсуждении](https://stackoverflow.com/questions/9926403/android-support-package-compatibility-library-use-v4-or-v13)). 

Две библиотеки поддержки: `Support-v4` и `Support-v13` нельзя использовать вместе в одном приложении, то есть они являются взаимоисключающими. Это связано с тем, что `Support-v13` фактически содержит все типы и реализацию `Support-v4`. Если вы попробуете и сослаться на оба проекта в одном и том же проекте, возникнут ошибки с повторяющимися типами.

## <a name="problems-with-referencing"></a>Проблемы со ссылками

Так как `Support-v4` стали настолько популярными, теперь от нее зависят многие сторонние библиотеки. Они могут зависеть от support-V13, но чаще всего они зависят от _версии 4_ , так как это дает приложениям, использующим сторонние библиотеки, возможность поддержки уровней API в меньшую сторону до 4.

Если библиотека стороннего производителя Xamarin ссылается на привязку `Xamarin.Android.Support.v4.dll` для `Support-v4`, любое приложение, использующее эту библиотеку, также должно ссылаться на `Xamarin.Android.Support.v4.dll`. Это станет проблемой, если тому же приложению требуется использовать некоторые из функций привязки `Xamarin.Android.Support.v13.dll` для `Support-v13`. Если вы ссылаетесь на обе привязки, возникнут ошибки с повторяющимися типами.

## <a name="type-forwarded-v4-binding-assembly"></a>Тип-перенаправленная сборка привязки v4

Чтобы обойти эту проблему, мы создали специальную сборку `Xamarin.Android.Support.v4.dll`, которая не имеет реализации, но просто `[assembly: TypeForwardedTo (..)]` атрибуты, перенаправляющие все типы `Support-v4` в реализацию в сборке `Xamarin.Android.Support.v13.dll`.

Это означает, что разработчик может ссылаться на эту сборку _с перенаправлением типа_ в своем приложении, которая будет соответствовать ссылке на `Xamarin.Android.Support.v4.dll` любыми сторонними библиотеками и по-прежнему разрешает использовать `Xamarin.Android.Support.v13.dll` в приложении.

## <a name="nuget-assistance"></a>Помощь по NuGet

Хотя разработчик может вручную добавить нужные ссылки, мы можем использовать NuGet, чтобы помочь выбрать правильную сборку (либо обычную привязку _v4_ , либо сборку с пересылкой типа _v4_ ) при установке пакета NuGet.

Таким образом, `Xamarin.Android.Support.v4` пакет NuGet теперь содержит следующую логику:

Если приложение предназначено для API уровня 13 (Gingerbread 3,2) или более поздней версии:

* `Xamarin.Android.Support.v13` NuGet будет автоматически добавлен в качестве зависимости.
* В проекте будет указана ссылка на `Xamarin.Android.Support.v4.dll` _типа, перенаправленная на перенаправление_ .

Если приложение нацелено на нечто меньше, чем API уровня 13, вы получите обычную привязку `Xamarin.Android.Support.v4.dll`, на которую ссылается проект.

## <a name="do-i-have-to-use-support-v13"></a>Нужно ли использовать support-V13?

Если приложение предназначено для API уровня 13 или выше и вы решили использовать `Xamarin Android Support-v4` пакет NuGet, то `Xamarin Android Support v13` пакет NuGet является обязательной зависимостью.

Мы почувствуете, что очень незначительное увеличение размера приложения (два JAR-файла, отличающиеся 17kb), хорошо проявляется для обеспечения совместимости и меньшего количества проблем.

Если вы непреклонен об использовании `Support-v4` в приложении, ориентированном на API уровня 13 или выше, вы всегда можете вручную скачать `.nupkg`, извлечь его и создать ссылку на сборку.
