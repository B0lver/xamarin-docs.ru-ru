---
title: Оптимизированные пакеты NuGet поддержки Android v4 и v13 в Xamarin
ms.topic: troubleshooting
ms.prod: xamarin
ms.assetid: FE66A82A-6C05-4646-BC52-E806F5DC606C
ms.technology: xamarin-android
author: davidortinau
ms.author: daortin
ms.date: 03/09/2018
ms.openlocfilehash: c74cac6a6d669385855999a565711a3fdc85f3b7
ms.sourcegitcommit: b0ea451e18504e6267b896732dd26df64ddfa843
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2020
ms.locfileid: "73019542"
---
# <a name="smarter-xamarin-android-support-v4--v13-nuget-packages"></a>Оптимизированные пакеты NuGet поддержки Android v4 и v13 в Xamarin

## <a name="about-the-android-support-libraries"></a>Сведения о библиотеках поддержки Android

Google создал библиотеки поддержки, чтобы сделать новые функции доступными для старых версий Android. Как правило, библиотекам поддержки предоставляется номер версии, который является самым низким уровнем API Android, с которым они совместимы (например: поддержку версии 4 можно использовать только на API уровня 4 и выше. Дополнительные сведения см. в этом [обсуждении Stack Overflow](https://stackoverflow.com/questions/9926403/android-support-package-compatibility-library-use-v4-or-v13)). 

Две библиотеки поддержки `Support-v4` и `Support-v13` нельзя использовать в одном приложении, то есть они являются взаимоисключающими. Это связано с тем, что `Support-v13` фактически содержит все типы и реализацию `Support-v4`. Если вы попробуете сослаться на обе версии в одном и том же проекте, то столкнетесь с ошибками повторяющегося типа.

## <a name="problems-with-referencing"></a>Проблемы со ссылками

Поскольку `Support-v4` стала настолько популярной, теперь от нее зависят многие сторонние библиотеки. Они могли бы зависеть от поддержки версии 13, но чаще всего зависят от _версии 4_, поскольку это дает приложениям, использующим сторонние библиотеки, возможность поддерживать уровни API до 4.

Если библиотека стороннего производителя Xamarin ссылается на привязку `Xamarin.Android.Support.v4.dll` для `Support-v4`, любое приложение, использующее эту библиотеку, также должно ссылаться на `Xamarin.Android.Support.v4.dll`. Это станет проблемой, если тому же приложению требуется использовать некоторые из функций привязки `Xamarin.Android.Support.v13.dll` к `Support-v13`. Если вы ссылаетесь на обе привязки, возникнут ошибки с повторяющимися типами.

## <a name="type-forwarded-v4-binding-assembly"></a>Сборка привязки v4 с перенаправленным типом

Чтобы обойти эту проблему, мы создали специальную сборку `Xamarin.Android.Support.v4.dll`, которая имеет не реализации, а атрибуты `[assembly: TypeForwardedTo (..)]`, которые перенаправляют все типы `Support-v4` в реализацию внутри сборки `Xamarin.Android.Support.v13.dll`.

Это означает, что разработчик может ссылаться на эту сборку с _перенаправленным типом_ в своем приложении, которая будет соответствовать ссылке `Xamarin.Android.Support.v4.dll` в любых сторонних библиотеках, в тоже время позволяя использовать в приложении `Xamarin.Android.Support.v13.dll`.

## <a name="nuget-assistance"></a>Помощь по NuGet

Хотя разработчик может вручную добавлять нужные ссылки, мы можем использовать NuGet для помощи в выборе правильной сборки (обычная привязка _версии 4_ или сборка с перенаправленным типом _версии 4_) при установке пакета NuGet.

Таким образом, пакет NuGet `Xamarin.Android.Support.v4` теперь содержит следующую логику.

Если приложение предназначено для API уровня 13 (Gingerbread 3.2) или более поздней версии:

* `Xamarin.Android.Support.v13` NuGet будет автоматически добавлен в качестве зависимости;
* В проекте будет указана ссылка на _тип с перенаправлением_ `Xamarin.Android.Support.v4.dll`.

Если приложение нацелено на уровень, являющийся ниже API уровня 13, вы получите обычную привязку `Xamarin.Android.Support.v4.dll`, на которую ссылается проект.

## <a name="do-i-have-to-use-support-v13"></a>Нужно ли использовать поддержку версии 13?

Если приложение предназначено для API уровня 13 или выше и вы решили использовать пакет NuGet `Xamarin Android Support-v4`, то пакет NuGet `Xamarin Android Support v13` является обязательной зависимостью.

Мы считаем, что незначительное увеличение размера приложения (два JAR-файла отличаются на 17 Кб) вполне оправдано с точки зрения совместимости и меньшего количества проблем, возникающих в связи с этим.

Если вы непреклонны в использовании `Support-v4` в приложении, которое нацелено на API уровня 13 или выше, вы всегда можете вручную загрузить файл `.nupkg`, извлечь его и создать ссылку на сборку.
