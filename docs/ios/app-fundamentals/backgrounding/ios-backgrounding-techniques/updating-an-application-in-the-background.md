---
title: Обновление приложения Xamarin.iOS в фоновом режиме
description: В этом документе описываются различные способы, чтобы обновить приложение Xamarin.iOS, которое находится в фоновом режиме, например область мониторинга выборку в фоновом режиме и удаленные уведомления.
ms.prod: xamarin
ms.assetid: A2B2231A-C045-4C11-8176-F9966485197A
ms.technology: xamarin-ios
author: lobrien
ms.author: laobri
ms.date: 03/18/2017
ms.openlocfilehash: 835dccaea79467582f56fd4b8b6b3b8f42acd632
ms.sourcegitcommit: 4b402d1c508fa84e4fc3171a6e43b811323948fc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61392352"
---
# <a name="updating-a-xamarinios-app-in-the-background"></a>Обновление приложения Xamarin.iOS в фоновом режиме

Фоновое обновление — это процесс пробуждение приложение, которое приостанавливается или не запущен и обновление его новым содержимым. iOS обеспечивает три варианта обновление содержимого в фоновом режиме.

1.  *Мониторинг области* и *значительные службы изменения расположения* -фонового триггера привязанный к местонахождению API-интерфейсы обновления на основании изменений в расположении пользователя. Эти API-интерфейсы можно использовать с осторожностью обновлять содержимое в приложениях не расположение под управлением iOS 6, где другие параметры недоступны.
1.  *Фон выборки (iOS 7 и более поздние)* -темпоральной подход к обновление *некритические* содержимое, которое обновляет *часто* .
1.  *Удаленные уведомления (iOS 7 и более поздние)* -приложения, которые получают Push-уведомлений можно использовать уведомления для активации фоновое обновление содержимого. Этот метод можно использовать для обновления с *важные, критичного по времени* содержимое, которое обновляет *нерегулярно* .


В следующих разделах описываются основы эти параметры.

## <a name="region-monitoring-and-significant-location-changes"></a>Мониторинг области и изменения значительное место

iOS предоставляет два API, привязанный к местонахождению с фоновой обработки возможности:

1.  *Мониторинг области* — это процесс настройки областей с границами и пробуждение устройства, когда пользователь входит или выходит из области. Регионы являются циклическими и может быть разных размеров. Если пользователь пересечет границы области, устройство будет пробуждения для обработки события, обычно путем обработки уведомление или в самом начале задачи. Мониторинг области требуется GPS, а также увеличивает батареи и использование данных.
1.  *Значительные службы изменения расположения* доступен простой и экономия питания вариант для устройств с помощью сотовой связи радио. Прослушивание изменений значительное место приложения будет уведомлен о устройство переключается towers ячейки. Эта служба может использоваться для пробуждения приостановлен или завершенного приложения и предоставляет возможность проверки нового содержания в фоновом режиме. Фоновое действие ограничена около 10 секунд, если не связан с [фоновой задачи](~/ios/app-fundamentals/backgrounding/ios-backgrounding-techniques/ios-backgrounding-with-tasks.md) .


Приложения не требуется расположение `UIBackgroundMode` эти привязанный к местонахождению API. Поскольку iOS не отслеживает типы задач, которые могут выполняться при пробуждении изменяется в местоположение пользователя устройства, эти API обеспечивают обхода обновление содержимого в фоновом режиме в iOS 6. *Имейте в виду запуск обновления в фоновом режиме с помощью интерфейсов API на основе расположения будет рисовать на ресурсы устройства что может запутать пользователей, не понимают, почему приложению требуется доступ к их расположение*. Проявляйте осторожность при реализации мониторинга регион или значительные изменения расположения для фоновой обработки в приложениях, которые еще не используете API расположения.

Приложения, с помощью расположение отслеживания для фоновой обработки содержат пробел в iOS 6: Если нужд приложения не помещаются в категорию необходимости фона, она имеет ограниченный параметры фоновой обработки. С появлением двух новых API *фоновое получение* и *удаленные уведомления*, iOS 7 (и более) предоставляет возможности фоновой обработки для большего числа приложений. Следующих двух разделах представлены эти новые API.

<a name="background_fetch" />

## <a name="background-fetch-ios-7-and-greater"></a>Выборку в фоновом режиме (iOS 7 и более)

В iOS 6 приложение, введя на переднем плане требуется время, чтобы загрузить новое содержимое, кратко, предоставляя пользователям с содержимым, которые они уже видели. Получение фоновых данных позволяет приложениям загружать новые данные *перед* пользователь запускает приложение и предоставить пользователю наиболее актуальные материалы.

Чтобы реализовать обработку в фоновом режиме, измените *Info.plist* и проверьте **включить фоновые режимы** и **выборку в фоновом режиме** флажки:

 [![](updating-an-application-in-the-background-images/fetch.png "Редактирование файла Info.plist и флажков включить фоновые режимы и фоновое получение")](updating-an-application-in-the-background-images/fetch.png#lightbox)

Затем в `AppDelegate`, переопределить `FinishedLaunching` метод, чтобы задать интервал выборки минимальное. В этом примере мы позволим как часто следует получить новое содержимое, поддерживаемую операционной Системой:

```csharp
public override bool FinishedLaunching (UIApplication application, NSDictionary launchOptions)
{
  UIApplication.SharedApplication.SetMinimumBackgroundFetchInterval (UIApplication.BackgroundFetchIntervalMinimum);
  return true;
}
```

Наконец, выполните fetch, переопределив `PerformFetch` метод в `AppDelegate`и передача в *обработчик завершения*. Обработчик завершения — это делегат, который принимает `UIBackgroundFetchResult`:

```csharp
public override void PerformFetch (UIApplication application, Action<UIBackgroundFetchResult> completionHandler)
{
  // Check for new data, and display it
  ...
  
  // Inform system of fetch results
  completionHandler (UIBackgroundFetchResult.NewData);
}
```

По завершении обновления содержимого, мы позволим знать путем вызова обработчика завершения с соответствующее состояние операционной системы. iOS поддерживает следующие три варианта состояние обработчика завершения.

1.  `UIBackgroundFetchResult.NewData` — Вызывается, когда была получена новое содержимое, и приложение было обновлено.
1.  `UIBackgroundFetchResult.NoData` — Вызывается, когда проходит fetch для нового содержимого, но содержимое не доступна.
1.  `UIBackgroundFetchResult.Failed` . Используется для обработки ошибок, вызывается, если выборка не удалось пройти через группу.


Приложений с помощью фоновое получение можно вызывать для обновления пользовательского интерфейса в фоновом режиме. Когда пользователь открывает приложение, пользовательского интерфейса будут актуальны и отображение нового содержимого. Также будут обновлены моментального снимка приложение переключателя приложения, поэтому пользователь может видеть, когда у приложения есть новое содержимое.

> [!IMPORTANT]
> Один раз `PerformFetch` является именем, приложение имеет приблизительно 30 секунд для запуска загрузки нового содержимого и вызова в блоке обработчика завершения. Если это занимает слишком много времени, приложение будет завершен. Рассмотрите возможность использования фоновое получение с _фоновой службы передачи_ при загрузке, мультимедиа и другие большие файлы.


### <a name="backgroundfetchinterval"></a>BackgroundFetchInterval

В приведенном выше примере, мы позволим ОС решить, как часто получить новое содержимое, задав интервал выборки минимальное значение `BackgroundFetchIntervalMinimum`. iOS поддерживает следующие три варианта для интервала выборки.

1.  `BackgroundFetchIntervalNever` -Указать системе никогда не получить новое содержимое. Позволяет отключить выборку в определенных ситуациях, например, если пользователь не выполнил вход. Это значение по умолчанию для интервала выборки. 
1.  `BackgroundFetchIntervalMinimum` -Позвольте системе решить, как часто для получения на основе шаблонов пользователя, срок службы аккумулятора, использование данных и потребности других приложений.
1.  `BackgroundFetchIntervalCustom` — Если вы знаете, как часто обновляется содержимое приложения, можно указать интервал «Сон» после каждой выборки во время которого приложение будет запрещено получение нового содержимого. После этого интервала, система будет определить, когда требуется пробно извлечь содержимое.


Оба `BackgroundFetchIntervalMinimum` и `BackgroundFetchIntervalCustom` в системе для планирования операций выборки. Этот интервал является динамическим, адаптации к потребностям устройства, а также привычки отдельного пользователя. Например если один пользователь проверяет каждое утро приложения, а другой проверки каждый час, iOS, обеспечит содержимого не требуется для обоих пользователей каждый раз при открытии приложения.

Для приложений, обновляющих часто некритические содержимым можно использовать выборку в фоновом режиме. Для приложений с критическими обновлениями следует использовать удаленные уведомления. Удаленные уведомления основаны на фоновое получение и совместно использовать один и тот же обработчик завершения. Мы подробно рассмотрим удаленные уведомления рядом.

 <a name="remote_notifications" />


## <a name="remote-notifications-ios-7-and-greater"></a>Удаленные уведомления (iOS 7 и более)

Push-уведомления являются сообщений JSON, отправляемых от поставщика на устройстве посредством *Push-уведомлений Apple (APN)*.

В iOS 6 входящего Push-уведомлений сообщает системе, чтобы предупредить пользователя, что происходит в приложении. Щелкнув уведомление извлекает приложения из состояния приостановки или нулем, и начинается обновление содержимого приложения. iOS 7 (и более) расширяет обычные Push-уведомлений, давая приложениям возможность обновить содержимое в фоновом режиме *перед* уведомления пользователя, так что пользователь может открыть приложение и появится новое содержимое немедленно.

Чтобы реализовать удаленных уведомлений, измените *Info.plist* и проверьте **включить фоновые режимы** и **удаленные уведомления** флажки:

 [![](updating-an-application-in-the-background-images/remote.png "Фоновый режим включить фоновые режимы и удаленные уведомления")](updating-an-application-in-the-background-images/remote.png#lightbox)

Затем задайте `content-available` флаг Push-уведомления сам 1. Это позволяет приложения о том, для получения нового содержимого перед выводом оповещения:

```csharp
'aps' {
  'content-available': 1,
  'alert': 'Something new has happened in your app!''
}
```

В *AppDelegate*, переопределить `DidReceiveRemoteNotification` метод для проверки полезные данные уведомления для доступного содержимого и вызывать в блоке обработчика завершения:

```csharp
public override void DidReceiveRemoteNotification (UIApplication application, NSDictionary userInfo, Action<UIBackgroundFetchResult> completionHandler)
{
  if([content-available]) {
    // fetch content
    completionHandler (UIBackgroundFetchResult.NewData);
  }
}
```

Удаленные уведомления следует использовать редко обновления с содержимым, которое имеет решающее значение для функции этого приложения. Дополнительные сведения об удаленных уведомлений, см. в разделе Xamarin [Push-уведомлений в iOS](~/ios/platform/user-notifications/deprecated/remote-notifications-in-ios.md) руководства.

> [!IMPORTANT]
> Так как механизм обновления в удаленных уведомлений основан на фоновое получение, приложение необходимо запускать загрузки нового содержимого и вызывать в блоке обработчика завершения в течение 30 секунд для получения уведомления, или iOS, чтобы закрыть приложение. Рассмотреть возможность объединения удаленные уведомления с помощью _фоновой службы передачи_ при загрузке, мультимедиа и других больших файлов в фоновом режиме.


### <a name="silent-remote-notifications"></a>Автоматическая удаленные уведомления

Удаленные уведомления — это простой способ уведомления приложений, обновлений и начать получение нового содержимого, но бывают случаи, где нам не нужно уведомить пользователя, что что-то изменилось. Например если пользователь помечает файл для синхронизации, не требуется уведомлять их каждый раз, обновляет файл. Синхронизация файла не удивительно событий и требуют немедленного вмешательства пользователя. Пользователи ожидают, что просто будут обновленными, при открытии файла.

Для случаев, как в примере выше iOS позволяет Push-уведомлений, отправляемых автоматически — то есть без предупреждения. Чтобы включить периодические уведомления в автоматическом один, просто удалите оповещение из полезные данные уведомления:

```csharp
'aps' {
  'content-available': 1
}
```

#### <a name="rate-limits"></a>Ограничения скорости

Основное различие между обычной и автоматической уведомления с точки зрения разработчика является автоматической Push-уведомлений ограничена частота. APNs будет отложить установку автоматической Push-уведомлений на устройство, если частота принудительной слишком сильной. Это гарантирует, что приложения не очистите ресурсы устройства с слишком много автоматические уведомления.

Тем не менее APNs позволит автоматические уведомления «дальше» наряду с обычного удаленного уведомления или keep-alive ответа. Так как регулярные уведомления не ограничена, они могут использоваться для передачи хранимых копии автоматические уведомления из APNs на устройстве, как показано на следующей схеме:

 [![](updating-an-application-in-the-background-images/silent.png "Регулярные уведомления можно использовать для передачи хранимых автоматические уведомления из APNs на устройстве, как показано на этой схеме")](updating-an-application-in-the-background-images/silent.png#lightbox)

> [!IMPORTANT]
> Apple рекомендует разработчикам отправлять автоматической Push-уведомлений всякий раз, когда приложению требуется и не APNs их доставку.


В этом разделе мы рассмотрели различные варианты обновление содержимого в фоновом режиме для запуска задачи, которые не помещаются в категорию необходимости фона. Теперь давайте посмотрим, некоторые из этих интерфейсов API в действии.

 [Далее: Часть 4 - iOS фоновой обработке пошаговые руководства](~/ios/app-fundamentals/backgrounding/ios-backgrounding-walkthroughs/index.md)
