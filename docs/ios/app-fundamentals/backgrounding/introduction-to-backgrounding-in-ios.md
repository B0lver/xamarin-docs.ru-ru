---
title: Общие сведения о фоновой обработке в iOS
description: 'В этом документе описывается фоновое описание в iOS: состояния приложений, методы жизненного цикла приложений и фоновое обновление приложения.'
ms.prod: xamarin
ms.assetid: E214F2C7-E74E-46C7-B5BA-080B30D61250
ms.technology: xamarin-ios
author: davidortinau
ms.author: daortin
ms.date: 07/24/2018
ms.openlocfilehash: b7b94ce0aba8d61b057b3e649cdd646ee08fcc05
ms.sourcegitcommit: 008bcbd37b6c96a7be2baf0633d066931d41f61a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/22/2020
ms.locfileid: "86933098"
---
# <a name="introduction-to-backgrounding-in-ios"></a>Общие сведения о фоновой обработке в iOS

iOS регулирует фоновую обработку очень тесно и предлагает три подхода к его реализации:

- **Регистрация фоновой задачи** . Если приложению требуется выполнить важную задачу, можно попросить iOS не прерывать задачу при перемещении приложения в фоновый режим. Например, приложению может потребоваться завершить вход пользователя или завершить загрузку большого файла.
- **Регистрация в качестве приложения, необходимого для фонового** использования. приложение может зарегистрироваться как приложение определенного типа с известными требованиями к *обделами* , такими как *аудио* , *VoIP* , внешние аксессуары, *киоска* и *Расположение* . Эти приложения разрешают непрерывную фоновую обработку при условии, что они выполняют задачи, находящиеся в параметрах зарегистрированного типа приложения.
- **Включение фоновых обновлений** . приложения могут запускать фоновые обновления с *наблюдением за регионом* или прослушивать *значительные изменения расположения* . Начиная с iOS 7, приложения также могут регистрироваться для обновления содержимого в фоновом режиме с помощью *фоновой выборки* или *удаленных уведомлений* .

## <a name="application-states-and-application-delegate-methods"></a>Состояния приложения и методы делегата приложения

Прежде чем углубляться в код для фоновой обработки в iOS, необходимо понять, как фоновый режим влияет на жизненный цикл приложения iOS.

Жизненный цикл приложения iOS — это коллекция состояний приложений и методов для перемещения между ними. Приложение переходит между состояниями в зависимости от поведения пользователя и требований к фоновому режиму приложения. Перемещение показано на следующей схеме:

 [![Схема состояний приложений и методов делегатов приложений](introduction-to-backgrounding-in-ios-images/applicationlifecycle-.png)](introduction-to-backgrounding-in-ios-images/applicationlifecycle-.png#lightbox)

- **Не запущено** — приложение еще не запущено на устройстве.
- **Запущенный/активный** — приложение находится на экране и выполняет код на переднем плане.
- **Неактивна** . приложение прервано входящим звонком, текстом или другим прерыванием.
- В **фоновом** режиме — приложение перемещается в фоновый режим и продолжается на выполнение фонового кода.
- **Suspended** — если в приложении нет кода для выполнения в фоновом режиме или если весь код завершен, приложение будет *приостановлено* операционной системой. Процесс приостановленного приложения сохраняется, но приложение не может выполнить код в этом состоянии.
- **Вернуться в состояние "не работает" или "завершение" (редкие)** — иногда процесс приложения уничтожается, а приложение возвращается к состоянию " *не выполняется* ". Это происходит в ситуациях нехватки памяти или в случае, если пользователь вручную завершает работу приложения.

С появлением поддержки многозадачной работы iOS редко завершает работу бездействующих приложений, а процессы *приостанавливаются* в памяти. Поддержание активности процесса приложения гарантирует быстрое запуск приложения при следующем его открытии пользователем. Это также означает, что приложения могут свободно перемещаться из *приостановленного* состояния обратно в *фоновое* состояние без рисования на системных ресурсах. iOS 7 использует эту функцию с новыми API, которые позволяют приложениям приостанавливать фоновые задачи при переходе устройства в спящий режим, обновлять содержимое непосредственно из фона без вмешательства пользователя и многое другое. Мы рассмотрим новые интерфейсы API в [методах фонового программирования iOS](~/ios/app-fundamentals/backgrounding/ios-backgrounding-techniques/index.md).

## <a name="application-lifecycle-methods"></a>Методы жизненного цикла приложения

При изменении состояния приложения iOS уведомляет приложение через методы событий в `AppDelegate` классе:

- `OnActivated`— Вызывается при первом запуске приложения и каждый раз, когда приложение возвращается на передний план. Это место для размещения кода, который должен выполняться при каждом открытии приложения.
- `OnResignActivation`— Если пользователь получает такое прерывание, как текст или телефонный вызов, этот метод вызывается, и приложение временно деактивируется. Если пользователь принимает телефонный звонок, приложение будет отправлено на задний план.
- `DidEnterBackground`— Вызывается, когда приложение переходит в фоновое состояние, этот метод предоставляет приложению примерно пять секунд для подготовки к возможному завершению. Используйте это время для сохранения данных и задач пользователя, а также для удаления конфиденциальной информации с экрана.
- `WillEnterForeground`— Когда пользователь возвращается в фоновое или приостановленное приложение и запускает его на переднем плане, `WillEnterForeground` вызывается метод. Это время для подготовки приложения к переходу на передний план путем повтора сохранения любого состояния, сохраненного во время `DidEnterBackground` .  `OnActivated`будет вызываться сразу после завершения этого метода.
- `WillTerminate`— Приложение завершает работу, и его процесс уничтожается. Этот метод вызывается только в том случае, если многозадачность недоступна на устройстве или в версии ОС, если память мала или если пользователь вручную завершает фоновое приложение. Обратите внимание, что приостановленные приложения, которые завершаются, не будут вызывать `WillTerminate` .

На следующей схеме показано, как состояния приложения и методы жизненного цикла соответствуют друг другу:

 [![На этой схеме показано, как состояния приложения и методы жизненного цикла связаны друг с другом](introduction-to-backgrounding-in-ios-images/image2.png)](introduction-to-backgrounding-in-ios-images/image2.png#lightbox)

## <a name="user-controls-for-backgrounding-in-ios"></a>Пользовательские элементы управления для фонового ввода в iOS

в iOS 7 появились некоторые функции для предоставления пользователям возможности контролировать фоновое состояние приложения. Как переключатель приложений, так и параметр фонового обновления приложения влияют на жизненный цикл приложения.

### <a name="app-switcher"></a>Переключатель приложений

Переключатель приложений — важная функция управления, появившаяся в iOS 7. Он запускается путем двойного касания кнопки **Home** и показывает приложения, процессы которых находятся в активном состоянии.

 [![Перемещение между приложениями с помощью переключателя приложений](introduction-to-backgrounding-in-ios-images/app-switcher-.png)](introduction-to-backgrounding-in-ios-images/app-switcher-.png#lightbox)

С помощью переключателя приложений пользователи могут прокручивать снимки всех фоновых и приостановленных приложений. Касание приложения запускает его на переднем плане. Прокрутка вверх удаляет приложение из фона, завершая процесс. В следующем разделе приводится более подробное рассмотрение переключателя приложений в [демонстрации жизненного цикла приложения iOS](~/ios/app-fundamentals/backgrounding/application-lifecycle-demo.md) .

> [!IMPORTANT]
> Переключатель приложения не показывает разницу между фоновыми и приостановленными приложениями.

### <a name="background-app-refresh-settings"></a>Параметры фонового обновления приложения

iOS 7 увеличивает пользовательский контроль над жизненным циклом приложения, позволяя пользователям отказаться от фонового использования приложений, [зарегистрированных для фоновой обработки](~/ios/app-fundamentals/backgrounding/ios-backgrounding-techniques/registering-applications-to-run-in-background.md). *Это не мешает приложениям выполнять фоновые задачи*.

Пользователи могут изменить этот параметр, перейдя к **параметрам > общие > фоновое обновление приложения** и изменение привилегий фонового режима для выбранного приложения. Если параметр фоновое обновление приложения имеет значение OFF, приложение будет приостановлено сразу после ввода фона и не сможет выполнять фоновую обработку:

 [![Параметры фонового обновления приложения](introduction-to-backgrounding-in-ios-images/settings-.png)](introduction-to-backgrounding-in-ios-images/settings-.png#lightbox)

Разработчики могут проверить состояние приложения фонового обновления с помощью `BackgroundRefreshStatus` API. Пример см. в подразделе [Проверка параметров фонового обновления](https://github.com/xamarin/recipes/tree/master/Recipes/ios/multitasking/check_background_refresh_setting).

Мы рассмотрели основы жизненного цикла приложения iOS и функции для управления жизненным циклом приложения. Теперь давайте посмотрим на жизненный цикл приложения iOS в действии.
