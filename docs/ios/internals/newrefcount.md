---
title: Новая ссылка, подсчет системы в Xamarin.iOS
description: Этот документ описывает расширенные ссылку Xamarin, инвентаризации системы, по умолчанию включен во всех приложениях Xamarin.iOS.
ms.prod: xamarin
ms.assetid: 0221ED8C-5382-4C1C-B182-6C3F3AA47DB1
ms.technology: xamarin-ios
author: lobrien
ms.author: laobri
ms.openlocfilehash: 3a40605dd58cac0bcf14c156ecf65aa3fec52bc6
ms.sourcegitcommit: e268fd44422d0bbc7c944a678e2cc633a0493122
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2018
ms.locfileid: "50103391"
---
# <a name="new-reference-counting-system-in-xamarinios"></a>Новая ссылка, подсчет системы в Xamarin.iOS

Xamarin.iOS 9.2.1 появился улучшенные подсчета системы и всех приложений по умолчанию ссылок. Его можно использовать для устранения многих проблем с памятью, которые было сложно для отслеживания и исправления в более ранних версиях Xamarin.iOS.

## <a name="enabling-the-new-reference-counting-system"></a>Включение новых подсчета системы ссылок

По состоянию на Xamarin 9.2.1 новый ref, подсчет системы включено **все** приложений по умолчанию.

Если вы разрабатываете приложение, можно проверить CSPROJ-файл, чтобы убедиться, что все вхождения `MtouchUseRefCounting` присваивается `true`, например ниже:

```xml
<MtouchUseRefCounting>true</MtouchUseRefCounting>
```

Если он становится равным `false` приложения не будет использовать новые средства.

### <a name="using-older-versions-of-xamarin"></a>В более старых версиях Xamarin

Xamarin.iOS 7.2.1 и выше возможности расширенного просмотра наш новый подсчет системы ссылок.

**Классический API:**

Чтобы включить этот новый Справочник по инвентаризации систему, установите флажок **использовать расширение подсчета ссылок** флажок см. в **Дополнительно** вкладке проекта **параметрах сборки iOS** , как показано ниже: 

[![](newrefcount-images/image1.png "Включить новую систему подсчета ссылок")](newrefcount-images/image1.png#lightbox)

Обратите внимание, что эти параметры будут удалены в более новых версиях Visual Studio для Mac.

 **[Unified API:](~/cross-platform/macios/unified/index.md)**

 Новый расширение подсчета ссылок является обязательным для на единый API и должен быть включен по умолчанию. Более старых версиях интегрированной среды разработки не возможно, это значение автоматически, и возможно, установите флажок с его самостоятельно.

    
> [!IMPORTANT]
> Более ранняя версия этой функции с момента вокруг MonoTouch 5.2 но было доступно только для **sgen** как экспериментальная предварительной версии. Эта версия новых инструментов, также доступна для **Boehm** сборщик мусора.


Традиционно были два вида объектов, которыми управляет Xamarin.iOS: те, которые были просто оболочкой собственный объект (одноранговые объекты) и те, которые расширенных или добавлены новые функциональные возможности (производных объектов) — обычно сохраняя состояние дополнительной памяти. Ранее было возможно, что нам удалось дополнить объект однорангового узла с состоянием (например, добавив C# обработчик событий), но, что мы позволим объект без ссылок и затем собранные. Это может привести к сбою позже (например если среде выполнения Objective-c. обратный вызов в управляемый объект).

Новая система автоматически обновляет одноранговые объекты в объекты, которые управляются средой выполнения, когда они хранят любую дополнительную информацию.

Это решает различных сбоев, произошедших в ситуациях, например такая:

```csharp
class MyTableSource : UITableViewSource {
   public override UITableViewCell GetCell (UITableView tableView, NSIndexPath indexPath) {
        var cell = tableView.DequeueReusableCell ("myId");
        if (cell != null)
                return cell;

        cell = new UITableViewCell (UITableViewCellStyle.Default, "myId");
        var txt = new UITextField ();
        txt.TouchDown += delegate { Console.WriteLine ("...."); };
        cell.ContentView.AddSubview (txt);
        return cell;
   }
}
```

Без расширение reference число завершался аварийно этот код, так как `cell` становится собираемой и поэтому его `TouchDown` делегат, который будет преобразована в указатель несвязанные.

Расширение reference число гарантирует управляемый объект остается активным и предотвращает его коллекции предоставляемые собственный объект хранится в машинном коде.

Новая система также избавляет от необходимости *большинство* закрытого резервного поля, используемые в привязках — это метод по умолчанию для сохранения экземпляра. Управляемых Компоновщик может удалить их все *ненужные* расширение подсчета поля из приложений с помощью новой ссылки.

Это означает, что экземпляры каждого управляемого объекта потреблять меньше памяти. Решает родственной проблемой, где некоторые резервные поля будут содержать ссылки, которые больше не нужны средой выполнения Objective-C, что затрудняет для освобождения памяти.
