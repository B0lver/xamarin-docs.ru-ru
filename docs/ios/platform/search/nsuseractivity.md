---
title: Поиск с помощью NSUserActivity в Xamarin.iOS
description: В этом документе описывается, как индексировать NSUserActivity, делая его доступным для поиска в центре внимания и Safari. В этом примере рассматривается реакция на выбор NSUserActivity в результатах поиска.
ms.prod: xamarin
ms.assetid: 0B28B284-C7C9-4C0D-A782-D471FBBC4CAE
ms.technology: xamarin-ios
author: lobrien
ms.author: laobri
ms.date: 03/20/2017
ms.openlocfilehash: b853bd3bc55a2d4cb613a9f0079aebae9f57027b
ms.sourcegitcommit: 4b402d1c508fa84e4fc3171a6e43b811323948fc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61357071"
---
# <a name="search-with-nsuseractivity-in-xamarinios"></a>Поиск с помощью NSUserActivity в Xamarin.iOS

`NSUserActivity` появился в iOS 8 и используется для предоставления данных для обработки.
Он позволяет создавать действия в определенной части вашего приложения, который затем может передаваться из системы на другой экземпляр вашему приложению на это устройство iOS. Получающим устройством, затем можно продолжить работу на предыдущее устройство, комплектация вправо, там, где остановились пользователь действия. Дополнительные сведения об использовании перемещение вручную см. в разделе наших [введение переходной](~/ios/platform/handoff.md) документации.

Знакомы с iOS 9, `NSUserActivity` можно индексировать (открыто и закрыто) и с которой был произведен в поиске Spotlight и Safari. Помечая `NSUserActivity` как индексируемые метаданные для поиска и добавления действия могут быть перечислены в результатах поиска на устройстве iOS.

[![](nsuseractivity-images/apphistory01.png "Обзор журнала приложения")](nsuseractivity-images/apphistory01.png#lightbox)

Если пользователь выбирает результат поиска, который принадлежит действие из приложения, приложение будет запущено, и описаны действия `NSUserActivity` будет перезапущена и отображаются для пользователя.

Следующие свойства `NSUserActivity` используются для поддержки поиска приложения:

 - `EligibleForHandoff` — Если `true`, это действие может использоваться в операции передачи.
 - `EligibleForSearch` — Если `true`, это действие будет добавлен к индексу на устройстве и представлены в результатах поиска.
 - `EligibleForPublicIndexing` — Если `true`, это действие будет добавить индекс на основе облака компании Apple и предоставляемые пользователям (с помощью функции поиска), которые еще не установили приложение на своем устройстве iOS. См. в разделе [открытый индексирование поиска](#public-search-indexing) Дополнительные сведения в приведенном ниже разделе.
 - `Title` — С заголовком для действия и отображается в результатах поиска. Пользователи также могут искать текст заголовка, сам.
 - `Keywords` — Представляет собой массив строк, используемых для описания действия, индексировать и сделать доступным для поиска конечным пользователем.
 - `ContentAttributeSet` — `CSSearchableItemAttributeSet` Дальнейшего действия подробно описаны и предоставляют форматированное содержимое в результатах поиска.
 - `ExpirationDate` — Если требуется, чтобы действие будет отображаться только для данной даты, можно указать здесь эту дату.
 - `WebpageURL` — Если действия можно просмотреть в Интернете, или если приложение поддерживает прямых ссылок Safari, можно задать ссылку на веб-странице.

## <a name="nsuseractivity-quickstart"></a>Краткое руководство NSUserActivity

Выполните эти инструкции для реализации доступным для поиска `NSUserActivity` в приложении:

- [Создание действия идентификаторы типа](#creatingtypeid)
- [Создание действия](#createactivity)
- [Реагирование на действия](#respondactivity)
- [Индексирование открытый поиска](#indexing)

Существуют некоторые [дополнительные преимущества](#benefits) с помощью `NSUserActivity` чтобы сделать содержимое доступным для поиска.

<a name="creatingtypeid" />

## <a name="creating-activity-type-identifiers"></a>Создание действия идентификаторы типа

Перед созданием действий поиска, вам потребуется создать _идентификатор типа действия_ для его идентификации. Идентификатор типа действия — это короткие строки, добавленной `NSUserActivityTypes` массив приложения **Info.plist** файл, используемый для идентификации данного типа действий пользователя. Будет существовать одна запись в массиве для каждого действия, которое приложение поддерживает и предоставляет для поиска приложения. 

Apple предлагает нотации обратного DNS-стиля для идентификатора типа действия для предотвращения конфликтов. Например: `com.company-name.appname.activity` для конкретного приложения на основе действий или `com.company-name.activity` для действий, которые могут выполняться для нескольких приложений.

Идентификатор типа действия используется при создании `NSUserActivity` экземпляр для определения типа действия. При действие продолжается в результате пользователь, коснувшись результатов поиска, используется тип действия (а также идентификатор приложения Team) определяет, какое приложение для запуска, чтобы продолжить действие.

Чтобы создать необходимые идентификаторы типа действия для поддержки этого поведения, изменение **Info.plist** файл и переключитесь на **источника** представления. Добавление `NSUserActivityTypes` ключа и создавать идентификаторы в следующем формате:

[![](nsuseractivity-images/type01.png "Ключ NSUserActivityTypes и необходимые идентификаторы в редакторе plist")](nsuseractivity-images/type01.png#lightbox)

В приведенном выше примере мы создали один новый идентификатор типа действия для действия поиска (`com.xamarin.platform`). При создании собственных приложений, замените содержимое файла `NSUserActivityTypes` массива с идентификаторами тип действия, относящиеся к действия приложения поддерживает.

<a name="createactivity" />

## <a name="creating-an-activity"></a>Создание действия

Ниже приведен пример создания действия для поиска размещенных индекса на устройстве:

```csharp
// Create App Search Activity
var activity = new NSUserActivity ("com.xamarin.platform");

// Define details
var info = new NSMutableDictionary ();
info.Add(new NSString("link"),new NSString("http://xamarin.com/platform"));

// Populate Activity
activity.Title = "The Xamarin Platform";
activity.UserInfo = info;

// Add App Search ability
activity.EligibleForSearch = true;
activity.BecomeCurrent();
```

Нам удалось Добавление дополнительных сведений, задав `ContentAttributeSet` свойство наших `NSUserActivity` следующим образом:

[![](nsuseractivity-images/apphistory02.png "Обзор поиска подробностей сложения")](nsuseractivity-images/apphistory02.png#lightbox)

С помощью `ContentAttributeSet` созданием результаты поиска с широкими возможностями, побудить конечному пользователю взаимодействовать с ними.

<a name="respondactivity" />

## <a name="responding-to-an-activity"></a>Реагирование на действия

Реагировать на пользователя, коснувшись результат поиска (`NSUserActivity`) для нашего приложения изменить **AppDelegate.cs** файл и переопределить `ContinueUserActivity` метод. Пример:

```csharp
public override bool ContinueUserActivity (UIApplication application, NSUserActivity userActivity, UIApplicationRestorationHandler completionHandler)
{

    // Take action based on the activity type
    switch (userActivity.ActivityType) {
    case "com.xamarin.platform":
        // Restore the state of the app here...
        break;
    }

    return true;
}
```

Обратите внимание, что это же переопределение метода используются для ответа на запросы перемещение вручную. Теперь при нажатии на ссылку из нашего приложения, в результатах поиска Spotlight, наше приложение будет выведен на передний план (или запуска, если еще не установлен) и будет отображаться содержимое, навигации или компонента, представленного этой ссылке:

[![](nsuseractivity-images/apphistory03.png "Восстановить предыдущее состояние из поиска")](nsuseractivity-images/apphistory03.png#lightbox)

<a name="indexing" />

## <a name="public-search-indexing"></a>Индексирование открытый поиска

Как было показано выше, облегчает позволяют осуществлять поиск содержимого приложения и функции, которые пользователь уже обнаруживается и используется на это устройство iOS с помощью iOS 9. При использовании общедоступного индексирования iOS 9 предоставляет способ для пользователей, кто еще не обнаруженных содержимое или функции еще (или, еще не установили приложение) для получения этих результатов в их поиске слишком.

Открытый индексирования работает следующим образом:

1. При создании действия для приложения можно пометить ее как общедоступную.
2. Открытый действия отправлен в Apple и индексируются в облаке.
3. Дополнительные пользователям взаимодействовать с приложением на устройстве и использовать определенные возможности или содержимое, представленное с помощью действия, возрастанием ранг.
4. Популярные открытый результаты будут доступны другим пользователям, даже если они не имеют установленное приложение.
5. Эти открытый результаты будут отображаться в поиске Spotlight и Safari (если действие содержит URL-адрес).

Мы может занять закрытый поиска действия, которое мы создали выше и разверните его должен быть общедоступным:

```csharp
// Create App Search Activity
var activity = new NSUserActivity ("com.xamarin.platform");

// Define details
var info = new NSMutableDictionary ();
info.Add(new NSString("link"),new NSString("http://xamarin.com/platform"));

// Populate Activity
activity.Title = "The Xamarin Platform";
activity.UserInfo = info;

// Add App Search ability
activity.EligibleForSearch = true;
activity.EligibleForPublicIndexing = true;
activity.BecomeCurrent();
```

Только потому, что действие задало для индексирования общедоступный задав `EligibleForPublicIndexing = true`, это не значит, что оно будет автоматически добавляться к индексу общедоступном облаке компании Apple. Сначала должны быть выполнены следующие условия:

1. Он должен отображаться в результатах поиска и выбрать несколько пользователей. Результаты остаются личными, пока не достигается пороговое значение активности службы взаимодействия.
2. Подготовка приложений предотвращает все пользовательские данные индексируются и общедоступными.

<a name="benefits" />

## <a name="additional-benefits"></a>Дополнительные преимущества

Принимая приложения поиска с помощью `NSUserActivity` в приложении, вы получаете следующие возможности:

- **Переадресуемое** — так как приложение поиска предоставление содержимого, навигации и/или функции с помощью того же механизма, как перемещение вручную (`NSUserActivity`), можно легко разрешить пользователям приложения для запуска действия на одном устройстве и продолжается на другой.
- **Siri предложения** -а также стандартные рекомендации, которые обычно делает предложения Siri, actives из вашего приложения могут быть автоматически предложены.
- **Смарт-напоминания Siri** -пользователи будут иметь возможность задавать Siri Напомните им о действиях из вашего приложения.



## <a name="related-links"></a>Связанные ссылки

- [Примеры iOS 9](https://developer.xamarin.com/samples/ios/iOS9/)
- [iOS 9 для разработчиков](https://developer.apple.com/ios/pre-release/)
- [iOS 9.0](https://developer.apple.com/library/prerelease/ios/releasenotes/General/WhatsNewIniOS/Articles/iOS9.html)
- [Руководство по программированию приложения поиска](https://developer.apple.com/library/prerelease/ios/documentation/General/Conceptual/AppSearch/index.html#//apple_ref/doc/uid/TP40016308)
- [Запись блога о & бразец](https://blog.xamarin.com/improve-discoverability-with-search-in-ios-9/)
