---
title: Широкий цвет в Xamarin. iOS
description: В этом документе рассматривается широкий цвет и его использование в приложении Xamarin. iOS или Xamarin. Mac.
ms.prod: xamarin
ms.assetid: 576E978A-F182-489A-83E4-D8CDC6890B24
ms.technology: xamarin-ios
author: davidortinau
ms.author: daortin
ms.date: 03/17/2017
ms.openlocfilehash: e7240a271de1f0199c2c9fc045f5c95745eb98c5
ms.sourcegitcommit: 2fbe4932a319af4ebc829f65eb1fb1816ba305d3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2019
ms.locfileid: "73031250"
---
# <a name="wide-color-in-xamarinios"></a>Широкий цвет в Xamarin. iOS

_В этой статье рассматривается широкий спектр и способы его использования в приложении Xamarin. iOS или Xamarin. Mac._

iOS 10 и macOS Sierra расширяют поддержку для форматов пикселей расширенного диапазона и цветовых пространств с широкими охватами по всей системе, включая такие платформы, как основные графические объекты, основные образы, металлы и Авфаундатион. Поддержка устройств с широкими цветами больше облегчило, предоставляя такое поведение во всем стеке графики.

## <a name="asset-catalogs"></a>Каталоги активов

### <a name="supporting-wide-color-with-asset-catalogs"></a>Поддержка расширенного цвета с помощью каталогов активов

В iOS 10 и macOS Sierra компания Apple расширила каталоги активов, используемые для включения и категоризации содержимого статического изображения в пакете приложения для поддержки расширенного цвета.

Использование каталогов активов предоставляет приложению следующие преимущества:

- Они предоставляют оптимальный вариант развертывания для статических ресурсов изображения.
- Они поддерживают автоматическое исправление цвета.
- Они поддерживают автоматическую оптимизацию формата пикселей.
- Они поддерживают создание срезов приложений и тонких приложений, что гарантирует, что только связанное с ним содержимое будет доставлено на устройство конечного пользователя.

Компания Apple внесла следующие улучшения в каталоги активов для поддержки широкого спектра цветов:

- Они поддерживают 16-битное содержимое (на каждый цветовой канал).
- Они поддерживают каталогизацию содержимого по отображаемому охвату. Содержимое можно пометить как для цветовых диапазонов sRGB или дисплея P3.

У разработчика есть три варианта поддержки широкого спектра содержимого в своих приложениях:

1. **Ничего не делать** , поскольку содержимое с широкими цветами следует использовать только в тех ситуациях, когда приложение должно отображать яркие цвета (где они улучшат работу пользователя), содержимое за пределами этого требования должно остаться без изменений. Он будет по прежнему отображаться правильно во всех случаях оборудования.
2. **Обновление существующего содержимого для показа P3. для** этого необходимо, чтобы разработчик заменил существующее содержимое образа в каталоге активов новым обновленным файлом в формате P3 и пометить его как таковое в редакторе ресурсов. Во время сборки из этих ресурсов будет сформирован производный образ sRGB.
3. **Предоставление оптимизированного содержимого ресурса** . в этом случае разработчик предоставит 8-разрядное решение sRGB и 16-разрядный дисплей с глубиной изображения для каждого образа в каталоге активов (правильно помеченный в редакторе ресурсов).

### <a name="asset-catalog-deployment"></a>Развертывание каталога активов

Если разработчик отправит приложение в магазин приложений с каталогами активов, включающими в себя содержимое с широкими цветами, то произойдет следующее:

- При развертывании приложения для конечного пользователя Фрагментирование приложения обеспечит доставку на устройство пользователя только соответствующего варианта содержимого.
- На устройстве, не поддерживающем широкий цвет, нет никакой стоимости полезных данных для включения содержимого с широким цветом, так как оно никогда не поставляется на устройство.
- `NSImage` в macOS Sierra (и более поздних версиях) автоматически выберет лучшее представление содержимого для дисплея оборудования.
- Отображаемое содержимое будет обновляться автоматически при изменении характеристик аппаратного отображения устройств.

### <a name="asset-catalog-storage"></a>Хранилище каталога активов

Хранилище каталога активов имеет следующие свойства и последствия для приложения:

- Во время сборки компания Apple пытается оптимизировать хранение содержимого изображения с помощью высококачественных преобразований изображений.
- 16-разряды используются для каждого цветового канала для широкого содержимого цвета.
- Сжатие изображений, зависящих от содержимого, используется для уменьшения размера содержимого, доступного для доставки. Для дальнейшей оптимизации размеров содержимого добавлены новые возможности сжатия с потерей данных.

## <a name="rendering-off-screen-images-in-app"></a>Отрисовка экранных изображений в приложении

В зависимости от типа создаваемого приложения он может разрешить пользователю включать содержимое изображений, собранных из Интернета, или создавать содержимое изображений непосредственно внутри приложения (например, для векторного приложения рисования).

В обоих случаях приложение может отображать необходимые изображения вне экрана в широком цвете с помощью расширенных функций, добавленных в iOS и macOS.

### <a name="drawing-wide-color-in-ios"></a>Широкий цвет рисования в iOS

Прежде чем обсудить, как правильно нарисовать изображение с широкими цветами в iOS 10, Взгляните на следующий распространенный код рисования iOS:

```csharp
public UIImage DrawWideColorImage ()
{
    var size = new CGSize (250, 250);
    UIGraphics.BeginImageContext (size);

    ...

    UIGraphics.EndImageContext ();
    return image = UIGraphics.GetImageFromCurrentImageContext ();
    }
```

Существуют проблемы со стандартным кодом, который необходимо устранить, _прежде чем_ его можно будет использовать для рисования широкого цветового изображения. Метод `UIGraphics.BeginImageContext (size)`, используемый для запуска рисования изображений iOS, имеет следующие ограничения.

- Он не может создавать контексты изображений с более чем 8 битами на цветовой канал.
- Он не может представлять цвета в цветовом пространстве расширенного диапазона sRGB.
- Он не имеет возможности предоставлять интерфейс для создания контекстов в цветовых пространствах, отличных от sRGB, из-за вызова подпрограмм нижнего уровня C в фоновом режиме.

Чтобы обрабатывались эти ограничения и нарисовать изображение с широкими цветами в iOS 10, используйте следующий код:

```csharp
public UIImage DrawWideColorImage ()
{
    var size = new CGSize (250, 250);
    var render = new UIGraphicsImageRenderer (size);

    var image = render.CreateImage ((UIGraphicsImageRendererContext context) => {
        var bounds = context.Format.Bounds;
        CGRect slice;
        CGRect remainder;
        bounds.Divide (bounds.Width / 2, CGRectEdge.MinXEdge, out slice, out remainder);

        var redP3 = UIColor.FromDisplayP3 (1.0F, 0.0F, 0.0F, 1.0F);
        redP3.SetColor ();
        context.FillRect (slice);

        var redRGB = UIColor.Red;
        redRGB.SetColor ();
        context.FillRect (remainder);
    });

    // Return results
    return image;
}
```

Новый класс `UIGraphicsImageRenderer` создает новый контекст изображения, который способен обрабатывать цветовое пространство с расширенным диапазоном sRGB и имеет следующие возможности.

- По умолчанию он полностью управляет цветом.
- По умолчанию он поддерживает цветовое пространство с расширенным диапазоном sRGB.
- Это интеллектуальное решение определяет, должна ли она отображаться в пространстве цветов sRGB или расширенном диапазоне в зависимости от возможностей устройства iOS, на котором выполняется приложение.
- Он полностью и автоматически управляет временем существования контекста образа (`CGContext`), поэтому разработчику не нужно беспокоиться о вызове команд Begin и End.
- Он совместим с методом `UIGraphics.GetCurrentContext()`.

Метод `CreateImage` класса `UIGraphicsImageRenderer` вызывается для создания изображения с широким цветом и передачей обработчика завершения с контекстом изображения для рисования. Все рисование выполняется внутри этого обработчика завершения следующим образом:

- Метод `UIColor.FromDisplayP3` создает новый полностью насыщенный красный цвет в широких цветовых пространствах и используется для отрисовки первой половины прямоугольника. 
- Вторая половина прямоугольника рисуется в нормальном для сравнения красном цвете sRGB.

### <a name="drawing-wide-color-in-macos"></a>Широкая цветовая прорисовка в macOS

Класс `NSImage` был расширен в macOS Sierra для поддержки рисования изображений с широкими цветами. Пример:

```csharp
var size = CGSize(250,250);
var wideColorImage = new NSImage(size, false, (drawRect) =>{
    var rects = drawRect.Divide(drawRect.Size.Width/2,CGRect.MinXEdge);

    var color = new NSColor(1.0, 0.0, 0.0, 1.0).Set();
    var path = new NSBezierPath(rects.Slice).Fill();

    color = new NSColor(1.0, 0.0, 0.0, 1.0).Set();
    path = new NSBezierPath(rects.Remainder).Fill();

    // Return modified
    return true;
});
```

## <a name="rendering-on-screen-images-in-app"></a>Подготовка изображений на экране в приложении

Для отображения изображений в широких цветах на экране этот процесс работает так же, как и для macOS и iOS, представленного выше.

### <a name="rendering-on-screen-in-ios"></a>Отрисовка на экране в iOS

Когда приложение должно визуализировать изображение в широком цвете на экране в iOS, переопределите метод `Draw` `UIView` по своему мнению как обычно. Пример:

```csharp
using System;
using UIKit;
using CoreGraphics;

namespace MonkeyTalk
{
    public class MonkeyView : UIView
    {
        public MonkeyView ()
        {
        }

        public override void Draw (CGRect rect)
        {
            base.Draw (rect);

            // Draw the image to screen
        ...
        }
    }
}
```

Так как iOS 10 работает с классом `UIGraphicsImageRenderer`, показанным выше, он определяет, должен ли он отображаться в цветовом пространстве sRGB или расширенном диапазоне sRGB в зависимости от возможностей устройства iOS, на котором выполняется приложение при вызове метода `Draw`. Кроме того, `UIImageView` был под управлением цветом, так как iOS 9,3.

Если приложению необходимо узнать, как выполняется отрисовка `UIView` или `UIViewController`, он может проверить новое свойство `DisplayGamut` класса `UITraitCollection`. Это значение будет `UIDisplayGamut` перечисление следующих элементов:

- –
- SRGB
- Не указан

Если приложение хочет контролировать, какое цветовое пространство используется для рисования изображения, оно может использовать новое свойство `ContentsFormat` `CALayer` для указания требуемого цветового пространства. Это значение может быть `CAContentsFormat` перечисление следующих элементов:

- Gray8Uint
- Rgba16Float
- Rgba8Uint

### <a name="rendering-on-screen-in-macos"></a>Отрисовка на экране в macOS

Когда приложение должно визуализировать изображение в широком цвете на экране в macOS, переопределите метод `DrawRect` `NSView`, как обычно. Пример:

```csharp
using System;
using AppKit;
using CoreGraphics;
using CoreAnimation;

namespace MonkeyTalkMac
{
    public class MonkeyView : NSView
    {
        public MonkeyView ()
        {
        }

        public override void DrawRect (CGRect dirtyRect)
        {
            base.DrawRect (dirtyRect);

            // Draw graphics into the view
            ...
        }
    }
}
```

Опять же, он определяет, будет ли он отображаться в цветовых пространствах sRGB или расширенном диапазоне sRGB на основе возможностей оборудования Mac, на котором выполняется приложение при вызове метода `DrawRect`.

Если приложение хочет контролировать, какое цветовое пространство используется для рисования изображения, оно может использовать новое свойство `DepthLimit` класса `NSWindow` для указания требуемого цветового пространства. Это значение может быть `NSWindowDepth` перечисление следующих элементов:

- онехундредтвентеигхтбитргб
- сикстифаурбитргб
- твентифаурбитргб
