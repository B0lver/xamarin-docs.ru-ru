---
title: Широкая цветовая палитра в Xamarin.iOS
description: В этом документе рассматриваются широкая цветовая палитра и как он может использоваться в приложении Xamarin.iOS и Xamarin.Mac.
ms.prod: xamarin
ms.assetid: 576E978A-F182-489A-83E4-D8CDC6890B24
ms.technology: xamarin-ios
author: lobrien
ms.author: laobri
ms.date: 03/17/2017
ms.openlocfilehash: 523aa1a97e1c536b5afbdb66c52f605382fa338d
ms.sourcegitcommit: a153623a69b5cb125f672df8007838afa32e9edf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/20/2019
ms.locfileid: "67268804"
---
# <a name="wide-color-in-xamarinios"></a>Широкая цветовая палитра в Xamarin.iOS

_В этой статье рассматриваются широкая цветовая палитра и как он может использоваться в приложении Xamarin.iOS и Xamarin.Mac._

iOS 10 и macOS Sierra улучшает поддержку форматы пикселей расширенный диапазон и широким пробелы во всей системе, включая платформы, такие как двухмерной графики, образ основных компонентов, исходного состояния системы и AVFoundation. Поддержка устройств с дисплеями широкая цветовая палитра дальнейшей менее жесткими, предоставляя это поведение во всем стеке всей графики.

## <a name="asset-catalogs"></a>Каталоги активов

### <a name="supporting-wide-color-with-asset-catalogs"></a>Поддержка широкая цветовая палитра с каталоги активов

В iOS 10 и macOS Sierra Apple был расширен каталоги активов используются для включения и классификации содержимого статическое изображение в пакет приложения для поддержки широкая цветовая палитра.

С помощью каталоги активов обеспечивает следующие преимущества для приложения:

- Они обеспечивают наилучший вариант развертывания для средств статическое изображение.
- Они поддерживают автоматической цветовой коррекции.
- Они поддерживают автоматическое пикселей формат оптимизации.
- Они поддерживают приложения срезов и Thinning приложения, который гарантирует, что только содержимое, которое является соответствующие get доставлены на устройство пользователя.

Широкая цветовая палитра поддержки Apple внес следующие улучшения в каталоги активов:

- Они поддерживают 16-разрядное (для каждого цветового канала) исходного содержимого.
- Они поддерживают каталогизации содержимое, отображаемое цветовой гаммы. Содержимое можно пометить как sRGB или охваты Display P3.

Разработчик имеет три варианта для поддержки широкая цветовая палитра содержимое в своих приложениях:

1. **Ничего не делать** -так, как содержимое широкая цветовая палитра следует использовать только в ситуациях, когда приложению необходимо отобразить яркие цвета (где они будут повысить удобство работы пользователей), как следует оставить содержимое за пределами этого требования-является. Она будет продолжать отрисовываться неправильно во всех ситуациях оборудования.
2. **Обновление существующего содержимого до Display P3** -это требует, чтобы разработчик заменить существующее содержимое образа в их каталог активов новый обновленный файл в формате P3 и пометить его как таковой в редакторе ресурсов. Во время сборки класс, производный от образа sRGB будут созданы из этих ресурсов.
3. **Предоставляют оптимизированные средства содержимого** -в этом случае разработчик будет предоставить 8-разрядное sRGB и Display P3 концепции 16-разрядное каждого изображения в каталоге ресурсов (должным образом с тегом в редакторе ресурсов).

### <a name="asset-catalog-deployment"></a>Ресурс каталога развертывания

Когда разработчик отправляет приложению Store приложения с каталоги активов, включить содержимое образа широкая цветовая палитра будет произойти следующее:

- Когда приложение развертывается для конечного пользователя, приложение Фрагментирование обеспечит доставлялось только соответствующий вариант содержимого на устройстве пользователя.
- На устройстве, не поддерживают широкая цветовая палитра существует плата не взимается полезных данных для включения содержимого широкая цветовая палитра, как никогда не отправляется на устройство.
- `NSImage` в macOS Sierra (и более поздней версии) автоматически выберет лучший содержимого представление для отображения оборудования.
- Содержимое, отображаемое, автоматически обновляются при или оборудования устройства отображения, изменения характеристики.

### <a name="asset-catalog-storage"></a>Хранилище каталога активов

Хранилище каталога активов имеет следующие свойства и ограничения в отношении приложения:

- Во время сборки Apple пытается оптимизировать хранение образа содержимого через преобразование изображений высокого качества.
- 16-бит используются на канал цвета для содержимого широкая цветовая палитра.
- Сжатие содержимого зависимые изображений используется снизить конечного результата размеры содержимого. Для дальнейшей оптимизации размеров содержимого были добавлены новые сжатия «с потерей данных».

## <a name="rendering-off-screen-images-in-app"></a>Подготовка к просмотру изображения вне экрана в приложении

В зависимости от типа создаваемого приложения, он может предоставить пользователю для включения содержимого образа, они были собраны из Интернета или создать образ содержимое непосредственно внутри приложения (например, векторного рисунка приложения, например).

В обоих случаях приложение может отображать необходимые изображения вне экрана в широкая цветовая палитра, используя расширенные функции, добавленные для iOS и macOS.

### <a name="drawing-wide-color-in-ios"></a>Широкая цветовая палитра рисование в iOS

Прежде чем обсуждать как правильно нарисовать изображение широкая цветовая палитра в iOS 10, взгляните на следующий общий код рисования iOS:

```csharp
public UIImage DrawWideColorImage ()
{
    var size = new CGSize (250, 250);
    UIGraphics.BeginImageContext (size);

    ...

    UIGraphics.EndImageContext ();
    return image = UIGraphics.GetImageFromCurrentImageContext ();
    }
```

Существуют проблемы с стандартный код, который будет необходимо решить _перед_ может использоваться для рисования изображения широкая цветовая палитра. `UIGraphics.BeginImageContext (size)` Метод, используемый для запуска iOS Рисование изображения имеет следующие ограничения:

- Не удается создать образ контексты с более чем 8 битами на канал цвета.
- Он не может представлять цветов в Extended Range sRGB цветового пространства.
- Он имеет возможность предоставить интерфейс создания контекстов в цветовом пространстве не sRGB из-за низкого уровня C подпрограммы, вызываемой в фоновом режиме.

Чтобы обрабатывать эти ограничения и нарисовать широкая цветовая палитра изображение в iOS 10, вместо этого используйте следующий код:

```csharp
public UIImage DrawWideColorImage ()
{
    var size = new CGSize (250, 250);
    var render = new UIGraphicsImageRenderer (size);

    var image = render.CreateImage ((UIGraphicsImageRendererContext context) => {
        var bounds = context.Format.Bounds;
        CGRect slice;
        CGRect remainder;
        bounds.Divide (bounds.Width / 2, CGRectEdge.MinXEdge, out slice, out remainder);

        var redP3 = UIColor.FromDisplayP3 (1.0F, 0.0F, 0.0F, 1.0F);
        redP3.SetColor ();
        context.FillRect (slice);

        var redRGB = UIColor.Red;
        redRGB.SetColor ();
        context.FillRect (remainder);
    });

    // Return results
    return image;
}
```

Новый `UIGraphicsImageRenderer` класс создает новый контекст образа, который может обрабатывать Extended Range sRGB цветовое пространство, и он обладает следующими функциями:

- Это полностью управляемый по умолчанию цвет.
- Он поддерживает Extended Range sRGB цветового пространства по умолчанию.
- Интеллектуально решает, если он должен отрисовываться соответствии с sRGB и Extended Range sRGB цветовое пространство на основе возможностей устройства iOS под управлением приложения.
- Он полностью и автоматически управляет контекстом изображений (`CGContext`) время существования, так что разработчик не нужно беспокоиться о вызове начинаются и заканчиваются контекстные команды.
- Она стала совместима с `UIGraphics.GetCurrentContext()` метод.

`CreateImage` Метод `UIGraphicsImageRenderer` класса вызывается, чтобы создать образ широкая цветовая палитра и передается с контекстом изображения для рисования в завершающий обработчик. Вся рисунка выполняется внутри этого обработчика завершения следующим образом:

- `UIColor.FromDisplayP3` Метод создает новый других красным цветом в обширном Display P3 цветового пространства и используется для рисования в первой половине прямоугольника. 
- Вторая половина прямоугольника рисуется в обычном sRGB, полностью насыщенными красный цвет для сравнения.

### <a name="drawing-wide-color-in-macos"></a>Широкая цветовая палитра рисование в macOS

`NSImage` Класс была расширена в macOS Sierra для поддержки Рисование изображения широкая цветовая палитра. Пример:

```csharp
var size = CGSize(250,250);
var wideColorImage = new NSImage(size, false, (drawRect) =>{
    var rects = drawRect.Divide(drawRect.Size.Width/2,CGRect.MinXEdge);

    var color = new NSColor(1.0, 0.0, 0.0, 1.0).Set();
    var path = new NSBezierPath(rects.Slice).Fill();

    color = new NSColor(1.0, 0.0, 0.0, 1.0).Set();
    path = new NSBezierPath(rects.Remainder).Fill();

    // Return modified
    return true;
});
```

## <a name="rendering-on-screen-images-in-app"></a>Подготовка к просмотру на экране изображений в приложении

Для подготовки к просмотру широкая цветовая палитра изображения на экране, этот процесс работает аналогично рисованию изображения вне экрана широкая цветовая палитра для macOS и iOS, представленной выше.

### <a name="rendering-on-screen-in-ios"></a>Подготовка к просмотру на экране в iOS

Если приложению необходимо отобразить изображение в расширенный цвет на экране в iOS, переопределяют `Draw` метод `UIView` рассматриваемый как обычно. Пример:

```csharp
using System;
using UIKit;
using CoreGraphics;

namespace MonkeyTalk
{
    public class MonkeyView : UIView
    {
        public MonkeyView ()
        {
        }

        public override void Draw (CGRect rect)
        {
            base.Draw (rect);

            // Draw the image to screen
        ...
        }
    }
}
```

Как и с iOS 10 `UIGraphicsImageRenderer` класс, показанный выше, интеллектуально решает, если он должен обрабатывать в sRGB и Extended Range sRGB цветовое пространство на основе возможностей устройства iOS, о том, когда выполняется приложение `Draw` вызывается метод. Кроме того `UIImageView` цветом, управляемых с момента iOS 9.3.

Если приложение необходимо знать, как рендеринг выполняется на `UIView` или `UIViewController`, можно проверить новый `DisplayGamut` свойство `UITraitCollection` класса. Это значение будет `UIDisplayGamut` перечисления из следующих:

- P3
- SRGB
- Не указан

Если приложение хочет управления цветового пространства, используемого для рисования изображения, можно использовать новый `ContentsFormat` свойство `CALayer` для указания нужного цветового пространства. Это значение может быть `CAContentsFormat` перечисления из следующих:

- Gray8Uint
- Rgba16Float
- Rgba8Uint

### <a name="rendering-on-screen-in-macos"></a>Подготовка к просмотру на экране в macOS

Если приложению необходимо отобразить изображение в расширенный цвет на экране в macOS, переопределяют `DrawRect` метод `NSView` рассматриваемый как обычно. Пример:

```csharp
using System;
using AppKit;
using CoreGraphics;
using CoreAnimation;

namespace MonkeyTalkMac
{
    public class MonkeyView : NSView
    {
        public MonkeyView ()
        {
        }

        public override void DrawRect (CGRect dirtyRect)
        {
            base.DrawRect (dirtyRect);

            // Draw graphics into the view
            ...
        }
    }
}
```

Опять же, он интеллектуально решает, если он должен обрабатывать в sRGB и Extended Range sRGB цветовое пространство, в зависимости от возможностей оборудования Mac, на котором выполняется приложение, о том, когда `DrawRect` вызывается метод.

Если приложение хочет управления цветового пространства, используемого для рисования изображения, можно использовать новый `DepthLimit` свойство `NSWindow` класса, чтобы указать нужный цветового пространства. Это значение может быть `NSWindowDepth` перечисления из следующих:

- OneHundredTwentyEightBitRgb
- SixtyfourBitRgb
- TwentyfourBitRgb
