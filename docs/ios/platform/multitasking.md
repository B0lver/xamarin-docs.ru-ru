---
title: Многозадачность для iPad в Xamarin.iOS
description: iOS 9 поддерживает два приложения, работающие в том же время, через слайд или разделенное представление. Она также поддерживает видео, воспроизведение рисунок в изображение.
ms.prod: xamarin
ms.assetid: 0F2266D7-21FF-404D-A148-0CFDE76B12AA
ms.technology: xamarin-ios
ms.custom: xamu-video
author: lobrien
ms.author: laobri
ms.date: 03/20/2017
ms.openlocfilehash: 888e00fbdbf30b5b2842bc30822a55f57372eb34
ms.sourcegitcommit: 654df48758cea602946644d2175fbdfba59a64f3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2019
ms.locfileid: "67831814"
---
# <a name="multitasking-for-ipad-in-xamarinios"></a>Многозадачность для iPad в Xamarin.iOS

_iOS 9 поддерживает два приложения, работающие в том же время, через слайд или разделенное представление. Она также поддерживает видео, воспроизведение рисунок в изображение._

![](multitasking-images/about02-sml.png "Разделение экрана пример") ![](multitasking-images/about03-sml.png "примере рисунка в изображение")

iOS 9 добавляет поддержку многозадачности для выполнения двух приложений в то же время на оборудовании конкретного iPad. Многозадачность для iPad поддерживает следующие функции:

- [**Слайд через** ](#Slide-Over) -пользователь может временно запуск второго приложения iOS в выдвижными панели (либо на правой или левой части экрана, в зависимости от направления языка), который охватывает примерно 25% основного приложения, выполняемого в данный момент. Проведите пальцем по доступен только на iPad Pro, iPad Air, iPad Air 2, iPad Mini 2, iPad Mini 3 или iPad Mini 4.
- [**Разделенное представление** ](#Split-View) -на оборудовании, поддерживаемых iPad (iPad 2 Air, iPad Mini 4 и iPad только Pro), пользователь может выбрать второе приложение и запустить его side-by-side с выполняющегося приложения в режиме экрана разбиения. Пользователь может управлять процент основной экран, который занимает каждого приложения.
- [**Картинка в картинке** ](#Picture-in-Picture) — для приложений, которые воспроизведения видео-контента, видео, которые теперь могут воспроизводиться в перемещаемой и окна регулируемого размера, расположенном поверх других приложений, выполняющихся на устройстве iOS. Пользователь имеет полный контроль над размер и положение этого окна. Картинка в картинке доступна только на iPad Pro, iPad Air, iPad Air 2, iPad Mini 2, iPad Mini 3 или iPad Mini 4.

Существует несколько вещей, которые следует учитывать при [поддерживающих многозадачность в приложении](#Supporting-Multitasking-in-your-App), в том числе:

- [Размера и ориентации экрана](#Screen-Size-Considerations)
- [Настраиваемая аппаратная сочетания клавиш](#Custom-Hardware-Keyboard-Shortcuts)
- [Управление ресурсами](#Resource-Management-Considerations)

Как разработчик приложения вы также можете [отказаться от многозадачность](#Opting-Out-of-Multitasking), в том числе [отключение воспроизведения видео PIP](#Disabling-PIP-Video-Playback).

В этой статье описываются действия, которые необходимо убедиться, что приложение Xamarin.iOS должно выполняться правильно в многозадачной среде, или как отказаться многозадачности, если это не хорошо подходит для вашего приложения.

> [!VIDEO https://youtube.com/embed/GctYAozoLr8]

**Многозадачность для iPad видео**


<a name="Multitasking-QuickStart" />

## <a name="multitasking-quickstart"></a>Краткое руководство многозадачность

Для поддержки **слайд через** или **разделенное представление** приложения необходимо выполнить следующие действия:

- Будет создаваться iOS 9 (или более поздней).
- Используйте раскадровку для его запуска экрана (и не ресурсы изображений).
- Используйте раскадровку с Автомакет и размеры для его пользовательского интерфейса.
- Поддерживает все 4 iOS устройства ориентации (книжная, ногами Книжная, Альбомная слева и Альбомная справа).

<a name="Multitasking" />

## <a name="about-multitasking-for-ipad"></a>О многозадачность для iPad

iOS 9 предоставляет новые возможности многозадачность для iPad с появлением _слайд через_, _разделенное представление_ (iPad 2 Air, iPad Mini 4 и только iPad Pro) и _картинка в картинке_. Мы рассмотрим более подробно рассмотрим эти функции в следующих разделах.

<a name="Slide-Over" />

### <a name="slide-over"></a>Слайд через

Функция слайд через позволяет пользователю выбрать второе приложение и отображает его на небольших скользящего панель, обеспечивающую быстрое взаимодействие. На панели слайдов через является временным и будет закрыто, пользователь возвращается к работе с основного приложения, еще раз.

[![](multitasking-images/about01.png "На панели слайдов через")](multitasking-images/about01.png#lightbox)

Самое главное — это пользователь решает, какие два приложения будут работать под управлением side-by-side и что разработчик может не контролирует этот процесс. Таким образом существует несколько действий, которые необходимо будет сделать, чтобы убедиться, что приложение Xamarin.iOS работает правильно панели слайдов через:

- **Использовать автоматический макет и размеры** — так, как приложение Xamarin.iOS теперь могут выполняться в נאחהגטזםף боковой панели, вы больше не могут полагаться на устройстве, его размера экрана или его ориентацию макета пользовательского интерфейса. Чтобы правильно масштабировании его интерфейс приложения, необходимо использовать автоматический макет и размеры. Дополнительные сведения см. наш [Знакомство с унифицированным раскадровкам](~/ios/user-interface/storyboards/unified-storyboards.md) документации.
- **Ресурсы эффективно использовать** , так как приложение может теперь быть совместно системы с другой выполняемому приложению, крайне важно, что ваше приложение эффективно использует системные ресурсы. Когда памяти становится разреженным, система будет автоматически завершена, приложение, которое занимает больше всего памяти. См. в разделе Apple [руководство по эффективности энергопотребления для приложений iOS](https://developer.apple.com/library/prerelease/ios/documentation/Performance/Conceptual/EnergyGuide-iOS/index.html#//apple_ref/doc/uid/TP40015243) для получения дополнительных сведений.

Проведите пальцем по доступен только на iPad Pro, iPad Air, iPad Air 2, iPad Mini 2, iPad Mini 3 или iPad Mini 4. Дополнительные сведения о подготовке приложения к слайд по, см. в разделе Apple [внедрение усовершенствования многозадачность для iPad](https://developer.apple.com/library/prerelease/ios/documentation/WindowsViews/Conceptual/AdoptingMultitaskingOniPad/index.html#//apple_ref/doc/uid/TP40015145) документации.

<a name="Split-View" />

### <a name="split-view"></a>Представление с разделением

На оборудовании, поддерживаемых iPad (iPad 2 Air, iPad Mini 4 и iPad только Pro) пользователь может выбрать второе приложение и запустить его side-by-side с выполняющегося приложения в режиме экрана разбиения. Пользователь может управлять процент основной экран, который занимает каждое приложение, перетащив на экране разделитель.

[![](multitasking-images/about02.png "Разделенное представление")](multitasking-images/about02.png#lightbox)

Как и слайд через пользователь решает, какие два приложения будут выполняться side-by-side и снова, разработчик может не контролирует этот процесс. Таким образом разделенное представление отнимает аналогичные у приложения Xamarin.iOS:

- **Использовать автоматический макет и размеры** , так как приложение Xamarin.iOS теперь может выполняться в режиме экрана разбиения в размере указанного пользователя, можно больше не полагаться на устройство, его размера экрана или его ориентацию макета пользовательского интерфейса. Чтобы правильно масштабировании его интерфейс приложения, необходимо использовать автоматический макет и размеры. Дополнительные сведения см. наш [Знакомство с унифицированным раскадровкам](~/ios/user-interface/storyboards/unified-storyboards.md) документации.
- **Ресурсы эффективно использовать** , так как приложение может теперь быть совместно системы с другой выполняемому приложению, крайне важно, что ваше приложение эффективно использует системные ресурсы. Когда памяти становится разреженным, система будет автоматически завершена, приложение, которое занимает больше всего памяти. См. в разделе Apple [руководство по эффективности энергопотребления для приложений iOS](https://developer.apple.com/library/prerelease/ios/documentation/Performance/Conceptual/EnergyGuide-iOS/index.html#//apple_ref/doc/uid/TP40015243) для получения дополнительных сведений.

Дополнительные сведения о подготовке приложения к разделенное представление, см. в разделе Apple [внедрение усовершенствования многозадачность для iPad](https://developer.apple.com/library/prerelease/ios/documentation/WindowsViews/Conceptual/AdoptingMultitaskingOniPad/index.html#//apple_ref/doc/uid/TP40015145) документации.

<a name="Picture-in-Picture" />

### <a name="picture-in-picture"></a>Картинка в картинке

Новый рисунок в изображение функция (также известный как _PIP_) пользователь может посмотреть видео в окне Мелкая "," с плавающей запятой, пользователю можно размещать в любом месте на экране выше другие работающие приложения.

[![](multitasking-images/about03.png "Пример рисунка в плавающем окне рисунка")](multitasking-images/about03.png#lightbox)

Как с слайд через и разделенное представление пользователь имеет полный контроль над просмотреть видеоролик на рисунке в графический режим. Если функция main вашего приложения для просмотра видео, ему понадобится внести некоторые изменения, чтобы правильно работать в режиме PIP. В противном случае изменения не требуются для поддержки PIP.

Для вашего приложения отобразить PIP видео по запросу пользователя, необходимо использовать либо _AVKit_ или _API-интерфейсы Foundation AV_. Платформа проигрывателя мультимедиа были разнесены в iOS 9 и не поддерживает PIP.

Картинка в картинке доступна только на iPad Pro, iPad Air, iPad Air 2, iPad Mini 2, iPad Mini 3 или iPad Mini 4. Дополнительные сведения см. в разделе наших [PictureInPicture пример приложения](https://developer.xamarin.com/samples/ios/iOS9/) и Apple [рисунок в быстром запуске рисунок](https://developer.apple.com/library/prerelease/ios/documentation/WindowsViews/Conceptual/AdoptingMultitaskingOniPad/QuickStartForPictureInPicture.html#//apple_ref/doc/uid/TP40015145-CH14) документации.

<a name="Supporting-Multitasking-in-your-App" />

## <a name="supporting-multitasking-in-your-app"></a>Поддержка многозадачности в приложении

Для любого существующего приложения Xamarin.iOS поддерживающих многозадачность выполняется прозрачный до тех пор, пока приложение уже соответствует руководства по разработке Apple и рекомендации по iOS 8. Это означает, что приложения должны использовать раскадровки Автомакет и размеры для макетов его пользовательский интерфейс (см. в разделе наших [Знакомство с унифицированным раскадровкам](~/ios/user-interface/storyboards/unified-storyboards.md) Дополнительные сведения).

Для этих приложений практически не требуются изменения для поддержки многозадачность и вести себя хорошо внутри него. Если приложение пользовательского интерфейса, был создан с помощью других методов, таких как непосредственно положения и размера элементов пользовательского интерфейса в C# кода или если он зависит от размеров экрана конкретное устройство или ориентации, ему понадобится значительные изменения для поддержки iOS 9 многозадачность правильно.

Для поддержки iOS 9 многозадачность на любое новое приложение Xamarin.iOS, попытку использования раскадровок с Автомакет и размеры всех макетов пользовательского интерфейса приложения и реализовать инструкциям в следующих разделах.

<a name="Screen-Size-Considerations" />

### <a name="screen-size-and-orientation-considerations"></a>Размер экрана и ориентацию рекомендации

До iOS 9 можно создать приложение на конкретное устройство экрана размера и ориентации. Так как приложение можно запустить панели слайдов Out или в режиме разделенное представление, его можно найти сам класс compact или обычной горизонтальный размер выполняются либо на устройстве iPad, независимо от размера ориентации или экрана физического устройства.

[![](multitasking-images/sizeclasses01.png "Размер экрана и ориентацию рекомендации")](multitasking-images/sizeclasses01.png#lightbox)

На iPad полноэкранного приложения имеет регулярных горизонтальные и вертикальные размеры. Все устройства iPhone, но iPhone 6 Plus и iPhone 6s Plus, иметь компактный размер классов в обоих направлениях в любой ориентации. IPhone 6 Plus и iPhone 6s Plus в альбомной ориентации имеют обычный класс размер по горизонтали и Compact вертикальный размер класс (во многом подобно iPad Mini).

На устройствах iPad, поддерживающих слайд через и разделенное представление может получиться следующие комбинации:

| **Ориентация** | **Основное приложение** | **Вторичный приложения** |
|--- |--- |--- |
| **Книжная ориентация** |75% от экрана<br />Compact по горизонтали<br />Регулярные по вертикали|25% от экрана<br />Compact по горизонтали<br />Регулярные по вертикали|
| **Альбомная ориентация** |75% от экрана<br />Регулярные по горизонтали<br />Регулярные по вертикали|25% от экрана<br />Compact по горизонтали<br />Регулярные по вертикали|
| **Альбомная ориентация** |50% от экрана<br />Compact по горизонтали<br />Регулярные по вертикали|50% от экрана<br />Compact по горизонтали<br />Регулярные по вертикали|

В примере [MuliTask](https://developer.xamarin.com/samples/monotouch/ios9/MultiTask/) приложения, если он выполняется на iPad в альбомном режиме во весь экран, он будет представлять, как в списке, так и в представлении «Подробности», в то же время:

[![](multitasking-images/sizeclasses03.png "Список и подробное представление, представленные в то же время")](multitasking-images/sizeclasses03.png#lightbox)

Если панели слайдов через выполняется то же приложение, оно выводится как класс Compact размер по горизонтали и отображается только список:

[![](multitasking-images/sizeclasses04.png "Только представленный список, когда устройство находится по горизонтали")](multitasking-images/sizeclasses04.png#lightbox)

Чтобы убедиться, что приложение ведет себя правильно в таких ситуациях, следует применять признака коллекций, а также размеры и соответствовать `IUIContentContainer` и `IUITraitEnvironment` интерфейсов. См. в разделе Apple [ссылки на класс UITraitCollection](https://developer.apple.com/library/prerelease/ios/documentation/UIKit/Reference/UITraitCollection_ClassReference/index.html#//apple_ref/doc/uid/TP40014202) и наши [Знакомство с унифицированным раскадровкам](~/ios/user-interface/storyboards/unified-storyboards.md) для дополнительных сведений.

Кроме того больше не могут полагаться на границы экрана устройства для определения видимой области приложения, необходимо вместо этого использовать границы окна приложения. Так как границы окна полностью находятся под контролем пользователя, нельзя программно изменить их или запрет на изменение этих границ.

Наконец, приложение должно использовать файл раскадровки для представления его запуска экрана, а не с помощью набора **.png** файлы изображений и поддерживает все четыре интерфейса ориентации (книжная, ногами Книжная, Альбомная слева и справа альбомная) следует учитывать для запуска панели слайдов через или в режиме разделенное представление.

<a name="Custom-Hardware-Keyboard-Shortcuts" />

### <a name="custom-hardware-keyboard-shortcuts"></a>Настраиваемая аппаратная сочетания клавиш

В iOS 9, выполняющихся на устройствах iPad, Apple имеет расширенная поддержка клавиатуры оборудования. устройства iPad всегда добавлены следующие основные клавиатуры через Bluetooth и неотъемлемыми производители создан клавиатуры, которые включены прокладкой проводов для традиционных клавиш для определенного iOS.

Теперь с iOS 9, приложения можно создать собственные настраиваемые сочетания клавиш. Кроме того, некоторые основные сочетания клавиш, таких как **команда C** (копия), **X команда** (cut), **команды-V** (Вставить) и **команды-Shift-H**  (Домашняя страница), без приложения, в частности письменного реагирование на них.

**Вкладка "команда"** приведет к появлению приложения переключателя, который позволяет пользователю быстро переключаться между приложениями с помощью клавиатуры, как Mac OS:

[![](multitasking-images/keyboard01.png "Переключатель приложения")](multitasking-images/keyboard01.png#lightbox)

Если приложение iOS 9 включает в себя сочетания клавиш, пользователь может удерживать **команда**, **параметр** или **управления** ключи для их отображения во всплывающем окне:

[![](multitasking-images/keyboard02.png "Всплывающее окно сочетания клавиш")](multitasking-images/keyboard02.png#lightbox)

#### <a name="defining-custom-keyboard-shortcuts"></a>Определение пользовательских сочетаний клавиш

Если мы добавим следующий код представления или контроллера представления в приложении. когда этого представления или контроллера является видимым, будут доступны настраиваемые сочетания клавиш:

```csharp
#region Custom Keyboard Shortcut
public override bool CanBecomeFirstResponder {
    get { return true; }
}

public override UIKeyCommand[] KeyCommands {
    get {

        var keyCommand = UIKeyCommand.Create (new NSString("n"), UIKeyModifierFlags.Command, new Selector ("NewEntry"), new NSString("New Entry"));
        return new UIKeyCommand[]{ keyCommand };
    }
}

[Export("NewEntry")]
public void NewEntry() {

    // Add a new entry
    ...

}
#endregion
```

Во-первых, мы переопределяем `CanBecomeFirstResponder` свойства и возвращаемые `true` что представления или контроллера представления позволяет получать ввод с клавиатуры. 

Далее мы переопределяем `KeyCommands` свойство и создать новую `UIKeyCommand` для **команда N** регистрации нажатия клавиш. При активации нажатие клавиши, мы вызываем `NewEntry` метод (что мы предоставляем в iOS 9 с помощью `Export` команду) для выполнения запрошенного действия.

Если мы запустим это приложение на iPad с подсоединенной клавиатурой оборудования и пользователь вводит **команда N**, новая запись добавляется в список. Если пользователь удерживает **команда** ключа, список сочетаний клавиш будут отображаться:

[![](multitasking-images/keyboard03.png "Всплывающее окно сочетания клавиш")](multitasking-images/keyboard03.png#lightbox)

См. образец [многозадачной работы приложения](https://developer.xamarin.com/samples/monotouch/ios9/MultiTask/) пример реализации.

<a name="Resource-Management-Considerations" />

### <a name="resource-management-considerations"></a>Рекомендации по управлению ресурсов

Даже для приложений, уже используете руководства и рекомендации по iOS 8 Управление ресурсами эффективный по-прежнему могут возникнуть проблемы. В iOS 9 приложения больше не имеют монопольного использования памяти, ЦП или других системных ресурсов.

Таким образом необходимо настроить приложение Xamarin.iOS для эффективного использования системных ресурсов, или она была направлена завершения в ситуациях нехватки памяти. Это одинаково справедливо для приложений, которые отказаться от многозадачность, после второго приложения может выполняться по-прежнему в слайд над панелью или изображения в окне рисунок требует дополнительных ресурсов или приводит к частоте обновления, чтобы упадет ниже 60 кадров в секунду.

Рассмотрим следующие действия пользователя и их последствиях:

- **Ввод текста панели слайдов через** — даже если приложение имеет без ввода текста, системную клавиатуру могут появиться через пользовательский Интерфейс. Таким образом приложение может потребоваться отвечать на отображение уведомлений клавиатуры (например, отображение и скрытие клавиатуры).
- **Выполнение второго приложения панели слайдов через** -новое приложение теперь выполняется на переднем плане и конкурировать с существующим приложением для системных ресурсов, например памяти и ЦП.
- **Воспроизведение видео в окне PIP** — не только это окно можно закрыть часть интерфейс вашего приложения, но приложения, который запустил видео по-прежнему работает в фоновом режиме и потребления ресурсов ЦП и памяти.

Чтобы убедиться, что приложение эффективно использует ресурсы, поступайте следующим:

- **Профилирование приложения с помощью Instruments** -проверьте на наличие утечек памяти, заметны ЦП и области, где приложение блокирует основной поток.
- **Отвечать на методы переходы состояний** — в вашей **AppDelegate.cs** файл override "и" ответ на состояние изменить методы, например, приложение, введя или возвращение из фонового. Освободите все ненужные ресурсов, таких как изображения, данных или представления и контроллера представления.
- **Тестирование Side-by-Side, с помощью приложений с большим объемом памяти** — запустить приложение, слайд-Out и разделенное представление на оборудовании физических операций ввода-вывода приложение с использованием памяти с большим объемом например карты (в режиме просмотра вспомогательной) и проверьте, оба приложения продолжает отвечать на запросы и не аварийному завершению работы.

См. в разделе Apple [руководство по эффективности энергопотребления для приложений iOS](https://developer.apple.com/library/prerelease/ios/documentation/Performance/Conceptual/EnergyGuide-iOS/index.html#//apple_ref/doc/uid/TP40015243) Дополнительные сведения об управлении ресурса.

<a name="Opting-Out-of-Multitasking" />

## <a name="opting-out-of-multitasking"></a>Отказ от многозадачность

Хотя Apple предполагает, что все приложения iOS 9 поддерживают многозадачность, могут существовать очень какой-либо причине приложение не слишком, такие как игры или приложения камеры, которым требуются во весь экран для правильной работы.

Для приложения Xamarin.iOS, чтобы отказаться от того, выполняемым в любом слайд Out панели или в режиме разделенное представление, изменение проекта **Info.plist** файл и проверьте **требует полноэкранного**:

[![](multitasking-images/fullscreen01.png "Отказ от многозадачность")](multitasking-images/fullscreen01.png#lightbox)

> [!IMPORTANT]
> Хотя отказ от многозадачность предотвращает приложения выполняются в слайд Out или представление с разделением, он не предотвращает другое приложение запуск в слайд Out или рисунок на рисунке видео выводил вместе с приложением.

<a name="Disabling-PIP-Video-Playback" />

### <a name="disabling-pip-video-playback"></a>Отключение PIP воспроизведения видео

В большинстве случаев приложения должен позволять пользователю для воспроизведения видео, которые в нем отображаются изображения в плавающем окне рисунка. Тем не менее могут возникнуть ситуации, где это может не быть полезным, например, видеофрагментов игр вырезания сцены.

Чтобы отказаться от воспроизведения видео PIP, выполните следующие действия в приложении.

- Если вы используете `AVPlayerViewController` для отображения видео, задайте `AllowsPictureInPicturePlayback` свойства `false`.
- Если вы используете `AVPlayerLayer` для отображения видео, не создавайте экземпляр `AVPictureInPictureController`.
- Если вы используете `WKWebView` для отображения видео, задайте `AllowsPictureInPictureMediaPlayback` свойства `false`.

<a name="Summary" />

## <a name="summary"></a>Сводка

Статья описывает шаги, необходимые, чтобы убедиться, что приложения Xamarin.iOS выполняется и правильно работать в iOS 9 новые возможности многозадачность для iPad. Кроме того он рассматривается отказ от горизонтального многозадачность для приложений, где это не подходит.



## <a name="related-links"></a>Связанные ссылки

- [Примеры iOS 9](https://developer.xamarin.com/samples/ios/iOS9/)
- [Поддержку многозадачности (пример)](https://developer.xamarin.com/samples/monotouch/ios9/MultiTask/)
- [Общие сведения о унифицированная раскадровка](~/ios/user-interface/storyboards/unified-storyboards.md)
- [iOS 9 для разработчиков](https://developer.apple.com/ios/pre-release/)
- [iOS 9.0](https://developer.apple.com/library/prerelease/ios/releasenotes/General/WhatsNewIniOS/Articles/iOS9.html)
- [Внедрение усовершенствования многозадачность для iPad](https://developer.apple.com/library/prerelease/ios/documentation/WindowsViews/Conceptual/AdoptingMultitaskingOniPad/index.html#//apple_ref/doc/uid/TP40015145)
- [Запись блога](https://blog.xamarin.com/using-auto-layouts-for-ios-9-splitview/)
