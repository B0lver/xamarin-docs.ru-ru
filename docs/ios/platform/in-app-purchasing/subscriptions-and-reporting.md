---
title: Подписки и отчетность в Xamarin.iOS
description: В этом документе описываются не продление подписки, бесплатные подписки, автоматически возобновляемой подписки и с помощью iTunes Connect, чтобы создать отчет для этих элементов.
ms.prod: xamarin
ms.assetid: 27EE4234-07F5-D2CD-DC1C-86E27C20141E
ms.technology: xamarin-ios
author: lobrien
ms.author: laobri
ms.date: 03/18/2017
ms.openlocfilehash: 4e63894cb862db3b5b5a1e7a2bebd79160c311a9
ms.sourcegitcommit: 4b402d1c508fa84e4fc3171a6e43b811323948fc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61367497"
---
# <a name="subscriptions-and-reporting-in-xamarinios"></a>Подписки и отчетность в Xamarin.iOS

## <a name="about-non-renewing-subscriptions"></a>О не продлении подписки

Обновление не подписки предназначены для продуктов, которые представляют продажи услуга с ограничением времени, например (одна неделя доступ к приложению навигации) или ограниченный по времени доступ в архив данных.   
   
Основные различия между не продление подписок и других типов продукта:

-  Определение продукта в iTunes Connect не включает термин. Код приложения должен иметь возможность определить срок действия из идентификатора продукта. 
-  Их можно приобрести несколько раз (например, готовых к использованию продукта). Приложения необходимые для управления термин срока и обновления и запрет на приобретение перекрытие подписок. 
-  Покупки не поддерживаются функцией StoreKit восстановления. Если подписки должна быть доступна во всех пользовательских устройств, приложение будет иметь проектировать и реализовывать эту функцию в сочетании с удаленным сервером. Приложения также несут ответственность за резервное копирование состояния подписки для случаев, когда устройство находится резервных копий затем восстановлена с backup. 
-  Общие сведения о реализации
-  Обновление без подписки обычно должны быть реализованы с помощью рабочего процесса доставки сервера и управлять ими аналогично готовых к использованию продуктов. 


## <a name="about-free-subscriptions"></a>О бесплатных подписок

Бесплатные подписки позволяют разработчикам для размещения свободного содержимого в приложениях киоска (их нельзя использовать в приложениях без киоска). После запуска бесплатную подписку она будет доступна на всех устройствах пользователей. Бесплатные подписки на неограниченный срок действия; они только завершаются при удалении приложения.

### <a name="implementation-overview"></a>Общие сведения о реализации

Бесплатные подписки гораздо ведут себя как автоматически возобновляемой подписки. Приложение должно иметь бесплатную подписку на продукт «приобрести», в iTunes Connect. При покупке пользователем, приобретении бесплатной подписки должны проверяться как продукт с автоматически возобновляемой подписки. Бесплатная подписка транзакции могут быть восстановлены.


## <a name="about-auto-renewable-subscriptions"></a>О подписках возобновляемую Auto

Auto-возобновляемую подписки главным образом используются в приложениях киоска. Они представляют продукт, который предоставляет пользователю доступ динамического содержимого в течение заданного периода времени, которое настроено в iTunes Connect (задать период — от 7 дней до 1 год). Подписки возобновляются автоматически, взимать оплату за пользователей идентификатор Apple ID в конце каждого периода подписки, если пользователь соглашается масштабирование. Этот тип продукта подходит для подписок магазин или новостей, где пользователь получает доступ к каждой проблемы, опубликованные во время подписки является допустимым.

### <a name="implementation-overview"></a>Общие сведения о реализации

Auto-возобновляемую подписки должны быть реализованы с помощью рабочего процесса Server-Delivered продуктов (см. *проверки поступления и продуктов Server-Delivered* раздел).

#### <a name="shared-secret"></a>Общий секрет

Общий секрет для покупки в приложении необходимо использовать в запросе JSON при проверке возобновляемую автоматической подписки на сервере. Общий секрет, создать или получить доступ с помощью iTunes Connect.

В iTunes Connect домашней странице выберите **Мои приложения**:   
   
 [![](subscriptions-and-reporting-images/image2.png "Выберите \"Мои приложения\"")](subscriptions-and-reporting-images/image2.png#lightbox)  
 
Выберите приложение и щелкнуть **покупки из приложений** вкладке:

[![](subscriptions-and-reporting-images/image6.png "Перейдите на вкладку покупки в приложении")](subscriptions-and-reporting-images/image6.png#lightbox)

В нижней части страницы выберите **представления или создать общий секрет**:
   
 [![](subscriptions-and-reporting-images/image40.png "Выберите представление или создать общий секрет")](subscriptions-and-reporting-images/image40.png#lightbox)

 [![](subscriptions-and-reporting-images/image41.png "Создать общий секрет")](subscriptions-and-reporting-images/image41.png#lightbox)   
   
   
   
 Чтобы использовать общий секрет, включите ее в полезных данных JSON, отправляемые серверы Apple при проверке Приход покупки в приложении автоматически возобновляемой подписки, следующим образом:

```csharp
{
   "receipt-data" : "(receipt bytes here)",
   "password"     : "(shared secret bytes here)"
}
```

Поле состояния ответа будет равен нулю, если покупки может использоваться, как с другими типами продукта.

#### <a name="downloading-items-after-the-initial-subscription-term"></a>Загрузка элементов истечении срока действия первоначальной подписки

Как часть предоставления продуктов подписки код часто следует проверить последние известные прихода на серверах компании Apple. Если подписка продлился автоматически с момента последней проверки, ответ JSON будет содержать дополнительные поля, которые уведомляют приложение транзакции, которая произошла (для которого следует продлить срок действия подписок). Будет содержать ответ в формате JSON:

```csharp
{
   "status" : 0,
   "receipt" : { (receipt here) },
   "latest_receipt" : "(base-64 encoded receipt here)",
   "latest_receipt_info" : { (latest receipt info here) }
}
```

Если состояние равно нулю, подписка по-прежнему действительна, и другие поля содержат допустимые данные. Если состояние — 21006 подписки истек. См. в разделе [проверить возобновляемую автоматическое уведомление о доставке подписки](https://developer.apple.com/library/ios/releasenotes/General/ValidateAppStoreReceipt/Chapters/ValidateRemotely.html) документации для других кодов ошибок.

#### <a name="restoring-auto-renewable-subscriptions"></a>Восстановление автоматически возобновляемую подписок

Вы получите несколько транзакций — исходной транзакции покупки, а также отдельную транзакцию для каждого периода времени, который продлен подписки. Необходимо отследить даты начала и условия, чтобы понять, что такое срок действия.   
   
   
   
 Объект SKPaymentTransaction не включает срок действия подписки — следует использовать другой идентификатор продукта для каждого термина и написать код, который можно экстраполировать на период подписки с даты покупки транзакции.

#### <a name="testing-auto-renewal"></a>Тестирование автоматического продления

Чтобы упростить тестирование подписки, их длительности сжимаются при тестировании в «песочнице». 1 неделя подписки возобновляются каждые 3 минуты, 1 год подписки возобновляются каждый час. Подписки будут автоматическое возобновление более 6 раз во время тестирования в изолированной среде.

## <a name="reporting"></a>Отчеты

iTunes Connect ( [itunesconnect.apple.com](http://itunesconnect.apple.com)) предоставляет:   
   
 **Продажи и тенденции** — отображает сведения приложения загрузки, обновления и покупки из приложений.   
   
 **Платежи и финансовые отчеты** – подробно доход, заработанных приложений, а также список платежей, которые были внесены и сколько раскрывающая информацию.

Ниже приведен пример продаж и тенденций отчета:   

 [![](subscriptions-and-reporting-images/image42.png "Пример отчета продаж и тенденций")](subscriptions-and-reporting-images/image42.png#lightbox)   
   
 Имеется также [ **мобильного подключения ITC**приложения iOS (ссылка iTunes)](http://itunes.apple.com/us/app/itunes-connect-mobile/id376771144?mt=8).
снимки экрана iPhone для некоторые доступные статистические данные, показаны ниже:   
   
 [![](subscriptions-and-reporting-images/image43.png "снимки экрана iPhone для некоторых из соответствующих статистических")](subscriptions-and-reporting-images/image43.png#lightbox)
