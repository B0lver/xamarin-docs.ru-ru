---
title: Приобретение невоспроизводимых продуктов в Xamarin. iOS
description: В этом документе описываются неиспользуемые продукты в Xamarin. iOS, которые приобретают пользователь, который остается доступным неограниченное время независимо от устройства.
ms.prod: xamarin
ms.assetid: 635D9CA2-6BCA-53E1-7B10-968029AA3493
ms.technology: xamarin-ios
author: davidortinau
ms.author: daortin
ms.date: 03/18/2017
ms.openlocfilehash: 78a4f3ae90b1b20e9fe3cd4164726fee34f38eb7
ms.sourcegitcommit: 00e6a61eb82ad5b0dd323d48d483a74bedd814f2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2020
ms.locfileid: "91435509"
---
# <a name="purchasing-non-consumable-products-in-xamarinios"></a>Приобретение невоспроизводимых продуктов в Xamarin. iOS

Клиент применяет невоспроизводимые продукты. Ожидание заключается в том, что они всегда будут иметь доступ к ним, даже если их устройство потеряно или украдено, или купит новое. Они полезны для книг, проблем с журналами, уровней игры, фильтров фотографий, "Pro-Features" и т. д. Когда пользователь приобретает неиспользуемый продукт, ему никогда не придется платить за него. Если код случайно попытается выполнить их, StoreKit отобразит сообщение о том, что оно уже было приобретено.

## <a name="non-consumable-products-sample"></a>Пример невоспроизводимых продуктов

[Код инапппурчасесампле](/samples/xamarin/ios-samples/storekit) содержит проект с именем *нонконсумаблес*. В примере кода показано, как реализовать невоспроизводимые продукты с помощью фильтров фотографий в качестве примера. После приобретения фильтра его можно применить к фотографии снова и снова. Вам больше не нужно повторно покупать ее.   

Процесс покупки показан в этой серии снимков экрана — кнопка **купить** становится кнопкой активации функций:   

 [![Процесс покупки показан в этой серии снимков экрана](purchasing-non-consumable-products-images/image34.png)](purchasing-non-consumable-products-images/image34.png#lightbox)   

Процесс покупки такой же, как и использующий продукт; Основное различие заключается в том, как покупка будет отслеживанием в коде приложения. В этом примере кнопка Купить доступна только в том случае, если продукт еще не приобретен, в противном случае кнопка активирует саму функцию.   

На следующей схеме показаны взаимодействия между классами и сервером App Store для выполнения невоспроизводимой покупки продукта:   

 [![Взаимодействие между классами и сервером App Store для выполнения невоспроизводимой покупки продукта](purchasing-non-consumable-products-images/image35.png)](purchasing-non-consumable-products-images/image35.png#lightbox)   

Основное отличие от возможного примера состоит в том, что после завершения покупки пользовательский интерфейс обновляется для предотвращения повторного приобретения. В этом примере уведомление об успешной транзакции обновляет пользовательский интерфейс, чтобы кнопка **купить** была преобразована в кнопку, которая активирует саму функцию.

## <a name="re-purchasing-non-consumable-products"></a>Повторное приобретение невоспроизводимых продуктов

При успешном приобретении продукта код должен скрывать или перенацелить кнопку покупки, чтобы предотвратить повторную попытку приобретения продукта пользователем. Пример приложения делает это, изменяя кнопку **купить** на кнопку, которая делает примерный фильтр фотографий работоспособным.   

Существуют ситуации, когда приложение не может определить, был ли уже приобретен неподдерживаемый продукт:

- Если приложение удалено и повторно установлено на устройстве, все записи о покупках будут утеряны (если только пользователь не выполнит восстановление резервной копии). 
- Если пользователь установил приложение на двух (или более) устройствах и выполняет покупку на одном из устройств. На других устройствах будет по прежнему отображаться продукт, доступный для приобретения. 
- Если клиент пытается повторно приобрести неиспользуемый продукт в таких ситуациях, магазин приложений снова выполнит этот продукт без оплаты. Изначально пользовательский интерфейс будет выполнять покупку (например, отображается предупреждение с подтверждением, а идентификатор Apple — обязательно), однако пользователь увидит сообщение о том, что продукт уже приобретен.  

Путь кода в этом сценарии точно такой же, как и для обычной покупки. единственными отличиями являются:

- У пользователя нет оплаты за продукт.
- `SKPaymentTransaction`Объект, переданный в приложение, будет иметь `OriginalTransaction` свойство, которое ссылается на транзакцию, созданную при первоначальном приобретении продукта. 
- Приложения, которые продают невоспроизводимые продукты, должны также реализовать функцию  **восстановления** StoreKit, чтобы помочь пользователям получить доступ к существующим покупкам.