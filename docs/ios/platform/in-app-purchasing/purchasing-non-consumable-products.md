---
title: Приобретение Неготовых продуктов в Xamarin.iOS
description: В этом документе описываются продукты неготовых в Xamarin.iOS, которые являются компонентами, приобретенных пользователем, которые остаются доступными неопределенно долгое время, независимо от устройства.
ms.prod: xamarin
ms.assetid: 635D9CA2-6BCA-53E1-7B10-968029AA3493
ms.technology: xamarin-ios
author: lobrien
ms.author: laobri
ms.date: 03/18/2017
ms.openlocfilehash: 060403baf8ac28b9b160632a01471b9828735069
ms.sourcegitcommit: e268fd44422d0bbc7c944a678e2cc633a0493122
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2018
ms.locfileid: "50118504"
---
# <a name="purchasing-non-consumable-products-in-xamarinios"></a>Приобретение Неготовых продуктов в Xamarin.iOS

Продукты не использоваться моделью «принадлежат» клиента. Ожидается, что они всегда имеет доступ к ним, даже в том случае, если устройство потеряно или украдено, или они купить новый. Они полезны для книг, выпуски magazine, игровые уровни, фильтры фотографий, «функции версии pro» т. д. Как только пользователь приобрел определенный продукт неготовых, им не придется оплачивать ее снова. Если ваш код случайно разрешает его попробовать, StoreKit отобразится сообщение, которое уже приобрели.

## <a name="non-consumable-products-sample"></a>Пример Неготовых продуктов

[Кода InAppPurchaseSample](https://developer.xamarin.com/samples/monotouch/StoreKit/) содержит проект с именем *NonConsumables*. В образце кода показано, как реализовать неготовых продуктов, используя фильтры фотографии в качестве примера. После приобретения фильтр можно применить его к фотографии снова и снова. Никогда не потребуется повторно купить ее.   
   
   
   
 Показан процесс покупки в этой серии снимков экрана — **купить** кнопка становится кнопкой активацию компонентов:   
   
   
   
 [![](purchasing-non-consumable-products-images/image34.png "В этой серии снимков экрана показан процесс покупки")](purchasing-non-consumable-products-images/image34.png#lightbox)   
   
   
   
 Процесс приобретения совпадает со значением готовых к использованию продукта; Ключевое отличие заключается в том, в способ отслеживания покупки в коде приложения. В этом примере кнопка приобрести только в том доступен в том случае, если продукт уже не был приобретен, в противном случае кнопка активирует сама эта функция.   
   
   
   

На следующей схеме показано взаимодействие между классами и серверу App Store для выполнения приобретения продукта неготовых:   
   
   
   
 [![](purchasing-non-consumable-products-images/image35.png "Приобрести взаимодействий между классами и серверу App Store для выполнения неготовых продукта")](purchasing-non-consumable-products-images/image35.png#lightbox)   
   
   
   
 Основное отличие из готовых к использованию примера является то, что после завершения покупки пользовательского интерфейса обновления для предотвращения повторного приобретения. В этом примере уведомление об успешной операции обновления пользовательского интерфейса таким образом, чтобы **купить** кнопка преобразуется в кнопку, которая активирует сама эта функция.

## <a name="re-purchasing-non-consumable-products"></a>Повторно приобретение Неготовых продуктов

Код обычно следует скрыть или переназначение кнопку Покупка после продукта успешно вы приобрели, чтобы предотвратить работу пользователя при попытке приобрести этот продукт еще раз. Пример приложения осуществляется путем изменения **купить** кнопки кнопки, которая делает Фотофильтр пример, в работе.   
   
   
   
 Существуют ситуации, где приложение не может определить ли неготовых продукта уже был приобретен:

-  Если приложение удаляется и повторно установить на устройстве, все записи покупки будут удалены (если не / до резервного копирования восстановления пользователем). 
-  Если пользователь имеет приложение установлено на устройствах две (или более) и совершает покупку через одно из устройств. Другие устройства будут доступны для приобретения продукта. 
-  Если клиент пытается повторно купить неготовых продукта в таких ситуациях, App Store поставим продукта еще раз бесплатно. Пользовательский интерфейс изначально будет отображаться для выполнения покупки (например, отображается предупреждение подтверждения и требуется идентификатор Apple ID) тем не менее пользователь затем увидит сообщение о том, что продукт уже был приобретен.  
   
   
   
 Ветвь кода в этом сценарии именно так же, как обычный покупки, единственными отличиями:

-  Пользователь не взимается плата снова для продукта.
-  `SKPaymentTransaction` Объекта, переданного приложению будет `OriginalTransaction` свойство, относящееся к транзакции, который был сформирован при изначально приобретенного продукта. 
-  Приложения, которые продают продукты не использоваться моделью необходимо также реализовать в StoreKit **восстановить** функцию, которая поможет пользователям извлекать существующие покупки. 
