---
title: Основы Покупка из приложения и конфигурации в Xamarin.iOS
description: В этом документе описывается покупки из приложений в Xamarin.iOS, посвященные важные сведения о правилах, конфигурации и iTunes Connect.
ms.prod: xamarin
ms.assetid: 11FB7F02-41B3-2B34-5A4F-69F12897FE10
ms.technology: xamarin-ios
author: bradumbaugh
ms.author: brumbaug
ms.date: 03/18/2017
ms.openlocfilehash: 9ded160ad4b31346c400e63d739a3dc21f6304d3
ms.sourcegitcommit: ea1dc12a3c2d7322f234997daacbfdb6ad542507
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/05/2018
ms.locfileid: "34787247"
---
# <a name="in-app-purchase-basics-and-configuration-in-xamarinios"></a>Основы Покупка из приложения и конфигурации в Xamarin.iOS

Для реализации покупки из приложений требуется приложению использовать API StoreKit на устройстве. StoreKit управляет весь обмен данными с серверами Apple iTunes, чтобы получить сведения о продукте и выполнения транзакций. Профиль подготовки должен быть настроен для совершения покупки из приложений и сведения о продукте, которые должны вводиться в iTunes Connect.

 [![](in-app-purchase-basics-and-configuration-images/image1.png "StoreKit управляет связью с Apple, как показано на этой диаграмме")](in-app-purchase-basics-and-configuration-images/image1.png#lightbox)

С помощью магазина приложений для предоставления покупки из приложений требуются следующие программы установки и конфигурации:

-  **iTunes Connect** — Настройка продуктов для продажи и настройка учетных записей пользователей "песочницы" для проверки приобретения. Необходимо также предоставить данные налогов и банковских операций в Apple, их можно передать средств, собранные от вашего имени.
-   **Портал Провизионирования iOS** — создать идентификатор пакета и предоставления доступа к магазина для своего приложения.
-  **Комплект средств для хранения** — Добавление кода в приложение для отображения продуктов, приобретения продуктов и отмены транзакций.
-  **Пользовательский код** — чтобы отслеживать покупки, совершенные клиентов и предоставлять продуктов или служб, которые они приобрели. Можно также требуется реализовать серверному процессу, чтобы проверить поступления продуктов, могут иметь содержимое, загружаемые с сервера (например, книги и журналах проблемы).


Существует два набор магазина «серверных средах».

-  **Производство** — транзакции с реальными money. Доступно только через приложения, которые были отправлены и одобрен Apple. Продуктов Покупка из приложения необходимо также просмотреть и утвердить, чтобы они стали доступны в рабочей среде.
-  **"Песочница"** — там, где происходит тестирования. Продукты доступны здесь сразу после создания (процесс утверждения применяется только в рабочей среде). Транзакции в изолированной среде требуют тестовых пользователей (не реальными идентификаторами Apple) для выполнения транзакций.

## <a name="in-app-purchase-rules"></a>Покупка из приложения правила

Не может принимать другие формы оплаты для цифровых продуктов и служб в приложении, и не ссылаются на их или называть их из пользователей в приложении. Это означает, что вы не можете принять кредитной карты или PayPal при приобретении в приложении — это наиболее подходящий механизм оплаты. Особым случаем за приобретение цифровых продуктов за пределами приложения, но для использования в приложении, такие как приобрести книги на веб-сайте, связанные с конкретным «вход» и использование, что «вход» в приложение позволяет пользователю получить доступ приобретенных книг.
Приложения, работающие таким образом не разрешено упомянуть или ссылки на функции внешнего закупок — разработчики должны взаимодействовать с этой возможностью для пользователей другими способами (возможно с помощью по электронной почте или другим прямого канала).

Тем не менее поскольку нельзя использовать покупки из приложений для физических товаров в том, что обращение, которое вы можете использовать механизм альтернативный оплаты (например) кредитной карты или PayPal) из в приложении.

Apple должен утвердить каждый продукт, прежде чем она переходит на продажи — имя, описание и снимок экрана «продукт» является обязательным для просмотра. Время проверки продукта является так же, как приложения обзоров.

Не удается выбрать любой цене для продукта — можно выбрать только «цена уровень», имеет определенное значение в каждой стране или валюте, которая поддерживает Apple. Не может иметь уровень разных ценовых в различных рынков.

## <a name="configuration"></a>Конфигурация

До написания любого кода покупках в приложении необходимо выполнить действия настройки в iTunes Connect ( [itunesconnect.apple.com](http://itunesconnect.apple.com)) и портал Провизионирования iOS ( [developer.apple.com/iOS](http://developer.apple.com/iOS)).

Следующие три действия должна быть завершена до написания любого кода:

-  **Учетная запись разработчика Apple** — предоставить банковских операций и налогообложения данные в Apple.
-  **Портал Провизионирования iOS** — обеспечить ваше приложение имеет допустимый идентификатор приложения (без подстановочных знаков с символом звездочки * в нем) и в приобретении приложение включен.
-  **Подключение приложения управления iTunes** — добавить продукты для вашего приложения.


### <a name="apple-developer-account"></a>Учетная запись разработчика Apple

Построение и распространение бесплатные приложения требует незначительного конфигурации в [iTunes Connect](https://itunesconnect.apple.com), однако для продажи платной приложения или покупки из приложений требуется для обеспечения Apple банковских операций и налогообложения сведения. Щелкните **соглашений, размер налога и банковских операций** в главном меню, показано ниже:

 [![](in-app-purchase-basics-and-configuration-images/image2.png "Щелкните соглашений, размер налога и банковских операций в главном меню")](in-app-purchase-basics-and-configuration-images/image2.png#lightbox)

Должен иметь учетную запись разработчика **платных приложений iOS** контракта в сущности, как показано на этом снимке экрана:

 [![](in-app-purchase-basics-and-configuration-images/image3.png "Учетной записи разработчика должны иметь iOS, которые фактически контракта платных приложений")](in-app-purchase-basics-and-configuration-images/image3.png#lightbox)

Вы не сможете проверить функциональные возможности StoreKit, пока **платных приложений iOS** контракт: StoreKit вызовы в коде будут завершаться сбоем, пока обработал Apple вашей **контракты, налоги и банковских операций** сведения.

### <a name="ios-provisioning-portal"></a>Портал подготовки iOS

Новые приложения настраиваются в **идентификаторы приложений** раздел **портал Провизионирования iOS**. Чтобы создать новый идентификатор приложения, перейдите к [центр портал Провизионирования iOS](https://developer.apple.com/membercenter/index.action), перейдите к **сертификаты, идентификаторы и профили** части портала, а затем нажмите **идентификаторы** под *приложений iOS*. Нажмите кнопку «+» в верхней части страницы право создания нового идентификатора приложения.


Форма для создания новых **идентификаторы приложений**

 выглядит следующим образом:

 [![](in-app-purchase-basics-and-configuration-images/image4.png "Форма для создания новых идентификаторов приложений")](in-app-purchase-basics-and-configuration-images/image4.png#lightbox)

Введите что-нибудь подходящее для *описание*, поэтому можно легко определить этот идентификатор приложения в списке. Для *префикс идентификатора приложения*, выберите идентификатор команды.

#### <a name="bundle-identifierapp-id-suffix-format"></a>Формат суффикс идентификатора приложений идентификатор пакета

Можно использовать любую строку, например для вашего **идентификатор пакета** (при условии, что он является уникальным в вашей учетной записи), однако корпорация Майкрософт рекомендует Apple, вы формату обратного DNS, а не использовать любой произвольной строки. Образец приложения, к этой статье использует com.xamarin.storekit.testing для идентификатор пакета, однако он будет одинаково допустимо использовать идентификатор как my_store_example (даже если Apple не рекомендуется).

> [!IMPORTANT]
> Apple также позволяет звездочка подстановки для добавления в конец **идентификатор пакета** , чтобы один идентификатор приложения можно использовать для нескольких приложений, однако _идентификаторы приложений подстановки не может использоваться для AppPurchase_. Например, введите идентификатор пакета подстановки com.xamarin.*

#### <a name="enabling-app-services"></a>Включение службы приложений

Обратите внимание, что **Покупка из приложения** будут автоматически включены в списке служб:

 [![](in-app-purchase-basics-and-configuration-images/image5.png "Покупка из приложения будут автоматически включены в списке служб")](in-app-purchase-basics-and-configuration-images/image5.png#lightbox)

#### <a name="provisioning-profiles"></a>Профили подготовки

Создайте разработки и профили подготовки производства, как обычно выбрав идентификатор приложения, который вы настроили для покупок в приложении. Ссылаться на [подготовки устройства iOS](~/ios/get-started/installation/device-provisioning/index.md) и [публикации в магазине приложений](~/ios/deploy-test/app-distribution/app-store-distribution/publishing-to-the-app-store.md) руководств для получения дополнительной информации.

## <a name="itunes-connect"></a>iTunes Connect

Нажмите кнопку **Мои приложения** в iTunes Connect, чтобы создать или изменить запись приложения iOS. Общие сведения о странице приложения показан ниже:

 [![](in-app-purchase-basics-and-configuration-images/image6.png "Общие сведения о странице приложения")](in-app-purchase-basics-and-configuration-images/image6.png#lightbox)

Нажмите кнопку **покупки из приложений** для создания или изменения к продаже продуктов. Этом снимке экрана показан пример приложения с несколькими продуктами уже добавлен:

 [![](in-app-purchase-basics-and-configuration-images/image7.png "Пример приложения с несколькими продуктами уже добавлено")](in-app-purchase-basics-and-configuration-images/image7.png#lightbox)

Процесс добавления новых продуктов состоит из двух шагов:

1.   Выберите тип продукта: [![](in-app-purchase-basics-and-configuration-images/image8.png "выберите тип продукта")](in-app-purchase-basics-and-configuration-images/image8.png#lightbox) 
2.   Введите атрибуты продуктов, включая идентификатор продукта, Ценовая категория и локализованного описания: [![](in-app-purchase-basics-and-configuration-images/image9.png "ввода атрибутов продуктов")](in-app-purchase-basics-and-configuration-images/image9.png#lightbox)

Ниже описаны поля, необходимые для каждого продукта покупки из приложений:


### <a name="reference-name"></a>Имя ссылки

Имя ссылки не отображаются для пользователей; он предназначен для внутреннего использования и отображается только в iTunes Connect.

### <a name="product-id-format"></a>Формат идентификатора продукта

Идентификатор продукта может содержать только буквенно-цифровых (A-Z, a-z, 0-9), символ подчеркивания (_) и символы точки (.). Несмотря на то, что для вашего идентификаторов можно использовать любую строку, Apple рекомендует формат обратного DNS. Например в примере приложения используется этот идентификатор пакета:

 `com.xamarin.storekit.testing`

Поэтому соглашение для идентификации продуктов Покупка из приложения будет выглядеть следующим образом:

```csharp
com.xamarin.storekit.testing.consume5credits
com.xamarin.storekit.testing.consume10credits
com.xamarin.storekit.testing.sepia
com.xamarin.storekit.testing.greyscale
```

Это соглашение об именовании не является принудительным, просто рекомендации по управлению продуктов. Кроме того, несмотря на следующие то же соглашение обратного DNS, идентификаторы продукта, *не связаны* идентификатор пакета и они не требуются для запуска с такой же строки. По-прежнему будет использовать идентификаторы, например photo_product_greyscale (даже если Apple не рекомендуется).

КОД продукта не отображается для пользователей, но она используется для ссылки продукт в коде приложения.

### <a name="product-type"></a>Тип продукта

Существует пять типов продукта Покупка из приложения, можно предложить:

1.  **Использовать** — объекты, расположенные «используется копирование», например валюты в игре, чтобы тратить проигрыватель. Если пользователь не резервного копирования и восстановления или в противном случае обновлен свое устройство, к использованию транзакции не получить восстанавливать (который фактически придаст проигрыватель те же преимущества заново). Код приложения должен быть предоставьте к использованию элемент сразу после завершения транзакции.
1.  **Не потребляемых** — покупок, «принадлежащие пользователю» один раз, например цифровой журнала проблему или уровне игр.
1.  **Автоматически обновляемый подписки** — только как подписки на реальных журнал, в конце периода подписки Apple автоматически повторно расходов клиента и расширяет термин подписки неограниченное время или до клиента явным образом отменяет его. Это способ оплаты предпочтительный для киоска новостей приложения (на самом деле, приложения должны поддерживать этот метод оплаты быть утвержден для распространения киоска новостей).
1.  **Освободить подписки** — может быть предоставлен только в приложениях с поддержкой киоска новостей, а также позволяет клиентам получать доступ к содержимому подписки на всех устройствах. Бесплатная подписка никогда не истекает.
1.  **Обновление без подписки** — следует использовать для продажи, ограниченной по времени доступ к статического содержимого, например один месяц к архив фото.


 *В настоящее время в этом документе рассматриваются только первый двух продуктов типы (который может быть использован и потребляемые не).*

 <a name="Price_Tiers" />

### <a name="price-tiers"></a>Уровни цен

Магазин приложений не позволяют выбрать произвольный цена для продуктов — Apple предоставляет фиксированной цене уровней, которые можно выбирать. Цены, исправлены в каждой валюте и Apple сохраняет за собой право изменить относительный цены (например, после длительного Изменение относительного иностранных валют курс конкретной валюты и доллара США).

Apple предоставляет цена матрицу, чтобы помочь выбрать правильный уровень для валюты и цена, для которых требуется. Фрагмент кода цена матрицы (август 2012 г.) показан ниже:

 [![](in-app-purchase-basics-and-configuration-images/image10.png "Фрагмент кода матрицы цена августа 2012 г.")](in-app-purchase-basics-and-configuration-images/image10.png#lightbox)

Во время записи (июнь 2013 г.), 87 уровни из долл. США 0,99, чтобы 999,99 долл. США. Матрица цены показывает цену ваши клиенты будут уделять и также сумму, которую вы будете получать от Apple — это меньше их 30% издержки и также все локальные налоги они необходимы для сбора (Обратите внимание, в примере, что США и Канаде продавцов получать 70 c для 99 p c roduct Австралийский продавцов находится только 63 c из-за "товаров &amp; налоговой службы" налагаемого на отпускная цена таких товаров).

Цены продукта может обновляться в любое время, включая изменения запланированного цен, вступают в силу в будущем. На этом снимке экрана показано, как добавляется изменение цены выпущен в будущем — цена, временно изменяется с уровня 1 для уровня 3 для сентября только:

 [![](in-app-purchase-basics-and-configuration-images/image11.png "Изменение цены, выпущен в будущем, где цена, временно изменяется с уровня 1 для уровня 3 для сентября только")](in-app-purchase-basics-and-configuration-images/image11.png#lightbox)

### <a name="free-products-not-supported"></a>Бесплатные продукты не поддерживается

Несмотря на то, что Apple предоставил особый режим бесплатная подписка для приложений киоска новостей, не удается задать нулевой (бесплатно) цены для всех других типов, Покупка из приложения. Хотя можно изменить (т. е. ниже) цены при покупке, нельзя сделать бесплатно через iTunes Connect покупки из приложений.

### <a name="localization"></a>Локализация

В iTunes Connect можно ввести другой текстовой имя и описание для любого числа поддерживаемых языков. Каждый язык может быть добавлено или изменено в помощью всплывающего окна:

 [![](in-app-purchase-basics-and-configuration-images/image12.png "Каждый язык может быть добавлено или изменено в помощью всплывающего окна")](in-app-purchase-basics-and-configuration-images/image12.png#lightbox)   
   
   
   
 При отображении сведения о продукте в приложении, локализованный текст доступен для отображения через StoreKit. Отображение валюты также должны быть переведены для отображения правильного символ и форматирование десятичных чисел — это форматирование рассматривается далее в документе.

### <a name="app-store-review"></a>Просмотр магазина

То же, что приложения — каждый продукт просматривается Apple до разрешения для перехода на продажи. Продукты, которые могут быть отклонены контента неправильное имя или описание или Apple можно решить, что вы выбрали неверного типа (например) Вы создается на книги или журнала, но используется тип продукта к использованию). Обзоров продуктов может занять до проверки приложения.

При первом запуске приложения отправляется покупок в приложении включена (ли это новое приложение, или было добавлено к существующему) необходимо также выбрать некоторые продукты для отправки с ним. На портале iTunes Connect будет предложено сделать это, как показано на этом снимке экрана:

 [![](in-app-purchase-basics-and-configuration-images/image13.png "На портале iTunes Connect будет предложено отправить некоторые продукты Майкрософт")](in-app-purchase-basics-and-configuration-images/image13.png#lightbox)   
   
   
   
 Покупки из приложений и приложения будут проверяться вместе, чтобы все они сразу получить утверждение (поэтому этого приложения не перейти в хранилище без любые утвержденные продукты!).

После утверждения первой версии с возможностью Покупка из приложения можно добавлять дополнительные продукты и отправлять их для просмотра в любое время. Также можно отправить новую версию вместе с продуктов определенной покупки из приложений с помощью **подробные сведения о версии** страницы, как видно в командной строке.

Ссылаться на [приложения хранилища просмотрите рекомендации](https://developer.apple.com/appstore/guidelines.html) для получения дополнительной информации.

 [Часть 2 — Обзор пакета хранилища и сведения о возврате продукта](~/ios/platform/in-app-purchasing/store-kit-overview-and-retreiving-product-information.md)
