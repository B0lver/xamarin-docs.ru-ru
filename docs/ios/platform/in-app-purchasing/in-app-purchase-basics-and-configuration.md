---
title: Основные сведения о покупке в приложении и их настройке в Xamarin.iOS
description: В этом документе описывается покупки из приложений в Xamarin.iOS, посвященные важные сведения о правилах, конфигурации и iTunes Connect.
ms.prod: xamarin
ms.assetid: 11FB7F02-41B3-2B34-5A4F-69F12897FE10
ms.technology: xamarin-ios
author: lobrien
ms.author: laobri
ms.date: 03/18/2017
ms.openlocfilehash: 267dac5b6aec263f1d8b69d81f34f732118c1802
ms.sourcegitcommit: 57e8a0a10246ff9a4bd37f01d67ddc635f81e723
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/08/2019
ms.locfileid: "57671992"
---
# <a name="in-app-purchase-basics-and-configuration-in-xamarinios"></a>Основные сведения о покупке в приложении и их настройке в Xamarin.iOS

Реализация покупки из приложений требует, чтобы использовать API StoreKit на устройстве приложение. StoreKit управляет всем обменом данными с серверами Apple iTunes, чтобы получить сведения о продукте и выполнения транзакций. Профиль подготовки должен быть настроен для покупки из приложений и сведения о продукте, которые должны вводиться в iTunes Connect.

 [![](in-app-purchase-basics-and-configuration-images/image1.png "StoreKit управляет всем обменом данными с Apple, как показано на этой диаграмме")](in-app-purchase-basics-and-configuration-images/image1.png#lightbox)

С помощью App Store для предоставления покупки из приложений требует следующих установку и настройку:

-  **iTunes Connect** — Настройка продуктов для продажи и настройка учетных записей пользователей "песочницы" для тестирования приобретения. Необходимо также предоставить данные для банковские и налоговые в Apple, они могут переводим средств, собранные от вашего имени.
-   **Портал подготовки iOS** — Создание идентификатора пакета и включение доступа App Store для приложения.
-  **Store Kit** — Добавление кода в приложение для отображения продуктов, приобретения продуктов и отмены транзакций.
-  **Пользовательский код** — чтобы отслеживать покупки, совершенные клиентами и предоставлять товары или услуги, которые они приобрели. Вы может также требуется реализовать процесс на стороне сервера для проверки поступления, если ваши продукты могут иметь содержимое, загружаемые с сервера (например, книги и выпуски magazine).


Существует два Store средах пакета средств «server».

-  **Производство** — транзакции с ощутимых деньгах. Доступно только через приложения, которые был отправлен и утвержденные компанией Apple. Продукты покупки в приложении необходимо также просмотреть и утвердить, прежде чем они станут доступны в рабочей среде.
-  **"Песочницы"** , по которому происходит тестирования. Продукты доступны здесь сразу после создания (процесс утверждения применяется только в рабочую среду). Транзакции в «песочнице» требуют тестовых пользователей (не реальные идентификаторы Apple ID) для выполнения транзакций.

## <a name="in-app-purchase-rules"></a>Правила Покупка из приложения

Не может принимать другие виды оплаты для цифровых продуктов и служб внутри своего приложения, ни упоминания их или называть их из пользователей в приложении. Это означает, что при покупки из приложений — это наиболее подходящий механизм оплаты не может принимать кредитные карты или PayPal. Есть особый случай для приобретения цифровых продуктов за пределами приложения, но для использования в приложении, такие как книги на веб-сайта, которые связаны с конкретным «login» приобретение и использование, что «вход» в приложении позволяет пользователю доступ приобретенных электронной документации по.
Приложения, работающие таким образом не разрешено упомянуть или связать с включенной функции external приобретения — разработчики должны взаимодействовать эту возможность для пользователей по-другому (возможно с помощью по электронной почте или другим прямого канала).

Тем не менее так как нельзя использовать покупки из приложений для физических товаров, в том, что обращение, которое можно использовать механизм альтернативный оплаты (например) кредитной карты или PayPal) из в приложении.

Корпорация Apple должна утвердить каждый продукт, прежде чем он переходит на продажи — имя, описание и снимок экрана «продукт» является обязательным для проверки. Время проверки продукта не отличаются от отзывов о приложении.

Невозможно выбрать любой ценой продукта — вы можете выбрать «Ценовая категория» с указанным значением в каждой страны и валюты, поддерживающий Apple. Не может иметь другой ценовой категорией на различных рынках.

## <a name="configuration"></a>Параметр Configuration

До написания любого кода приобретения в приложении необходимо выполнить некоторую работу настройки в iTunes Connect ( [itunesconnect.apple.com](http://itunesconnect.apple.com)) и на портале подготовки iOS ( [developer.apple.com/iOS](https://developer.apple.com/iOS)).

Следующие три действия должна быть завершена до написания любого кода:

-  **Учетная запись разработчика Apple** — предоставить банковские и налогообложения данные в Apple.
-  **Портал подготовки iOS** — обеспечить приложение имеет допустимый идентификатор приложения (не подстановочный знак звездочка * в нем) и включил в покупки приложений.
-  **iTunes Connect приложения управления** — добавьте программные продукты для вашего приложения.


### <a name="apple-developer-account"></a>Учетная запись разработчика Apple

Создание и распространение бесплатных приложений требует очень мало настройки в [iTunes Connect](https://itunesconnect.apple.com), однако для продажи платные приложения или покупки из приложений требуется для обеспечения Apple с данными о банковских операций и налогообложения. Щелкните **соглашениями, налогами и банковскими операциями** главном меню, как показано ниже:

 [![](in-app-purchase-basics-and-configuration-images/image2.png "Щелкните соглашениями, налогами и банковскими в главном меню")](in-app-purchase-basics-and-configuration-images/image2.png#lightbox)

Должен иметь учетную запись разработчика **платных приложений iOS** контракта в сущности, как показано на следующем снимке экрана:

 [![](in-app-purchase-basics-and-configuration-images/image3.png "Вашей учетной записи разработчика должен иметь iOS, которые фактически контракта платных приложений")](in-app-purchase-basics-and-configuration-images/image3.png#lightbox)

Вы не сможете протестировать любой StoreKit, пока не получится **платных приложений iOS** контракт: StoreKit вызовы в коде будут завершаться сбоем, пока обработал Apple вашей **контракты, налоги и банковские** сведения.

### <a name="ios-provisioning-portal"></a>Портал подготовки iOS

Новые приложения настраиваются в **идентификаторов приложений** раздел **портал подготовки iOS**. Чтобы создать новый идентификатор приложения, перейдите к [центр участников из портал подготовки iOS](https://developer.apple.com/membercenter/index.action), перейдите к **сертификаты, идентификаторы и профили** раздела на портале и щелкните **идентификаторы** под *приложений iOS*. Затем нажмите кнопку «+» в верхней части право создания нового идентификатора приложения.


Форма для создания новых **идентификаторов приложений**

 выглядит следующим образом:

 [![](in-app-purchase-basics-and-configuration-images/image4.png "Форма для создания новых идентификаторов приложений")](in-app-purchase-basics-and-configuration-images/image4.png#lightbox)

Введите что-нибудь подходящее для *описание*, поэтому можно легко определить этот идентификатор приложения в списке. Для *префикс идентификатора приложения*, выберите идентификатор команды.

#### <a name="bundle-identifierapp-id-suffix-format"></a>Формат суффикс идентификатора приложения или идентификатор пакета

Можно использовать любой строкой, например для вашей **идентификатор пакета** (при условии, что он является уникальным в вашей учетной записи), однако компания Apple рекомендует вам имеют формат обратного запроса DNS, а не использовать произвольную строку. Пример приложения, сопровождающий эту статью использует com.xamarin.storekit.testing для идентификатора пакета, однако было бы допустимым для использования идентификатор как my_store_example (несмотря на то что Apple не рекомендуется).

> [!IMPORTANT]
> Apple позволяет групповые звездочка, добавляемый в конец **идентификатор пакета** , чтобы один идентификатор приложения можно использовать для нескольких приложений, однако _групповые идентификаторы приложений не может использоваться для AppPurchase_. Например, идентификатор пакета групповые com.xamarin.*

#### <a name="enabling-app-services"></a>Включение службы приложений

Обратите внимание, что **покупки в приложении** автоматически включается в списке служб:

 [![](in-app-purchase-basics-and-configuration-images/image5.png "Покупка из приложения будут автоматически включены в списке служб")](in-app-purchase-basics-and-configuration-images/image5.png#lightbox)

#### <a name="provisioning-profiles"></a>Профили подготовки

Создавайте разработки и профили подготовки рабочей среде, как обычно выбор идентификатора приложения, настройки для покупки из приложений. Ссылаться на [подготовки устройства iOS](~/ios/get-started/installation/device-provisioning/index.md) и [публикации в App Store](~/ios/deploy-test/app-distribution/app-store-distribution/publishing-to-the-app-store.md) направляющие Дополнительные сведения.

## <a name="itunes-connect"></a>iTunes Connect

Нажмите кнопку **Мои приложения** в iTunes Connect, чтобы создать или изменить запись приложения iOS. Ниже приведен обзор страницы приложения.

 [![](in-app-purchase-basics-and-configuration-images/image6.png "На странице Обзор приложения")](in-app-purchase-basics-and-configuration-images/image6.png#lightbox)

Нажмите кнопку **покупки из приложений** для создания или изменения ваших продуктов для продажи. На этом снимке экрана показан пример приложения с несколькими продуктами, которые уже добавлены:

 [![](in-app-purchase-basics-and-configuration-images/image7.png "Пример приложения с несколькими продуктами, которые уже добавлен")](in-app-purchase-basics-and-configuration-images/image7.png#lightbox)

Процесс добавления новых продуктов состоит из двух шагов:

1.   Выберите тип продукта: [![](in-app-purchase-basics-and-configuration-images/image8.png "Выберите тип продукта")](in-app-purchase-basics-and-configuration-images/image8.png#lightbox) 
2.   Введите атрибуты продуктов, включая идентификатор продукта, Ценовая категория и локализованные описания: [![](in-app-purchase-basics-and-configuration-images/image9.png "Ввода атрибутов продуктов")](in-app-purchase-basics-and-configuration-images/image9.png#lightbox)

Поля, необходимые для каждого продукта Покупка из приложения, описаны ниже:


### <a name="reference-name"></a>Ссылочное имя

Имя ссылки не отображается для пользователей; он предназначен для внутреннего использования и отображается только в iTunes Connect.

### <a name="product-id-format"></a>Формат идентификатора продукта

Идентификатор продукта может содержать только буквенно-цифровых (A-Z, a – z, 0-9), символ подчеркивания (_) и точка (.) символов. Несмотря на то, что для вашей идентификаторов можно использовать любую строку, компания Apple рекомендует формат обратного запроса DNS. Например пример приложения использует этот идентификатор пакета:

 `com.xamarin.storekit.testing`

Поэтому соглашение для идентификации продуктов Покупка из приложения будет выглядеть следующим образом:

```csharp
com.xamarin.storekit.testing.consume5credits
com.xamarin.storekit.testing.consume10credits
com.xamarin.storekit.testing.sepia
com.xamarin.storekit.testing.greyscale
```

Это соглашение об именовании не применяются, просто рекомендацию, чтобы помочь в управлении ваших продуктов. Кроме того, несмотря на следующие то же соглашение об обратного запроса DNS, идентификаторы продукта, *не связаны* идентификатор пакета и они не требуются для запуска с этой же строкой. По-прежнему будет допустимо использовать идентификаторы, например photo_product_greyscale (несмотря на то что Apple не рекомендуется).

Идентификатор продукта не отображается для пользователей, но он используется для ссылки на продукт в коде приложения.

### <a name="product-type"></a>Тип продукта

Существует пять типов продукта покупки из приложений, которым вы можете предлагать:

1.  **Готовых к использованию** — вещи, которые являются «используемом вверх», например в игре валюты, которые можно потратить проигрыватель. Если пользователь не резервного копирования и восстановления или в противном случае устройство обновляются, готовых к использованию транзакции не восстанавливаются также (что эффективно даст проигрыватель те же преимущества, снова и снова). Код приложения должен быть предоставьте готовых к использованию элемент сразу же после завершения транзакции.
1.  **Не использоваться моделью** — покупок, которые он «владеет» один раз, например цифровой журнал проблему или уровня игры.
1.  **Auto-возобновляемую подписок** — просто как подписке на журнал реального мира, в конце периода подписки в Apple автоматически снова расходов клиента и расширяет срок действия подписки, неограниченно долго, пока клиент явным образом Отменяет ее. Это метод предпочтительных платежных для приложения киоска (на самом деле, приложения должны поддерживать этот метод оплаты, чтобы быть утвержден для киоска распространения).
1.  **Бесплатная подписка** — могут быть предложены только в приложениях с поддержкой киоска, и позволяет клиенту получать доступ к содержимому подписки на своих устройствах. Бесплатные подписки никогда не истекает.
1.  **Без продления подписка** — следует использовать для продажи ограниченный по времени доступ для статического содержимого, например один месяц к архивом фотографии.


 *В настоящее время в этом документе рассматриваются только первый два продукта типы (удобной, а не использоваться моделью).*

 <a name="Price_Tiers" />

### <a name="price-tiers"></a>Уровни цена

Apple предоставляет Фиксированная цена за уровни, вы можете выбрать один из App Store не позволяет выбрать произвольные цены на использование продуктов. Исправленные цены в валюте и Apple сохраняет за собой право изменить относительный цены (например, после длительного изменения в относительный иностранных курс определенной валюты и доллар США).

Apple предоставляет цена матрицу, чтобы помочь вам выбрать правильный уровень для валюты и цен, который будет. Ниже приведен отрывок цена матрицы (август 2012 г.).

 [![](in-app-purchase-basics-and-configuration-images/image10.png "Выдержка из матрицы цена август 2012 г.")](in-app-purchase-basics-and-configuration-images/image10.png#lightbox)

На момент написания статьи (июнь 2013 г) существует 87 уровней с USD 0,99 для 999,99 долл. США. Матрицы цен показана цена, что ваши клиенты будут платить и также сумму, которую вы будете получать от Apple — это меньше их расходов на 30% и также любой местных налогов они необходимы для сбора (Обратите внимание, что в примере, что США и Канады продавцы получают 70 c для 99 p c люч продукта, хотя Австралийский продавцы получают только на 63 c из-за "товары &amp; налоговой службы" переводятся на отпускная цена таких товаров).

Цены на ваш продукт можно обновить в любое время, включая изменения запланированного цен, которые будут действовать на определенную дату в будущем. На этом снимке экрана показано, как добавляется изменение в цене за будущее — цена, временно изменяется с уровня 1 на уровень 3 для сентября только:

 [![](in-app-purchase-basics-and-configuration-images/image11.png "Где цена, временно изменяется с уровня 1 на уровень 3 для сентября только изменение в цене, выпущенных в будущее")](in-app-purchase-basics-and-configuration-images/image11.png#lightbox)

### <a name="free-products-not-supported"></a>Бесплатные продукты, которые не поддерживаются

Несмотря на то, что Apple предоставляет специальные возможность бесплатной подписки для приложения киоска, не позволяют задать ноль (бесплатно) цену для любых других типов покупки в приложении. Можно изменять (т. е. ниже) цены при покупке, не могут вносить покупки из приложений «бесплатный» через iTunes Connect.

### <a name="localization"></a>Локализация

В iTunes Connect можно ввести другой текстовой имя и описание для любого числа поддерживаемых языков. Каждый язык может быть добавлен и изменять их в через контекстное меню:

 [![](in-app-purchase-basics-and-configuration-images/image12.png "Каждый язык может быть добавлен и изменять их в с помощью контекстного меню")](in-app-purchase-basics-and-configuration-images/image12.png#lightbox)   
   
   
   
 После отображения сведений о продукте в приложении, локализованный текст можно отобразить с помощью StoreKit. Отображение валюты, также должны быть переведены Показать правильный символ и форматирование десятичных чисел — это форматирование рассматривается далее в этом документе.

### <a name="app-store-review"></a>Обзор App Store

Совпадение с кодом приложения — каждый продукт, при необходимости, Apple разрешение на переход на продажи. Продукты, которые могут быть отклонены для нежелательного содержимого в имя или описание или Apple может решить, что вы выбрали тип неправильный продукт (например) Вы создали книги или журнала проблема, но использовал тип готовых к использованию продукта). Обзоры продуктов может занять проверку приложения.

При первом запуске приложения отправляется с покупки из приложений включен (будь это новое приложение или добавлены возможности к уже существующей) необходимо также задать некоторые продукты для отправки с ним. На портале iTunes Connect будет предложено сделать это, как показано на следующем снимке экрана:

 [![](in-app-purchase-basics-and-configuration-images/image13.png "На портале iTunes Connect предложит вам отправлять некоторые продукты Майкрософт, а также")](in-app-purchase-basics-and-configuration-images/image13.png#lightbox)   
   
   
   
 Покупки из приложений и приложения будут проверяться вместе, таким образом, чтобы все они получить утверждение за один раз (чтобы это приложение не могу в хранилище без любых утвержденных продуктов!).

После первой версии с возможностью покупки в приложении был утвержден, можно добавить дополнительные продукты и их отправки на проверку в любое время. Вы также можете отправить новую версию вместе с продуктов определенной покупки из приложений с помощью **о версии** странице, как видно из строки.

Ссылаться на [руководства по оценке App Store](https://developer.apple.com/appstore/guidelines.html) Дополнительные сведения.

 [Часть 2. Обзор Store Kit и получение сведений о продукте](~/ios/platform/in-app-purchasing/store-kit-overview-and-retreiving-product-information.md)
