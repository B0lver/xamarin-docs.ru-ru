---
title: PassKit в Xamarin.iOS
description: В приложение Wallet позволяет iOS пользователям хранить цифровой передает на своих устройствах. PassKit framework позволяет разработчикам взаимодействовать с передает программным способом.
ms.prod: xamarin
ms.assetid: 74B9973B-C1E8-B727-3F6D-59C1F98BAB3A
ms.technology: xamarin-ios
author: lobrien
ms.author: laobri
ms.date: 06/13/2018
ms.openlocfilehash: d1c640bef41e875b3bb427d657c9c239e4c3e16d
ms.sourcegitcommit: 4b402d1c508fa84e4fc3171a6e43b811323948fc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61192676"
---
# <a name="passkit-in-xamarinios"></a>PassKit в Xamarin.iOS

В приложение Wallet iOS позволяет пользователям хранить цифровой передает на своих устройствах.
Эти пропуски создаются коммерсантами и отправлено по электронной почте, URL-адреса, или с помощью продавца в собственные приложения iOS. Эти пропуски может представлять разные действия, от билеты на фильм баллов для посадочные талоны. PassKit framework позволяет разработчикам взаимодействовать с передает программным способом.

В этом документе представлены кошелек и с помощью PassKit API с Xamarin.iOS.

 [![](passkit-images/image1.png "Wallet, хранит и упорядочивает все этапы, на телефоне")](passkit-images/image1.png#lightbox)

## <a name="requirements"></a>Требования

PassKit функциям, рассматриваемым в этом документе требуют iOS 6 и Xcode 4.5, а также Xamarin.iOS 6.0.

## <a name="introduction"></a>Вступление

Ключевой проблемой, которая решает PassKit является распространения и управления штрихкоды. Вот несколько примеров реальных использования штрих-коды в настоящее время:

-   **Приобретение через Интернет билеты на фильм** — клиенты обычно по электронной почте штрих-код, представляющий их билетов. Этот штрихкод печатается и затраченное на кинотеатрах, который должен проверяться для записи.
-   **Баллов** — клиентов содержат ряд различных конкретного хранилища карт в wallet или парковке, для отображения и сканирование при покупке товаров.
-   **Купоны** — купоны распространяются по электронной почте, в виде печатного веб-страницы, через горизонтальные рамки и как штрихкоды в газеты и журналы. Клиенты привести их в хранилище для сканирования, взамен получать товары, услугам и скидкам.
-   **С передачей передает** — аналогичен покупке билета фильма.

PassKit предлагает альтернативный подход для каждого из этих сценариев:

-   **Билеты на фильм** — после покупки, клиент добавляет передать запрос в службу событий (с помощью электронной почты или ссылку веб-сайта). В то время для фрагмента подходы pass, автоматически отобразятся на экране блокировки Напоминаем, и при получении в кинотеатрах pass легко извлекается и отображается в Wallet для сканирования.
-   **Баллов** — вместо (или в дополнение к) программное обеспечение использования физических карт, хранилища может выдавать (по электронной почте или после входа веб-сайта) за проход карты Store. Хранилище можно предоставить дополнительные функции, такие как обновление сальдо счета при проходе через Push-уведомлений, а с помощью служб geolocation pass может автоматически отображаются на экране блокировки когда клиент превышает это расположение хранилища.
-   **Купоны** — передает купона может легко создавать с уникальными характеристиками, помогающие при отслеживании и распределенных с помощью ссылок на адрес электронной почты или веб-сайта. Скачанный купоны можно автоматически отображаются на экране блокировки, если пользователь является практически определенное расположение, и (или) в указанный день (например, когда приближается Дата окончания срока действия). Так как купоны хранятся на телефон пользователя, они всегда под рукой и не потерян. Купоны может предлагать клиентам скачать карт разрабатываются дополнительные приложения, поскольку приложение Store ссылки могут быть включены в Pass, увеличение взаимодействия с клиентом.
-   **С передачей передает** — после возврата процесс в сети, клиент получит их посадочный по электронной почте или ссылку. Сопутствующее приложение, предоставляемых поставщиком транспорта удалось включите процесс возврата, а также позволяют клиенту для выполнения дополнительных функций, таких как выбор их рабочее место или обед. Поставщик транспорта можно использовать Push-уведомления для обновления pass, если транспортный элемент откладывается или отменено. При приближении времени посадочные pass будет отображаться на экране блокировки, Напоминаем и для предоставления быстрого доступа для передачи.

По существу PassKit предоставляет простой и удобный способ хранения и отображения штрихкоды на устройстве iOS. Дополнительное время и расположение интеграции экран блокировки Push-уведомления и дополнительное приложение интегрировать его предоставляет основу для очень сложных продажи, учета и выставление счетов служб.

## <a name="passkit-ecosystem"></a>Экосистема PassKit

PassKit не просто API в платформе CocoaTouch, а он является частью большего размера экосистема приложений, данных и служб, предназначенных для упрощения безопасного совместно использования и управления штрихкодов и другие данные. Высокоуровневые схеме ниже показаны различные сущности, которые могут принимать участие в создании и использовании проходов.

 [![](passkit-images/image2.png "Это общая схема показаны сущности, участвующие в создании и использовании передает")](passkit-images/image2.png#lightbox)

Каждый фрагмент экосистемы имеет четко определенные роли:

-   **Wallet** — Apple встроенное приложение iOS, хранит и отображает проходов. Это является единственным местом, который передает подготавливаются к просмотру для использования в реальном мире (т. е штрихкода отображается, вместе с данными, локализованных на этапе).
-   **Сопутствующих приложений** — приложения iOS 6, созданные передать поставщиков для расширения функциональных возможностей проходов, выдачи, таких как добавление значения в карте магазина, изменение место в посадочный или другие функции конкретного бизнеса. Карт разрабатываются дополнительные приложения не являются обязательными для прохождения будут полезны.
-   **Сервер** — защищенном сервере, где передает можно созданный и подписанный для распространения. Вспомогательное приложение может подключиться к серверу для создания нового передает или запрос обновления для существующих проходов. При необходимости может реализовать веб-служба API, который нужно вызвать Wallet, чтобы обновить передает.
-   **Серверы APNS** — сервер имеет возможность уведомить Wallet обновлений для этапа на данном устройстве с помощью APNS. Отправьте уведомление Wallet, который затем будет связаться с сервером для сведения об изменении. Карт разрабатываются дополнительные приложения не обязательно должны реализовать APNS для этой функции (они могут прослушивать `PKPassLibraryDidChangeNotification` ).
-   **Каналом приложений** — приложения, которые не работают со напрямую передает (как карт разрабатываются дополнительные приложения), но что может повысить свои программы, распознает передает и позволяя им добавляемый Wallet. Почтовые клиенты, браузеры социальных сетей и других приложениях статистической обработки данных все возникающие вложения или ссылки на этапы.

Экосистемы в целом выглядит сложным, поэтому стоит отметить, что некоторые компоненты являются необязательными, и гораздо проще реализаций PassKit возможны.

## <a name="what-is-a-pass"></a>Что такое атака Pass?

Pass — это совокупность данных, представляющий запрос в службу, купона или карты. Могут быть предназначены для однократного использования пользователем (и поэтому содержит сведения, такие как рейсов номер и рабочее место размещения) или же это может несколько используйте маркер, который может совместно использоваться любое число пользователей (например, купон на скидку). Подробное описание доступно в Apple [о передаче файлов](https://developer.apple.com/library/prerelease/ios/#documentation/UserExperience/Reference/PassKit_Bundle/Chapters/Introduction.html) документа.

### <a name="types"></a>Типы

В настоящее время пять поддерживаемых типов, которые можно будет различить в приложение Wallet макет и верхней границе элемента pass:

-  **Событие билет** – небольшой полукруглые обрезки.
-   **Pass адаптации** — деления в сторону, связанные с транспортом значок можно указать (например) шины, обучение, "в самолете").
-   **Store карты** — скругленными сверху, например кредитной или дебетовой карты.
-  **Купона** — перфорированной вдоль верхней.
-  **Универсальный** — то же, что карты Store, закругленной вершиной.


На этом снимке экрана показаны пять pass типы (в порядке: купона, generic, хранения, карты, посадочный и билет событий):

 [![](passkit-images/image3.png "На этом снимке экрана показаны типы пять pass")](passkit-images/image3.png#lightbox)

### <a name="file-structure"></a>Структура файла

Передайте файл является фактически ZIP-архив с **.pkpass** , содержащий несколько конкретных файлов JSON (обязательно), различные изображения файлы с расширением (необязательно) а также локализованные строки (необязательно).

-   **PASS.JSON** — обязательный. Содержит все сведения для прохода.
-   **manifest.JSON** — обязательный. Содержит хэш SHA1 для каждого файла в pass, за исключением файл сигнатур и этот файл (manifest.json).
-   **подпись** — обязательный. Созданный путем подписания `manifest.json` файл с помощью сертификата, созданного на портале подготовки iOS.
-  **Logo.PNG** — необязательно.
-  **Background.PNG** — необязательно.
-  **icon.PNG** — необязательно.
-  **Файлы локализуемые строки** — необязательно.

Структура каталогов pass файла приведена ниже (это содержимое ZIP-архив):

 [![](passkit-images/image4.png "Структура каталогов файла pass приведена здесь")](passkit-images/image4.png#lightbox)

### <a name="passjson"></a>PASS.JSON

JSON — это формат, так как передает обычно создаются на сервере — это означает, что код создания независимых от платформы на сервере. Приведены три основных элемента информации на каждом этапе.

-   **teamIdentifier** – это свяжет все этапы, создать учетную запись App Store. Это значение отображается в на портале подготовки iOS.
-   **passTypeIdentifier** — Зарегистрируйтесь на портале подготовки к группе передает друг с другом (Если вы создаете более одного типа). Например кафе создать тип хранилища карт pass, чтобы позволяют своим клиентам заработать деньги на счете лояльности, но также отдельные купона передачи типа для создания и распространения купоны скидки. Этот же кафе может даже содержать события динамической музыки и выдача передает запрос в службу событий для тех.
-   **serialNumber** — уникальную строку в это `passTypeidentifier` . Значение является непрозрачным для Wallet, но важна для отслеживания конкретных проходах при обмене данными с сервером.

Есть много других ключей JSON, в каждом проходе, пример которого приведен ниже:

``` 
{
   "passTypeIdentifier":"com.xamarin.passkitdoc.banana",  //Type Identifier (iOS Provisioning Portal)
   "formatVersion":1,                                     //Always 1 (for now)
   "organizationName":"Xamarin",                          //The name which appears on push notifications
   "serialNumber":"12345436XYZ",                          //A number for you to identify this pass
   "teamIdentifier":"XXXAAA1234",                         //Your Team ID
   "description":"Xamarin Demo",                          //
   "foregroundColor":"rgb(54,80,255)",                    //color of the data text (note the syntax)
   "backgroundColor":"rgb(209,255,247)",                  //color of the background
   "labelColor":"rgb(255,15,15)",                         //color of label text and icons
   "logoText":"Banana ",                                  //Text that appears next to logo on top
   "barcode":{                                            //Specification of the barcode (optional)
      "format":"PKBarcodeFormatQR",                       //Format can be QR, Text, Aztec, PDF417
      "message":"FREE-BANANA",                            //What to encode in barcode
      "messageEncoding":"iso-8859-1"                      //Encoding of the message
   },
   "relevantDate":"2012-09-15T15:15Z",                    //When to show pass on screen. ISO8601 formatted.
  /* The following fields are specific to which type of pass. The name of this object specifies the type, e.g., boardingPass below implies this is a boarding pass. Other options include storeCard, generic, coupon, and eventTicket */
   "boardingPass":{
/*headerFields, primaryFields, secondaryFields, and auxiliaryFields are arrays of field object. Each field has a key, label, and value*/
      "headerFields":[          //Header fields appear next to logoText
         {
            "key":"h1-label",   //Must be unique. Used by iOS apps to get the data.
            "label":"H1-label", //Label of the field
            "value":"H1"        //The actual data in the field
         },
         {
            "key":"h2-label",
            "label":"H2-label",
            "value":"H2"
         }
      ],
      "primaryFields":[       //Appearance differs based on pass type
         {
            "key":"p1-label",
            "label":"P1-label",
            "value":"P1"
         }
      ],
      "secondaryFields":[     //Typically appear below primaryFields
         {
            "key":"s1-label",
            "label":"S1-label",
            "value":"S1"
         }
      ],
      "auxiliaryFields":[    //Appear below secondary fields
         {
            "key":"a1-label",
            "label":"A1-label",
            "value":"A1"
         }
      ],
      "transitType":"PKTransitTypeAir"  //Only present in boradingPass type. Value can
                                        //Air, Bus, Boat, or Train. Impacts the picture
                                        //that shows in the middle of the pass.
   }
}
```

### <a name="barcodes"></a>Штрих-коды

Поддерживаются только форматы 2D: PDF417, Aztec, QR. Apple утверждений, что одномерные штрих-коды являются непригодна для сканирования на экране телефона с подсветкой.

Альтернативный текст, отображаемый под ним необязателен – некоторые продавцы хотите иметь возможность чтения или типа вручную.

Кодировка ISO-8859-1 — наиболее распространенных, проверка, какая кодировка используется сканирования системы, в которых будет считывать к передает.

### <a name="relevancy-lock-screen"></a>Релевантность (блокировка экрана)

Существует два типа данных, которые могут вызвать pass, отображаемый на экране блокировки.

 **Расположение**

Можно указать до 10 расположений проход, например хранилищ, которые часто посещает клиента или расположение кинотеатрах или аэропорта. Клиент может задать эти расположения с помощью дополнительного приложения или поставщик может определить их на основе данных об использовании (если собранные с разрешением клиента).

При отображении на экране блокировки pass барьер вычисляется таким образом, когда пользователь покидает область pass скрыт с экрана блокировки. Радиус привязывается к передайте стиль, чтобы избежать злонамеренного использования.

 **Дата и время**

Можно указать только один даты и времени в цикл. Дата и время полезно для активации напоминания экрана блокировки для посадочные талоны и билеты событий.

Можно обновить с помощью Push-уведомлений или PassKit API таким образом, чтобы значения даты и времени могут быть обновлены в случае многократного использования билета (например, билет сезона theatre или спортивных комплексного).

### <a name="localization"></a>Локализация

Перевод pass на несколько языков аналогичен локализации приложений iOS: создание языка определенные каталоги с `.lproj` расширения и поместите локализованные элементы внутри. Переводы текста следует вводить в `pass.strings` файл, хотя локализованных изображений должны иметь имя, совпадающее с именем образа, они заменяют в корне Pass.

## <a name="security"></a>Безопасность

Передает подписываются с помощью закрытый сертификат, который будет создан на портале подготовки iOS. Приведены шаги для входа на проход.

1.  Вычислить хэш SHA1 для каждого файла в каталоге pass (не используйте `manifest.json` или `signature` файл, ни один из которых должна существовать в любом случае на этом этапе).
1.  Запись `manifest.json` как список ключей и значений JSON с хэшем к каждому имени файла.
1.  Использовать сертификат для подписи `manifest.json` файла и записи результата в файл с именем `signature` .
1.  АРХИВИРОВАТЬ все, что и присвоить полученный файл `.pkpass` расширение файла.


Так как ваш закрытый ключ необходим для подписывания pass, этот процесс должно осуществляться только на защищенном сервере, которым вы управляете. НЕ распространяйте ключи попробуем создать передает в приложение.

 
## <a name="configuration-and-setup"></a>Установка и настройка

Этот раздел содержит инструкции, которые помогут вашей подготовки сведения о настройке и создать ваш первый проход.

### <a name="provisioning-passkit"></a>Подготовка PassKit

Чтобы pass ввести App Store он должен быть привязан к учетной записи разработчика. Это в два этапа:

1.  Pass должны быть зарегистрированы с использованием уникального идентификатора, под названием передать тип ID.
1.  Должен быть создан действительный сертификат для подписи pass цифровой подписью разработчика.

Для создания следующих do ИД типа карты.

#### <a name="create-a-pass-type-id"></a>Создать идентификатор типа Pass

Первым шагом является настройка ИД типа карты для каждая новая _тип_ этапа, которые должны поддерживаться. Передайте идентификатор (или идентификатор типа передачи) создает уникальный идентификатор для прохода. Мы будем использовать этот идентификатор для связывания pass с учетной записью разработчика, с помощью сертификата.

1. В [сертификаты, идентификаторы и профили части на портале подготовки iOS](https://developer.apple.com/account/overview.action), перейдите к **идентификаторы** и выберите **передать идентификаторы типов** . Затем выберите **+** кнопку, чтобы создать новый тип этапа: [![](passkit-images/passid.png "Создание нового типа pass")](passkit-images/passid.png#lightbox)

2.   Укажите **описание** (имя) и **идентификатор** (уникальная строка) для прохода. Обратите внимание, что все идентификаторы типов для передачи должен начинаться со строки `pass.` в этом примере мы используем `pass.com.xamarin.coupon.banana` : [![](passkit-images/register.png "Изменить описание и идентификатор")](passkit-images/register.png#lightbox)


3.   Подтвердите ИД, нажав кнопку **зарегистрировать** кнопки.

#### <a name="generate-a-certificate"></a>Создание сертификата

Чтобы создать новый сертификат для этого ИД типа карты, сделайте следующее:

1.  Выберите только что созданный идентификатор передачи из списка и нажмите кнопку **изменить** : [![](passkit-images/pass-done.png "Выберите в списке новый ИД")](passkit-images/pass-done.png#lightbox)

    Выберите **Create Certificate...** :

    [![](passkit-images/cert-dist.png "Выберите Создание сертификата")](passkit-images/cert-dist.png#lightbox)


2.  Выполните действия для создания подписи сертификата запроса (CSR).
  
3. Нажмите клавишу **Продолжить** кнопку на портале разработчика и отправьте его для создания сертификата.

4. Загрузите сертификат и дважды щелкните его, чтобы установить его в вашей связке ключей.


Теперь, когда мы создали сертификат для этого ИД типа карты, следующем разделе описывается создание проверку вручную.

Дополнительные сведения о подготовке для Wallet см [работа с возможностями](~/ios/deploy-test/provisioning/capabilities/wallet-capabilities.md) руководства.

### <a name="create-a-pass-manually"></a>Создать цикл вручную

Теперь, когда мы создали передать тип, можно вручную создайте цикл для тестирования на симуляторе или на устройстве. Ниже приведены шаги для создания карты.

-  Создайте каталог для хранения файлов pass.
-  Создайте файл pass.json, содержащий все необходимые данные.
-  Включите изображения в папке (при необходимости).
-  Вычислить хэш SHA1 для каждого файла в папке и запись в manifest.json.
-  Подписывать manifest.json Скачанный сертификат P12-файл.
-  ZIP-содержимое каталога и переименуйте с расширением .pkpass.


Существуют некоторые исходные файлы в [пример кода](https://developer.xamarin.com/samples/monotouch/PassKit/) для этой статьи, который может использоваться для создания за проход. Используйте файлы из `CouponBanana.raw` каталог CreateAPassManually каталога. Присутствуют следующие файлы:

 [![](passkit-images/image18.png "Эти файлы присутствуют")](passkit-images/image18.png#lightbox)

Откройте pass.json и изменить содержимое JSON. По крайней мере, необходимо обновить `passTypeIdentifier` и `teamIdentifer` в соответствии с вашей учетной записи разработчика Apple.

```csharp
"passTypeIdentifier" : "pass.com.xamarin.coupon.banana",
"teamIdentifier" : "?????????",
```

Затем необходимо вычислить хеш-коды для каждого файла и создать `manifest.json` файл. Он будет выглядеть следующим образом после завершения:

```csharp
{
  "icon@2x.png" : "30806547dcc6ee084a90210e2dc042d5d7d92a41",
  "icon.png" : "87e9ffb203beb2cce5de76113f8e9503aeab6ecc",
  "pass.json" : "c83cd1441c17ecc6c5911bae530d54500f57d9eb",
  "logo.png" : "b3cd8a488b0674ef4e7d941d5edbb4b5b0e6823f",
  "logo@2x.png" : "3ccd214765507f9eab7244acc54cc4ac733baf87"
}
```

Затем подпись должен быть создан для этого файла, с помощью сертификата (P12-файл), который был создан для этого передайте тип идентификатора.

#### <a name="signing-on-a-mac"></a>Подписи на компьютере Mac

Скачайте **Wallet начальное значение техническими материалами** из [загружает Apple](https://developer.apple.com/downloads/index.action?name=Passbook) сайта. Используйте `signpass` средство для преобразования папки в pass (это также будет рассчитываться SHA1 хэширует и ZIP-выходные данные в файл .pkpass).

#### <a name="testing"></a>Тестирование

Если для проверки выходных данных из этих средств (Задание имени файла на ZIP и откройте его), вы увидите следующие файлы (Обратите внимание, добавление `manifest.json` и `signature` файлов):

 [![](passkit-images/image19.png "Изучить выходные данные этих средств")](passkit-images/image19.png#lightbox)

После подписи, ZIPped и переименовала этот файл (например) Чтобы `BananaCoupon.pkpass`) можно перетащить его в симулятор для тестирования или отправить по электронной почте его для извлечения на реальных устройствах. Вы должны увидеть экран для **Add** pass, следующим образом:

 [![](passkit-images/image20.png "Добавление экрана pass")](passkit-images/image20.png#lightbox)

Обычно бы автоматизировать этот процесс на сервере, однако ручного создания pass может быть приемлемым вариантом для малого бизнеса, только при создании купонов, не требуется поддержка внутреннего сервера.

## <a name="wallet"></a>Wallet

Wallet — это Центральная часть экосистемы PassKit. На этом снимке экрана показаны пустой Wallet и внешний вид списка pass и отдельных этапов:

 [![](passkit-images/image21.png "На этом снимке экрана показано пустой Wallet, а также внешний вид списка pass и отдельных этапов")](passkit-images/image21.png#lightbox)

Возможности Wallet.

-  Он является единственным местом, передает отрисовываются с помощью их штрихкода для сканирования.
-  Пользователь может изменить параметры для обновлений. Если параметр включен, Push-уведомления могут активировать обновления данных при передаче.
-  Пользователь может включить или отключить интеграцию с экрана блокировки. Если параметр включен, это позволяет pass, автоматически появляются на экране блокировки, на основе соответствующих время и расположение данных, внедренных в pass.
-  Обратной стороне pass поддерживает по запросу для обновления, если web-server-URL-адрес предоставляется в pass JSON.
-  Помощник по поиску приложений можно открыть (или скачать) Если идентификатор приложения предоставляется в pass JSON.
-  Передает можно удалить (с милый разбиения анимации).

## <a name="adding-passes-into-wallet"></a>Добавление этапов в Wallet

Передает могут добавляться к Wallet одним из следующих способов:

* **Каналом приложений** — они не управляют передает напрямую, они просто загрузить файлы pass и предоставить пользователю возможность добавления карт в Wallet. 

* **Сопутствующих приложений** — они записываются поставщиками для распространения передает и предлагают дополнительные возможности можно просматривать или редактировать их. Приложений Xamarin.iOS имеют полный доступ к API для создания и управления передает PassKit. Затем можно добавить передает с помощью Wallet `PKAddPassesViewController`. Этот процесс описан более подробно в **приложений Companion** настоящего документа.

### <a name="conduit-applications"></a>Каналом приложений

Приложения каналом, промежуточных приложений, которые могут получать передает от имени пользователя и должен быть запрограммированы для распознавания типу содержимого и предоставляют функциональные возможности для добавления к кошельку. Примеры приложений каналом.

-   **Mail** — распознает вложение проход.
-   **Safari** — распознает pass Content-Type, при нажатии на ссылку pass URL-адрес.
-   **Другие пользовательские приложения** – любое приложение, которое получать вложения или открывать ссылки (социальных клиентах, читатели электронной почты, и т.д.).


На этом снимке экрана показано, как **Mail** в iOS 6 распознает вложение pass и (при касании) предлагает **добавить** его Wallet.

 [![](passkit-images/image22.png "На этом снимке экрана показано, как письма в iOS 6 распознает вложение pass")](passkit-images/image22.png#lightbox)

 [![](passkit-images/image23.png "На этом снимке экрана показано, как почта предлагает добавляется вложение pass карт в Wallet")](passkit-images/image23.png#lightbox)

Если вы создаете приложение, которое может быть каналом для проходов, они могут распознать.

-  **Расширение файла** -.pkpass
-  **Тип MIME** -application/vnd.apple.pkpass
-  **UTI** — com.apple.pkpass


Основной процесс работы приложения каналом — получить файл pass и вызвать его PassKit `PKAddPassesViewController` дать пользователю возможность добавить pass их Wallet. Реализация этого контроллера представлений рассматривается в следующем разделе на **приложений Companion**.

Каналом приложений не обязательно должны быть подготовлены для определенную парольную идентификатор типа в точно так же, сопровождающий приложения.

## <a name="companion-applications"></a>Помощник по поиску приложений

Это дополнительное приложение предоставляет дополнительные функциональные возможности для работы с проходит успешно, включая создание Pass, обновление данных, связанных с проходом и других аспектов управления этапах, связанных с приложением.

Помощник по поиску приложений не следует пытаться функции Wallet. Они не предназначены для отображения этапов для сканирования.

Далее в этом разделе описывается создание базовое дополнительное приложение, взаимодействующее с PassKit.

### <a name="provisioning"></a>Подготовка

Так как Wallet — это технология магазина, приложение должно быть подготовлено отдельно и нельзя использовать профиль подготовки команды или идентификатор приложения подстановочный знак. Ссылаться на [работа с возможностями](~/ios/deploy-test/provisioning/capabilities/wallet-capabilities.md) руководство по созданию уникальный идентификатор приложения и профиль подготовки для приложения Wallet.

### <a name="entitlements"></a>Права

**Entitlements.plist** файла должны быть включены в всех последних проектов Xamarin.iOS. Чтобы добавить новый файл Entitlements.plist, выполните действия, описанные в [работа с назначениями](~/ios/deploy-test/provisioning/entitlements.md) руководства.

Чтобы задать права выполните следующие действия:

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

Дважды щелкните **Entitlements.plist** файла на панели решения, чтобы открыть в редакторе файлов Entitlements.plist:

![](passkit-images/image31.png "Редактор Entitlements.plst")

В разделе "Wallet", выберите **включить кошелек** параметр

![](passkit-images/image32.png "Включить кошелек прав")


Значение по умолчанию — для вашего приложения разрешить всеми типами карт. Тем не менее существует возможность ограничить работу приложения и только с подмножеством типов карт. Для этого выберите **разрешить подмножество team передаче типов** и введите идентификатор типа pass подмножество, которое вы хотите разрешить.

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

Дважды щелкните **Entitlements.plist** файл, чтобы открыть исходный файл XML.

Чтобы добавить назначение Wallet, задайте **свойство** для `Passbook Identifiers` в раскрывающемся списке, который автоматически установит **тип** `Array`. Затем задайте строку **значение** для `$(TeamIdentifierPrefix)*`:

![](passkit-images/image33.png "Включить кошелек прав")

Это позволит вашему приложение работать со всеми типами карт. Чтобы ограничить работу приложения и только с подмножеством типов карт, задайте строковое значение:

`$(TeamIdentifierPrefix)pass.$(CFBundleIdentifier)`

Где `pass.$(CFBundleIdentifier)` является Идентификатором pass, будет создана [выше](~/ios/platform/passkit.md)

-----

### <a name="debugging"></a>Отладка

При наличии проблем с развертыванием приложения, убедитесь, что используется правильный **профиль подготовки** и что `Entitlements.plist` выбран в качестве **настраиваемые назначения** файл в **подписывание пакета iPhone** параметры.

При появлении этой ошибки при развертывании:

```csharp
Installation failed: Your code signing/provisioning profiles are not correctly configured (error: 0xe8008016)
```

затем `pass-type-identifiers` неверный массива назначения (или не соответствует **профиль подготовки**). Проверьте правильность идентификаторы передачи типов и идентификатора вашей команды.

## <a name="classes"></a>Классы

Следующие классы PassKit доступны для приложений для доступа к этапов:

-  **PKPass** — экземпляр за проход.
-  **PKPassLibrary** — предоставляет API для доступа к передает на устройстве.
-  **PKAddPassesViewController** — используется для отображения pass для пользователя сохранить в их Wallet.
-  **PKAddPassesViewControllerDelegate** — разработчики Xamarin.iOS

## <a name="example"></a>Пример

Ссылаться на проект PassLibrary в [пример кода](https://developer.xamarin.com/samples/monotouch/PassKit/) для этой статьи. Он демонстрирует следующие общие функции, которые потребуются в это дополнительное приложение Wallet:

### <a name="check-that-wallet-is-available"></a>Убедитесь, что Wallet доступно

Wallet недоступен на устройствах iPad, поэтому приложения следует проверить перед попыткой обращения к функции PassKit.

```csharp
if (PKPassLibrary.IsAvailable) {
    // create an instance and do stuff...
}
```

### <a name="creating-a-pass-library-instance"></a>Создание экземпляра библиотеки Pass

Библиотека PassKit не является одноэлементным множеством, приложения должны создавать и хранить и экземпляр для доступа к PassKit API.

```csharp
if (PKPassLibrary.IsAvailable) {
    library = new PKPassLibrary ();
    // do stuff...
}
```

### <a name="get-a-list-of-passes"></a>Получить список этапов

Приложения могут запросить список передает из библиотеки. Этот список автоматически фильтруется по PassKit, таким образом, будут отображаться только этапы, которые созданы с помощью идентификатора вашей команды и перечислены в на правах.

```csharp
var passes = library.GetPasses ();  // returns PKPass[]
```

Обратите внимание, что симулятор не отфильтровать список этапов, которые возвращаются, поэтому этот метод необходимо протестировать на реальных устройствах. Этот список могут отображаться в UITableView. [Пример приложения](https://developer.xamarin.com/samples/monotouch/PassKit/) выглядит следующим образом после добавления двух купоны:

 [![](passkit-images/image29.png "Внешний вид пример приложения следующим образом, после добавления двух купонов")](passkit-images/image29.png#lightbox)

### <a name="displaying-passes"></a>Отображение передает

Для подготовки к просмотру передает в карт разрабатываются дополнительные приложения доступен ограниченный набор информации.

Выберите из этого набора стандартных свойств для отображения списков проходит успешно, как в примере кода.

```csharp
string passInfo =
                "Desc:" + pass.LocalizedDescription
                + "\nOrg:" + pass.OrganizationName
                + "\nID:" + pass.PassTypeIdentifier
                + "\nDate:" + pass.RelevantDate
                + "\nWSUrl:" + pass.WebServiceUrl
                + "\n#" + pass.SerialNumber
                + "\nPassUrl:" + pass.PassUrl;
```

Эта строка отображается в виде предупреждения в [пример](https://developer.xamarin.com/samples/monotouch/PassKit/):

 [![](passkit-images/image30.png "Предупреждение купона выбран в образце")](passkit-images/image30.png#lightbox)

Можно также использовать `LocalizedValueForFieldKey()` метод для извлечения данных из поля этапов проектирования (так как вы будете знать, какие поля должны присутствовать). В примере кода это не отображаются.

### <a name="loading-a-pass-from-a-file"></a>Загрузка цикл из файла

Так как за проход могут добавляться только к кошельку с разрешения пользователя, контроллер представления должно быть предоставлено позволить им с выбором. Этот код используется в **добавить** кнопки в примере, чтобы загрузить предварительно созданные pass, которое внедрено в приложении (это следует заменить на тот, который вы выполнили вход):

```csharp
NSData nsdata;
using ( FileStream oStream = File.Open (newFilePath, FileMode.Open ) ) {
        nsdata = NSData.FromStream ( oStream );
}
var err = new NSError(new NSString("42"), -42);
var newPass = new PKPass(nsdata,out err);
var pkapvc = new PKAddPassesViewController(newPass);
NavigationController.PresentModalViewController (pkapvc, true);
```

Pass предоставляется **добавить** и **отменить** параметры:

 [![](passkit-images/image20.png "Различные варианты, добавить \"и\" Отмена pass")](passkit-images/image20.png#lightbox)

### <a name="replace-an-existing-pass"></a>Замените существующий проход

Замена существующих передать не требует разрешения пользователя, однако он завершится ошибкой, если pass еще не существует.

```csharp
if (library.Contains (newPass)) {
     library.Replace (newPass);
}
```

### <a name="editing-a-pass"></a>Редактирование Pass

PKPass не является изменяемой, поэтому не удается обновить объекты pass в коде. Для изменения данных в передаче приложение должно иметь доступ к веб-сервер, который может сохраняться записи об этапах и создайте новый файл pass с обновленными значениями, которые можно загрузить приложение.

Создание файла PASS необходимо сделать на сервере, поскольку передает должен быть подписан сертификатом, которые должны быть защищены, конфиденциальность и безопасность.

После создания файла обновленные pass, используйте `Replace` метод перезаписывает старые данные на устройстве.

### <a name="display-a-pass-for-scanning"></a>Отображать за проход для сканирования

Как уже говорилось ранее, только Wallet можно отобразить pass для сканирования. Цикл можно отобразить с помощью `OpenUrl` метод, как показано:

 `UIApplication.SharedApplication.OpenUrl (p.PassUrl);`

### <a name="receiving-notifications-of-changes"></a>Получать уведомления об изменениях

Приложения могут вести прослушивание для изменения, внесенные в библиотеку передать с помощью `PKPassLibraryDidChangeNotification`. Изменения может быть вызвано уведомления, активируя обновлений в фоновом режиме, поэтому рекомендуется отслеживать их в приложении.

```csharp
noteCenter = NSNotificationCenter.DefaultCenter.AddObserver (PKPassLibrary.DidChangeNotification, (not) => {
    BeginInvokeOnMainThread (() => {
        new UIAlertView("Pass Library Changed", "Notification Received", null, "OK", null).Show();
        // refresh the list
        var passlist = library.GetPasses ();
        table.Source = new TableSource (passlist, library);
        table.ReloadData ();
    });
}, library);  // IMPORTANT: must pass the library in
```

Передайте экземпляр библиотеки при регистрации для уведомления, так как PKPassLibrary не является одноэлементным множеством, важно.

## <a name="server-processing"></a>Сервер обработки

Подробное описание созданию серверного приложения для поддержки PassKit выходит за рамки данной вводной статьи.

См. в разделе [расчетной книжки dotnet](https://github.com/tomasmcguinness/dotnet-passbook) открытым исходным кодом C# серверного кода.

## <a name="push-notifications"></a>Push-уведомления

Подробное описание с помощью Push-уведомления для обновления передает выходит за рамки данной вводной статьи.

Будет необходимо реализовать действующие по принципу REST API, определенный по Apple, чтобы отвечать на веб-запросов от Wallet, когда требуются обновления.

См. в разделе Apple [обновление за проход](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Updating.html#//apple_ref/doc/uid/TP40012195-CH5-SW1) для дополнительных сведений.

## <a name="summary"></a>Сводка

В этой статье представлены PassKit, описанные ниже перечислены некоторые причины, почему это удобно и описано те элементы, которые должны быть реализованы для полного решения PassKit. Он описываются шаги, необходимые для настройки учетной записи разработчика Apple для создания этапы, процесс, чтобы сделать цикл вручную, а также как получить доступ к API-интерфейсы PassKit из приложения Xamarin.iOS.

## <a name="related-links"></a>Связанные ссылки

- [Wallet для разработчиков](https://developer.apple.com/wallet/)
- [Пример PassKit](https://developer.xamarin.com/samples/monotouch/PassKit/)
- [Руководство разработчика wallet](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/index.html#//apple_ref/doc/uid/TP40012195-CH1-SW1)
- [Платформы – Apple Pay и Wallet (WWDC видео)](https://developer.apple.com/videos/frameworks/apple-pay-and-wallet)
- [Ссылка на платформу PassKit](https://developer.apple.com/library/prerelease/ios/#documentation/UserExperience/Reference/PassKit_Framework/_index.html)
- [Расчетная книжка Web Service Reference](https://developer.apple.com/library/prerelease/ios/#documentation/PassKit/Reference/PassKit_WebService/WebService.html)
- [О файлах Pass](https://developer.apple.com/library/prerelease/ios/#documentation/UserExperience/Reference/PassKit_Bundle/Chapters/Introduction.html)
- [DotNet-расчетной книжки](https://github.com/tomasmcguinness/dotnet-passbook), библиотекой с открытым исходным кодом для создания iOS Wallet пакетов
- [Введение в iOS 6](~/ios/platform/introduction-to-ios6/index.md)
