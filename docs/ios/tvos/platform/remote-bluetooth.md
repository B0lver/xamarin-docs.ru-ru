---
title: Siri контроллеры удаленного подключения и Bluetooth для tvOS в Xamarin
description: В этой статье описывается, как работать с Siri удаленными устройствами и игровыми контроллерами Bluetooth в приложениях tvOS, написанных с помощью Xamarin.
ms.prod: xamarin
ms.assetid: BDB9894A-236B-424B-9032-ACD12A6C5720
ms.technology: xamarin-ios
author: davidortinau
ms.author: daortin
ms.date: 03/16/2017
ms.openlocfilehash: a97d3da4f451051dcb17c68da54cadf7d841fd50
ms.sourcegitcommit: 93e6358aac2ade44e8b800f066405b8bc8df2510
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/09/2020
ms.locfileid: "84566231"
---
# <a name="siri-remote-and-bluetooth-controllers-for-tvos-in-xamarin"></a>Siri контроллеры удаленного подключения и Bluetooth для tvOS в Xamarin

Пользователи приложения Xamarin. tvOS не будут взаимодействовать с интерфейсом напрямую, как с iOS, где они наследуют образы на экране устройства, но косвенно из комнаты, использующей [Удаленный Siri](#The-Siri-Remote).

Если приложение является игрой, при необходимости можно создать поддержку сторонних производителей для устройств iOS (MFI) и [игровых контроллеров Bluetooth](#Bluetooth-Game-Controllers) в приложении.

[![](remote-bluetooth-images/intro01.png "The Bluetooth Remote and Game Controller")](remote-bluetooth-images/intro01.png#lightbox)

В этой статье описываются [Siri удаленные](#The-Siri-Remote), [жесты сенсорной поверхности](#Touch-Surface-Gestures) и [удаленные кнопки Siri](#Siri-Remote-Buttons) , а также показано, как работать с ними с помощью [жестов и раскадровок](#Gestures-and-Storyboards), [жестов и кода](#Gestures-and-Code) и [обработки событий низкого уровня](#Low-Level-Event-Handling). В заключение рассматривается [Работа с игровыми контроллерами](#Working-with-Game-Controllers) в приложении Xamarin. tvOS.

<a name="The-Siri-Remote"></a>

## <a name="the-siri-remote"></a>Siri Remote

Основной способ взаимодействия пользователей с Apple TV и приложения Xamarin. tvOS заключается в включенном удаленном Siri. Компания Apple разработала удаленное соединение между пользователем, находясь на диване, и интерфейсом пользователя Apple TV, отображаемым в комнате на экране телевизора.

Ваш запрос в качестве разработчика tvOS приложений — это создание быстрого, простого в использовании и визуально привлекательного пользовательского интерфейса, использующего Siriую сенсорную поверхность, акселерометр, гироскопом и кнопки на пульте дистанционного управления.

[![](remote-bluetooth-images/remote01.png "The Siri Remote")](remote-bluetooth-images/remote01.png#lightbox)

Siri Remote имеет следующие функции и ожидаемые использования в приложении tvOS:

|Функция|Общее использование приложения|Использование игрового приложения|
|---|---|---|
|**Сенсорная поверхность**<br />Проведите пальцем к навигации, нажмите, чтобы выделить и удерживать контекстные меню.|**Касание или прокрутка**<br />Перемещение пользовательского интерфейса между элементами, на которые осуществляется фокус ввода.<br /><br />**Нажмите кнопку**<br />Активирует выбранный элемент (в фокусе).|**Касание или прокрутка**<br />Зависит от дизайна игры и может использоваться в качестве D-кнопки с помощью краев.<br /><br />**Нажмите кнопку**<br />Выполнение основной функции кнопки.|
|**Меню**<br />Нажмите, чтобы вернуться к предыдущему экрану или меню.|Возврат к предыдущему экрану и выход из экрана главного приложения Apple TV.|Приостановка и возобновление игрового процесса, возврат к предыдущему экрану и выход из главного экрана Apple TV с экрана основного приложения.|
|**Siri и поиск**<br />В странах с Siri нажмите и удерживайте для управления голосовыми данными во всех остальных странах, чтобы отобразить экран поиска.|Н/Д|Н/Д|
|**Воспроизведение/Пауза**<br />Воспроизведение и приостановка мультимедиа или предоставление дополнительной функции в приложениях.|Запускает воспроизведение мультимедиа и приостанавливает или возобновляет воспроизведение.|Выполняет вторичную функцию кнопки или пропускает вводное видео (если существует).|
|**Главная**<br />Нажмите клавишу, чтобы вернуться на начальный экран, дважды щелкните для отображения работающих приложений, нажмите и удерживайте в спящем режиме.|Н/Д|Н/Д|
|**Том**<br />Управляет подключенным звуковым или видеооборудованием.|Н/Д|Н/Д|

<a name="Touch-Surface-Gestures"></a>

## <a name="touch-surface-gestures"></a>Жесты сенсорной поверхности

Сенсорная поверхность удаленного Siriа может обнаруживать различные жесты с одним пальцем, на которые вы можете ответить в приложении Xamarin. tvOS:

|Прокрутка|Нажмите кнопку|Касание|
|---|---|---|
|![](remote-bluetooth-images/Gesture01.png)|![](remote-bluetooth-images/Gesture02.png)|![](remote-bluetooth-images/Gesture03.png)|
|Перемещает выделение (фокус) между элементами пользовательского интерфейса на экране (вверх, влево, вправо). С помощью инерции можно быстро прокручивать большие списки содержимого.|Активирует выбранный элемент (в фокусе) или выступает в качестве основной кнопки в игре. Нажатие и удержание могут активировать контекстные меню или дополнительные функции.|Неприкосновенное касание сенсорной поверхности на краях действует как направленные кнопки на крестовине, перемещение фокуса вверх, вниз, влево или вправо в зависимости от области касания. В зависимости от приложения можно использовать для отображения скрытых элементов управления.|

Apple предоставляет следующие рекомендации по работе с жестами сенсорной поверхности:

- **Различие между щелчками и** щелчками является преднамеренным действием пользователя и хорошо подходит для выбора, активации и основной кнопки игры. Касание более незаметно, и его следует использовать экономно, потому что пользователь часто удерживает Siri удаленно и может случайно активировать событие TAP.
- **Не переопределяйте стандартные жесты** — пользователь имеет возможность, чтобы определенные жесты выполняли определенные действия, не следует переопределять значение или функцию этих жестов в приложении. Единственным исключением является игровое приложение во время активности Active игрового процесса.
- **Определение новых жестов** , которые не обязательно должным образом. у пользователя есть ожидание, что определенные жесты будут выполнять определенные действия. Не следует определять пользовательские жесты для выполнения стандартных действий. И опять же, игры — это наиболее распространенное исключение, при котором пользовательские жесты могут добавить забавное, иммерсивное воспроизведение в игру.
- **Если это уместно, отвечайте на касания D** . светлое касание угловых кромок сенсорной поверхности реагирует на то, что на игровом контроллере выполняется перемещение фокуса или направление вверх, вниз, влево или вправо. При необходимости вы должны ответить на эти жесты в своем приложении или игре.

<a name="Siri-Remote-Buttons"></a>

## <a name="siri-remote-buttons"></a>Удаленные кнопки Siri

В дополнение к жестам на сенсорной поверхности приложение может ответить на пользователя, щелкнув сенсорную область или нажав кнопку Воспроизвести/приостановить. При доступе к Siri Remote с помощью платформы игровых устройств можно также обнаружить нажатую кнопку меню.

Кроме того, можно обнаружить нажатия клавиш в меню с помощью распознавателя жестов со стандартными `UIKit` элементами. Если вы перехватываете нажатую кнопку меню, вы несете ответственность за закрытие текущего представления и контроллера представления и возврат к предыдущему.

> [!IMPORTANT]
> Необходимо **всегда** назначать функцию кнопке Воспроизвести/приостановить на удаленном. Наличие нефункциональной кнопки может привести к нарушению внешнего вида приложения для конечного пользователя. Если у вас нет допустимой функции для этой кнопки, назначьте ту же функцию, что и основная кнопка (щелкните сенсорную поверхность).

<a name="Gestures-and-Storyboards"></a>

## <a name="gestures-and-storyboards"></a>Жесты и раскадровки

Самым простым способом работы с Siri Remote в приложении Xamarin. tvOS является добавление распознавателей жестов к представлениям в конструкторе интерфейсов.

Чтобы добавить распознаватель жестов, выполните следующие действия.

1. В **Обозреватель решений**дважды щелкните `Main.storyboard` файл и откройте его для редактирования конструктора интерфейсов.
2. Перетащите **распознаватель жестов касания** из **библиотеки** и поместите его в представление:

    [![](remote-bluetooth-images/storyboard01.png "A Tap Gesture Recognizer")](remote-bluetooth-images/storyboard01.png#lightbox)
3. Установите флажок **выбрать** в разделе **"Кнопка"** **инспектора атрибутов**:

    [![](remote-bluetooth-images/storyboard02.png "Check Select")](remote-bluetooth-images/storyboard02.png#lightbox)
4. **SELECT** означает, что жест будет отвечать на щелчок пользователя в **сенсорной области** Siri Remote. Кроме того, у вас есть возможность отвечать на кнопки **меню**, **воспроизведения, паузы**, **вверх**, **вниз**, **влево** и **вправо** .
5. Затем следует связать **действие** **распознавателя жестов TAP** и вызвать его `TouchSurfaceClicked` :

    [![](remote-bluetooth-images/storyboard03.png "An Action from the Tap Gesture Recognizer")](remote-bluetooth-images/storyboard03.png#lightbox)
6. Сохраните изменения и вернитесь в Visual Studio для Mac.

Измените файл контроллера представления (example `FirstViewController.cs` ) и добавьте следующий код, обрабатывающий активируемый жест:

```csharp
using System;
using UIKit;

namespace tvRemote
{
    public partial class FirstViewController : UIViewController
    {
        ...

        #region Custom Actions
        partial void TouchSurfaceClicked (Foundation.NSObject sender) {
            // Handle click here
            ...
        }
        #endregion
    }
}
```

Дополнительные сведения о работе с раскадровками см. в статье [Hello, tvOS краткое руководство по началу работы](~/ios/tvos/get-started/hello-tvos.md). В частности, [Создание пользовательского интерфейса](~/ios/tvos/get-started/hello-tvos.md#Creating-the-User-Interface) и [запись кода с разделами розеток и Actions](~/ios/tvos/get-started/hello-tvos.md#Writing-the-Code) .

<a name="Gestures-and-Code"></a>

## <a name="gestures-and-code"></a>Жесты и код

Кроме того, можно создавать жесты непосредственно в коде C# и добавлять их в представления пользовательского интерфейса. Например, чтобы добавить ряд распознавателей жестов считывания, измените контроллер представления и добавьте следующий код:

```csharp
using System;
using UIKit;

namespace tvRemote
{
    public partial class SecondViewController : UIViewController
    {
        #region Constructors
        public SecondViewController (IntPtr handle) : base (handle)
        {
        }
        #endregion

        #region Override Methods
        public override void ViewDidLoad ()
        {
            base.ViewDidLoad ();

            // Wire-up gestures
            var upGesture = new UISwipeGestureRecognizer (() => {
                RemoteView.ArrowPressed = "Up";
                ButtonLabel.Text = "Swiped Up";
            }) {
                Direction = UISwipeGestureRecognizerDirection.Up
            };
            this.View.AddGestureRecognizer (upGesture);

            var downGesture = new UISwipeGestureRecognizer (() => {
                RemoteView.ArrowPressed = "Down";
                ButtonLabel.Text = "Swiped Down";
            }) {
                Direction = UISwipeGestureRecognizerDirection.Down
            };
            this.View.AddGestureRecognizer (downGesture);

            var leftGesture = new UISwipeGestureRecognizer (() => {
                RemoteView.ArrowPressed = "Left";
                ButtonLabel.Text = "Swiped Left";
            }) {
                Direction = UISwipeGestureRecognizerDirection.Left
            };
            this.View.AddGestureRecognizer (leftGesture);

            var rightGesture = new UISwipeGestureRecognizer (() => {
                RemoteView.ArrowPressed = "Right";
                ButtonLabel.Text = "Swiped Right";
            }) {
                Direction = UISwipeGestureRecognizerDirection.Right
            };
            this.View.AddGestureRecognizer (rightGesture);
        }
        #endregion
    }
}
```

<a name="Low-Level-Event-Handling"></a>

## <a name="low-level-event-handling"></a>Обработка событий низкого уровня

Если вы создаете настраиваемый тип на основе `UIKit` в приложении Xamarin. tvOS (например `UIView` ,), вы также можете обеспечить низкую обработку нажатия кнопки с помощью `UIPress` событий.

`UIPress`Событием является tvOS `UITouch` , что событие относится к iOS, за исключением того, что `UIPress` возвращает сведения о нажатии кнопки на удаленном или другом подключенном устройстве Bluetooth (например, в игровом контроллере). `UIPress`события описывают нажатую кнопку и ее состояние ("начато", "отменено", "изменено" или "завершено").

Для аналоговых кнопок на устройствах, таких как игровые контроллеры Bluetooth, `UIPress` также возвращается величина силы, применяемая к кнопке. `Type`Свойство `UIPress` события определяет, какая физическая кнопка изменила состояние, а остальные свойства описывают произошедшие изменения.

В следующем коде показан пример обработки событий низкого уровня `UIPress` для `UIView` :

```csharp
using System;
using Foundation;
using UIKit;

namespace tvRemote
{
    public partial class EventView : UIView
    {
        #region Computed Properties
        public override bool CanBecomeFocused {
            get {
                return true;
            }
        }
        #endregion

        #region
        public EventView (IntPtr handle) : base (handle)
        {
        }
        #endregion

        #region Override Methods
        public override void PressesBegan (NSSet<UIPress> presses, UIPressesEvent evt)
        {
            base.PressesBegan (presses, evt);

            foreach (UIPress press in presses) {
                // Was the Touch Surface clicked?
                if (press.Type == UIPressType.Select) {
                    BackgroundColor = UIColor.Red;
                }
            }
        }

        public override void PressesCancelled (NSSet<UIPress> presses, UIPressesEvent evt)
        {
            base.PressesCancelled (presses, evt);

            foreach (UIPress press in presses) {
                // Was the Touch Surface clicked?
                if (press.Type == UIPressType.Select) {
                    BackgroundColor = UIColor.Clear;
                }
            }
        }

        public override void PressesChanged (NSSet<UIPress> presses, UIPressesEvent evt)
        {
            base.PressesChanged (presses, evt);
        }

        public override void PressesEnded (NSSet<UIPress> presses, UIPressesEvent evt)
        {
            base.PressesEnded (presses, evt);

            foreach (UIPress press in presses) {
                // Was the Touch Surface clicked?
                if (press.Type == UIPressType.Select) {
                    BackgroundColor = UIColor.Clear;
                }
            }
        }
        #endregion
    }
}
```

Как и в случае с `UITouch` событиями, если необходимо реализовать какие `UIPress` – либо переопределения событий, следует реализовать все четыре.

<a name="Bluetooth-Game-Controllers"></a>

## <a name="bluetooth-game-controllers"></a>Игровые контроллеры Bluetooth

В дополнение к стандартному удаленному Siri, который поставляется с Apple TV, третья сторона, созданная для игровых контроллеров Bluetooth (MFI), может связываться с Apple TV и использовать для управления приложением Xamarin. tvOS.

[![](remote-bluetooth-images/game01.png "Bluetooth Game Controllers")](remote-bluetooth-images/game01.png#lightbox)

Игровые контроллеры можно использовать для улучшения игрового процесса и предоставления смысла в игре. Они также могут использоваться для управления стандартным интерфейсом Apple TV, поэтому для использования не нужно переключаться между удаленным и контроллером.

> [!IMPORTANT]
> Игровые контроллеры Bluetooth — это необязательная покупка, которую могут выполнять пользователи. приложение не может заставить пользователя приобретать его. Если приложение поддерживает игровые контроллеры, оно также должно поддерживать Siri Remote, чтобы играть можно было использовать для всех пользователей Apple TV.

У игрового устройства есть следующие функции и ожидаемое использование в приложении tvOS:

|Функция|Общее использование приложения|Использование игрового приложения|
|---|---|---|
|**Панель D**|Переходит по элементам пользовательского интерфейса (изменения фокуса).|Зависит от игры.|
|**А**|Активирует выбранный элемент (с фокусом).|Выполняет основную функцию кнопки и подтверждает действия диалогового окна.|
|**Б**|Возвращается к предыдущему экрану или завершает работу на начальном экране, если на главном экране приложения.|Выполняет вторичную кнопку кнопки или возвращается к предыдущему экрану.|
|**X**|Запускает воспроизведение мультимедиа или приостанавливает или возобновляет воспроизведение.|Зависит от игры.|
|**Y**|Недоступно|Зависит от игры.|
|**Меню**|Возвращается к предыдущему экрану или завершает работу на начальном экране, если на главном экране приложения.|Приостановка и возобновление игрового процесса, возврат к предыдущему экрану или выход из экрана на начальном экране, если на главном экране приложения.|
|**Кнопка влево**|Переходит влево.|Зависит от игры.|
|**Левый триггер**|Переходит влево.|Зависит от игры.|
|**Кнопка вправо**|Переходит вправо.|Зависит от игры.|
|**Правый триггер**|Переходы вправо|Зависит от игры.|
|**Левый аналоговый стик**|Переходит по элементам пользовательского интерфейса (изменения фокуса).|Зависит от игры.|
|**Правый аналоговый стик**|Недоступно|Зависит от игры.|

Компания Apple предоставляет следующие рекомендации по работе с игровыми контроллерами:

- **Подтвердите подключения к игровому контроллеру** . приложение tvOS может быть запущено и остановлено в любое время конечным пользователем. Всегда следует проверять наличие игрового устройства во время запуска приложения или в спящий режиме и предпринимать необходимые действия.
- **Убедитесь, что приложение работает на Siri удаленных и игровых контроллерах** . не требуется, чтобы пользователи переключались между Siri удаленным и игровым контроллером для использования приложения. Регулярно протестируйте приложение с обоими типами контроллеров, гарантируя простоту навигации и работы.
- **Обеспечить способ обратного** нажатия кнопки меню должен всегда возвращаться к предыдущему экрану. Если пользователь находится на главном экране приложения, кнопка меню должна вернуть их на начальный экран Apple TV. Во время игрового процесса на кнопке меню должно отобразиться предупреждение, предоставляя пользователю возможность приостановить или возобновить игрового процесса или вернуться в главное меню.

<a name="Working-with-Game-Controllers"></a>

## <a name="working-with-game-controllers"></a>Работа с игровыми контроллерами

Как упоминалось выше, в дополнение к стандартному удаленному Siri, поставляемому с Apple TV, пользователь может дополнительно подключить третью сторону, сделанный для игровых контроллеров Bluetooth iOS (MFI) и использовать его для управления приложением Xamarin. tvOS.

Если для приложения требуются низкоуровневые входные контроллеры, можно использовать [инфраструктуру игрового контроллера](https://developer.apple.com/library/prerelease/tvos/documentation/ServicesDiscovery/Conceptual/GameControllerPG/Introduction/Introduction.html#//apple_ref/doc/uid/TP40013276) Apple, которая имеет следующие изменения для tvOS:

- Добавлен профиль Micro Game Controller ( `GCMicroGamepad` ) для целевого объекта Siri Remote.
- Новый `GCEventViewController` класс можно использовать для маршрутизации событий игрового контроллера через приложение. Дополнительные сведения см. в разделе [Определение входного игрового](#determining-game-controller-input) устройства ниже.

<a name="Game-Controller-Support-Requirements"></a>

### <a name="game-controller-support-requirements"></a>Требования к поддержке игрового контроллера

У Apple есть несколько особых требований, которые должны быть выполнены, если ваше приложение Xamarin. tvOS поддерживает игровые контроллеры:

- **Необходимо поддерживать удаленную службу Siri** . необходимо всегда поддерживать Siri Remote. Для игры не требуется, чтобы игровое устройство стороннего производителя было восприниматься.
- **Необходимо поддерживать Расширенный макет элемента управления** — все игровые контроллеры tvOS не-формфиттинг, расширенные контроллеры.
- **Игры должны воспроизводиться с автономными контроллерами** . Если ваше приложение поддерживает расширенный игровой контроллер, оно должно работать только с этим игровым контроллером.
- **Необходимо поддерживать кнопку Воспроизведение/пауза** — во время игрового процесса, если пользователь нажмет кнопку Воспроизведение/пауза, должно отобразиться предупреждение, предоставляя пользователю возможность приостановить или возобновить игрового процесса или вернуться в главное меню.

<a name="Enabling-Game-Controller-Support"></a>

### <a name="enabling-game-controller-support"></a>Включение поддержки игрового контроллера

Чтобы включить поддержку игровых контроллеров в приложении Xamarin. tvOS, дважды щелкните `Info.plist` файл в **Обозреватель решений** , чтобы открыть его для редактирования:

[![](remote-bluetooth-images/game02.png "The Info.plist editor")](remote-bluetooth-images/game02.png#lightbox)

В разделе **игровой контроллер** установите флажок **включить игровые контроллеры**, а затем проверьте все типы игровых контроллеров, которые будут поддерживаться приложением.

<a name="Using-the-Siri-Remote-as-a-Game-Controller"></a>

### <a name="using-the-siri-remote-as-a-game-controller"></a>Использование Siri Remote в качестве игрового устройства

Удаленный Siri, который поставляется с Apple TV, может использоваться в качестве ограниченного игрового устройства. Как и в случае с другими игровыми контроллерами, он отображается в инфраструктуре игрового контроллера как `GCController` объект и поддерживает `GCMotion` `GCMicroGamepad` профили и.

Siri Remote имеет следующие характеристики при использовании в качестве игрового устройства:

- Сенсорную поверхность можно использовать в качестве D-Pad, предоставляющей аналоговые входные данные.
- Удаленное расположение можно использовать как в книжной, так и в альбомной ориентации, а приложение принимает решение о том, что объект профиля должен автоматически отражать входные данные.
- Щелкнув сенсорную поверхность, вы нажимаете кнопку **а** на игровом контроллере.
- Кнопка воспроизведение/пауза действует аналогично кнопке **X** в игровом контроллере.
- На кнопке меню должно отобразиться предупреждение, предоставляя пользователю возможность приостановить или возобновить игрового процесса или вернуться в главное меню.

<a name="Summary"></a>

### <a name="determining-game-controller-input"></a>Определение входного игрового устройства

В отличие от iOS, где события игрового контроллера могут быть получены параллельно с помощью событий касания, tvOS обрабатывает все низкоуровневые события для доставки `UIKit` событий высокого уровня. В результате, если требуется доступ к событиям игрового контроллера низкого уровня, необходимо отключить `UIKit` поведение по умолчанию.

В tvOS, когда требуется обрабатывать входные данные игрового устройства напрямую, необходимо использовать `GCEventViewController` (или подкласс) для вывода пользовательского интерфейса игры. Каждый раз, когда a `GCEventViewController` является *первым респондентом*, входные данные игрового устройства будут записываться и доставляться в ваше приложение через платформу игровых контроллеров.

Свойство класса можно использовать `UserInteractionEnabled` `GCEventViewController` для переключения способа обработки и обработки событий.

Сведения о реализации поддержки игровых устройств см. в разделе " [Работа с игровыми контроллерами](https://developer.apple.com/library/prerelease/tvos/documentation/General/Conceptual/AppleTV_PG/WorkingwithGameControllers.html) " в статье [по программированию приложений для tvOS](https://developer.apple.com/library/prerelease/tvos/documentation/General/Conceptual/AppleTV_PG/index.html) и [игрового контроллера](https://developer.apple.com/library/prerelease/tvos/documentation/ServicesDiscovery/Conceptual/GameControllerPG/Introduction/Introduction.html).

<a name="Summary"></a>

## <a name="summary"></a>Сводка

В этой статье рассматривается новый удаленный Siri, поставляемый с Apple TV, жестами сенсорной поверхности и удаленными кнопками Siri. Далее рассматривается работа с жестами и раскадровками, жестами и кодом и событиями низкого уровня. Наконец, если обсуждалась работа с игровыми контроллерами.

## <a name="related-links"></a>Связанные ссылки

- [Примеры tvOS](https://docs.microsoft.com/samples/browse/?products=xamarin&term=Xamarin.iOS+tvOS)
- [tvOS](https://developer.apple.com/tvos/)
- [Руководства по tvOSму интерфейсу](https://developer.apple.com/tvos/human-interface-guidelines/)
- [Руководством по программированию приложений для tvOS](https://developer.apple.com/library/prerelease/tvos/documentation/General/Conceptual/AppleTV_PG/)
