---
title: Повышение частоты кадров с CCSpriteSheet
description: CCSpriteSheet предоставляет функциональные возможности для объединения и с помощью много файлов изображений в одну текстуру. Сокращение числа текстуры можно улучшить, время загрузки игры и частоты кадров.
ms.prod: xamarin
ms.assetid: A1334030-750C-4C60-8B84-1A8A54B0D00E
author: charlespetzold
ms.author: chape
ms.date: 03/24/2017
ms.openlocfilehash: 9b0f58554b26b1a5334970b8c1288234acbf8db7
ms.sourcegitcommit: 0a72c7dea020b965378b6314f558bf5360dbd066
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/09/2018
ms.locfileid: "33922552"
---
# <a name="improving-frame-rate-with-ccspritesheet"></a>Повышение частоты кадров с CCSpriteSheet

_CCSpriteSheet предоставляет функциональные возможности для объединения и с помощью много файлов изображений в одну текстуру. Сокращение числа текстуры можно улучшить, время загрузки игры и частоты кадров._

Многие игры требуют оптимизации усилия гладко и быстро загрузить на мобильных устройствах. `CCSpriteSheet` Класс может помочь устранить многие распространенные проблемы производительности, испытываемых CocosSharp игры. В настоящем руководстве описывается общих проблем производительности и способы их решения с помощью `CCSpriteSheet` класса.


## <a name="what-is-a-sprite-sheet"></a>Что такое sprite листа?

A *sprite лист*, который может также называться *atlas текстуры*, — это изображение, которое объединяет несколько изображений в один файл. Это может повысить производительность во время выполнения, а также время загрузки содержимого.

Например на следующем рисунке представлен простой sprite лист, созданный три отдельные изображения. Отдельных изображений может быть любого размера, а полученный sprite листа не обязательно должен полностью заполненным:

![](ccspritesheet-images/image1.png "Отдельных изображений может быть любого размера, а результирующее sprite листа не обязательно должен полностью заполненным")


### <a name="render-states"></a>Отображения состояния

Визуальные CocosSharp объекты (такие как `CCSprite`) упростить код отрисовки через традиционного графического код отрисовки API например MonoGame или OpenGL, которых требуется создание буферы вершин (как описано в [трехмерной графики с Вершин в MonoGame](~/graphics-games/monogame/3d/part2.md) руководства). Несмотря на его простоты CocosSharp не избежать затрат на параметр *отображения состояния*, которые являются количество раз, необходимо перейти в коде отрисовки, текстур или других состояний, относящихся к визуализации.

Внутреннего кода CocosSharp отображает каждый элемент visual последовательно, по мере прохождения визуального дерева, начиная с текущим `CCScene`. Например рассмотрим следующие сцены.

![](ccspritesheet-images/image2.png "Рассмотрим этот сцены")

CocosSharp будет отображен четыре звезды в последовательности:

![](ccspritesheet-images/image3.png "CocosSharp будет отображен четыре звезды в последовательности")

Поскольку каждое `CCSprite` использует же текстуры CocosSharp можно сгруппировать все четыре звезды. Этот код требует только один отрисовки состояние назначения (назначение типа «звезда» текстуры) на кадр. Этот сценарий является очень эффективно.

Конечно очень мало игры использовать только один образ. Следующие сцены появились график планеты.

![](ccspritesheet-images/image4.png "График планеты вводит этот сцены")

В идеале CocosSharp отображать все спрайтов, используя один образ сначала (например звезды), а затем остальная часть спрайтов, с помощью другого изображения (планета):

![](ccspritesheet-images/image5.png "В идеале CocosSharp отображать все спрайтов сначала с помощью одного образа например звезд, а затем остальная часть с помощью другого изображения планета спрайты")

Порядок выше требует двух отображения состояния: один на первый типа «звезда», в первом планеты.

Если все `CCSprite` экземпляры являются дочерними элементами одной и той же `CCNode`, то CocosSharp будет оптимизировать порядок рисования, чтобы уменьшить изменения состояния отображения. Если, с другой стороны, `CCSprite` экземпляров упорядочены таким образом, что CocosSharp не позволяет оптимизировать для подготовки к просмотру (например, если они являются частью другого объекта `CCNode` экземпляры), то порядок может оказаться неоптимальным. Ниже приведен наихудшее порядок возможных рисования, возникающие в пяти состояниях отрисовки.

![](ccspritesheet-images/image6.png "Это показывает наихудшее порядок возможных draw, приведет к пяти состояний отрисовки")

Состояния визуализации может быть трудно оптимизацию, так как порядок рисования должен подчиняться визуального дерева `CCNode` экземпляров. Это дерево часто структурированные для упрощения работы с (например, сущности, содержащий их визуальных дочерних элементов), или организации из-за нужного визуального макета в соответствии с определением художник.

Конечно идеальная ситуация является состояние одной визуализации, несмотря на наличие нескольких изображений. Игры CocosSharp достигается путем объединения всех образов в один файл, то загрузка одного файла (вместе с его описанием **.plist** файл) в `CCSpriteSheet`. С помощью `CCSpriteSheet` класс становится еще более важно для игр, которые имеют большое количество изображений или которые имеют очень сложных макетов. 

### <a name="load-times"></a>Время загрузки

Объединение нескольких изображений в один файл также улучшает время загрузки игры по ряду причин:

 - Объединение нескольких изображений в один файл может снизить общее количество пикселей, используемыми с помощью эффективной упаковки
 - Загрузка меньшее число файлов означает меньше служебных данных каждого файла, например анализе .png заголовков
 - Загрузка меньшее число файлов требует меньше время, что важно для дисковой носители, такие как DVD-диски и жесткие диски компьютера традиционных поиска

## <a name="using-ccspritesheet-in-code"></a>Использование CCSpriteSheet в коде

Для создания `CCSpriteSheet` экземпляра, код необходимо указать образ и файл, который определяет области изображение, используемое для каждого кадра. Изображение можно загрузить в виде **.png** или **.xnb** файла (при использовании [конвейера содержимого](~/graphics-games/cocossharp/content-pipeline/index.md)). Файл, определяющий кадры — **.plist** файл, который может быть создан вручную или *TexturePacker* (который мы обсудим ниже).

Пример приложения, который [можно загрузить здесь](https://developer.xamarin.com/samples/mobile/SpriteSheetDemo/), создает `CCSpriteSheet` из **.png** и **.plist** файл, используя следующий код:

```csharp
CCSpriteSheet sheet = new CCSpriteSheet ("sheet.plist", "sheet.png"); 
```

После загрузки `CCSpriteSheet` содержит `List` из `CCSpriteFrame` экземпляров — каждого экземпляра, соответствующий одному из источника изображения, используемые для создания всей таблицы. В случае использования **SpriteSheetDemo** проекта, `CCSpriteSheet` содержит три изображения. **.Plist** файла можно проверить в Visual Studio для Mac или в любом текстовом редакторе, чтобы узнать, какие образы. Если мы **.plist** файл в текстовом редакторе, можно увидеть три кадра (разделов опущены, чтобы подчеркнуть имена ключей):


```csharp
...
<dict>
    <key>frames</key>
    <dict>
        <key>farBackground.png</key>
        ...
        <key>foreground.png</key>
        ...
<key>forestBackground.png</key>
...
```

Мы используем `Find` метод, чтобы найти кадры по имени, как показано ниже (опущены код, чтобы подчеркнуть `CCSpriteFrame` использования):


```csharp
CCSpriteFrame frame;
...
frame = sheet.Frames.Find(item=>item.TextureFilename == "farBackground.png"); 
CCSprite sprite = new CCSprite (frame); 
...
```

Поскольку `CCSprite` конструктор может занять `CCSpriteFrame` параметр, код никогда не должен изучить сведения о `CCSpriteFrame`, например какие текстуры использует или область изображения в лист master sprite.


## <a name="creating-a-sprite-sheet-plist"></a>Создание листа sprite .plist

Plist-файл является xml-файл, который можно создавать и изменять вручную. Аналогичным образом графических редакторах можно использовать для объединения нескольких файлов в один большой файл. После создания и обслуживания sprite таблицы может быть очень много времени, мы рассмотрим TexturePacker программы, для которой можно экспортировать в формате CocosSharp. TexturePacker предлагает бесплатно и «Pro» версия и доступен для Windows и Mac OS. В оставшейся части этого руководства можно выполнять с помощью бесплатной версии. 

Может быть TexturePacker [загружаются с веб-сайта TexturePacker](https://www.codeandweb.com/texturepacker). При открытии TexturePacker нет загрузки проекта. Начальный экран можно добавить спрайтов откройте последние проекты (если другие проекты были созданы) и выберите формат, используемый для sprite листа. CocosSharp использует формат данных Cocos2D:

![](ccspritesheet-images/image7.png "CocosSharp использует формат данных Cocos2D")

Файлы изображений (например, **.png**) могут добавляться в TexturePacker путем перетаскивания их из проводника Windows в Windows или поиска на компьютере Mac. TexturePacker автоматически обновляет предварительного просмотра таблицы sprite каждый раз при добавлении файла:

![](ccspritesheet-images/image8.png "TexturePacker автоматически обновляет предварительного просмотра таблицы sprite каждый раз при добавлении файла")

Для экспорта sprite листа, нажмите кнопку **лист sprite публикации** кнопку и выберите расположение для sprite листа. TexturePacker будет сохранен как это plist-файл и файл изображения.

Чтобы использовать результирующие файлы, добавьте в проект CocosSharp .plist и .png. Сведения о добавлении файлов в проекты CocosSharp см. в разделе [BouncingGame руководство](~/graphics-games/cocossharp/bouncing-game.md). Когда добавляются файлы, они могут быть загружены `CCSpriteSheet` как было показано выше в приведенном выше коде:

```csharp
CCSpriteSheet sheet = new CCSpriteSheet ("sheet.plist", "sheet.png"); 
```

### <a name="considerations-for-maintaining-a-texturepacker-sprite-sheet"></a>Рекомендации в отношении обслуживания лист sprite TexturePacker

Как игры разработаны, исполнители могут добавлять, удалять или изменять картинок. Любое изменение требует sprite обновленный лист. Следующие замечания может облегчить sprite лист обслуживания:

 - Сохранить исходные файлы (файлы, используемые для создания листов sprite) в папку проекта и убедитесь, что они добавляются в систему управления версиями. Эти файлы требуется повторно создать лист sprite при каждом внесении изменений.
 - Не добавлять исходных файлов в Visual Studio для Mac или Visual Studio, или если они добавлены, задайте **действие при построении** для **нет**. Если файлы добавляются и иметь конкретную платформу **действие при построении**, а затем они излишне увеличивается размер файла итоговое приложение.
 - Рассмотрите возможность использования *интеллектуальные папки* в TexturePacker. Смарт-папки автоматически добавляют все автономные образы sprite листа. Эта возможность позволяет сэкономить много времени, когда Разработка игр с большим числом изображений. 

    ![](ccspritesheet-images/image9.png "Эта возможность позволяет сэкономить много времени, когда Разработка игр с большим числом изображений")
 - Обратите внимание на размеры текстуры sprite листа. Некоторые старые phone оборудование не поддерживает текстуры, объем которых превышает 2048 x 2048. Кроме того 32-разрядного образа 2048 x 2048 использует почти 17 МБ ОЗУ — значительный объем памяти.
 - TexturePacker не включает папки в sprite имена по умолчанию, поэтому возможны конфликты имен. Лучше всего определитесь, чтобы включить папку имена или не в начале разработки. Больше игр следует использовать имена папок для предотвращения конфликтов. Для включения пути к папке, щелкните **Показывать дополнительные** в **данные** и проверить, **имя папки в начале**. 

    ![](ccspritesheet-images/image10.png "Для включения пути к папке, нажмите кнопку Показать подробности в разделе данных и проверьте имя папки в начале")

## <a name="summary"></a>Сводка

В этом руководстве описывается создание и использование `CCSpriteSheet` класса. Также описывается создание файлов, которые могут быть загружены в `CCSpriteSheet` экземпляров с помощью программы TexturePacker.

## <a name="related-links"></a>Связанные ссылки

- [CCSpriteSheet](https://developer.xamarin.com/api/type/CocosSharp.CCSpriteSheet/)
- [Полная демонстрация (пример)](https://developer.xamarin.com/samples/mobile/SpriteSheetDemo/)
