---
title: Общие сведения о коде общего доступа
description: 'В этом документе сравниваются различные методы совместного использования кода между межплатформенными проектами: общие проекты, переносимые библиотеки классов и .NET Standard, включая преимущества и недостатки каждого из них.'
ms.prod: xamarin
ms.assetid: B73675D2-09A3-14C1-E41E-20352B819B53
author: davidortinau
ms.author: daortin
ms.date: 08/06/2018
ms.openlocfilehash: 78b849434a087cf7951fe36345688251885ea00b
ms.sourcegitcommit: 2fbe4932a319af4ebc829f65eb1fb1816ba305d3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2019
ms.locfileid: "73016901"
---
# <a name="sharing-code-overview"></a>Общие сведения о коде общего доступа

_В этом документе сравниваются различные методы совместного использования кода между межплатформенными проектами: .NET Standard, общие проекты и переносимые библиотеки классов, включая преимущества и недостатки каждого из них._

Существует три метода совместного использования кода между межплатформенными приложениями:

- [**Библиотеки .NET Standard**](#Net_Standard) — .NET Standard проекты могут реализовывать код для совместного использования на нескольких платформах, а также иметь доступ к большому числу API-интерфейсов .NET (в зависимости от версии). .NET Standard 1,0-1,6 реализуют последовательно более крупные наборы интерфейсов API, а .NET Standard 2,0 — лучший охват платформы .NET BCL (включая API-интерфейсы .NET, доступные в приложениях Xamarin).
- [**Общие проекты**](#Shared_Projects) — используйте тип проекта общего ресурса для организации исходного кода и используйте `#if` директивы компилятора, необходимые для управления требованиями конкретной платформы.
- [**Переносимые библиотеки классов**](#Portable_Class_Libraries) (не рекомендуется) — переносимые библиотеки классов (PCL) могут ориентироваться на несколько платформ с общей поверхностью API и использовать интерфейсы для предоставления функциональных возможностей для конкретных платформ. PCL не рекомендуются в последних версиях Visual Studio &ndash; использовать .NET Standard.

Цель стратегии совместного использования кода заключается в поддержке архитектуры, показанной на этой схеме, где одна база кода может использоваться несколькими платформами.

 ![Архитектура приложения общего кода](code-sharing-images/conceptualarchitecture.png "Архитектура приложения общего кода")

В этой статье сравниваются доступные методы, которые помогут выбрать подходящий тип проекта для приложений.

<a name="Net_Standard" />

## <a name="net-standard-libraries"></a>Библиотеки .NET Standard

Библиотеки [.NET Standard](~/cross-platform/app-fundamentals/net-standard.md) предоставляют хорошо определенный набор библиотек базовых классов, на которые можно ссылаться в различных типах проектов, включая проекты на разных платформах, такие как Xamarin. Android и Xamarin. iOS. .NET Standard 2,0 рекомендуется использовать для обеспечения максимальной совместимости с существующим кодом .NET Framework.

![Схема .NET Standard](code-sharing-images/netstandard.png "Схема .NET Standard")

### <a name="benefits"></a>Преимущества

- Позволяет совместно использовать код в нескольких проектах.
- Операции рефакторинга всегда обновляют все затронутые ссылки.
- Более крупная контактная зона библиотеки базовых классов (BCL) .NET доступна по сравнению с профилями PCL. В частности, .NET Standard 2,0 имеет почти ту же поверхность API, что и .NET Framework, и рекомендуется для новых приложений и переноса существующих PCL.

### <a name="disadvantages"></a>Недостатки

- Нельзя использовать директивы компилятора, такие как `#if __IOS__`.

### <a name="remarks"></a>Заметки

.NET Standard [похож на PCL](https://docs.microsoft.com/dotnet/standard/net-standard#comparison-to-portable-class-libraries), но с более простой моделью поддержки платформы и большим количеством классов из BCL.

<a name="Shared_Projects" />

## <a name="shared-projects"></a>Общие проекты

[Общие проекты](~/cross-platform/app-fundamentals/shared-projects.md) содержат файлы кода и активы, которые включены в любой проект, который ссылается на них. Совместное использование проектов не приводит к созданию скомпилированных выходных данных.

На этом снимке экрана показан файл решения, содержащий три проекта приложений (для Android, iOS и Windows) с **общим** проектом, содержащим общие C# файлы исходного кода:

![Решение общего проекта](code-sharing-images/sharedsolution.png "Решение общего проекта")

На следующей схеме показана концептуальная архитектура, в которой каждый проект содержит все файлы с общим исходным кодом:

![Общая диаграмма проекта](code-sharing-images/sharedassetproject.png "Общая диаграмма проекта")

### <a name="example"></a>Пример

Для кросс-платформенного приложения, поддерживающего iOS, Android и Windows, потребуется проект приложения для каждой платформы. Общий код находится в общем проекте.

Пример решения будет содержать следующие папки и проекты (имена проектов были выбраны для выразительности, проекты не должны следовать этим рекомендациям по именованию):

- **Shared** — общий проект, содержащий код, общий для всех проектов.
- **Аппандроид** — проект приложения Xamarin. Android.
- **Аппиос** — проект приложения Xamarin. iOS.
- **Аппвиндовс** — проект приложения Windows.

Таким образом, три проекта приложения совместно используют один и тот же исходный код ( C# общие файлы). Все изменения общего кода будут общими для всех трех проектов.

### <a name="benefits"></a>Преимущества

- Позволяет совместно использовать код в нескольких проектах.
- Общий код может быть разветвлен на основе платформы с помощью директив компилятора (например, с помощью `#if __ANDROID__`, как описано в документе [Создание кросс-платформенных приложений](~/cross-platform/app-fundamentals/building-cross-platform-applications/index.md) ).
- Проекты приложений могут содержать ссылки на конкретные платформы, которые может использовать общий код (например, использование `Community.CsharpSqlite.WP7` в примере задачи для Windows Phone).

### <a name="disadvantages"></a>Недостатки

- Рефакторингы, влияющие на код внутри директив компилятора "Inactive", не обновляют код внутри этих директив.
- В отличие от большинства других типов проектов, в общем проекте нет выходной сборки. Во время компиляции файлы обрабатываются как часть ссылающегося проекта и компилируются в эту сборку. Если вы хотите поделиться кодом в виде сборки, то .NET Standard или переносимые библиотеки классов являются лучшим решением.

<a name="Shared_Remarks" />

### <a name="remarks"></a>Заметки

Хорошим решением для разработчиков приложений является написание кода, предназначенного только для совместного использования в своем приложении (а не для распространения другим разработчикам).

<a name="Portable_Class_Libraries" />

## <a name="portable-class-libraries"></a>Переносимые библиотеки классов

> [!TIP]
> Библиотеки .NET Standard 2,0 рекомендуется использовать в переносимых библиотеках классов.

[Здесь подробно рассматриваются](~/cross-platform/app-fundamentals/pcl.md)переносимые библиотеки классов.

![Диаграмма переносимой библиотеки классов](code-sharing-images/portableclasslibrary.png "Диаграмма переносимой библиотеки классов")

### <a name="benefits"></a>Преимущества

- Позволяет совместно использовать код в нескольких проектах.
- Операции рефакторинга всегда обновляют все затронутые ссылки.

### <a name="disadvantages"></a>Недостатки

- В последних версиях Visual Studio рекомендуется использовать вместо них .NET Standard библиотеки. См. [Описание различий](https://docs.microsoft.com/dotnet/standard/net-standard#comparison-to-portable-class-libraries) между PCL и .NET Standard.
- Нельзя использовать директивы компилятора.
- Можно использовать только подмножество .NET Framework, определяемое выбранным профилем (Дополнительные сведения см. в статье [Введение в PCL](~/cross-platform/app-fundamentals/pcl.md) ).

### <a name="remarks"></a>Заметки

Шаблон PCL считается устаревшим в последних версиях Visual Studio.

## <a name="summary"></a>Сводка

Выбранная стратегия совместного использования кода будет определяться управляемыми платформами. Выберите метод, который лучше подходит для вашего проекта.

.NET Standard является лучшим выбором для создания библиотек кода для совместного размещения (особенно для публикации в NuGet). Общие проекты хорошо подходят для разработчиков приложений, планирующих использовать многие функции платформы в своих кросс-платформенных приложениях.

Хотя проекты PCL продолжают поддерживаться в Visual Studio, .NET Standard рекомендуется для новых проектов.

## <a name="related-links"></a>Связанные ссылки

- [Создание кросс-платформенных приложений (основной документ)](~/cross-platform/app-fundamentals/building-cross-platform-applications/index.md)
- [Переносимые библиотеки классов](~/cross-platform/app-fundamentals/pcl.md)
- [Общие проекты](~/cross-platform/app-fundamentals/shared-projects.md)
- [.NET Standard](~/cross-platform/app-fundamentals/net-standard.md)
- [Практический пример: Tasky](~/cross-platform/app-fundamentals/building-cross-platform-applications/case-study-tasky.md)
- [Пример задачи (GitHub)](https://github.com/xamarin/mobile-samples/tree/master/Tasky)
- [Пример задачи с использованием PCL (GitHub)](https://github.com/xamarin/mobile-samples/tree/master/TaskyPortable)
