---
title: Введение в переносимые библиотеки классов (PCL)
description: В этой статье представлены проекты переносимой библиотеки классов (PCL) и описывается создание и использование переносимой библиотеки Классов проектов в Visual Studio для Mac и Visual Studio.
ms.prod: xamarin
ms.assetid: 76ba8f7a-9b6e-40f5-9a29-ff1274ece4f2
author: conceptdev
ms.author: crdun
ms.date: 07/18/2018
ms.openlocfilehash: 83b1da5cd10a46b8480b0755eeb16bf7434a5906
ms.sourcegitcommit: 46bb04016d3c35d91ff434b38474e0cb8197961b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/26/2018
ms.locfileid: "39270093"
---
# <a name="portable-class-libraries-pcl"></a>Переносимые библиотеки классов (PCL)

> [!WARNING]
> Переносимые библиотеки классов (PCL), считаются устаревшими в последних версиях Visual Studio.
> Хотя по-прежнему можно открыть, изменить и скомпилировать PCL, для новых проектов рекомендуется использовать [библиотеки .NET Standard](~/cross-platform/app-fundamentals/net-standard.md).

Ключевым компонентом создания кросс платформенных приложений является возможность совместно использовать код в различные проекты под конкретные платформы. Тем не менее это осложняется тем, что часто использоваться другой набор вложенных библиотеки классов .NET Base (BCL) различных платформ и таким образом, будут построены на другой профиль библиотеки .NET Core. Это означает, что каждой платформы можно использовать только библиотеки классов, которые нацелены на тот же профиль, чтобы они отображались требовать отдельных проектов библиотеки классов для каждой платформы.

Существует три основных подхода к совместного использования кода для устранения этой проблемы: **проектов .NET Standard**, **проектах общих ресурсов**, и **проекты переносимой библиотеки классов (PCL)**.

- **Проектов .NET standard** являются предпочтительным подходом для совместного использования кода .NET, Узнайте больше о [проектов .NET Standard и Xamarin](~/cross-platform/app-fundamentals/net-standard.md).
- **Общие проекты активов** использовать один набор файлов и предлагает простой и быстрый способ для совместного использования кода в решении и обычно использует директивы условной компиляции, чтобы указывать пути кода для различных платформ, которые будут его использовать (для получения дополнительных сведений сведения см. в разделе [статье проектах общих](~/cross-platform/app-fundamentals/shared-projects.md)).
- **PCL** проекты предназначены для конкретные профили, поддерживающие известный набор классов BCL/features. Отрицательной стороной переносимую библиотеку классов то, что они часто требуют очень архитектуры усилий для разделения кода конкретного профиля на собственные библиотеки.

Этой странице объясняется, как создать **PCL** проект, предназначенный для конкретного профиля, который можно затем ссылаться на несколько проектов для конкретных платформ.

## <a name="what-is-a-portable-class-library"></a>Что такое переносимой библиотеки классов

При создании проекта приложения или проект библиотеки, итоговому файлу DLL будет ограничен работа на конкретную платформу, для которого он создан. Это позволяет записывая сборку для приложения Windows, а затем повторно использовать его на Xamarin.iOS и Xamarin.Android.

При создании переносимой библиотеки классов, тем не менее, можно выбрать сочетание платформ, которые требуется код для запуска на. Выбор совместимости, внесенные при создании переносимой библиотеки классов, преобразуются в «Профиль» идентификатор, описывающий, какие платформы, библиотека поддерживает.

В следующей таблице показаны некоторые функции, которые зависят от платформы .NET. Чтобы создать сборку переносимой библиотеки Классов, выполнение на определенных устройствах и платформах нужно просто выбрать какие поддержки является обязательным при создании проекта.

|Функция|.NET Framework|Приложения универсальной платформы Windows|Silverlight|Windows Phone|Xamarin|
|---|---|---|---|---|---|
|Ядро|Y|Y|Y|Y|Y|
|LINQ|Y|Y|Y|Y|Y|
|IQueryable|Y|Y|Y|7.5 +|Y|
|Сериализация|Y|Y|Y|Y|Y|
|Заметки к данным|4.0.3 +|Y|Y||Y|

Столбце Xamarin отражен тот факт, что Xamarin.iOS и Xamarin.Android поддерживает все профили, поставляемых с Visual Studio, и доступность функций во всех библиотеках, создаваемых будет ограничен только других платформ, выбранный для поддержки.

Сюда также входят профили, которые являются комбинацией:

- .NET 4 или .NET 4.5
- Silverlight 5
- Windows Phone 8
- Приложения универсальной платформы Windows

Дополнительные сведения о возможностях различные профили на [веб-сайта корпорации Майкрософт](http://msdn.microsoft.com/library/gg597391(v=vs.110).aspx) и другой участник сообщества см. в разделе [профиль PCL сводки](http://embed.plnkr.co/03ck2dCtnJogBKHJ9EjY) включающее поддерживается framework сведения и другие примечания.

**Преимущества**

1. Совместного использования централизованной кода — писать и тестировать код в одном проекте, могут использоваться другие библиотеки или приложения.
2. Операции рефакторинга будет влиять на весь код загружен в решение (переносимой библиотеки классов и проекты под конкретные платформы).
3. Проект переносимой библиотеки Классов можно легко ссылаться на другие проекты в решении или выходной сборки может использоваться для других пользователей, для ссылки в своих решениях.

**Недостатки**

1. Так как же переносимой библиотеки классов распределена между несколькими приложениями, специфические для платформы библиотеки не могут ссылаться (например) Community.CsharpSqlite.WP7).
2. Подмножество переносимой библиотеки классов не может содержать классы, которые в противном случае будут доступны в MonoTouch и Mono для Android (например, DllImport или System.IO.File).

> [!NOTE]
> Переносимые библиотеки классов, которые стали нерекомендуемыми в последнюю версию Visual Studio и [библиотеки .NET Standard](net-standard.md) вместо этого рекомендуется использовать.

В некоторой степени обоих недостатки можно обойти с помощью шаблона поставщика или внедрение зависимостей для кода фактическую реализацию в проектах платформы для интерфейса или базового класса, который определен в переносимой библиотеке классов.

На этой схеме показана архитектура кросс платформенные приложения с помощью переносимой библиотеки классов для совместного использования кода, но также с помощью внедрения зависимости для передачи в возможности, зависящие от платформы.

[![](pcl-images/image1.png "На этой схеме показана архитектура кросс платформенные приложения с помощью переносимой библиотеки классов для совместного использования кода, но также с помощью внедрения зависимости для передачи в возможности, зависящие от платформы")](pcl-images/image1.png#lightbox)

# <a name="visual-studio-for-mactabmacos"></a>[Visual Studio для Mac](#tab/macos)

## <a name="visual-studio-for-mac-walkthrough"></a>Visual Studio для Mac Пошаговое руководство

В этом разделе описано, как создать и использовать переносимую библиотеку классов с помощью Visual Studio для Mac. См. в разделе примера PCL полную реализацию.

### <a name="creating-a-pcl"></a>Создание PCL

Добавление переносимой библиотеки классов в решение очень сходно с добавлением обычного проекта библиотеки.

1. В **новый проект** окна выберите **Многоплатформенность > Библиотека > переносимой библиотеки** параметр:

    ![Создание нового проекта переносимой библиотеки Классов](pcl-images/image2.png)

1. При создании переносимой библиотеки Классов в Visual Studio для Mac автоматически настраивается с профилем, подходящий для Xamarin.iOS и Xamarin.Android. Проект PCL. ОНИ будут отображаться, как показано на следующем снимке экрана:

    ![Проект переносимой библиотеки Классов на панели решения](pcl-images/image3.png)

Переносимая библиотека Классов теперь готов для кода для добавления. Его можно также ссылаться на другие проекты (проекты приложений, проекты библиотек и даже в других проектах переносимой библиотеки Классов).

### <a name="editing-pcl-settings"></a>Изменение параметров переносимой библиотеки Классов

Чтобы просмотреть и изменить параметры для этого проекта переносимой библиотеки Классов, щелкните правой кнопкой мыши проект и выберите **параметры > Создать > Общие** . появится экран, показанный здесь:

[![Параметры проекта переносимой библиотеки Классов для установки профиля](pcl-images/image4-sml.png)](pcl-images/image4.png#lightbox)

Нажмите кнопку **изменений...**  для изменения целевой профиль для этого переносимой библиотеки классов.

Если профиль изменяется после кода уже был добавлен в переносимую библиотеку классов, это возможно, что библиотека больше не будут компилироваться, если код ссылается на функции, которые не являются частью вновь выбранного профиля.

## <a name="working-with-a-pcl"></a>Работа с PCL

При создании кода в библиотеке переносимой библиотеки Классов, редактор Visual Studio для Mac распознает ограничения выбранного профиля и соответствующим образом настроить параметры автозаполнения. Например, на этом снимке экрана показаны варианты автозавершения для System.IO с использованием профиля по умолчанию (Profile136), используемых в Visual Studio для Mac — Обратите внимание, который указывает, около половины всех доступных классов отображаются полосы прокрутки (на самом деле существует только 14 классы доступны).

[![Список IntelliSense 14 классов в классе System.IO PCL](pcl-images/image6.png)](pcl-images/image6.png#lightbox)

Сравнить с System.IO, автозавершения в проекте Xamarin.iOS или Xamarin.Android —, 40 классы, доступные включая часто используемые классы, как `File` и `Directory` которого не принадлежат ни одному профилю PCL.

[![Список IntelliSense 40 классы в пространстве имен .NET Framework System.IO](pcl-images/image7.png)](pcl-images/image7.png#lightbox)

Это отражает базовой компромисс с помощью переносимой библиотеки Классов — возможность легко совместное использование кода на многих платформах означает, что некоторые API вам недоступны, поскольку они не имеют сравнимые реализации для всех возможных платформ.

### <a name="using-pcl"></a>С помощью переносимой библиотеки Классов

После создания проекта переносимой библиотеки Классов, можно добавить ссылку на него из любой проектов, совместимый с приложения или библиотеки таким же образом, обычно добавляются ссылки. В Visual Studio для Mac, щелкните правой кнопкой мыши на узел "ссылки" и выберите **изменить ссылки...**  переключитесь **проекты** как показано:

[![Добавьте ссылку на переносимую библиотеку Классов с помощью параметра Изменить ссылки](pcl-images/image8.png)](pcl-images/image8.png#lightbox)

На следующем рисунке показаны панели решения для примера приложения TaskyPortable, показывающий библиотеки PCL снизу и ссылку на эту библиотеку PCL в проекте Xamarin.iOS.

[![Пример решения TaskyPortable отображение-проект переносимой библиотеки Классов](pcl-images/image9.png)](pcl-images/image9.png#lightbox)

Выходные данные из библиотеки PCL (т. е. сборку библиотеки DLL) можно также добавить как ссылку для большинства проектов. Это делает идеальное решение для отправки кроссплатформенных компоненты и библиотеки PCL.

# <a name="visual-studiotabwindows"></a>[Visual Studio](#tab/windows)

## <a name="visual-studio-walkthrough"></a>Пошаговое руководство по Visual Studio

В этом разделе описано, как создать и использовать переносимую библиотеку классов с помощью Visual Studio. См. в разделе примера PCL полную реализацию.

### <a name="creating-a-pcl"></a>Создание PCL

Добавление переносимой библиотеки Классов в решение в Visual Studio немного отличается от добавления регулярных проекта:

1. В **Добавление нового проекта** выберите **библиотека классов (для прежних версий Portable)** параметр. Обратите внимание, что описание справа будет указано, что этот тип проекта устарел.

    [![Окно нового проекта для создания переносимой библиотеке классов](pcl-images/image10-sml.png "переносимой библиотеки классов")](pcl-images/image10.png#lightbox)

2. Visual Studio предложит немедленно с следующее диалоговое окно, таким образом, можно настроить профиль.
 Установка флажка платформы, которые необходимо поддерживать и нажмите кнопку OK.

    [![Выберите целевой платформы для библиотеки](pcl-images/image11-sml.png "деления платформы, необходимые для поддержки и нажмите кнопку ОК")](pcl-images/image11.png#lightbox)

3. Проект PCL. ОНИ будут отображаться, как показано в обозревателе решений &ndash; текст **(Portable)** отображается рядом с именем проекта, чтобы указать это переносимую библиотеку Классов:

    ![NET Framework определенные в профиле переносимой библиотеки Классов](pcl-images/image12.png "NET Framework определенные в профиле переносимой библиотеки Классов")

Переносимая библиотека Классов теперь готов для кода для добавления. Его можно также ссылаться на другие проекты (проекты приложений, проекты библиотек и даже в других проектах переносимой библиотеки Классов).

### <a name="editing-pcl-settings"></a>Изменение параметров переносимой библиотеки Классов

Параметры переносимой библиотеки Классов можно просмотреть и изменить, щелкнув правой кнопкой мыши на проект и выбрав **свойства > Библиотека** , как показано на следующем снимке экрана:

[![Изменить целевые платформы](pcl-images/image13-sml.png)](pcl-images/image13.png#lightbox)

Если профиль изменяется после кода уже был добавлен в переносимую библиотеку классов, это возможно, что библиотека больше не будут компилироваться, если код ссылается на функции, которые не являются частью вновь выбранного профиля.

> [!TIP]
> Также имеется сообщение, предупреждающее о том, **. NETStandard способ является предпочтительным для совместного использования кода**. Указание на то, что, хотя PCL по-прежнему поддерживаются, рекомендуется выполнить обновление до .NET Standard.

### <a name="working-with-a-pcl"></a>Работа с PCL

При создании кода в библиотеке переносимой библиотеки Классов Visual Studio распознает ограничения выбранного профиля и соответствующим образом изменить параметры технологии Intellisense. Например, на этом снимке экрана показаны варианты автозавершения для System.IO с использованием профиля по умолчанию (Profile136) – Обратите внимание, который указывает, около половины всех доступных классов отображаются полосы прокрутки (на самом деле доступны только классы 14).

[![Меньшего числа операций ввода-ВЫВОДА классы, доступные в переносимую библиотеку Классов](pcl-images/image14.png)](pcl-images/image14.png#lightbox)

Сравнить с System.IO, автозавершение в обычный проект —, 40 классы, доступные включая часто используемые классы, как `File` и `Directory` которого не принадлежат ни одному профилю PCL.

[![Многие дополнительные классы ввода-ВЫВОДА, доступные в .NET Framework](pcl-images/image15.png)](pcl-images/image15.png#lightbox)

Это отражает базовой компромисс с помощью переносимой библиотеки Классов — возможность легко совместное использование кода на многих платформах означает, что некоторые API вам недоступны, поскольку они не имеют сравнимые реализации для всех возможных платформ.

> [!TIP]
> .NET standard 2.0 представляет гораздо большую API контактную зону чем PCL, включая пространство имен System.IO. Для новых проектов .NET Standard рекомендуется переносимой библиотеки Классов.

### <a name="using-pcl"></a>С помощью переносимой библиотеки Классов

После создания проекта переносимой библиотеки Классов, можно добавить ссылку на него из любой проектов, совместимый с приложения или библиотеки таким же образом, обычно добавляются ссылки. В Visual Studio, щелкните правой кнопкой мыши на узел "ссылки" и выберите `Add Reference...` переключитесь **решение > проекты** как показано:

[![Добавьте ссылку на переносимую библиотеку Классов с помощью вкладки Добавление ссылки проектов](pcl-images/image16.png)](pcl-images/image16.png#lightbox)

На следующем рисунке показан на панели решения для примера приложения TaskyPortable, показывающий библиотеки PCL снизу и ссылку на эту библиотеку PCL в проекте Xamarin.iOS.

[![Пример решения TaskyPortable, показывающий библиотеку PCL](pcl-images/image17.png)](pcl-images/image17.png#lightbox)

Выходные данные из библиотеки PCL (т. е. сборку библиотеки DLL) можно также добавить как ссылку для большинства проектов.
Это делает идеальное решение для отправки кроссплатформенных компоненты и библиотеки PCL.

-----

## <a name="pcl-example"></a>Пример PCL

[TaskyPortable](https://developer.xamarin.com/samples/mobile/TaskyPortable/) пример приложения демонстрирует, как можно использовать переносимую библиотеку классов с помощью Xamarin.
Ниже приведены некоторые снимки экрана итоговый приложения, работающие на iOS и Android.

[![](pcl-images/image18.png "Ниже приведены некоторые снимки экрана, полученный приложений, работающих под управлением iOS, Android и Windows Phone")](pcl-images/image18.png#lightbox)

Он использует ряд классов данных и логики, которые являются исключительно переносимого кода, а также показано, как включить требования платформы, с помощью внедрения зависимостей для реализации базы данных SQLite.

Ниже приведен структуру решения (в Visual Studio для Mac и Visual Studio соответственно):

[![](pcl-images/image19.png "Структура решения показано в Visual Studio для Mac и Visual Studio соответственно")](pcl-images/image19.png#lightbox)

Так как SQLite-NET-код содержит специфические для платформы (Чтобы работать с реализациями SQLite на каждый другой операционной системы) для демонстрационных целей, он были вынесены в абстрактный класс, который может быть скомпилирован в переносимую библиотеку классов, и фактический код, реализованный как подклассы в проекты iOS и Android.

### <a name="taskyportablelibrary"></a>TaskyPortableLibrary

Компоненты .NET, которые может поддерживать ограничен переносимой библиотеки классов. Так как она компилируется для запуска на нескольких платформах, не могут вносить использование `[DllImport]` функциональность, которая используется в SQLite-NET. Вместо SQLite-NET реализуется как абстрактный класс и затем ссылаться через оставшуюся часть совместно используемого кода. Ниже приводится его абстрактный API.

```csharp
public abstract class SQLiteConnection : IDisposable {

    public string DatabasePath { get; private set; }
    public bool TimeExecution { get; set; }
    public bool Trace { get; set; }
    public SQLiteConnection(string databasePath) {
         DatabasePath = databasePath;
    }
    public abstract int CreateTable<T>();
    public abstract SQLiteCommand CreateCommand(string cmdText, params object[] ps);
    public abstract int Execute(string query, params object[] args);
    public abstract List<T> Query<T>(string query, params object[] args) where T : new();
    public abstract TableQuery<T> Table<T>() where T : new();
    public abstract T Get<T>(object pk) where T : new();
    public bool IsInTransaction { get; protected set; }
    public abstract void BeginTransaction();
    public abstract void Rollback();
    public abstract void Commit();
    public abstract void RunInTransaction(Action action);
    public abstract int Insert(object obj);
    public abstract int Update(object obj);
    public abstract int Delete<T>(T obj);

    public void Dispose()
    {
        Close();
    }
    public abstract void Close();

}
```

Остальная часть совместно используемого кода использует абстрактный класс для «магазин» и «получить» объекты из базы данных. В любое приложение, использующее этого абстрактного класса необходимо передать в полную реализацию функциональности реальной базы данных.

### <a name="taskyandroid-and-taskyios"></a>TaskyAndroid и TaskyiOS

В iOS и в проектах приложений Android содержатся пользовательского интерфейса и другие специфические для платформы код, используемый для передачи up общий код в переносимой библиотеке Классов.

Эти проекты также содержат реализацию абстрактного базы данных API, который работает на этой платформе. В iOS и Android Sqlite компонент database engine встроены в операционную систему, чтобы можно было использовать реализацию `[DllImport]` как показано для предоставления конкретная реализация подключение к базе данных. Ниже приведен фрагмент кода реализации конкретной платформы.

```csharp
[DllImport("sqlite3", EntryPoint = "sqlite3_open")]
public static extern Result Open(string filename, out IntPtr db);

[DllImport("sqlite3", EntryPoint = "sqlite3_close")]
public static extern Result Close(IntPtr db);
```

Полная реализация видно в примере кода.

## <a name="summary"></a>Сводка

В этой статье кратко обсуждается преимуществах и недостатках переносимые библиотеки классов, было продемонстрировано, как создавать и использовать PCL из среды Visual Studio для Mac и Visual Studio. и наконец появился полный пример приложения — TaskyPortable —, которое показывает PCL в действии.

## <a name="related-links"></a>Связанные ссылки

- [TaskyPortable (пример)](https://developer.xamarin.com/samples/mobile/TaskyPortable/)
- [Создание кроссплатформенных приложений](~/cross-platform/app-fundamentals/building-cross-platform-applications/index.md)
- [Переносимые Visual Basic](~/cross-platform/platform/visual-basic/index.md)
- [Общие проекты](~/cross-platform/app-fundamentals/shared-projects.md)
- [Варианты совместного использования кода](~/cross-platform/app-fundamentals/code-sharing.md)
- [Кроссплатформенная разработка в .NET Framework (Microsoft)](https://docs.microsoft.com/dotnet/standard/cross-platform/cross-platform-development-with-the-portable-class-library)
