---
title: Обновление имеющихся приложений Mac
description: В этом документе описаны шаги, которые должны выполняться для обновления приложения из классического интерфейса API на единый API Xamarin.Mac.
ms.prod: xamarin
ms.assetid: 26673CC5-C1E5-4BAC-BEF4-9A386B296FD5
author: asb3993
ms.author: amburns
ms.date: 03/29/2017
ms.openlocfilehash: 5e6034b079bba5e884872e4f2096d677fd3641d0
ms.sourcegitcommit: 4b402d1c508fa84e4fc3171a6e43b811323948fc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61213566"
---
# <a name="updating-existing-mac-apps"></a>Обновление имеющихся приложений Mac

Обновление существующего приложения для использования на единый API требуется внести изменения в файле проекта также пространства имен и API, используемые в коде приложения.

## <a name="the-road-to-64-bits"></a>Пути к 64-разрядная

Новые интерфейсы API единой необходимы для поддержки 64-разрядных архитектур устройства из приложения Xamarin.Mac. Начиная с 1 февраля 2015 г. компания Apple требует, что все новые приложения отправки в Mac App Store поддерживает 64-разрядной архитектуры.

Xamarin предоставляет средства для Visual Studio для Mac и Visual Studio для автоматизации процесса миграции с классической API на единый API или файлы проекта можно преобразовать вручную. Хотя настоятельно рекомендуется с помощью автоматического средства, в этой статье мы рассмотрим оба метода.

### <a name="before-you-start"></a>Перед началом работы …

Перед обновлением существующего кода на единый API, настоятельно рекомендуется устранить все *предупреждения компиляции*. Многие *предупреждения* в классический API станет как ошибки, после перехода на единой системе. Исправления ошибок, перед началом стало проще, поскольку компилятор сообщений из классический API часто предоставляют рекомендации о том, что для обновления.

## <a name="automated-updating"></a>Автоматическое обновление

После устранения предупреждения, выделите существующий проект Mac в Visual Studio для Mac или Visual Studio и выберите **переходу на единый API Xamarin.Mac** из **проекта** меню. Пример:

![](updating-mac-apps-images/beta-tool1.png "Выберите пункт \"Миграция\", чтобы единый API Xamarin.Mac из меню \"проект\"")

Вам потребуется принять данное предупреждение, перед запуском автоматической миграции (очевидно, что следует убедиться у вас есть резервные копии или систему управления версиями перед тем, как это adventure):

![](updating-mac-apps-images/migrate01.png "Согласиться на это предупреждение, перед запуском автоматической миграции")

Существует два поддерживаемых типов требуемой версии .NET Framework, которые могут быть выбраны при использовании на единый API в приложении Xamarin.Mac.

- **Xamarin.Mac Mobile Framework** -это же настроенной платформе .NET framework используется Xamarin.iOS и Xamarin.Android, которые поддерживают подмножество полной **Desktop** framework. Это рекомендуемая платформа, так как она обеспечивает меньший размер двоичных файлов, из-за превосходные связывания поведения.
- **Xamarin.Mac .NET 4.5 Framework** -эта инфраструктура еще раз, — это подмножество **Desktop** framework. Тем не менее, он урезает гораздо меньше полной **Desktop** framework, чем **Mobile** framework и должны _«просто работали»_ с большинство пакетов NuGet или библиотеки сторонних производителей. Это позволяет разработчику использовать стандартный **Desktop** сборки, хотя по-прежнему с помощью поддерживаемых framework, но этот параметр создает больших пакетов приложений. Это рекомендуемая платформа, где используются сборки .NET сторонних поставщиков, которые не совместимы с **Xamarin.Mac Mobile Framework**. Список поддерживаемых сборок, см. в разделе наших [сборки](~/cross-platform/internals/available-assemblies.md) документации.

Подробные сведения о требуемых версий .NET Framework и последствия выбора конкретного целевого объекта для приложения Xamarin.Mac, см. в разделе наших [целевых платформ](~/mac/platform/target-framework.md) документации. 

По сути, оно автоматизирует все действия, описанные в **обновления вручную** разделе представленные ниже и он предлагается преобразования существующего проекта Xamarin.Mac на единый API.

## <a name="steps-to-update-manually"></a>Действия для обновления вручную

Опять же после устранения предупреждения выполните следующие действия для ручного обновления приложений Xamarin.Mac для использования на новый единый API.

### <a name="1-update-project-type--build-target"></a>1. Тип обновления проекта & целевого объекта сборки

Изменение версии проекта в вашей **csproj** файлов из `42C0BBD9-55CE-4FC1-8D90-A7348ABAFB23` для `A3F8F2AB-B479-4A4A-A458-A89E7DC349F1`. Изменить **csproj** файл в текстовом редакторе, заменив первый элемент в `<ProjectTypeGuids>` элемент, как показано:

![](updating-mac-apps-images/csproj.png "Изменить csproj-файла в текстовом редакторе, заменив первый элемент в элемент ProjectTypeGuids, как показано")

Изменение **импорта** элемент, содержащий `Xamarin.Mac.targets` для `Xamarin.Mac.CSharp.targets` как показано:

![](updating-mac-apps-images/csproj2.png "Изменить элемент импорта, содержащий Xamarin.Mac.targets для Xamarin.Mac.CSharp.targets, как показано")

Добавьте следующие строки кода после `<AssemblyName>` элемент:

```xml
<TargetFrameworkVersion>v2.0</TargetFrameworkVersion>
<TargetFrameworkIdentifier>Xamarin.Mac</TargetFrameworkIdentifier>

```

Пример

![](updating-mac-apps-images/csproj3.png "Добавьте следующие строки кода после элемента < AssemblyName >")

### <a name="2-update-project-references"></a>2. Обновление ссылок проекта

Разверните проект приложения Mac **ссылки** узла. Первоначально будут отображены * неработающих - **XamMac** ссылку как на этом снимке экрана (так как мы только что изменили тип проекта):

![](updating-mac-apps-images/references.png "Он первоначально будут отображены ссылку разбить XamMac примерно")

Нажмите кнопку **значок шестеренки** рядом с **XamMac** запись и выберите **удалить** удалить неработающую ссылку.

После этого щелкните правой кнопкой мыши **ссылки** папку в **обозревателе решений** и выберите **изменить ссылки**. Прокрутите до нижней части списка ссылок и установите флажок помимо **Xamarin.Mac**.

![](updating-mac-apps-images/references2.png "Прокрутите до нижней части списка ссылок и установите флажок помимо Xamarin.Mac")

Нажмите клавишу **ОК** следует сохранить проект ссылки изменения.

### <a name="3-remove-monomac-from-namespaces"></a>3. Удалить MonoMac из пространства имен

Удалить **MonoMac** префикс пространства имен в `using` инструкций или везде, где classname полностью квалифицирован (например) `MonoMac.AppKit` становится просто `AppKit`).

### <a name="4-remap-types"></a>4. Сопоставление типов

[Собственные типы](~/cross-platform/macios/nativetypes.md) были представлены, которые заменяют некоторые типы, которые ранее были использованы, например для экземпляров `System.Drawing.RectangleF` с `CoreGraphics.CGRect` (к примеру). Полный список типов можно найти на [собственные типы](~/cross-platform/macios/nativetypes.md) страницы.

### <a name="5-fix-method-overrides"></a>5. Исправьте переопределения методов

Некоторые `AppKit` методы были изменены для использования нового подпись [собственные типы](~/cross-platform/macios/nativetypes.md) (такие как `nint`). Если пользовательские подклассы переопределить эти методы, подписи больше не будут соответствовать и приведет к ошибкам. Исправьте эти переопределения методов, изменив подкласс, в соответствии с новой подпись, используя собственные типы. 

## <a name="considerations"></a>Особенности

Следующие факторы следует принимать во внимание при преобразовании существующего проекта Xamarin.Mac из классический API в новый единый API, если приложение зависит от того, компонент или пакет NuGet. 

### <a name="components"></a>Компоненты

Любой компонент, который включен в приложении также потребуется обновить на единый API или при попытке компиляции возникнет конфликт. Для любой включен компонент замену текущей версии до новой версии из Store компонента Xamarin, который поддерживает единый API и выполните чистую сборку. Любой компонент, который еще не был преобразован автором, будут отображаться 32-разрядная версия только предупреждение в хранилище компонентов.

### <a name="nuget-support"></a>Поддержка NuGet

Хотя мы отправили изменения в NuGet для работы с поддержкой единый API, не было новую версию NuGet, поэтому мы при оценке способы получения NuGet для распознавания новых интерфейсов API. 

До этого времени, так же, как компоненты вам потребуется для переключения любой пакет NuGet в проекте версию, которая поддерживает унифицированными API и после выполнения чистой сборки.

> [!IMPORTANT]
> При наличии ошибки в форме _«ошибка 3 не может включать в один и тот же проект Xamarin.Mac «monomac.dll» и «Xamarin.Mac.dll» — «Xamarin.Mac.dll» указывается явным образом, хотя «monomac.dll» ссылается "xxx, версия = 0.0.000, язык и региональные параметры = neutral, PublicKeyToken = null'»_ после преобразования приложения Unified API-интерфейсам, это обычно из-за наличия компонента или пакета NuGet в проекте, который не был обновлен на единый API. Необходимо удалить существующий компонент/NuGet, обновление до версии, которая поддерживает унифицированными API и выполните чистую сборку.

## <a name="enabling-64-bit-builds-of-xamarinmac-apps"></a>Включение 64-разрядных сборок приложений Xamarin.Mac

Для мобильного приложения Xamarin.Mac, был преобразован в единый API разработчик по-прежнему необходимо позволяют построить приложение для 64-разрядных компьютерах из параметров приложения. См. в разделе **Включение 64 разрядных сборок из приложений Xamarin.Mac** из [32 или 64-разрядных платформ](~/cross-platform/macios/32-and-64/index.md) документа подробные инструкции по включению 64-разрядная версия сборки.
    
## <a name="finishing-up"></a>Завершение

Независимо от того, имеется ли вы решили использовать автоматический или ручной метод для преобразования приложения Xamarin.Mac из классической модели в Unified API-интерфейсы, существует несколько экземпляров, кроме того, требующих ручного вмешательства. См. наш [советы для обновления кода на единый API](~/cross-platform/macios/unified/updating-tips.md) Документирование известных проблем и обходных пути.

## <a name="related-links"></a>Связанные ссылки

- [Советы по обновлению кода в Unified API](~/cross-platform/macios/unified/updating-tips.md)
- [Работа с собственными типами в кроссплатформенных приложениях](~/cross-platform/macios/native-types-cross-platform.md)
- [Классический и отличия Unified API](https://developer.xamarin.com/releases/ios/api_changes/classic-vs-unified-8.6.0/)
