---
title: "Обновление существующего приложения Mac"
description: "Выполните следующие действия для обновления существующего приложения для использования API единой Xamarin.Mac."
ms.topic: article
ms.prod: xamarin
ms.assetid: 26673CC5-C1E5-4BAC-BEF4-9A386B296FD5
ms.technology: xamarin-cross-platform
author: asb3993
ms.author: amburns
ms.date: 03/29/2017
ms.openlocfilehash: 1967dea3b7f3a870950cdc7732292e9d4e24a1a8
ms.sourcegitcommit: 6cd40d190abe38edd50fc74331be15324a845a28
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/27/2018
---
# <a name="updating-existing-mac-apps"></a>Обновление существующего приложения Mac

_Выполните следующие действия для обновления существующего приложения для использования API единой Xamarin.Mac._

Обновление существующего приложения для использования API единой требует внесения изменений в самом файле проекта также относительно пространства имен и API, используемые в коде приложения.

# <a name="the-road-to-64-bits"></a>Пути к 64-разрядная

Новые API единой необходимы для поддержки 64-разрядных архитектур устройств из Xamarin.Mac приложения. Начиная с 1 февраля 2015 г. Apple требует, чтобы все новые отправки приложений в магазине приложений Mac поддерживают 64-разрядной архитектуры.

Xamarin предоставляет средства для Visual Studio для Mac и Visual Studio для автоматизации процесса миграции с классической API в единой API или файлов проекта можно преобразовать вручную. Хотя настоятельно рекомендуется с помощью автоматического средства, в этой статье будут рассмотрены оба метода.

## <a name="before-you-start"></a>Перед началом работы...

Перед обновлением существующего кода в единой API, настоятельно рекомендуется устранить все *предупреждения компиляции*. Многие *предупреждения* в классический API станет как ошибки, после перехода на единый. Исправления перед началом выполняется проще, поскольку сообщения компилятора из классический API часто содержат указания о том, что для обновления.


# <a name="automated-updating"></a>Автоматическое обновление

После устранения предупреждения, выберите существующий проект Mac в Visual Studio для Mac или Visual Studio и выберите **Миграция в единой API Xamarin.Mac** из **проекта** меню. Пример:

![](updating-mac-apps-images/beta-tool1.png "Выбрать миграции Xamarin.Mac единой API из меню "проект"")

Необходимо дать согласие на это предупреждение, перед запуском автоматической миграции (очевидно, что вам следует иметь резервные копии и системы управления версиями перед переходом на этом adventure):

![](updating-mac-apps-images/migrate01.png "Согласиться на это предупреждение перед запуском автоматической миграции")

Существует два поддерживаемых типов требуемой версии .NET Framework, которые могут быть выбраны при использовании API единой в приложении Xamarin.Mac:

- **Xamarin.Mac Mobile Framework** -это же настраиваемой .NET framework, используемой Xamarin.iOS и Xamarin.Android, поддерживающие подмножество полной **Desktop** framework. Это рекомендуемый framework, так как она обеспечивает меньшее среднее двоичные файлы из-за более высокой связывания поведение.
- **Xamarin.Mac .NET 4.5 Framework** -платформа, — это подмножество **Desktop** framework. Тем не менее, он урезает гораздо меньше полного **Desktop** framework, чем **Mobile** framework и должны _«работать»_ с большинством пакетов NuGet или библиотеки сторонних производителей. Это позволяет разработчикам использовать стандартный **Desktop** сборки, хотя по-прежнему используется поддерживаемых платформ, но этот параметр создает больших пакетов приложений. Это рекомендуемый framework, где используются сборки .NET сторонних производителей, не совместимы с **Xamarin.Mac Mobile Framework**. Список поддерживаемых сборок см. в разделе нашей [сборки](~/cross-platform/internals/available-assemblies.md) документации.

Подробные сведения о целевые платформы и последствия для выбора конкретного целевого приложения Xamarin.Mac, см. в разделе нашей [целевые платформы](~/mac/platform/target-framework.md) документации. 

По сути, средство автоматизирует все шаги, описанные в **обновление вручную** раздел представленные ниже и является предложенным методом преобразования существующего проекта Xamarin.Mac в единой API.

# <a name="steps-to-update-manually"></a>Действия для обновления вручную

Еще раз после устранения предупреждения выполните следующие действия для ручного обновления Xamarin.Mac приложений для использования нового единой API.

## <a name="1-update-project-type--build-target"></a>1. Тип обновления проекта и целевой объект построения

Изменить версию проекта в вашей **csproj** файлов из `42C0BBD9-55CE-4FC1-8D90-A7348ABAFB23` для `A3F8F2AB-B479-4A4A-A458-A89E7DC349F1`. Изменить **csproj** файл в текстовом редакторе, заменив первый элемент в `<ProjectTypeGuids>` элемента, как показано:

![](updating-mac-apps-images/csproj.png "Измените csproj-файле в текстовом редакторе, заменив первый элемент в элемент ProjectTypeGuids, как показано")

Изменение **импорта** элемент, содержащий `Xamarin.Mac.targets` для `Xamarin.Mac.CSharp.targets` следующим:

![](updating-mac-apps-images/csproj2.png "Изменить элемент Import, содержащий Xamarin.Mac.targets для Xamarin.Mac.CSharp.targets, как показано")

Добавьте следующие строки кода после `<AssemblyName>` элемента:

```xml
<TargetFrameworkVersion>v2.0</TargetFrameworkVersion>
<TargetFrameworkIdentifier>Xamarin.Mac</TargetFrameworkIdentifier>

```

Пример

![](updating-mac-apps-images/csproj3.png "Добавьте следующие строки кода после элемента < имя_сборки >")


## <a name="2-update-project-references"></a>2. Обновление ссылок проекта

Разверните узел проекта приложения Mac **ссылки** узла. Первоначально будут отображены * неработающие - **XamMac** ссылки как на следующий снимок экрана (так как мы только что изменили тип проекта):

![](updating-mac-apps-images/references.png "Он первоначально будут отображены ссылку неработающие XamMac похоже на этот снимок экрана")

Нажмите кнопку **значок шестеренки** рядом с **XamMac** запись и выберите **удалить** удалить поврежденную ссылку.

После этого щелкните правой кнопкой мыши **ссылки** папки в **обозревателе решений** и выберите **изменить ссылки**. Прокрутите вниз список ссылок и установите флажок помимо **Xamarin.Mac**.

![](updating-mac-apps-images/references2.png "Прокрутите вниз список ссылок и установите флажок помимо Xamarin.Mac")

Нажмите клавишу **ОК** сохранить ссылки на проект.

## <a name="3-remove-monomac-from-namespaces"></a>3. Удалите MonoMac из пространства имен

Удалить **MonoMac** префикс из пространства имен в `using` инструкции или везде, где classname полностью квалифицирован (например) `MonoMac.AppKit` становится просто `AppKit`).

## <a name="4-remap-types"></a>4. Сопоставление типов

[Собственные типы](~/cross-platform/macios/nativetypes.md) была введена которой заменить некоторые типы, которые ранее были использованы, такие как экземпляры компонента `System.Drawing.RectangleF` с `CoreGraphics.CGRect` (например). Полный список типов можно найти на [собственные типы](~/cross-platform/macios/nativetypes.md) страницы.

## <a name="5-fix-method-overrides"></a>5. Исправьте переопределения методов

Некоторые `AppKit` методы были изменены для использования новой подписи [собственные типы](~/cross-platform/macios/nativetypes.md) (такие как `nint`). Если пользовательские подклассов переопределить эти методы сигнатурами больше не будет соответствовать и приведет к ошибкам. Исправьте эти переопределения методов, изменив подкласс для сопоставления нового подпись, используя собственные типы. 

# <a name="considerations"></a>Особенности

Следующие факторы следует принимать во внимание при преобразовании существующего проекта Xamarin.Mac классический API в новый интерфейс API единой Если приложение зависит от компонента или пакета NuGet. 

## <a name="components"></a>Компоненты

Любой компонент, который включен в приложении также необходимо обновить в единой API или при компиляции возникнет конфликт. Для любого компонента включено заменить текущую версию с новой версией в магазине Xamarin компонента, поддерживающий API единой и выполните чистую сборку. Любой компонент, который еще не был преобразован автором, будут отображаться только предупреждение в хранилище компонентов 32-разрядная.


## <a name="nuget-support"></a>Поддержка NuGet

Пока мы публиковать изменения NuGet для работы с поддержкой единого API, не нового выпуска NuGet, поэтому мы оценке способы получения NuGet распознавать новые интерфейсы API. 

До этого времени, так же, как компоненты необходимо для переключения любой пакет NuGet, включенных в версию, которая поддерживает API-интерфейсы единого проект и затем выполните чистую сборку.

> [!IMPORTANT]
> **Примечание:** при наличии ошибки в виде _«ошибка 3 не может включать в том же проекте Xamarin.Mac «monomac.dll» и «Xamarin.Mac.dll» — «Xamarin.Mac.dll» упоминается явно, пока ссылается «monomac.dll» "xxx Версия = 0.0.000, язык и региональные параметры = neutral, PublicKeyToken = null'»_ после преобразования приложения единой API-интерфейсам, это обычно из-за наличия компонента или пакета NuGet в проект, который не был обновлен для API единой. Необходимо удалить существующий компонент/NuGet, обновите версию, которая поддерживает API-интерфейсы единой и выполните чистую сборку.




# <a name="enabling-64-bit-builds-of-xamarinmac-apps"></a>Включение 64-разрядных сборок Xamarin.Mac приложений

Для Xamarin.Mac мобильного приложения, преобразованное в единой API разработчику по-прежнему необходимо позволяют строить приложения для 64-разрядных компьютерах из параметров приложения. См. в разделе **Включение 64 разрядных сборок из Xamarin.Mac приложений** из [анализ 32 или 64-разрядной платформе](~/cross-platform/macios/32-and-64.md) документа подробные инструкции по включению 64-разрядных сборок.
    
# <a name="finishing-up"></a>Завершающие операции

Ли вы решили использовать автоматический или ручной метод для преобразования приложения Xamarin.Mac из классической единой API-интерфейсам, существует несколько экземпляров, кроме того, требующих ручного вмешательства. См. в разделе нашей [советы для обновления кода в единой API](~/cross-platform/macios/unified/updating-tips.md) документов для известных проблем и обходных пути.


## <a name="related-links"></a>Связанные ссылки

- [Советы по обновлению кода в Unified API](~/cross-platform/macios/unified/updating-tips.md)
- [Работа с собственными типами в кроссплатформенных приложениях](~/cross-platform/macios/native-types-cross-platform.md)
- [Классический vs отличия единой API](https://developer.xamarin.com/releases/ios/api_changes/classic-vs-unified-8.6.0/)
